import{j as e}from"./jsx-runtime-CBjAUaf4.js";import{r as u,R as re}from"./index-CoAThXCU.js";import{I as x,B as le}from"./api-input-Dr_LPgA6.js";import{L as ne}from"./listing-by-address-BB_rkcpP.js";import"./jsx-runtime-B2VJbz7C.js";import"./unified-address-search-Czsw31PV.js";function G({className:B,onComparablesFound:A,searchRadius:f=2}){const[j,Y]=u.useState(null),[o,k]=u.useState(null),[N,L]=u.useState([]),[v,D]=u.useState(!1),[w,g]=u.useState(null),[a,d]=u.useState({radius:f}),[P,H]=u.useState([]),[q,E]=u.useState(!1),[J,I]=u.useState(!1),W=async()=>{var h,y,n;const s=document.querySelector('input[placeholder*="API"]'),r=(h=s==null?void 0:s.value)==null?void 0:h.trim();if(r){E(!0);try{const m=await fetch("https://api.repliers.io/listings?aggregates=details.propertyType",{headers:{"REPLIERS-API-KEY":r}});if(m.ok){const c=await m.json();if(console.log("ðŸ“Š Property types aggregates response:",c),(n=(y=c.aggregates)==null?void 0:y.details)!=null&&n.propertyType){const l=c.aggregates.details.propertyType,i=Object.entries(l).sort(([,p],[,t])=>t-p).map(([p])=>p);H(i),console.log("ðŸ  Property types loaded:",i)}}else console.warn("âŒ Failed to fetch property types aggregates")}catch(m){console.warn("âŒ Error fetching property types:",m)}finally{E(!1)}}};re.useEffect(()=>{const s=()=>{P.length===0&&W()};s();const r=document.querySelector('input[placeholder*="API"]');if(r)return r.addEventListener("blur",s),()=>r.removeEventListener("blur",s)},[P.length]);const X=s=>{var h,y,n,m,c,l,i,p;const r={};if((h=s.details)!=null&&h.numBedrooms&&(r.numBedrooms=s.details.numBedrooms),(y=s.details)!=null&&y.numBathrooms&&(r.numBathrooms=s.details.numBathrooms),(n=s.map)!=null&&n.lat?r.lat=s.map.lat:(m=s.map)!=null&&m.latitude&&(r.lat=s.map.latitude),(c=s.map)!=null&&c.long?r.long=s.map.long:(l=s.map)!=null&&l.longitude&&(r.long=s.map.longitude),(i=s.details)!=null&&i.propertyType&&(r.propertyType=s.details.propertyType),(p=s.details)!=null&&p.sqft&&(r.sqft=s.details.sqft),typeof s.address=="object"&&s.address!==null&&"city"in s.address)r.city=s.address.city;else if(typeof s.address=="string"){const t=s.address.split(",");t.length>=2&&(r.city=t[t.length-2].trim())}return s.type&&(r.type=s.type),r},Q=s=>{if(Y(s),s){const r=X(s);k(r),d({...r,radius:f,status:"A",lastStatus:void 0,type:r.type,minBeds:r.numBedrooms,maxBeds:r.numBedrooms,minBaths:r.numBathrooms,maxBaths:r.numBathrooms,minSqft:r.sqft?r.sqft-100:void 0,maxSqft:r.sqft?r.sqft+100:void 0}),console.log("ðŸ  Listing selected:",s),console.log("ðŸ“Š Comparable data extracted:",r)}else k(null),d({radius:f});L([]),g(null),I(!1)},Z=async s=>{var y;if(s.preventDefault(),!j||!a){g("Please select a property listing first.");return}const r=document.querySelector('input[placeholder*="API"]'),h=(y=r==null?void 0:r.value)==null?void 0:y.trim();if(!h){g("API key is required to search for comparable properties.");return}D(!0),g(null),I(!0);try{const n=new URLSearchParams;a.status&&a.status.trim()&&n.append("status",a.status),a.lastStatus&&a.lastStatus.trim()&&a.status!=="A"&&n.append("lastStatus",a.lastStatus),a.type&&a.type.trim()&&n.append("type",a.type),a.propertyType&&a.propertyType.trim()&&n.append("propertyType",a.propertyType),a.minBeds!==void 0&&a.minBeds!==null&&!isNaN(a.minBeds)&&n.append("minBeds",a.minBeds.toString()),a.maxBeds!==void 0&&a.maxBeds!==null&&!isNaN(a.maxBeds)&&n.append("maxBeds",a.maxBeds.toString()),a.minBaths!==void 0&&a.minBaths!==null&&!isNaN(a.minBaths)&&n.append("minBaths",a.minBaths.toString()),a.maxBaths!==void 0&&a.maxBaths!==null&&!isNaN(a.maxBaths)&&n.append("maxBaths",a.maxBaths.toString()),a.minSqft!==void 0&&a.minSqft!==null&&!isNaN(a.minSqft)&&n.append("minSqft",a.minSqft.toString()),a.maxSqft!==void 0&&a.maxSqft!==null&&!isNaN(a.maxSqft)&&n.append("maxSqft",a.maxSqft.toString()),a.city&&a.city.trim()&&n.append("city",a.city),a.lat!==void 0&&a.lat!==null&&!isNaN(a.lat)&&n.append("lat",a.lat.toString()),a.long!==void 0&&a.long!==null&&!isNaN(a.long)&&n.append("long",a.long.toString()),a.radius!==void 0&&a.radius!==null&&!isNaN(a.radius)&&n.append("radius",a.radius.toString());const m=`https://api.repliers.io/listings?${n.toString()}`;console.log("ðŸ” Making comparables API request to:",m),console.log("ðŸ“Š Search parameters:",Object.fromEntries(n));const c=await fetch(m,{headers:{"REPLIERS-API-KEY":h}});if(console.log("ðŸ“¡ Comparables response status:",c.status,c.statusText),!c.ok){const t=await c.text();throw console.error("âŒ Comparables API Error:",t),new Error(`API request failed: ${c.status} ${c.statusText} - ${t}`)}const l=await c.json();console.log("ðŸ“¦ Comparables API Response:",l);let i=[];if(l.data&&Array.isArray(l.data))i=l.data;else if(l.results&&Array.isArray(l.results))i=l.results;else if(l.listings&&Array.isArray(l.listings))i=l.listings;else if(l.items&&Array.isArray(l.items))i=l.items;else if(l.properties&&Array.isArray(l.properties))i=l.properties;else if(Array.isArray(l))i=l;else if(l.count>0){for(const t of Object.keys(l))if(typeof l[t]=="object"&&l[t]!==null&&!["apiVersion","page","numPages","pageSize","count"].includes(t))if(Array.isArray(l[t])){i=l[t];break}else{i=[l[t]];break}}console.log("ðŸ“‹ Extracted comparable listings:",i),console.log("ðŸ“‹ Comparable listings count:",i.length);const p=i.map((t,ae)=>{var F,O,R,U,$,K;const M=t.listDate||t.soldDate||t.closingDate;let b=null;if(M)try{const T=new Date(M),te=new Date().getTime()-T.getTime();b=Math.floor(te/(1e3*3600*24)),b<0&&(b=0)}catch(T){console.warn("Error calculating days on market:",T),b=t.daysOnMarket||t.dom||t.daysonmarket||null}else b=t.daysOnMarket||t.dom||t.daysonmarket||null;return{id:t.mlsNumber||t.id||t.mls||`comparable-${ae}`,address:C(t.address),price:t.listPrice||t.price||t.soldPrice||0,beds:((F=t.details)==null?void 0:F.numBedrooms)||t.beds||0,baths:((O=t.details)==null?void 0:O.numBathrooms)||t.baths||0,sqft:((R=t.details)==null?void 0:R.sqft)||t.sqft||0,pricePerSqft:t.listPrice&&((U=t.details)!=null&&U.sqft)?Math.round(t.listPrice/t.details.sqft):0,yearBuilt:(($=t.details)==null?void 0:$.yearBuilt)||t.yearBuilt||null,daysOnMarket:b,distance:0,lastSoldDate:t.soldDate||t.listDate||t.closingDate||new Date().toISOString(),propertyType:((K=t.details)==null?void 0:K.propertyType)||t.propertyType||"Unknown",imageUrl:void 0}});L(p),A==null||A(p),p.length===0?g("No comparable properties found with the current search criteria. Try adjusting your filters."):setTimeout(()=>{const t=document.querySelector("#comparable-results");t&&t.scrollIntoView({behavior:"smooth",block:"start"})},100)}catch(n){console.error("ðŸ’¥ Error in handleFindComparables:",n),g(n instanceof Error?n.message:"Failed to fetch comparable properties. Please try again.")}finally{D(!1)}},ee=s=>`$${s.toLocaleString()}`,se=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),C=s=>{if(typeof s=="string")return s;if(typeof s=="object"&&s!==null){const r=[];return s.streetNumber&&r.push(s.streetNumber),s.streetName&&r.push(s.streetName),s.streetSuffix&&r.push(s.streetSuffix),s.city&&r.push(s.city),s.state&&r.push(s.state),(s.zip||s.postalCode)&&r.push(s.zip||s.postalCode),r.length>0?r.join(" "):"Address not available"}return"Address not available"};return e.jsx("div",{className:B,children:e.jsxs("form",{onSubmit:Z,className:"space-y-6",children:[e.jsx(ne,{onListingSelected:Q,showDetails:!1,className:"mb-6"}),j&&o&&e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-white shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Selected Property for Comparable Search"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Property Details"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Address: "}),e.jsx("span",{className:"font-medium",children:C(j.address)})]}),o.numBedrooms&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Bedrooms: "}),e.jsx("span",{className:"font-medium",children:o.numBedrooms})]}),o.numBathrooms&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Bathrooms: "}),e.jsx("span",{className:"font-medium",children:o.numBathrooms})]}),o.sqft&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Square Footage: "}),e.jsx("span",{className:"font-medium",children:o.sqft.toLocaleString()})]}),o.propertyType&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Property Type: "}),e.jsx("span",{className:"font-medium",children:o.propertyType})]}),o.city&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"City: "}),e.jsx("span",{className:"font-medium",children:o.city})]}),o.type&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Listing Type: "}),e.jsx("span",{className:"font-medium capitalize",children:o.type})]}),o.lat&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Latitude: "}),e.jsx("span",{className:"font-medium",children:o.lat.toFixed(6)})]}),o.long&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Longitude: "}),e.jsx("span",{className:"font-medium",children:o.long.toFixed(6)})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Search Parameters"}),e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs font-semibold text-gray-800 uppercase tracking-wide mb-2 border-b border-gray-200 pb-1",children:"Status/Type Filters"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Status:"}),e.jsxs("select",{value:a.status||"A",onChange:s=>{const r=s.target.value||void 0;d({...a,status:r,lastStatus:r==="A"?void 0:a.lastStatus})},className:"h-8 text-sm border border-gray-300 rounded-md px-2 w-full",children:[e.jsx("option",{value:"A",children:"A - Available"}),e.jsx("option",{value:"U",children:"U - Unavailable (Sold/Leased)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Last Status:"}),e.jsxs("select",{value:a.lastStatus||"",onChange:s=>d({...a,lastStatus:s.target.value||void 0}),disabled:a.status==="A",className:`h-8 text-sm border border-gray-300 rounded-md px-2 w-full ${a.status==="A"?"bg-gray-100 text-gray-400 cursor-not-allowed":""}`,children:[e.jsx("option",{value:"",children:"Select Last Status"}),e.jsx("option",{value:"Sld",children:"Sld - Sold"}),e.jsx("option",{value:"Lsd",children:"Lsd - Leased"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Listing Type:"}),e.jsxs("select",{value:a.type||"sale",onChange:s=>d({...a,type:s.target.value||void 0}),className:"h-8 text-sm border border-gray-300 rounded-md px-2 w-full",children:[e.jsx("option",{value:"sale",children:"Sale"}),e.jsx("option",{value:"lease",children:"Lease"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs font-semibold text-gray-800 uppercase tracking-wide mb-2 border-b border-gray-200 pb-1",children:"Property Characteristics"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Property Type:"}),e.jsxs("select",{value:a.propertyType||"",onChange:s=>d({...a,propertyType:s.target.value||void 0}),disabled:q,className:`h-8 text-sm border border-gray-300 rounded-md px-2 w-full ${q?"bg-gray-100 text-gray-400":""}`,children:[e.jsx("option",{value:"",children:q?"Loading...":"Select Property Type"}),P.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Min Beds:"}),e.jsx(x,{type:"number",value:a.minBeds||"",onChange:s=>d({...a,minBeds:s.target.value?Number(s.target.value):void 0}),className:"h-8 text-sm",min:"0",max:"20"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Max Beds:"}),e.jsx(x,{type:"number",value:a.maxBeds||"",onChange:s=>d({...a,maxBeds:s.target.value?Number(s.target.value):void 0}),className:"h-8 text-sm",min:"0",max:"20"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Min Baths:"}),e.jsx(x,{type:"number",value:a.minBaths||"",onChange:s=>d({...a,minBaths:s.target.value?Number(s.target.value):void 0}),className:"h-8 text-sm",min:"0",max:"20",step:"0.5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Max Baths:"}),e.jsx(x,{type:"number",value:a.maxBaths||"",onChange:s=>d({...a,maxBaths:s.target.value?Number(s.target.value):void 0}),className:"h-8 text-sm",min:"0",max:"20",step:"0.5"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Min Sqft:"}),e.jsx(x,{type:"number",value:a.minSqft||"",onChange:s=>d({...a,minSqft:s.target.value?Number(s.target.value):void 0}),className:"h-8 text-sm",min:"0",max:"50000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Max Sqft:"}),e.jsx(x,{type:"number",value:a.maxSqft||"",onChange:s=>d({...a,maxSqft:s.target.value?Number(s.target.value):void 0}),className:"h-8 text-sm",min:"0",max:"50000"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs font-semibold text-gray-800 uppercase tracking-wide mb-2 border-b border-gray-200 pb-1",children:"Location Parameters"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"City:"}),e.jsx(x,{type:"text",value:a.city||"",onChange:s=>d({...a,city:s.target.value||void 0}),className:"h-8 text-sm"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Latitude:"}),e.jsx(x,{type:"number",value:a.lat!==void 0?a.lat.toFixed(6):"",onChange:s=>d({...a,lat:s.target.value?Number(s.target.value):void 0}),className:"h-8 text-sm",step:"0.000001",min:"-90",max:"90"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Longitude:"}),e.jsx(x,{type:"number",value:a.long!==void 0?a.long.toFixed(6):"",onChange:s=>d({...a,long:s.target.value?Number(s.target.value):void 0}),className:"h-8 text-sm",step:"0.000001",min:"-180",max:"180"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Search Radius (km):"}),e.jsx(x,{type:"number",value:a.radius||"",onChange:s=>d({...a,radius:s.target.value?Number(s.target.value):void 0}),className:"h-8 text-sm",min:"0.1",max:"10",step:"0.1"})]})]})]})]})]})]})]}),j&&a&&e.jsx("div",{className:"flex justify-center",children:e.jsx(le,{type:"submit",disabled:v,className:"px-8 py-2",children:v?"Searching...":"Find Comparables"})}),w&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-800",children:w})}),v&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Searching for comparable properties..."})]}),N.length>0&&!v&&e.jsxs("div",{id:"comparable-results",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-xl font-semibold",children:["Comparable Properties (",N.length,")"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Within ",a.radius||f," km"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:N.map(s=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded p-3 hover:shadow-sm transition-all duration-200 hover:border-gray-300",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-1 leading-tight",children:C(s.address)}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-lg font-bold text-green-600",children:ee(s.price)}),e.jsx("span",{className:"px-1.5 py-0.5 text-xs font-medium bg-blue-100 text-blue-800 rounded",children:s.propertyType})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-1.5 mb-2",children:[e.jsxs("div",{className:"text-center p-1.5 bg-gray-50 rounded text-xs",children:[e.jsx("div",{className:"text-sm font-bold text-gray-900",children:s.beds}),e.jsx("div",{className:"text-xs text-gray-600",children:"Beds"})]}),e.jsxs("div",{className:"text-center p-1.5 bg-gray-50 rounded text-xs",children:[e.jsx("div",{className:"text-sm font-bold text-gray-900",children:s.baths}),e.jsx("div",{className:"text-xs text-gray-600",children:"Baths"})]}),e.jsxs("div",{className:"text-center p-1.5 bg-gray-50 rounded text-xs",children:[e.jsx("div",{className:"text-sm font-bold text-gray-900",children:s.sqft||"N/A"}),e.jsx("div",{className:"text-xs text-gray-600",children:"Sq Ft"})]}),e.jsxs("div",{className:"text-center p-1.5 bg-gray-50 rounded text-xs",children:[e.jsx("div",{className:"text-sm font-bold text-gray-900",children:s.yearBuilt||"N/A"}),e.jsx("div",{className:"text-xs text-gray-600",children:"Built"})]})]}),e.jsxs("div",{className:"space-y-0.5 text-xs",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"MLS #:"}),e.jsx("span",{className:"font-medium text-gray-900",children:s.id})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Days on Market:"}),e.jsx("span",{className:"font-medium text-gray-900",children:s.daysOnMarket||"N/A"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Listed Date:"}),e.jsx("span",{className:"font-medium text-gray-900",children:se(s.lastSoldDate)})]})]})]},s.id))})]}),N.length===0&&!v&&j&&J&&w===null&&e.jsx("div",{className:"text-center py-8",children:e.jsxs("p",{className:"text-gray-600",children:["No comparable properties found within"," ",a.radius||f," km. Try increasing the search radius."]})})]})})}G.__docgenInfo={description:`ComparablesByAddressSearch Component

@description A component that allows users to search for comparable properties by address using Google Places API
@param props - The component props
@returns JSX.Element`,methods:[],displayName:"ComparablesByAddressSearch",props:{className:{required:!1,tsType:{name:"string"},description:""},onComparablesFound:{required:!1,tsType:{name:"signature",type:"function",raw:"(comparables: ComparableProperty[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"ComparableProperty"}],raw:"ComparableProperty[]"},name:"comparables"}],return:{name:"void"}}},description:""},searchRadius:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"2.0",computed:!1}}}};const ue={title:"POCS/Comparables/ComparablesByAddressSearch",component:G,parameters:{layout:"padded",docs:{description:{component:"A comprehensive component for searching comparable properties by address using Google Places API integration."}}},tags:["autodocs"],argTypes:{className:{control:"text",description:"Additional CSS classes to apply to the component"},onComparablesFound:{action:"comparables-found",description:"Callback function called when comparable properties are found"},searchRadius:{control:{type:"number",min:.1,max:5,step:.1},description:"Search radius in miles"}}},S={args:{searchRadius:2},decorators:[B=>e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsx(B,{})})],parameters:{docs:{description:{story:"The default configuration with standard search parameters. Users can search for an address and find comparable properties within 2 km."}}}};var z,_,V;S.parameters={...S.parameters,docs:{...(z=S.parameters)==null?void 0:z.docs,source:{originalSource:`{
  args: {
    searchRadius: 2.0
  },
  decorators: [Story => <div className="max-w-4xl mx-auto p-6">
        <Story />
      </div>],
  parameters: {
    docs: {
      description: {
        story: "The default configuration with standard search parameters. Users can search for an address and find comparable properties within 2 km."
      }
    }
  }
}`,...(V=(_=S.parameters)==null?void 0:_.docs)==null?void 0:V.source}}};const he=["Default"];export{S as Default,he as __namedExportsOrder,ue as default};
