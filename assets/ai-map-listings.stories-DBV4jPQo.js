import{j as t}from"./jsx-runtime-xF634gn_.js";import{r as g}from"./index-C-7etoUd.js";import{m as Ne}from"./mapbox-gl-vCdO7wfF.js";import{B as kt,C as Nt}from"./car-CJRJwKAe.js";import{B as $e}from"./bath-D_6pRDEi.js";import{X as pt}from"./x-C6fJ-1bL.js";import{L as Lt}from"./loader-circle-x9Fu845P.js";import{S as Et,C as It,M as ot}from"./search-CpmvFUy8.js";import{c as Fe}from"./createLucideIcon-BmJP7rG3.js";import{H as ze,B as at}from"./house-C1D6uJK2.js";import{C as mt}from"./chevron-down-BzbnjZNy.js";/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Bt=Fe("circle-check",Mt);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qt=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],Dt=Fe("dollar-sign",qt);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]],Rt=Fe("sparkles",At),zt=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),$t=e=>{if(!e)return"N/A";const s=e.numBedrooms,o=e.numBedroomsPlus;return s&&o&&o>0?`${s} + ${o}`:(s==null?void 0:s.toString())||"N/A"},Ft=e=>{if(!e)return"N/A";const s=e.numBathrooms,o=e.numBathroomsPlus;return s&&o&&o>0?`${s} + ${o}`:(s==null?void 0:s.toString())||"N/A"},Ot=e=>{var s;return e&&((s=e.numGarageSpaces)==null?void 0:s.toString())||"N/A"},Wt=(e,s)=>s==="New"||s==="Pc"||s==="Ext"?e==="Sale"?"For Sale":e==="Lease"?"For Lease":e||null:s?{Sus:"Suspended",Exp:"Expired",Sld:"Sold",Ter:"Terminated",Dft:"Deal Fell Through",Lsd:"Leased",Sc:"Sold Conditionally",Sce:"Sold Conditionally (Escape Clause)",Lc:"Leased Conditionally",Cs:"Coming Soon"}[s]||s:null,_t=e=>{if(!e)return"Address not available";const o=[e.streetNumber,e.streetDirection,e.streetName,e.streetSuffix].filter(Boolean).join(" "),r=[e.city,e.state].filter(Boolean).join(", ");return[o,r].filter(Boolean).join(", ")},gt=({type:e,lastStatus:s,size:o="sm"})=>{const r=Wt(e,s);if(!r)return null;let p="bg-green-100 text-green-600";switch(r){case"For Sale":p="bg-green-100 text-green-600";break;case"For Lease":p="bg-purple-100 text-purple-600";break;case"Sold":p="bg-blue-100 text-blue-600";break;case"Leased":p="bg-purple-100 text-purple-600";break;case"Sold Conditionally":case"Sold Conditionally (Escape Clause)":case"Leased Conditionally":p="bg-amber-100 text-amber-600";break;case"Coming Soon":p="bg-indigo-100 text-indigo-600";break;case"Suspended":p="bg-orange-100 text-orange-600";break;case"Expired":p="bg-gray-100 text-gray-500";break;case"Terminated":case"Deal Fell Through":p="bg-red-100 text-red-600";break;default:p="bg-gray-100 text-gray-500"}const f=o==="xs"?"text-xs":"text-sm";return t.jsx("span",{className:`${f} px-2 py-1 rounded-md font-medium ${p}`,children:r})};gt.__docgenInfo={description:"",methods:[],displayName:"StatusTag",props:{type:{required:!1,tsType:{name:"string"},description:""},lastStatus:{required:!1,tsType:{name:"string"},description:""},size:{required:!1,tsType:{name:"union",raw:'"xs" | "sm"',elements:[{name:"literal",value:'"xs"'},{name:"literal",value:'"sm"'}]},description:"",defaultValue:{value:'"sm"',computed:!1}}}};function Oe({listing:e,onClick:s}){var o,r;return t.jsx("div",{className:"p-4 cursor-pointer hover:bg-gray-50 transition-colors duration-200",onClick:s,children:t.jsxs("div",{className:"flex items-start gap-4",children:[t.jsx("div",{className:"bg-gray-100 rounded-md overflow-hidden flex-shrink-0 h-20 aspect-[4/3]",children:(o=e.images)!=null&&o[0]?t.jsx("img",{src:`https://cdn.repliers.io/${e.images[0]}?class=small`,alt:"Property",className:"object-cover w-full h-full"}):t.jsx("div",{className:"flex items-center justify-center h-full text-gray-400 text-sm",children:"No Image"})}),t.jsxs("div",{className:"flex-grow min-w-0",children:[t.jsxs("div",{className:"flex justify-between items-start mb-2",children:[t.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[t.jsx("h4",{className:"font-semibold text-gray-800 truncate text-base",children:e.listPrice?zt(e.listPrice):"Price N/A"}),t.jsx("span",{className:"text-gray-400 text-sm",children:"|"}),t.jsx("span",{className:"text-gray-600 truncate text-sm",children:e.mlsNumber})]}),t.jsx("div",{className:"flex-shrink-0 ml-2",children:t.jsx(gt,{type:e.type,lastStatus:e.lastStatus,size:"sm"})})]}),t.jsx("p",{className:"text-gray-600 leading-relaxed text-sm mb-2",children:_t(e.address)}),t.jsxs("div",{className:"flex items-center text-gray-500 space-x-3 flex-wrap text-sm",children:[t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(kt,{className:"w-4 h-4"}),$t(e.details)]}),t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx($e,{className:"w-4 h-4"}),Ft(e.details)]}),t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(Nt,{className:"w-4 h-4"}),Ot(e.details)]}),((r=e.details)==null?void 0:r.propertyType)&&t.jsxs("span",{className:"text-gray-400",children:["| ",e.details.propertyType]})]})]})]})})}Oe.__docgenInfo={description:"",methods:[],displayName:"ListingPreview",props:{listing:{required:!0,tsType:{name:"ListingResult"},description:""},onClick:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};function ft({open:e,onClose:s,listing:o,position:r,mapContainer:p}){const f=g.useRef(null),[a,h]=g.useState({x:0,y:0}),[I,j]=g.useState("bottom"),[l,c]=g.useState(!1);if(g.useEffect(()=>{c(!1)},[e]),g.useEffect(()=>{if(!e||!f.current||!p)return;const v=f.current.getBoundingClientRect(),w=r.x,y=r.y,m=450,E=v.height||200,z=16,D=window.innerWidth,d=window.innerHeight;let k=w-m/2,M=y-E-16,Y="bottom";k<z?k=z:k+m>D-z&&(k=D-m-z),M<z&&(M=y+32,Y="top"),M+E>d-z&&(w>D/2?(k=w-m-16,M=y-E/2,Y="right"):(k=w+16,M=y-E/2,Y="left"),M<z&&(M=z),M+E>d-z&&(M=d-E-z)),h({x:k,y:M}),j(Y),c(!0)},[e,r,p]),g.useEffect(()=>{const u=v=>{f.current&&!f.current.contains(v.target)&&s()};return e&&document.addEventListener("mousedown",u),()=>{document.removeEventListener("mousedown",u)}},[e,s]),!e||!o)return null;const N=()=>{const u="absolute w-3 h-3 bg-white transform rotate-45 border";switch(I){case"bottom":return`${u} -bottom-1.5 left-1/2 -translate-x-1/2 border-r border-b border-gray-200`;case"top":return`${u} -top-1.5 left-1/2 -translate-x-1/2 border-l border-t border-gray-200`;case"left":return`${u} -left-1.5 top-1/2 -translate-y-1/2 border-l border-b border-gray-200`;case"right":return`${u} -right-1.5 top-1/2 -translate-y-1/2 border-r border-t border-gray-200`;default:return`${u} -bottom-1.5 left-1/2 -translate-x-1/2 border-r border-b border-gray-200`}};return t.jsx("div",{ref:f,className:"fixed w-[450px]",style:{zIndex:9999,left:`${a.x}px`,top:`${a.y}px`,visibility:l?"visible":"hidden",opacity:l?1:0,transition:"opacity 150ms ease-in-out"},children:t.jsxs("div",{className:"bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden relative",children:[t.jsx("div",{className:N()}),t.jsx("button",{onClick:s,className:"absolute top-2 right-2 z-10 p-1 rounded-full bg-white hover:bg-gray-100 transition-colors shadow-sm border border-gray-200","aria-label":"Close",children:t.jsx(pt,{size:16,className:"text-gray-600"})}),t.jsx(Oe,{listing:o,onClick:()=>{}})]})})}ft.__docgenInfo={description:"",methods:[],displayName:"PropertyTooltip",props:{open:{required:!0,tsType:{name:"boolean"},description:""},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},listing:{required:!0,tsType:{name:"union",raw:"ListingResult | null",elements:[{name:"ListingResult"},{name:"null"}]},description:""},position:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  x: number;
  y: number;
}`,signature:{properties:[{key:"x",value:{name:"number",required:!0}},{key:"y",value:{name:"number",required:!0}}]}},description:""},mapContainer:{required:!0,tsType:{name:"union",raw:"HTMLElement | null",elements:[{name:"HTMLElement"},{name:"null"}]},description:""}}};function yt({open:e,onClose:s,properties:o,position:r,mapContainer:p}){const f=g.useRef(null),[a,h]=g.useState({x:0,y:0}),[I,j]=g.useState("bottom"),[l,c]=g.useState(!1);if(g.useEffect(()=>{if(!e){c(!1);return}},[e]),g.useEffect(()=>{if(!e||!p)return;const u=r.x,v=r.y,w=480,y=Math.min(o.length*120+80,400),m=16,E=window.innerWidth,z=window.innerHeight;let D=u-w/2,d=v-y-16,k="bottom";D<m?D=m:D+w>E-m&&(D=E-w-m),d<m&&(d=v+32,k="top"),d+y>z-m&&(u>E/2?(D=u-w-16,d=v-y/2,k="right"):(D=u+16,d=v-y/2,k="left"),d<m&&(d=m),d+y>z-m&&(d=z-y-m)),h({x:D,y:d}),j(k),c(!0)},[e,r,p,o.length]),g.useEffect(()=>{const u=v=>{f.current&&!f.current.contains(v.target)&&s()};return e&&document.addEventListener("mousedown",u),()=>{document.removeEventListener("mousedown",u)}},[e,s]),!e||o.length===0)return null;const N=()=>{const u="absolute w-3 h-3 bg-white transform rotate-45 border";switch(I){case"bottom":return`${u} -bottom-1.5 left-1/2 -translate-x-1/2 border-r border-b border-gray-200`;case"top":return`${u} -top-1.5 left-1/2 -translate-x-1/2 border-l border-t border-gray-200`;case"left":return`${u} -left-1.5 top-1/2 -translate-y-1/2 border-l border-b border-gray-200`;case"right":return`${u} -right-1.5 top-1/2 -translate-y-1/2 border-r border-t border-gray-200`;default:return`${u} -bottom-1.5 left-1/2 -translate-x-1/2 border-r border-b border-gray-200`}};return t.jsx("div",{ref:f,className:"fixed w-[480px]",style:{zIndex:9999,left:`${a.x}px`,top:`${a.y}px`,visibility:l?"visible":"hidden",opacity:l?1:0,transition:"opacity 150ms ease-in-out"},children:t.jsxs("div",{className:"bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden relative",children:[t.jsx("div",{className:N()}),t.jsxs("div",{className:"px-4 py-3 border-b border-gray-100 bg-gray-50 relative",children:[t.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:o.length===1?"1 Property":`${o.length} Properties`}),t.jsx("button",{onClick:s,className:"absolute top-2 right-2 p-1 rounded-full bg-white hover:bg-gray-100 transition-colors shadow-sm border border-gray-200","aria-label":"Close",children:t.jsx(pt,{size:16,className:"text-gray-600"})})]}),t.jsx("div",{className:"max-h-[400px] overflow-y-auto",children:o.map((u,v)=>t.jsx("div",{className:"border-b border-gray-100 last:border-b-0",children:t.jsx(Oe,{listing:u,onClick:()=>{}})},`${u.mlsNumber}-${v}`))})]})})}yt.__docgenInfo={description:"",methods:[],displayName:"ClusterTooltip",props:{open:{required:!0,tsType:{name:"boolean"},description:""},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},properties:{required:!0,tsType:{name:"Array",elements:[{name:"ListingResult"}],raw:"ListingResult[]"},description:""},position:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  x: number;
  y: number;
}`,signature:{properties:[{key:"x",value:{name:"number",required:!0}},{key:"y",value:{name:"number",required:!0}}]}},description:""},mapContainer:{required:!0,tsType:{name:"union",raw:"HTMLElement | null",elements:[{name:"HTMLElement"},{name:"null"}]},description:""}}};const it="i'm looking for a 2 bedroom 2 bathroom condo to rent in rosedale",Ht=50;function ht({value:e,onChange:s,onFocus:o,onSearch:r,isSearching:p,placeholder:f}){const[a,h]=g.useState(""),[I,j]=g.useState(!0);g.useEffect(()=>{e.length>0&&j(!1)},[e]),g.useEffect(()=>{if(I)if(a.length<it.length){const c=setTimeout(()=>{h(it.slice(0,a.length+1))},Ht);return()=>clearTimeout(c)}else{const c=setTimeout(()=>{h("")},2e3);return()=>clearTimeout(c)}},[a,I]);const l=c=>{c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),r())};return t.jsxs("div",{style:{position:"relative"},children:[t.jsx("textarea",{value:e,onChange:c=>s(c.target.value),onKeyDown:l,placeholder:a,rows:1,style:{width:"100%",height:"120px",padding:"20px 60px 20px 20px",fontSize:"16px",border:"2px solid #e5e7eb",borderRadius:"12px",background:"#f9fafb",outline:"none",transition:"all 200ms ease",resize:"none",fontFamily:"inherit",lineHeight:"1.5",verticalAlign:"top"},onFocus:c=>{c.currentTarget.style.borderColor="#6366f1",c.currentTarget.style.background="white",c.currentTarget.style.boxShadow="0 0 0 3px rgba(99, 102, 241, 0.1)",o()},onBlur:c=>{c.currentTarget.style.borderColor="#e5e7eb",c.currentTarget.style.background="#f9fafb",c.currentTarget.style.boxShadow="none"}}),t.jsx("button",{onClick:r,disabled:p||!e.trim(),style:{position:"absolute",right:"16px",bottom:"16px",width:"32px",height:"32px",background:p||!e.trim()?"#d1d5db":"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)",border:"none",borderRadius:"6px",boxShadow:"0 2px 8px rgba(79, 70, 229, 0.3)",cursor:p||!e.trim()?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 200ms ease",color:"white"},onMouseEnter:c=>{!p&&e.trim()&&(c.currentTarget.style.transform="scale(1.05)",c.currentTarget.style.boxShadow="0 4px 12px rgba(79, 70, 229, 0.4)")},onMouseLeave:c=>{c.currentTarget.style.transform="scale(1)",c.currentTarget.style.boxShadow="0 2px 8px rgba(79, 70, 229, 0.3)"},children:p?t.jsx(Lt,{size:14,className:"animate-spin"}):t.jsx(Et,{size:14})})]})}ht.__docgenInfo={description:"",methods:[],displayName:"SearchInput",props:{value:{required:!0,tsType:{name:"string"},description:""},onChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(value: string) => void",signature:{arguments:[{type:{name:"string"},name:"value"}],return:{name:"void"}}},description:""},onFocus:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onSearch:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},isSearching:{required:!0,tsType:{name:"boolean"},description:""},placeholder:{required:!1,tsType:{name:"string"},description:""}}};function xt({prompt:e,url:s,summary:o,filters:r}){const f=(()=>{const a=[],I=new URL(s).searchParams;if(r.neighborhood&&a.push({label:"Neighborhood",value:r.neighborhood,icon:t.jsx(ot,{size:14})}),r.city&&a.push({label:"City",value:r.city,icon:t.jsx(ot,{size:14})}),r.propertyTypes&&r.propertyTypes.length>0?a.push({label:"Property Type",value:r.propertyTypes.join(", "),icon:t.jsx(ze,{size:14})}):I.get("class")&&a.push({label:"Property Type",value:I.get("class")||"",icon:t.jsx(ze,{size:14})}),r.bedrooms?a.push({label:"Bedrooms",value:r.bedrooms==="5+"?"5+":r.bedrooms,icon:t.jsx(at,{size:14})}):I.get("minBeds")&&a.push({label:"Bedrooms",value:`${I.get("minBeds")}+`,icon:t.jsx(at,{size:14})}),r.bathrooms?a.push({label:"Bathrooms",value:r.bathrooms,icon:t.jsx($e,{size:14})}):I.get("minBaths")&&a.push({label:"Bathrooms",value:`${I.get("minBaths")}+`,icon:t.jsx($e,{size:14})}),r.minPrice||r.maxPrice){const j=[];r.minPrice&&j.push(`$${r.minPrice.toLocaleString()}+`),r.maxPrice&&j.push(`up to $${r.maxPrice.toLocaleString()}`),a.push({label:"Price Range",value:j.join(" "),icon:t.jsx(Dt,{size:14})})}return r.listingType&&a.push({label:"Listing Type",value:r.listingType==="sale"?"For Sale":"For Rent",icon:t.jsx(ze,{size:14})}),a})();return t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[t.jsxs("div",{style:{background:"linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%)",borderRadius:"12px",padding:"12px 16px",border:"1px solid #d1d5db"},children:[t.jsx("div",{style:{fontSize:"10px",fontWeight:"700",color:"#6b7280",marginBottom:"6px",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Your Search"}),t.jsxs("div",{style:{fontSize:"14px",color:"#1f2937",fontWeight:"500"},children:['"',e,'"']})]}),t.jsxs("div",{style:{background:"linear-gradient(135deg, #eef2ff 0%, #e0e7ff 100%)",borderRadius:"12px",padding:"12px 16px",border:"1px solid #c7d2fe"},children:[t.jsxs("div",{style:{fontSize:"10px",fontWeight:"700",color:"#6366f1",marginBottom:"8px",textTransform:"uppercase",letterSpacing:"0.5px",display:"flex",alignItems:"center",gap:"4px"},children:[t.jsx(Bt,{size:12}),"Understood As"]}),t.jsx("div",{style:{fontSize:"13px",color:"#4338ca",marginBottom:"12px",fontWeight:"500"},children:o}),f.length>0&&t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:f.map((a,h)=>t.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:"4px",padding:"4px 10px",background:"white",borderRadius:"6px",fontSize:"11px",fontWeight:"600",color:"#4338ca",border:"1px solid #c7d2fe"},children:[a.icon,t.jsxs("span",{style:{color:"#6b7280"},children:[a.label,":"]}),t.jsx("span",{children:a.value})]},h))})]}),t.jsxs("div",{style:{fontSize:"11px",color:"#6b7280",display:"flex",alignItems:"center",gap:"4px",padding:"4px 0"},children:[t.jsx(It,{size:12}),"Use advanced filters below to refine your search further"]})]})}xt.__docgenInfo={description:"",methods:[],displayName:"SearchFeedback",props:{prompt:{required:!0,tsType:{name:"string"},description:""},url:{required:!0,tsType:{name:"string"},description:""},summary:{required:!0,tsType:{name:"string"},description:""},filters:{required:!0,tsType:{name:"any"},description:""}}};function Ut(e){const[s,o]=g.useState(!1),[r,p]=g.useState(null),[f,a]=g.useState(null);return{processSearch:async j=>{var l;if(!j.trim())return p("Please enter a search query"),null;o(!0),p(null);try{const c={prompt:j.trim(),...f&&{nlpId:f}};console.log("ðŸ” NLP Request:",c);const N=await fetch("https://api.repliers.io/nlp",{method:"POST",headers:{"REPLIERS-API-KEY":e,"Content-Type":"application/json"},body:JSON.stringify(c)});if(N.status===406)throw new Error(`That doesn't seem to be a property search. Try something like "2 bedroom condo in Toronto"`);if(N.status===401)throw new Error("Invalid API key. Please check your Repliers API key.");if(N.status===429)throw new Error("Too many requests. Please wait a moment and try again.");if(!N.ok)throw new Error(`Search failed: ${N.status} ${N.statusText}`);const u=await N.json();return console.log("âœ… FULL NLP RESPONSE:",JSON.stringify(u,null,2)),console.log("ðŸ“Š NLP Response Breakdown:",{nlpId:u.nlpId,url:u.request.url,summary:u.request.summary,body:u.request.body,imageSearchItems:(l=u.request.body)==null?void 0:l.imageSearchItems,locations:u.request.locations,fullResponse:u}),a(u.nlpId),u}catch(c){const N=c instanceof Error?c.message:"Search failed";return p(N),null}finally{o(!1)}},isProcessing:s,error:r,nlpId:f,resetNlpId:()=>{a(null)}}}function Yt(e){const o=new URL(e).searchParams,r={},p=o.get("propertyType");p&&(r.propertyTypes=p.split(",").map(m=>m.trim()));const f=o.get("minBeds");if(f){const m=parseInt(f);m===0?r.bedrooms="0":m===1?r.bedrooms="1":m===2?r.bedrooms="2":m===3?r.bedrooms="3":m===4?r.bedrooms="4":m>=5&&(r.bedrooms="5+")}const a=o.get("minBaths");if(a){const m=parseInt(a);m===1?r.bathrooms="1+":m===2?r.bathrooms="2+":m===3?r.bathrooms="3+":m===4?r.bathrooms="4+":m>=5&&(r.bathrooms="5+")}const h=o.get("minPrice");h&&(r.minPrice=parseInt(h));const I=o.get("maxPrice");I&&(r.maxPrice=parseInt(I));const j=o.get("minSqft");j&&(r.minSqft=parseInt(j));const l=o.get("maxSqft");l&&(r.maxSqft=parseInt(l));const c=o.get("minParkingSpaces");c&&(r.garageSpaces=`${c}+`);const N=o.get("type");N==="sale"||N==="Sale"?r.listingType="sale":(N==="lease"||N==="Lease")&&(r.listingType="lease");const u=o.get("status");u==="A"?r.activeListingDays="all":u==="U"?r.unavailableListingDays="all":u==="S"&&(r.soldListingDays="all");const v=o.get("city");v&&(r.city=v);const w=o.get("neighborhood");w&&(r.neighborhood=w);const y=o.get("map");if(y)try{const m=JSON.parse(y);Array.isArray(m)&&(r.map=m)}catch{}return r}function Gt(e){return e.request.summary||""}function Jt(e){const s=e.request.locations;if(!s||s.length===0)return console.log("No locations in NLP response"),null;const o=s[0],r=o.map;if(!r)return console.log("No map data in NLP location"),null;const p=[parseFloat(r.longitude),parseFloat(r.latitude)];let f;r.boundary&&Array.isArray(r.boundary)&&(f=r.boundary);const a=o.type==="neighborhood"?14:o.type==="city"?11:o.type==="area"?10:12;return console.log("ðŸ“ Extracted location from NLP response:",{name:o.name,type:o.type,center:p,zoom:a,hasBounds:!!f}),{center:p,bounds:f,zoom:a}}function bt({bedrooms:e,bathrooms:s,onBedroomsChange:o,onBathroomsChange:r}){const p=["all","0","1","2","3","4","5+"],f=["all","1+","2+","3+","4+","5+"];return t.jsxs("div",{children:[t.jsxs("div",{style:{marginBottom:"16px"},children:[t.jsx("div",{style:{fontSize:"12px",fontWeight:"600",color:"#6b7280",marginBottom:"8px",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Bedrooms"}),t.jsx("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:p.map(a=>t.jsx("button",{onClick:()=>o(a),style:{padding:"10px 18px",background:e===a?"#6366f1":"white",color:e===a?"white":"#374151",border:`1px solid ${e===a?"#6366f1":"#d1d5db"}`,borderRadius:"8px",fontSize:"14px",fontWeight:e===a?"600":"400",cursor:"pointer",transition:"all 200ms ease",minWidth:"48px"},onMouseEnter:h=>{e!==a&&(h.currentTarget.style.background="#f3f4f6",h.currentTarget.style.borderColor="#9ca3af")},onMouseLeave:h=>{e!==a&&(h.currentTarget.style.background="white",h.currentTarget.style.borderColor="#d1d5db")},children:a==="all"?"Any":a},a))})]}),t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"12px",fontWeight:"600",color:"#6b7280",marginBottom:"8px",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Bathrooms"}),t.jsx("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:f.map(a=>t.jsx("button",{onClick:()=>r(a),style:{padding:"10px 18px",background:s===a?"#6366f1":"white",color:s===a?"white":"#374151",border:`1px solid ${s===a?"#6366f1":"#d1d5db"}`,borderRadius:"8px",fontSize:"14px",fontWeight:s===a?"600":"400",cursor:"pointer",transition:"all 200ms ease",minWidth:"48px"},onMouseEnter:h=>{s!==a&&(h.currentTarget.style.background="#f3f4f6",h.currentTarget.style.borderColor="#9ca3af")},onMouseLeave:h=>{s!==a&&(h.currentTarget.style.background="white",h.currentTarget.style.borderColor="#d1d5db")},children:a==="all"?"Any":a},a))})]})]})}bt.__docgenInfo={description:"",methods:[],displayName:"BedroomBathroomFilter",props:{bedrooms:{required:!0,tsType:{name:"string"},description:""},bathrooms:{required:!0,tsType:{name:"string"},description:""},onBedroomsChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(value: string) => void",signature:{arguments:[{type:{name:"string"},name:"value"}],return:{name:"void"}}},description:""},onBathroomsChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(value: string) => void",signature:{arguments:[{type:{name:"string"},name:"value"}],return:{name:"void"}}},description:""}}};function St({filters:e,onFiltersChange:s,apiKey:o}){const[r,p]=g.useState([]),[f,a]=g.useState(!0),[h,I]=g.useState(!1);g.useEffect(()=>{(async()=>{var v,w;try{const y=new URL("https://api.repliers.io/listings");y.searchParams.set("aggregates","details.propertyType"),y.searchParams.set("listings","false"),y.searchParams.set("status","A");const m=await fetch(y.toString(),{headers:{"REPLIERS-API-KEY":o,"Content-Type":"application/json"}});if(!m.ok)throw new Error(`Failed to fetch property types: ${m.status}`);const z=((w=(v=(await m.json()).aggregates)==null?void 0:v.details)==null?void 0:w.propertyType)||{},D=Object.entries(z).sort(([,d],[,k])=>k-d).map(([d])=>d);p(D)}catch{}finally{a(!1)}})()},[o]);const j=u=>{const w=e.propertyTypes.includes(u)?e.propertyTypes.filter(y=>y!==u):[...e.propertyTypes,u];s({...e,propertyTypes:w})},l=()=>{const u=e.propertyTypes.length===r.length;s({...e,propertyTypes:u?[]:[...r]})};if(f)return t.jsx("div",{style:{position:"relative",marginBottom:"12px"},children:t.jsx("div",{style:{padding:"8px 12px",fontSize:"12px",color:"#6b7280",fontStyle:"italic"},children:"Loading property types..."})});const c=e.propertyTypes.length===0||e.propertyTypes.length===r.length,N=e.propertyTypes.length>0&&e.propertyTypes.length<r.length;return t.jsxs("div",{style:{position:"relative",marginBottom:"12px"},children:[t.jsxs("button",{onClick:()=>I(!h),style:{width:"100%",padding:"8px 12px",backgroundColor:"white",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",textAlign:"left"},children:[t.jsx("span",{children:c?"All property types":N?`${e.propertyTypes.length} selected`:"Select property types"}),t.jsx(mt,{size:16,style:{transform:h?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"}})]}),h&&t.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:"white",border:"1px solid #d1d5db",borderRadius:"6px",marginTop:"4px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",zIndex:1002,maxHeight:"300px",overflowY:"auto"},children:[t.jsxs("div",{onClick:l,style:{padding:"8px 12px",fontSize:"14px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",backgroundColor:c?"#f3f4f6":"white",borderBottom:"1px solid #f3f4f6"},onMouseEnter:u=>{c||(u.currentTarget.style.backgroundColor="#f9fafb")},onMouseLeave:u=>{c||(u.currentTarget.style.backgroundColor="white")},children:[t.jsx("div",{style:{width:"16px",height:"16px",border:"2px solid #d1d5db",borderRadius:"3px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:c?"#10b981":"white",borderColor:c?"#10b981":"#d1d5db"},children:c&&t.jsx("svg",{width:"10",height:"8",viewBox:"0 0 10 8",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M8.5 1L3.5 6L1.5 4",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),"All property types"]}),r.map(u=>{const v=e.propertyTypes.includes(u);return t.jsxs("div",{onClick:()=>j(u),style:{padding:"8px 12px",fontSize:"14px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",backgroundColor:v?"#f3f4f6":"white"},onMouseEnter:w=>{v||(w.currentTarget.style.backgroundColor="#f9fafb")},onMouseLeave:w=>{v||(w.currentTarget.style.backgroundColor="white")},children:[t.jsx("div",{style:{width:"16px",height:"16px",border:"2px solid #d1d5db",borderRadius:"3px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:v?"#10b981":"white",borderColor:v?"#10b981":"#d1d5db"},children:v&&t.jsx("svg",{width:"10",height:"8",viewBox:"0 0 10 8",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M8.5 1L3.5 6L1.5 4",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),u]},u)})]})]})}St.__docgenInfo={description:"",methods:[],displayName:"PropertyTypeFilter",props:{filters:{required:!0,tsType:{name:"MapFilters"},description:""},onFiltersChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(filters: MapFilters) => void",signature:{arguments:[{type:{name:"MapFilters"},name:"filters"}],return:{name:"void"}}},description:""},apiKey:{required:!0,tsType:{name:"string"},description:""}}};const Xt=["2 bedroom 2 bath condo in rosedale","3+ bed house in north york close to the highway","waterfront properties for rent in downtown toronto"];function wt({filters:e,onFiltersChange:s,onSearch:o,apiKey:r,onMapUpdate:p}){const[f,a]=g.useState(!1),[h,I]=g.useState(!1),[j,l]=g.useState(""),[c,N]=g.useState(null),u=g.useRef(null),{processSearch:v,isProcessing:w,error:y,resetNlpId:m}=Ut(r),E=d=>{l(d),d!==j&&(m(),c&&d!==c.summary&&N(null))};g.useEffect(()=>{const d=k=>{u.current&&!u.current.contains(k.target)&&a(!1)};return f&&document.addEventListener("mousedown",d),()=>{document.removeEventListener("mousedown",d)}},[f]),g.useEffect(()=>{const d=k=>{k.key==="Escape"&&f&&a(!1)};return document.addEventListener("keydown",d),()=>{document.removeEventListener("keydown",d)}},[f]);const z=()=>{a(!0)},D=async d=>{const k=d||j;if(!k.trim())return;d&&l(d);const M=await v(k);if(M){const Y=Yt(M.request.url),ce={...e,...Y};if(s(ce),p)if(Y.map){const ee=Y.map[0];if(ee&&ee.length>0){const ue=ee.map(fe=>fe[0]),be=ee.map(fe=>fe[1]),Se=Math.min(...ue),Ie=Math.max(...ue),we=Math.min(...be),ge=Math.max(...be),oe=(Se+Ie)/2,x=(we+ge)/2;p({center:[oe,x],bounds:Y.map,zoom:12})}}else{const ee=Jt(M);ee&&p({center:ee.center,bounds:ee.bounds,zoom:ee.zoom})}const me=Gt(M);me&&l(me),N({prompt:k,url:M.request.url,summary:me,filters:Y}),await(o==null?void 0:o(j))}};return t.jsxs("div",{ref:u,style:{position:"absolute",top:"16px",left:"16px",width:"600px",maxWidth:"calc(100vw - 32px)",background:"white",borderRadius:"16px",padding:"0",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.08)",zIndex:1e3,transition:"all 300ms ease-out",maxHeight:f?"90vh":"auto",overflow:"visible"},children:[t.jsx(ht,{value:j,onChange:E,onFocus:z,onSearch:D,isSearching:w,placeholder:"Search properties..."}),y&&t.jsx("div",{style:{margin:"12px 16px",padding:"12px 16px",background:"#fef2f2",border:"1px solid #fecaca",borderRadius:"8px",color:"#dc2626",fontSize:"14px"},children:y}),t.jsxs("div",{style:{maxHeight:f?"600px":"0",opacity:f?1:0,overflow:"hidden",transition:"max-height 300ms ease-out, opacity 300ms ease-out",marginTop:f?"20px":"0",padding:f?"0 16px 16px 16px":"0"},children:[!h&&!c&&t.jsxs("div",{children:[t.jsxs("div",{style:{fontSize:"11px",fontWeight:"700",color:"#9ca3af",marginBottom:"12px",textTransform:"uppercase",letterSpacing:"1px",display:"flex",alignItems:"center",gap:"6px"},children:[t.jsx(Rt,{size:14}),"Try These Searches"]}),t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:Xt.map((d,k)=>t.jsx("button",{onClick:()=>D(d),disabled:w,style:{padding:"12px 16px",background:"linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%)",border:"1px solid #e5e7eb",borderRadius:"12px",fontSize:"14px",color:"#374151",textAlign:"left",cursor:w?"not-allowed":"pointer",transition:"all 200ms ease",fontWeight:"500"},onMouseEnter:M=>{w||(M.currentTarget.style.background="linear-gradient(135deg, #eef2ff 0%, #e0e7ff 100%)",M.currentTarget.style.borderColor="#c7d2fe",M.currentTarget.style.transform="translateX(4px)")},onMouseLeave:M=>{M.currentTarget.style.background="linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%)",M.currentTarget.style.borderColor="#e5e7eb",M.currentTarget.style.transform="translateX(0)"},children:d},k))}),t.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, #e5e7eb 50%, transparent)",margin:"16px 0"}})]}),!h&&c&&t.jsxs("div",{children:[t.jsx(xt,{prompt:c.prompt,url:c.url,summary:c.summary,filters:c.filters}),t.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, #e5e7eb 50%, transparent)",margin:"16px 0"}})]}),t.jsxs("button",{onClick:()=>I(!h),style:{width:"100%",padding:"12px 16px",background:"transparent",border:"1px solid #e5e7eb",borderRadius:"10px",fontSize:"14px",fontWeight:"600",color:"#6366f1",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",transition:"all 200ms ease"},onMouseEnter:d=>{d.currentTarget.style.background="#f9fafb",d.currentTarget.style.borderColor="#6366f1"},onMouseLeave:d=>{d.currentTarget.style.background="transparent",d.currentTarget.style.borderColor="#e5e7eb"},children:[t.jsxs("span",{children:[h?"Hide":"Show"," Advanced Filters"]}),t.jsx(mt,{size:18,style:{transform:h?"rotate(180deg)":"rotate(0deg)",transition:"transform 200ms ease"}})]}),h&&t.jsxs("div",{style:{marginTop:"16px"},children:[t.jsx("div",{style:{marginBottom:"16px"},children:t.jsxs("select",{value:e.listingType||"sale",onChange:d=>s({...e,listingType:d.target.value}),style:{width:"100%",padding:"10px 12px",background:"white",border:"1px solid #d1d5db",borderRadius:"8px",fontSize:"14px",color:"#374151",cursor:"pointer"},children:[t.jsx("option",{value:"sale",children:"For Sale"}),t.jsx("option",{value:"lease",children:"For Lease"})]})}),t.jsx("div",{style:{marginBottom:"16px"},children:t.jsx(St,{filters:e,onFiltersChange:s,apiKey:r})}),t.jsxs("div",{style:{marginBottom:"16px"},children:[t.jsx("div",{style:{fontSize:"12px",fontWeight:"600",color:"#6b7280",marginBottom:"8px",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Price Range"}),t.jsxs("div",{style:{display:"flex",gap:"8px"},children:[t.jsx("input",{type:"number",placeholder:"Min",value:e.minPrice||"",onChange:d=>s({...e,minPrice:d.target.value?parseInt(d.target.value):void 0}),style:{flex:1,padding:"10px 12px",border:"1px solid #d1d5db",borderRadius:"8px",fontSize:"14px",outline:"none"}}),t.jsx("input",{type:"number",placeholder:"Max",value:e.maxPrice||"",onChange:d=>s({...e,maxPrice:d.target.value?parseInt(d.target.value):void 0}),style:{flex:1,padding:"10px 12px",border:"1px solid #d1d5db",borderRadius:"8px",fontSize:"14px",outline:"none"}})]})]}),t.jsx("div",{style:{marginBottom:"16px"},children:t.jsx(bt,{bedrooms:e.bedrooms||"all",bathrooms:e.bathrooms||"all",onBedroomsChange:d=>s({...e,bedrooms:d}),onBathroomsChange:d=>s({...e,bathrooms:d})})})]})]})]})}wt.__docgenInfo={description:"",methods:[],displayName:"SearchPanel",props:{filters:{required:!0,tsType:{name:"MapFilters"},description:""},onFiltersChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(filters: MapFilters) => void",signature:{arguments:[{type:{name:"MapFilters"},name:"filters"}],return:{name:"void"}}},description:""},apiKey:{required:!0,tsType:{name:"string"},description:""},onSearch:{required:!1,tsType:{name:"signature",type:"function",raw:"(query: string) => void",signature:{arguments:[{type:{name:"string"},name:"query"}],return:{name:"void"}}},description:""},onMapUpdate:{required:!1,tsType:{name:"signature",type:"function",raw:"(update: { center?: [number, number]; bounds?: number[][][]; zoom?: number }) => void",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{ center?: [number, number]; bounds?: number[][][]; zoom?: number }",signature:{properties:[{key:"center",value:{name:"tuple",raw:"[number, number]",elements:[{name:"number"},{name:"number"}],required:!1}},{key:"bounds",value:{name:"Array",elements:[{name:"Array",elements:[{name:"Array",elements:[{name:"number"}],raw:"number[]"}],raw:"number[][]"}],raw:"number[][][]",required:!1}},{key:"zoom",value:{name:"number",required:!1}}]}},name:"update"}],return:{name:"void"}}},description:""}}};const Kt=(e,s)=>{const o=(r,p)=>r>=100?`${Math.round(r)}${p}`:r>=10?`${Math.round(r*10)/10}${p}`:`${Math.round(r*100)/100}${p}`;if(s==="Lease"){if(e>=1e3){const r=e/1e3;return o(r,"K")}return Math.round(e).toString()}else{if(e>=999500){const r=e/1e6;return o(r,"M")}else if(e>=1e3){const r=e/1e3;return o(r,"K")}return Math.round(e).toString()}},Qt=(e,s,o)=>e==="U"&&(s==="Sld"||s==="Sc")?"#8b7fa8":e==="U"?"#f59e0b":o==="Lease"?"#a855f7":"#22c55e",Zt=(e,s,o,r)=>{const p=Kt(e,s),f=Qt(o,r,s),a=document.createElement("div");return a.style.cssText=`
    background-color: ${f};
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 600;
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    white-space: nowrap;
    pointer-events: auto;
    cursor: pointer;
  `,a.textContent=p,a},We=e=>{var s,o,r,p,f,a,h,I;return(s=e.coordinates)!=null&&s.lat&&((o=e.coordinates)!=null&&o.lng)?{lat:e.coordinates.lat,lng:e.coordinates.lng}:e.latitude&&e.longitude?{lat:e.latitude,lng:e.longitude}:(r=e.map)!=null&&r.latitude&&((p=e.map)!=null&&p.longitude)?{lat:e.map.latitude,lng:e.map.longitude}:(f=e.location)!=null&&f.latitude&&((a=e.location)!=null&&a.longitude)?{lat:e.location.latitude,lng:e.location.longitude}:(h=e.center)!=null&&h.lat&&((I=e.center)!=null&&I.lng)?{lat:e.center.lat,lng:e.center.lng}:null},_e=e=>{if(e.length===0)return null;let s=e[0].lat,o=e[0].lat,r=e[0].lng,p=e[0].lng;return e.forEach(f=>{s=Math.max(s,f.lat),o=Math.min(o,f.lat),r=Math.max(r,f.lng),p=Math.min(p,f.lng)}),{north:s,south:o,east:r,west:p}},He=(e,s)=>{const{north:o,south:r,east:p,west:f}=s,a=20,h=(o-r)/a,I=(p-f)/a,j=Array(a).fill(0).map(()=>Array(a).fill(0));e.forEach(v=>{const w=Math.floor((v.lat-r)/h),y=Math.floor((v.lng-f)/I),m=Math.max(0,Math.min(a-1,w)),E=Math.max(0,Math.min(a-1,y));j[m][E]++});let l=0,c=0,N=0;for(let v=0;v<a;v++)for(let w=0;w<a;w++)j[v][w]>l&&(l=j[v][w],c=r+(v+.5)*h,N=f+(w+.5)*I);return l>0?[N,c]:[(p+f)/2,(o+r)/2]},Vt=e=>{try{const s=localStorage.getItem(`mapListings-autoCenter-${e}`);if(s){const o=JSON.parse(s);if(Date.now()-o.timestamp<1440*60*1e3)return{center:o.center}}}catch{}return null},Ee=(e,s)=>{try{const o={...s,timestamp:Date.now()};localStorage.setItem(`mapListings-autoCenter-${e}`,JSON.stringify(o))}catch{}},er=async(e,s="average")=>{var o,r,p,f,a,h,I,j;try{const c=await fetch("https://api.repliers.io/listings",{method:"POST",headers:{"REPLIERS-API-KEY":e,"Content-Type":"application/json"},body:JSON.stringify({queries:[{cluster:!0,clusterPrecision:8,clusterLimit:50,status:"A"},{cluster:!1,listings:!0,pageSize:500,status:"A"}]})});if(c.status===400)return lt(e,s);if(!c.ok)throw new Error(`Bundled auto-center API Error: ${c.status} ${c.statusText}`);const N=await c.json(),u=N[0]||{},v=N[1]||{},w=((r=(o=u.aggregates)==null?void 0:o.map)==null?void 0:r.clusters)||u.clusters||[],y=v.listings||v.results||[];if(s==="city"&&w.length>0){let d=null,k=0;if(w.forEach(M=>{const Y=M.count||0;Y>k&&(k=Y,d=M)}),d){const M=[((p=d.location)==null?void 0:p.longitude)||((f=d.coordinates)==null?void 0:f.lng)||d.longitude||((a=d.center)==null?void 0:a.lng),((h=d.location)==null?void 0:h.latitude)||((I=d.coordinates)==null?void 0:I.lat)||d.latitude||((j=d.center)==null?void 0:j.lat)];if(M[0]&&M[1]){const ce={center:[M[0],M[1]]};return Ee(`${e}-${s}`,ce),ce}}}if(y.length===0)return null;const m=[];if(y.forEach(d=>{const k=We(d);k&&m.push(k)}),m.length===0)return null;const E=_e(m);if(!E)return null;const D={center:He(m,E)};return Ee(`${e}-${s}`,D),D}catch{return lt(e,s)}},lt=async(e,s="average")=>{var o,r,p,f,a,h,I,j;try{let l=[],c=[];if(s==="city")try{const y=new URL("https://api.repliers.io/listings");y.searchParams.set("cluster","true"),y.searchParams.set("clusterPrecision","8"),y.searchParams.set("clusterLimit","50"),y.searchParams.set("status","A");const m=await fetch(y.toString(),{headers:{"REPLIERS-API-KEY":e,"Content-Type":"application/json"}});if(m.ok){const E=await m.json();l=((r=(o=E.aggregates)==null?void 0:o.map)==null?void 0:r.clusters)||E.clusters||[]}}catch{}try{const y=new URL("https://api.repliers.io/listings");y.searchParams.set("pageSize","500"),y.searchParams.set("status","A");const m=await fetch(y.toString(),{headers:{"REPLIERS-API-KEY":e,"Content-Type":"application/json"}});if(m.ok){const E=await m.json();c=E.listings||E.results||[]}}catch{}if(s==="city"&&l.length>0){let y=null,m=0;if(l.forEach(E=>{const z=E.count||0;z>m&&(m=z,y=E)}),y){const E=[((p=y.location)==null?void 0:p.longitude)||((f=y.coordinates)==null?void 0:f.lng)||y.longitude||((a=y.center)==null?void 0:a.lng),((h=y.location)==null?void 0:h.latitude)||((I=y.coordinates)==null?void 0:I.lat)||y.latitude||((j=y.center)==null?void 0:j.lat)];if(E[0]&&E[1]){const D={center:[E[0],E[1]]};return Ee(`${e}-${s}`,D),D}}}if(c.length===0)return null;const N=[];if(c.forEach(y=>{const m=We(y);m&&N.push(m)}),N.length===0)return null;const u=_e(N);if(!u)return null;const w={center:He(N,u)};return Ee(`${e}-${s}`,w),w}catch{return null}};function Pt({apiKey:e,mapboxToken:s,initialCenter:o,initialZoom:r,height:p="100%",width:f="100%",mapStyle:a="mapbox://styles/mapbox/streets-v12",centerCalculation:h="average",showPropertyCount:I=!0}){const j=g.useRef(null),l=g.useRef(null),[c,N]=g.useState(null),[u,v]=g.useState(0),[w,y]=g.useState(o||null),[m,E]=g.useState(r||null),z=g.useRef(null),D=g.useRef(null),[d,k]=g.useState(!1),[M,Y]=g.useState(null),[ce,me]=g.useState({x:0,y:0}),[ee,ue]=g.useState(!1),[be,Se]=g.useState([]),[Ie,we]=g.useState({x:0,y:0}),ge=g.useRef([]),oe=g.useRef(null),[x,fe]=g.useState({listingType:"sale",propertyTypes:[],bedrooms:"all",bathrooms:"all",garageSpaces:"all",openHouse:"all"}),vt=g.useCallback(P=>{fe(P)},[]),Tt=g.useCallback(P=>{l.current&&P.center&&l.current.easeTo({center:P.center,zoom:P.zoom||l.current.getZoom(),duration:1e3})},[]),Pe=g.useCallback(()=>{ge.current.forEach(P=>P.remove()),ge.current=[]},[]),Me=g.useCallback(P=>{l.current&&(Pe(),P.forEach(i=>{if("isProperty"in i.properties&&i.properties.isProperty&&i.properties.listPrice){const{listPrice:q,status:b,lastStatus:C}=i.properties,B=i.properties.type||"Sale",[L,O]=i.geometry.coordinates;if(isNaN(L)||isNaN(O)||L===null||O===null)return;const S=typeof q=="string"?parseFloat(q):q;if(isNaN(S))return;const W=Zt(S,B,b,C),H=new Ne.Marker({element:W,anchor:"bottom",offset:[0,-5]}).setLngLat([L,O]).addTo(l.current);W.addEventListener("click",async re=>{var de;const G=re.clientX,_=re.clientY;if(me({x:G,y:_}),i.properties.address&&i.properties.images){const se={mlsNumber:i.properties.mlsNumber||"N/A",listPrice:S,address:i.properties.address,details:i.properties.details,images:i.properties.images,type:i.properties.type,lastStatus:i.properties.lastStatus,status:i.properties.status};Y(se),k(!0);return}try{const se=await fetch(`https://api.repliers.io/listings?mlsNumber=${i.properties.mlsNumber}&fields=address.*,details.*,images,type,lastStatus,status,class`,{headers:{"REPLIERS-API-KEY":e,"Content-Type":"application/json"}});if(!se.ok)throw new Error(`Failed to fetch property details: ${se.status}`);const ne=(de=(await se.json()).listings)==null?void 0:de[0];if(ne){const ae={mlsNumber:i.properties.mlsNumber||"N/A",listPrice:S,address:ne.address,details:ne.details,images:ne.images,type:ne.type||i.properties.type,lastStatus:ne.lastStatus,status:ne.status};Y(ae),k(!0)}else{const ae={mlsNumber:i.properties.mlsNumber||"N/A",listPrice:S,address:i.properties.address,details:i.properties.details,images:i.properties.images,type:i.properties.type,lastStatus:i.properties.lastStatus,status:i.properties.status};Y(ae),k(!0)}}catch{const ye={mlsNumber:i.properties.mlsNumber||"N/A",listPrice:S,address:i.properties.address,details:i.properties.details,images:i.properties.images,type:i.properties.type,lastStatus:i.properties.lastStatus,status:i.properties.status};Y(ye),k(!0)}}),ge.current.push(H)}}))},[Pe,e]);g.useEffect(()=>{(async()=>{if(w&&m)return;const i=Vt(`${e}-${h}`);if(i){y(i.center),E(r||10);return}const q=await er(e,h);q?(y(q.center),E(r||10)):(y([-98.5795,39.8283]),E(r||10))})()},[e,w,m,h,r]);const Ue=g.useCallback(P=>P<=6?5:P<=8?8:P<=10?12:P<=12?16:P<=14?20:P<=17?25:29,[]),ve=g.useCallback(P=>{const i=P.getSouthWest(),q=P.getNorthEast();return[[[i.lng,i.lat],[q.lng,i.lat],[q.lng,q.lat],[i.lng,q.lat],[i.lng,i.lat]]]},[]),Be=g.useCallback((P,i,q)=>{const b={};if(P==="active"){if(b.status="A",i!=="all"){const C=new Date;if(i.endsWith("+")){const B=parseInt(i.replace("+","")),L=new Date(C);L.setDate(L.getDate()-B),b.maxListDate=L.toISOString().split("T")[0]}else{const B=parseInt(i),L=new Date(C);L.setDate(L.getDate()-B),b.minListDate=L.toISOString().split("T")[0]}}}else if(P==="sold"){b.status="U",b.lastStatus="Sld";const C=parseInt(i);if(C>=2007&&C<=2025)b.minSoldDate=`${i}-01-01`,b.maxSoldDate=`${i}-12-31`;else{const B=new Date,L=new Date(B);L.setDate(L.getDate()-C),b.minSoldDate=L.toISOString().split("T")[0],b.maxSoldDate=B.toISOString().split("T")[0]}}else if(P==="unavailable"){b.status="U";const C=parseInt(i);if(C>=2007&&C<=2025)b.minUnavailableDate=`${i}-01-01`,b.maxUnavailableDate=`${i}-12-31`;else{const B=new Date,L=new Date(B);L.setDate(L.getDate()-C),b.minUnavailableDate=L.toISOString().split("T")[0],b.maxUnavailableDate=B.toISOString().split("T")[0]}}if(x.listingType==="sale"?b.type="Sale":x.listingType==="lease"&&(b.type="Lease"),x.propertyTypes.length===1&&(b["details.propertyType"]=x.propertyTypes[0]),x.minPrice&&x.minPrice>0&&(b.minPrice=x.minPrice),x.maxPrice&&x.maxPrice>0&&(b.maxPrice=x.maxPrice),x.bedrooms&&x.bedrooms!=="all"&&(x.bedrooms==="5+"?b.minBedrooms=5:(b.minBedrooms=parseInt(x.bedrooms),b.maxBedrooms=parseInt(x.bedrooms))),x.bathrooms&&x.bathrooms!=="all"&&(b.minBaths=parseInt(x.bathrooms.replace("+",""))),x.garageSpaces&&x.garageSpaces!=="all"&&(b.minGarageSpaces=parseInt(x.garageSpaces.replace("+",""))),x.minSqft&&x.minSqft>0&&(b.minSqft=x.minSqft),x.maxSqft&&x.maxSqft>0&&(b.maxSqft=x.maxSqft),x.openHouse&&x.openHouse!=="all"){const C=new Date;C.setHours(0,0,0,0);let B=null,L=null;if(x.openHouse==="today")B=C,L=C;else if(x.openHouse==="thisWeekend"){const O=C.getDay(),S=O===0?6:6-O,W=new Date(C);W.setDate(C.getDate()+S);const H=new Date(W);H.setDate(W.getDate()+1),B=W,L=H}else if(x.openHouse==="thisWeek"){B=C;const O=new Date(C);O.setDate(C.getDate()+(7-C.getDay())),L=O}else x.openHouse==="anytime"&&(B=C);B&&(b.minOpenHouseDate=B.toISOString().split("T")[0],L&&(b.maxOpenHouseDate=L.toISOString().split("T")[0]))}return b},[x]),qe=g.useCallback((P,i)=>{const[q,b]=P,[C,B]=i,L=6371e3,O=(B-b)*Math.PI/180,S=(C-q)*Math.PI/180,W=Math.sin(O/2)*Math.sin(O/2)+Math.cos(b*Math.PI/180)*Math.cos(B*Math.PI/180)*Math.sin(S/2)*Math.sin(S/2),H=2*Math.atan2(Math.sqrt(W),Math.sqrt(1-W));return L*H},[]),Te=g.useCallback((P,i)=>{const q=[],b=new Set;return P.forEach((C,B)=>{if(b.has(B))return;const L=[C];b.add(B);const O=C.geometry.coordinates;P.forEach((S,W)=>{if(b.has(W)||B===W)return;const H=S.geometry.coordinates;qe(O,H)<=i&&(L.push(S),b.add(W))}),q.push(L)}),q},[qe]),Ye=g.useCallback((P,i)=>{const q=i<=10?30:i<=12?60:i<=13?100:30,b=i<=10?500:i<=12?300:i<=13?200:100,C=P.filter(S=>S.properties.count<=q),B=P.filter(S=>S.properties.count>q);if(C.length===0)return P;const O=Te(C,b).map(S=>{if(S.length===1)return S[0];const W=S.reduce((G,_)=>G+_.properties.count,0),H=S.reduce((G,_)=>G+_.geometry.coordinates[0],0)/S.length,re=S.reduce((G,_)=>G+_.geometry.coordinates[1],0)/S.length;return{type:"Feature",properties:{count:W,precision:S[0].properties.precision,id:`merged-${S.map(G=>G.properties.id).join("-")}`,members:[]},geometry:{type:"Point",coordinates:[H,re]}}});return[...B,...O]},[Te]),Ce=g.useCallback(async P=>{var L,O;if(!l.current)return;const i=l.current.getZoom(),q=Ue(i),b=JSON.stringify(ve(P)),C=Math.round(i*2)/2,B=JSON.stringify(x);if(!(D.current&&D.current.bounds===b&&Math.abs(D.current.zoom-C)<.5&&D.current.filters===B)){D.current={bounds:b,zoom:C,filters:B},z.current=i,N(null);try{const S=[];x.activeListingDays!==void 0&&S.push({type:"active",value:x.activeListingDays}),x.soldListingDays!==void 0&&S.push({type:"sold",value:x.soldListingDays}),x.unavailableListingDays!==void 0&&S.push({type:"unavailable",value:x.unavailableListingDays}),S.length===0&&S.push({type:"active",value:"all"});const W=S.length>1;let H;if(W){const n=S.map(({type:R,value:X})=>{const U=Be(R,X,i);return U.map=ve(P),U}),A=new URL("https://api.repliers.io/listings");i>=18?(A.searchParams.set("cluster","false"),A.searchParams.set("listings","true"),A.searchParams.set("fields","address.*,mlsNumber,listPrice,details.numBedrooms,details.numBedroomsPlus,details.numBathrooms,details.numBathroomsPlus,details.numGarageSpaces,details.propertyType,type,lastStatus,images,status,class,coordinates,latitude,longitude,geo,location,map"),A.searchParams.set("pageSize","500")):(A.searchParams.set("cluster","true"),A.searchParams.set("clusterPrecision",q.toString()),A.searchParams.set("clusterLimit","500"),A.searchParams.set("clusterFields","mlsNumber,listPrice,coordinates,type,address.*,details.numBedrooms,details.numBedroomsPlus,details.numBathrooms,details.numBathroomsPlus,details.numGarageSpaces,details.propertyType,lastStatus,images,status,class"),i>=14?(A.searchParams.set("listings","true"),A.searchParams.set("fields","address.*,mlsNumber,listPrice,details.numBedrooms,details.numBedroomsPlus,details.numBathrooms,details.numBathroomsPlus,details.numGarageSpaces,details.propertyType,type,lastStatus,images,status,class,coordinates,latitude,longitude,geo,location,map"),A.searchParams.set("pageSize","500")):A.searchParams.set("listings","false"));const T={queries:n},$=await fetch(A.toString(),{method:"POST",headers:{"REPLIERS-API-KEY":e,"Content-Type":"application/json"},body:JSON.stringify(T)});if(!$.ok){const R=await $.text();throw new Error(`Bundled API Error: ${$.status} ${$.statusText} - ${R}`)}H=await $.json()}else{const{type:n,value:A}=S[0],T=new URL("https://api.repliers.io/listings"),$=Be(n,A,i);Object.entries($).forEach(([X,U])=>{Array.isArray(U)?U.forEach(F=>T.searchParams.append(X,F.toString())):T.searchParams.set(X,U.toString())}),T.searchParams.set("map",JSON.stringify(ve(P))),T.searchParams.set("key",e),i>=18?(T.searchParams.set("cluster","false"),T.searchParams.set("listings","true"),T.searchParams.set("fields","address.*,mlsNumber,listPrice,details.numBedrooms,details.numBedroomsPlus,details.numBathrooms,details.numBathroomsPlus,details.numGarageSpaces,details.propertyType,type,lastStatus,images,status,class,coordinates,latitude,longitude,geo,location,map"),T.searchParams.set("pageSize","500")):(T.searchParams.set("cluster","true"),T.searchParams.set("clusterPrecision",q.toString()),T.searchParams.set("clusterLimit","500"),T.searchParams.set("clusterFields","mlsNumber,listPrice,coordinates,type,address.*,details.numBedrooms,details.numBedroomsPlus,details.numBathrooms,details.numBathroomsPlus,details.numGarageSpaces,details.propertyType,lastStatus,images,status,class"),i>=14?(T.searchParams.set("listings","true"),T.searchParams.set("fields","address.*,mlsNumber,listPrice,details.numBedrooms,details.numBedroomsPlus,details.numBathrooms,details.numBathroomsPlus,details.numGarageSpaces,details.propertyType,type,lastStatus,images,status,class,coordinates,latitude,longitude,geo,location,map"),T.searchParams.set("pageSize","500")):T.searchParams.set("listings","false"));const R=await fetch(T.toString(),{headers:{"REPLIERS-API-KEY":e,"Content-Type":"application/json"}});if(!R.ok)throw new Error(`API Error: ${R.status} ${R.statusText}`);H=await R.json()}const re=((O=(L=H.aggregates)==null?void 0:L.map)==null?void 0:O.clusters)||H.clusters||[],G=[],_=[],de=H.listings||H.results||[],se=n=>x.propertyTypes.length===0?!0:n?x.propertyTypes.includes(n):!1;re.forEach((n,A)=>{var $,R,X,U,F,J,K,V,xe,Je,Xe,Ke,Qe,Ze,Ve,et,tt,rt,st,nt;const T=[(($=n.location)==null?void 0:$.longitude)||((R=n.coordinates)==null?void 0:R.lng)||n.longitude||((X=n.center)==null?void 0:X.lng),((U=n.location)==null?void 0:U.latitude)||((F=n.coordinates)==null?void 0:F.lat)||n.latitude||((J=n.center)==null?void 0:J.lat)];if(n.count===1&&i>=14){const le=((K=n.listing)==null?void 0:K.listPrice)||n.listPrice||n.map&&((V=n.map[0])==null?void 0:V.listPrice),Ae=((Je=(xe=n.listing)==null?void 0:xe.details)==null?void 0:Je.propertyType)||((Xe=n.details)==null?void 0:Xe.propertyType);se(Ae)&&_.push({type:"Feature",properties:{mlsNumber:n.mlsNumber||((Ke=n.listing)==null?void 0:Ke.mlsNumber)||`single-${A}`,listPrice:typeof le=="string"?parseFloat(le):le,propertyType:n.propertyType||((Qe=n.listing)==null?void 0:Qe.propertyType)||n.status||"Sale",type:((Ze=n.listing)==null?void 0:Ze.type)||n.type,isProperty:!0,address:((Ve=n.listing)==null?void 0:Ve.address)||n.address,details:((et=n.listing)==null?void 0:et.details)||n.details,images:((tt=n.listing)==null?void 0:tt.images)||n.images,lastStatus:((rt=n.listing)==null?void 0:rt.lastStatus)||n.lastStatus,status:((st=n.listing)==null?void 0:st.status)||n.status,class:((nt=n.listing)==null?void 0:nt.class)||n.class},geometry:{type:"Point",coordinates:[T[0],T[1]]}})}else if(n.count===1)G.push({type:"Feature",properties:{count:n.count||1,apiCount:n.count||1,precision:n.precision||q,id:`cluster-${A}`,members:n.properties||n.map||[]},geometry:{type:"Point",coordinates:[T[0],T[1]]}});else{let le=T;if(n.properties&&Array.isArray(n.properties)){const je=[];if(n.properties.forEach(ke=>{const Re=We(ke);Re&&je.push(Re)}),je.length>0){const ke=_e(je);ke&&(le=He(je,ke))}}const Ae=n.properties||n.map||[],jt=n.count||1;G.push({type:"Feature",properties:{count:jt,apiCount:n.count||1,precision:n.precision||q,id:`cluster-${A}`,members:Ae},geometry:{type:"Point",coordinates:[le[0],le[1]]}})}});const ye=new Set(_.map(n=>n.properties.mlsNumber));let ne=0,ae=0,te=0;const Q=de.filter(n=>{var X,U,F,J,K,V,xe;if(ye.has(n.mlsNumber))return ne++,!1;const A=((X=n.map)==null?void 0:X.longitude)||((U=n.coordinates)==null?void 0:U.lng)||((F=n.coordinates)==null?void 0:F.longitude)||n.longitude||n.lng,T=((J=n.map)==null?void 0:J.latitude)||((K=n.coordinates)==null?void 0:K.lat)||((V=n.coordinates)==null?void 0:V.latitude)||n.latitude||n.lat;return A!==void 0&&T!==void 0&&!isNaN(A)&&!isNaN(T)?se((xe=n.details)==null?void 0:xe.propertyType)?!0:(te++,!1):(ae++,!1)}).map(n=>{var R,X,U,F,J;const A={mlsNumber:n.mlsNumber,listPrice:typeof n.listPrice=="string"?parseFloat(n.listPrice):n.listPrice,propertyType:n.propertyType||((R=n.details)==null?void 0:R.propertyType)||n.type||n.status||"Sale",type:n.type,isProperty:!0},T=i>=13?{address:n.address,details:n.details,images:n.images,type:n.type,lastStatus:n.lastStatus,status:n.status,class:n.class}:{};return{type:"Feature",properties:{...A,...T},geometry:{type:"Point",coordinates:[((X=n.coordinates)==null?void 0:X.lng)||n.longitude||((U=n.map)==null?void 0:U.longitude),((F=n.coordinates)==null?void 0:F.lat)||n.latitude||((J=n.map)==null?void 0:J.latitude)]}}}),he=(n,A,T)=>{const $=[...A,...T];return n.map(R=>{const X=R.geometry.coordinates,U=$.filter(J=>{const K=J.geometry.coordinates;return qe(X,K)<=50}),F=U.length>0?U.length:R.properties.count;return{...R,properties:{...R.properties,count:F}}})},ie=Q.length>0||_.length>0,Z=i>=14&&ie?he(G,Q,_):G;let pe;if(i>=14){const n=[...Z.map(T=>({...T,type:"cluster"})),..._.map(T=>({...T,type:"singleProperty"})),...Q.map(T=>({...T,type:"property"}))];pe=Te(n,50).map(T=>{const $=T.filter(F=>F.type==="cluster"),R=T.filter(F=>F.type==="property"||F.type==="singleProperty"),X=$.reduce((F,J)=>{var K;return F+(((K=J.properties)==null?void 0:K.count)||0)},0),U=R.length;return i>=17?R.length>0?R:$.length>0?$[0]:null:R.length>3?$.length>0?$.reduce((F,J)=>{var K,V;return(((K=J.properties)==null?void 0:K.count)||0)>(((V=F.properties)==null?void 0:V.count)||0)?J:F}):R[0]:X>U&&$.length>0?$.reduce((F,J)=>{var K,V;return(((K=J.properties)==null?void 0:K.count)||0)>(((V=F.properties)==null?void 0:V.count)||0)?J:F}):R.length>0?R:$.length>0&&$[0].properties.count>0?$[0]:null}).flat().filter(Boolean)}else pe=Ye([...G,..._],i);const De={type:"FeatureCollection",features:pe},Ge=l.current.getSource("listings");Ge&&(Ge.setData(De),Me(pe));const Ct=H.count||G.reduce((n,A)=>n+A.properties.count,0);v(Ct)}catch(S){const W=S instanceof Error?S.message:"Failed to load listings";N(W)}}},[e,Ue,ve,Me,x,Be,Te,Ye]);return g.useEffect(()=>{oe.current=Ce},[Ce]),g.useEffect(()=>{if(!(!j.current||l.current||!w||m===null))return Ne.accessToken=s,l.current=new Ne.Map({container:j.current,style:a,center:w,zoom:m}),l.current.on("load",()=>{var i;if(!l.current)return;l.current.addControl(new Ne.NavigationControl),l.current.addSource("listings",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),l.current.addLayer({id:"clusters",type:"circle",source:"listings",filter:["has","count"],paint:{"circle-color":["step",["get","count"],"#51bbd6",30,"#f1c40f",60,"#f39c12",150,"#f28cb1",500,"#e74c3c"],"circle-radius":["step",["get","count"],10,30,12,60,14,150,18,500,22],"circle-stroke-width":2,"circle-stroke-color":"#fff","circle-opacity":.8}}),l.current.addLayer({id:"cluster-count",type:"symbol",source:"listings",filter:["has","count"],layout:{"text-field":["get","count"],"text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":["step",["get","count"],10,30,11,60,12,150,14,500,16]},paint:{"text-color":"#ffffff"}}),l.current.addLayer({id:"property-dots",type:"circle",source:"listings",filter:["has","isProperty"],paint:{"circle-color":"#374151","circle-radius":3,"circle-stroke-width":1,"circle-stroke-color":"#fff","circle-opacity":.9}}),l.current.on("click","clusters",async q=>{var re,G;if(!l.current||!((re=q.features)!=null&&re[0]))return;const b=q.features[0],C=b.geometry.coordinates,B=b.properties.count;b.properties.apiCount;const L=q.originalEvent.clientX,O=q.originalEvent.clientY,S=l.current.getZoom();if(S>=18){l.current.easeTo({center:C,zoom:Math.min(S+1,22),duration:500});return}if(S>=14){const _=l.current.getSource("listings");if(_&&_._data){const ae=(((G=_._data.features)==null?void 0:G.filter(te=>{var Q;return((Q=te.properties)==null?void 0:Q.isProperty)===!0}))||[]).map(te=>{const Q=te.geometry.coordinates,he=Math.sqrt(Math.pow(Q[0]-C[0],2)+Math.pow(Q[1]-C[1],2));return{feature:te,distance:he}}).sort((te,Q)=>te.distance-Q.distance).slice(0,B);if(ae.length>0){const te=ae.map(({feature:ie})=>{const Z=ie.properties;return{mlsNumber:Z.mlsNumber||"N/A",listPrice:Z.listPrice||0,address:Z.address||{streetNumber:"Unknown",streetName:"Address",city:"Unknown",state:"Unknown"},details:Z.details||{numBedrooms:0,numBathrooms:0,numGarageSpaces:0,propertyType:"Unknown"},images:Z.images||[],type:Z.type||"Sale",lastStatus:Z.lastStatus||"New",status:Z.status||"A"}}),Q=te.map(ie=>ie.mlsNumber);new Set(Q);const he=te.filter((ie,Z,pe)=>Z===pe.findIndex(De=>De.mlsNumber===ie.mlsNumber));Se(he),we({x:L,y:O}),ue(!0),k(!1);return}}const de=[{mlsNumber:`Cluster-${B}`,listPrice:0,address:{streetNumber:"Multiple",streetName:"Properties",city:"Available",state:""},details:{numBedrooms:0,numBathrooms:0,numGarageSpaces:0,propertyType:`${B} Properties in Cluster`},images:[],type:"Sale",lastStatus:"Available",status:"A"}];Se(de),we({x:L,y:O}),ue(!0),k(!1);return}const W=S>=14?2:S>=12?3:4,H=Math.min(S+W,16);l.current.easeTo({center:C,zoom:H,duration:1e3,easing:_=>_*(2-_)})}),l.current.on("mouseenter","clusters",()=>{l.current&&(l.current.getCanvas().style.cursor="pointer")}),l.current.on("mouseleave","clusters",()=>{l.current&&(l.current.getCanvas().style.cursor="")}),l.current.on("mouseenter","property-dots",()=>{l.current&&(l.current.getCanvas().style.cursor="pointer")}),l.current.on("mouseleave","property-dots",()=>{l.current&&(l.current.getCanvas().style.cursor="")});const P=l.current.getBounds();P&&((i=oe.current)==null||i.call(oe,P))}),l.current.on("moveend",()=>{var i;if(!l.current)return;const P=l.current.getBounds();P&&((i=oe.current)==null||i.call(oe,P))}),()=>{Pe(),l.current&&(l.current.remove(),l.current=null)}},[s,a,w,m,Pe,Me]),g.useEffect(()=>{if(l.current){D.current=null;const P=l.current.getBounds();P&&Ce(P)}},[x,Ce]),t.jsxs("div",{style:{width:f,height:p,position:"relative"},children:[t.jsx("div",{ref:j,style:{width:"100%",height:"100%"},className:"rounded-lg overflow-hidden"}),t.jsx(wt,{filters:x,onFiltersChange:vt,apiKey:e,onMapUpdate:Tt}),I&&t.jsx("div",{style:{position:"absolute",bottom:"16px",right:"16px",backgroundColor:"rgba(255, 255, 255, 0.95)",padding:"8px 12px",borderRadius:"6px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.15)",fontSize:"14px",fontWeight:"600",color:"#374151"},children:c?t.jsx("span",{style:{color:"#ef4444"},children:"Error"}):t.jsxs("span",{children:[u.toLocaleString()," properties"]})}),c&&t.jsx("div",{style:{position:"absolute",bottom:"16px",left:"16px",right:"16px",backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"6px",padding:"12px",color:"#b91c1c",fontSize:"14px"},children:c}),t.jsx(ft,{open:d,onClose:()=>k(!1),listing:M,position:ce,mapContainer:j.current}),t.jsx(yt,{open:ee,onClose:()=>ue(!1),properties:be,position:Ie,mapContainer:j.current})]})}Pt.__docgenInfo={description:"",methods:[],displayName:"AIMapListings",props:{apiKey:{required:!0,tsType:{name:"string"},description:"Repliers API key - required"},mapboxToken:{required:!0,tsType:{name:"string"},description:"MapBox access token - required"},initialCenter:{required:!1,tsType:{name:"tuple",raw:"[number, number]",elements:[{name:"number"},{name:"number"}]},description:"Initial map center coordinates [lng, lat] - auto-detects if not provided"},initialZoom:{required:!1,tsType:{name:"number"},description:"Initial zoom level - auto-calculates if not provided"},height:{required:!1,tsType:{name:"string"},description:"Map container height",defaultValue:{value:'"100%"',computed:!1}},width:{required:!1,tsType:{name:"string"},description:"Map container width",defaultValue:{value:'"100%"',computed:!1}},mapStyle:{required:!1,tsType:{name:"string"},description:"Map style",defaultValue:{value:'"mapbox://styles/mapbox/streets-v12"',computed:!1}},centerCalculation:{required:!1,tsType:{name:"union",raw:'"average" | "city"',elements:[{name:"literal",value:'"average"'},{name:"literal",value:'"city"'}]},description:"Center calculation method",defaultValue:{value:'"average"',computed:!1}},showPropertyCount:{required:!1,tsType:{name:"boolean"},description:"Show property count display",defaultValue:{value:"true",computed:!1}}}};const gr={title:"POCS/AI-MapListings",component:Pt,parameters:{layout:"fullscreen"}},tr="pxI19UMy9zfw9vz5lRxoGpjJWXrMnm",rr="pk.eyJ1IjoibWlsYW5zb21hIiwiYSI6ImNtZWJrODZmajBwMWQya3B3cHE1M2Y3anoifQ.HMDLOc-6V9K3-mHKeTHHxw",Le={args:{apiKey:tr,mapboxToken:rr,height:"100vh",width:"100vw",mapStyle:"mapbox://styles/mapbox/streets-v12",centerCalculation:"city"}};var ct,ut,dt;Le.parameters={...Le.parameters,docs:{...(ct=Le.parameters)==null?void 0:ct.docs,source:{originalSource:`{
  args: {
    apiKey: SAMPLE_API_KEY,
    mapboxToken: SAMPLE_MAPBOX_TOKEN,
    height: "100vh",
    width: "100vw",
    mapStyle: "mapbox://styles/mapbox/streets-v12",
    centerCalculation: "city"
  }
}`,...(dt=(ut=Le.parameters)==null?void 0:ut.docs)==null?void 0:dt.source}}};const fr=["Default"];export{Le as Default,fr as __namedExportsOrder,gr as default};
