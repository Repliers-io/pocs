import{j as e}from"./jsx-runtime-CBjAUaf4.js";import{r as j,R as ge}from"./index-CoAThXCU.js";import{I as N,B as ve}from"./api-input-9U5A1nxs.js";import{L as je}from"./listing-by-address-Dyz2ZUr-.js";import"./jsx-runtime-B2VJbz7C.js";import"./api-keys-context-CG-H9iRu.js";import"./createLucideIcon-DXKbrH_m.js";import"./unified-address-search-CcXvpIBo.js";function ne({className:q,onComparablesFound:E,searchRadius:w=2}){const[n,ie]=j.useState(null),[u,M]=j.useState(null),[B,R]=j.useState([]),[$,de]=j.useState([]),[k,F]=j.useState(!1),[D,P]=j.useState(null),[t,p]=j.useState({radius:w}),[I,ce]=j.useState([]),[U,O]=j.useState(!1),[me,V]=j.useState(!1),pe=async()=>{var i,d,l;const a=document.querySelector('input[placeholder*="API"]'),r=(i=a==null?void 0:a.value)==null?void 0:i.trim();if(r){O(!0);try{const h=await fetch("https://api.repliers.io/listings?aggregates=details.propertyType",{headers:{"REPLIERS-API-KEY":r}});if(h.ok){const y=await h.json();if(console.log("üìä Property types aggregates response:",y),(l=(d=y.aggregates)==null?void 0:d.details)!=null&&l.propertyType){const o=y.aggregates.details.propertyType,m=Object.entries(o).sort(([,g],[,s])=>s-g).map(([g])=>g);ce(m),console.log("üè† Property types loaded:",m)}}else console.warn("‚ùå Failed to fetch property types aggregates")}catch(h){console.warn("‚ùå Error fetching property types:",h)}finally{O(!1)}}};ge.useEffect(()=>{const a=()=>{I.length===0&&pe()};a();const r=document.querySelector('input[placeholder*="API"]');if(r)return r.addEventListener("blur",a),()=>r.removeEventListener("blur",a)},[I.length]);const xe=a=>{var d,l,h,y,o,m,g,s,S,A;const r={};if((d=a.details)!=null&&d.numBedrooms&&(r.numBedrooms=a.details.numBedrooms),(l=a.details)!=null&&l.numBathrooms&&(r.numBathrooms=a.details.numBathrooms),(h=a.map)!=null&&h.lat?r.lat=a.map.lat:(y=a.map)!=null&&y.latitude&&(r.lat=a.map.latitude),(o=a.map)!=null&&o.long?r.long=a.map.long:(m=a.map)!=null&&m.longitude&&(r.long=a.map.longitude),(g=a.details)!=null&&g.propertyType&&(r.propertyType=a.details.propertyType),(s=a.details)!=null&&s.sqft&&(r.sqft=a.details.sqft),typeof a.address=="object"&&a.address!==null&&"city"in a.address)r.city=a.address.city;else if(typeof a.address=="string"){const v=a.address.split(",");v.length>=2&&(r.city=v[v.length-2].trim())}let i=a.type||a.listingType||a.transactionType||((S=a.details)==null?void 0:S.type)||((A=a.details)==null?void 0:A.listingType)||"sale";return r.type=i.toLowerCase(),r},ue=a=>{if(ie(a),a){const r=xe(a);let i;if(a.taxes?i=a.taxes.annualAmount||a.taxes.annual||a.taxes.yearly||a.taxes.total||a.taxes.amount||a.taxes:a.propertyTaxes?i=a.propertyTaxes:a.annualTaxes?i=a.annualTaxes:a.yearlyTaxes?i=a.yearlyTaxes:a.details&&a.details.taxes?i=a.details.taxes.annualAmount||a.details.taxes.annual||a.details.taxes.yearly||a.details.taxes.total||a.details.taxes.amount||a.details.taxes:a.financials&&a.financials.taxes&&(i=a.financials.taxes),i&&typeof i!="number"){const h=parseFloat(i);i=isNaN(h)?void 0:h}const d=a.soldPrice||a.listPrice;M(r);const l={...r,radius:w,status:"A",lastStatus:void 0,type:r.type,minBeds:r.numBedrooms,maxBeds:r.numBedrooms,minBaths:r.numBathrooms,maxBaths:r.numBathrooms,minSqft:r.sqft?r.sqft-100:void 0,maxSqft:r.sqft?r.sqft+100:void 0,maxTaxes:i?Math.ceil(i/100)*100:void 0,minPrice:d?r.type==="lease"?Math.max(1e3,Math.floor(d*.8/100)*100):Math.max(5e4,Math.floor(d*.8/1e4)*1e4):r.type==="lease"?1e3:5e4,maxPrice:d?r.type==="lease"?Math.ceil(d/100)*100:Math.ceil(d/1e4)*1e4:void 0};console.log("üîÑ About to set editable data:",l),console.log("üîç Key values being set:",{type:l.type,minPrice:l.minPrice,maxPrice:l.maxPrice,maxTaxes:l.maxTaxes,extractedType:r.type,referencePrice:d,isLease:r.type==="lease"}),p(l),console.log("üè† Listing selected:",a),console.log("üìä Comparable data extracted:",r),console.log("üí∞ Reference price:",d),console.log("üè∑Ô∏è Property taxes:",i),console.log("üìù Final editable data being set:",{...r,type:r.type,minPrice:d?r.type==="lease"?Math.max(1e3,Math.floor(d*.8/100)*100):Math.max(5e4,Math.floor(d*.8/1e4)*1e4):r.type==="lease"?1e3:5e4,maxPrice:d?r.type==="lease"?Math.ceil(d/100)*100:Math.ceil(d/1e4)*1e4:void 0,maxTaxes:i?Math.ceil(i/100)*100:void 0})}else M(null),p({radius:w});R([]),P(null),V(!1)},ye=async a=>{var d;if(a.preventDefault(),!n||!t){P("Please select a property listing first.");return}const r=document.querySelector('input[placeholder*="API"]'),i=(d=r==null?void 0:r.value)==null?void 0:d.trim();if(!i){P("API key is required to search for comparable properties.");return}F(!0),P(null),V(!0);try{const l=new URLSearchParams;t.status&&t.status.trim()&&l.append("status",t.status),t.lastStatus&&t.lastStatus.trim()&&t.status!=="A"&&l.append("lastStatus",t.lastStatus),t.type&&t.type.trim()&&l.append("type",t.type),t.propertyType&&t.propertyType.trim()&&l.append("propertyType",t.propertyType),t.minBeds!==void 0&&t.minBeds!==null&&!isNaN(t.minBeds)&&l.append("minBeds",t.minBeds.toString()),t.maxBeds!==void 0&&t.maxBeds!==null&&!isNaN(t.maxBeds)&&l.append("maxBeds",t.maxBeds.toString()),t.minBaths!==void 0&&t.minBaths!==null&&!isNaN(t.minBaths)&&l.append("minBaths",t.minBaths.toString()),t.maxBaths!==void 0&&t.maxBaths!==null&&!isNaN(t.maxBaths)&&l.append("maxBaths",t.maxBaths.toString()),t.minSqft!==void 0&&t.minSqft!==null&&!isNaN(t.minSqft)&&l.append("minSqft",t.minSqft.toString()),t.maxSqft!==void 0&&t.maxSqft!==null&&!isNaN(t.maxSqft)&&l.append("maxSqft",t.maxSqft.toString()),t.city&&t.city.trim()&&l.append("city",t.city),t.lat!==void 0&&t.lat!==null&&!isNaN(t.lat)&&l.append("lat",t.lat.toString()),t.long!==void 0&&t.long!==null&&!isNaN(t.long)&&l.append("long",t.long.toString()),t.radius!==void 0&&t.radius!==null&&!isNaN(t.radius)&&l.append("radius",t.radius.toString()),t.maxTaxes!==void 0&&t.maxTaxes!==null&&!isNaN(t.maxTaxes)&&l.append("maxTaxes",t.maxTaxes.toString()),t.minPrice!==void 0&&t.minPrice!==null&&!isNaN(t.minPrice)&&t.minPrice>0&&l.append("minPrice",t.minPrice.toString()),t.maxPrice!==void 0&&t.maxPrice!==null&&!isNaN(t.maxPrice)&&l.append("maxPrice",t.maxPrice.toString());const h=`https://api.repliers.io/listings?${l.toString()}`;console.log("üîç Making comparables API request to:",h),console.log("üìä Search parameters:",Object.fromEntries(l));const y=await fetch(h,{headers:{"REPLIERS-API-KEY":i}});if(console.log("üì° Comparables response status:",y.status,y.statusText),!y.ok){const s=await y.text();throw console.error("‚ùå Comparables API Error:",s),new Error(`API request failed: ${y.status} ${y.statusText} - ${s}`)}const o=await y.json();console.log("üì¶ Comparables API Response:",o),console.log("üì¶ Response keys:",Object.keys(o)),console.log("üì¶ Response data type:",typeof o),o.data&&Array.isArray(o.data)&&(console.log("üì¶ Found data.data array with",o.data.length,"items"),o.data.length>0&&console.log("üì¶ First item in data.data:",JSON.stringify(o.data[0],null,2)));let m=[];if(o.data&&Array.isArray(o.data))m=o.data;else if(o.results&&Array.isArray(o.results))m=o.results;else if(o.listings&&Array.isArray(o.listings))m=o.listings;else if(o.items&&Array.isArray(o.items))m=o.items;else if(o.properties&&Array.isArray(o.properties))m=o.properties;else if(Array.isArray(o))m=o;else if(o.count>0){for(const s of Object.keys(o))if(typeof o[s]=="object"&&o[s]!==null&&!["apiVersion","page","numPages","pageSize","count"].includes(s))if(Array.isArray(o[s])){m=o[s];break}else{m=[o[s]];break}}console.log("üìã Extracted comparable listings:",m),console.log("üìã Comparable listings count:",m.length),m.length>0&&console.log("üîç First listing structure:",JSON.stringify(m[0],null,2));const g=m.map((s,S)=>{var W,z,J,_,Y,H,G,X,Z,Q,ee,ae,se,te;const A=s.listDate||s.soldDate||s.closingDate;let v=null;if(A)try{const b=new Date(A),T=new Date().getTime()-b.getTime();v=Math.floor(T/(1e3*3600*24)),v<0&&(v=0)}catch(b){console.warn("Error calculating days on market:",b),v=s.daysOnMarket||s.dom||s.daysonmarket||null}else v=s.daysOnMarket||s.dom||s.daysonmarket||null;let f;console.log(`üñºÔ∏è Debugging images for listing ${S}:`,{id:s.mlsNumber||s.id||s.mls,imageFields:{images:s.images,photos:s.photos,media:s.media,pictures:s.pictures,attachments:s.attachments,imageUrl:s.imageUrl,image:s.image,primaryPhoto:s.primaryPhoto,photoUrl:s.photoUrl,thumbnailUrl:s.thumbnailUrl,mainImage:s.mainImage,featuredImage:s.featuredImage}});const be=[s.images,s.photos,s.media,s.pictures,s.attachments];for(const b of be)if(b&&Array.isArray(b)&&b.length>0){const c=b[0];if(console.log("üñºÔ∏è Found image array with first image:",c),typeof c=="string"){c.startsWith("http")?f=c:f=`https://cdn.repliers.io/${c}?class=small`,console.log("üñºÔ∏è Using string image URL:",f);break}else if(c&&typeof c=="object"){const T=c.url||c.src||c.href||c.link||c.mediaUrl||c.fullSizeUrl||c.largePhotoUrl||c.photoUrl;if(T&&(T.startsWith("http")?f=T:f=`https://cdn.repliers.io/${T}?class=small`),console.log("üñºÔ∏è Extracted from object:",{object:c,extractedUrl:T,finalUrl:f}),f)break}}if(!f){const b={imageUrl:s.imageUrl,image:s.image,primaryPhoto:s.primaryPhoto,photoUrl:s.photoUrl,thumbnailUrl:s.thumbnailUrl,mainImage:s.mainImage,featuredImage:s.featuredImage};console.log("üñºÔ∏è Checking direct properties:",b);const c=s.imageUrl||s.image||s.primaryPhoto||s.photoUrl||s.thumbnailUrl||s.mainImage||s.featuredImage;c&&(c.startsWith("http")?f=c:f=`https://cdn.repliers.io/${c}?class=small`,console.log("üñºÔ∏è Found direct property image:",f))}console.log(`üñºÔ∏è Final imageUrl for listing ${S}:`,f);let x;if(console.log(`üí∞ Debugging property taxes for listing ${S}:`,{id:s.mlsNumber||s.id,taxes:s.taxes,propertyTaxes:s.propertyTaxes,annualTaxes:s.annualTaxes,yearlyTaxes:s.yearlyTaxes,detailsTaxes:(W=s.details)==null?void 0:W.taxes,financialsTaxes:(z=s.financials)==null?void 0:z.taxes,allTaxFields:{"listing.taxes":s.taxes,"listing.propertyTaxes":s.propertyTaxes,"listing.annualTaxes":s.annualTaxes,"listing.yearlyTaxes":s.yearlyTaxes,"listing.details.taxes":(J=s.details)==null?void 0:J.taxes,"listing.financials.taxes":(_=s.financials)==null?void 0:_.taxes,"listing.details.propertyTaxes":(Y=s.details)==null?void 0:Y.propertyTaxes,"listing.details.annualTaxes":(H=s.details)==null?void 0:H.annualTaxes,"listing.taxInfo":s.taxInfo,"listing.propertyTax":s.propertyTax,"listing.tax":s.tax,"listing.assessment":s.assessment,"listing.assessments":s.assessments}}),s.taxes?x=s.taxes.annual||s.taxes.yearly||s.taxes.total||s.taxes.amount||s.taxes.annualAmount||s.taxes:s.propertyTaxes?x=s.propertyTaxes:s.annualTaxes?x=s.annualTaxes:s.yearlyTaxes?x=s.yearlyTaxes:s.details&&s.details.taxes?x=s.details.taxes.annual||s.details.taxes.yearly||s.details.taxes.total||s.details.taxes.amount||s.details.taxes.annualAmount||s.details.taxes:s.financials&&s.financials.taxes?x=s.financials.taxes:(G=s.details)!=null&&G.propertyTaxes?x=s.details.propertyTaxes:(X=s.details)!=null&&X.annualTaxes?x=s.details.annualTaxes:s.taxInfo?x=s.taxInfo.annual||s.taxInfo.amount||s.taxInfo:s.propertyTax?x=s.propertyTax:s.tax?x=s.tax:s.assessment?x=s.assessment.taxes||s.assessment.propertyTax||s.assessment:s.assessments&&Array.isArray(s.assessments)&&s.assessments.length>0&&(x=s.assessments[0].taxes||s.assessments[0].propertyTax),x&&typeof x!="number"){const b=parseFloat(x);x=isNaN(b)?void 0:b}return console.log(`üí∞ Final property taxes for listing ${S}:`,x),{id:s.mlsNumber||s.id||s.mls||`comparable-${S}`,address:C(s.address),price:s.listPrice||s.price||s.soldPrice||0,beds:((Z=s.details)==null?void 0:Z.numBedrooms)||s.beds||0,baths:((Q=s.details)==null?void 0:Q.numBathrooms)||s.baths||0,sqft:((ee=s.details)==null?void 0:ee.sqft)||s.sqft||0,pricePerSqft:s.listPrice&&((ae=s.details)!=null&&ae.sqft)?Math.round(s.listPrice/s.details.sqft):0,yearBuilt:((se=s.details)==null?void 0:se.yearBuilt)||s.yearBuilt||null,daysOnMarket:v,distance:0,lastSoldDate:s.soldDate||s.listDate||s.closingDate||new Date().toISOString(),propertyType:((te=s.details)==null?void 0:te.propertyType)||s.propertyType||"Unknown",imageUrl:f,propertyTaxes:x}});R(g),de(m),E==null||E(g),g.length===0?P("No comparable properties found with the current search criteria. Try adjusting your filters."):setTimeout(()=>{const s=document.querySelector("#comparable-results");s&&s.scrollIntoView({behavior:"smooth",block:"start"})},100)}catch(l){console.error("üí• Error in handleFindComparables:",l),P(l instanceof Error?l.message:"Failed to fetch comparable properties. Please try again.")}finally{F(!1)}},K=a=>`$${a.toLocaleString()}`,he=a=>new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),C=a=>{if(typeof a=="string")return a;if(typeof a=="object"&&a!==null){const r=[];return a.streetNumber&&r.push(a.streetNumber),a.streetName&&r.push(a.streetName),a.streetSuffix&&r.push(a.streetSuffix),a.city&&r.push(a.city),a.state&&r.push(a.state),(a.zip||a.postalCode)&&r.push(a.zip||a.postalCode),r.length>0?r.join(" "):"Address not available"}return"Address not available"},fe=a=>{const r=$.find(l=>(l.mlsNumber||l.id||`comparable-${$.indexOf(l)}`)===a.id);if(!r){console.error("Could not find original listing data for property:",a.id);return}const i=window.open("","_blank");if(!i){alert("Please allow popups to view detailed property information");return}const d=`
      <!DOCTYPE html>
      <html lang="en">
      <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Property Details - ${C(r.address)}</title>
        <script src="https://unpkg.com/react@18/umd/react.development.js"><\/script>
        <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"><\/script>
        <script src="https://unpkg.com/@babel/standalone/babel.min.js"><\/script>
        <script src="https://cdn.tailwindcss.com"><\/script>
      </head>
      <body class="bg-gray-50 p-4">
        <div id="root"></div>
        <script type="text/babel">
          const { useState } = React;
          
          // This is a simplified version of PropertyDetailsDisplay for the new tab
          function PropertyDetailsDisplay({ listing }) {
            const [selectedImage, setSelectedImage] = useState(null);

            const formatPrice = (price) => {
              return '$' + price.toLocaleString();
            };

            const formatAddress = (address) => {
              if (typeof address === "string") return address;
              if (typeof address === "object" && address !== null) {
                const parts = [];
                if (address.streetNumber) parts.push(address.streetNumber);
                if (address.streetName) parts.push(address.streetName);
                if (address.streetSuffix) parts.push(address.streetSuffix);
                if (address.city) parts.push(address.city);
                if (address.state) parts.push(address.state);
                if (address.zip || address.postalCode) parts.push(address.zip || address.postalCode);
                return parts.length > 0 ? parts.join(" ") : "Address not available";
              }
              return "Address not available";
            };

            const validFieldCount = Object.entries(listing).filter(
              ([, value]) => value !== null && value !== undefined
            ).length;

            return React.createElement('div', { className: 'max-w-6xl mx-auto' },
              React.createElement('div', { 
                className: 'border border-gray-200 rounded-lg p-6 bg-white shadow-sm' 
              },
                React.createElement('div', { 
                  className: 'flex items-start justify-between mb-4' 
                },
                  React.createElement('div', {},
                    React.createElement('h3', { 
                      className: 'text-lg font-semibold text-gray-900 mb-1' 
                    }, 'Property Details'),
                    React.createElement('p', { 
                      className: 'text-sm text-gray-500' 
                    }, formatAddress(listing.address))
                  ),
                  listing.status && React.createElement('span', { 
                    className: 'px-3 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full' 
                  }, listing.status === "A" ? "Available" : listing.status === "U" ? "Sold" : listing.status)
                ),
                React.createElement('div', { className: 'space-y-6' },
                  React.createElement('details', { className: 'group', open: true },
                    React.createElement('summary', { 
                      className: 'cursor-pointer text-sm font-medium text-gray-700 hover:text-gray-900' 
                    }, \`üîç Complete Property Information (Click to expand) - \${validFieldCount} fields\`),
                    React.createElement('div', { 
                      className: 'mt-4 grid grid-cols-1 md:grid-cols-2 gap-4' 
                    },
                      Object.entries(listing).map(([key, value]) => {
                        if (value === null || value === undefined) return null;
                        
                        let displayValue;
                        if (typeof value === "object") {
                          if (key === "address") {
                            displayValue = formatAddress(value);
                          } else if (Array.isArray(value)) {
                            displayValue = value.join(", ");
                          } else {
                            displayValue = JSON.stringify(value, null, 2);
                          }
                        } else if (typeof value === "number" && (key.includes("price") || key.includes("Price"))) {
                          displayValue = formatPrice(value);
                        } else if (typeof value === "number" && key.includes("sqft")) {
                          displayValue = value.toLocaleString() + " sqft";
                        } else if (typeof value === "boolean") {
                          displayValue = value ? "Yes" : "No";
                        } else {
                          displayValue = String(value);
                        }
                        
                        const displayKey = key.replace(/([A-Z])/g, " $1").replace(/^./, str => str.toUpperCase());
                        
                        return React.createElement('div', { 
                          key: key, 
                          className: 'border-l-2 border-blue-200 pl-3' 
                        },
                          React.createElement('div', { 
                            className: 'text-xs font-medium text-gray-500 uppercase tracking-wide' 
                          }, displayKey),
                          React.createElement('div', { 
                            className: 'text-sm font-medium text-gray-900 mt-1 break-words' 
                          },
                            typeof value === "object" && !Array.isArray(value) && key !== "address" 
                              ? React.createElement('pre', { 
                                  className: 'text-xs bg-gray-50 p-2 rounded overflow-auto max-h-32' 
                                }, displayValue)
                              : React.createElement('span', {}, displayValue)
                          )
                        );
                      }).filter(Boolean)
                    )
                  )
                )
              )
            );
          }

          const listing = ${JSON.stringify(r)};
          const root = ReactDOM.createRoot(document.getElementById('root'));
          root.render(React.createElement(PropertyDetailsDisplay, { listing: listing }));
        <\/script>
      </body>
      </html>
    `;i.document.write(d),i.document.close()};return e.jsx("div",{className:q,children:e.jsxs("form",{onSubmit:ye,className:"space-y-6",children:[e.jsx(je,{onListingSelected:ue,showDetails:!1,className:"mb-6"}),n&&u&&e.jsxs("div",{id:"selected-property-section",className:"border border-gray-200 rounded-lg p-4 bg-white shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Selected Property for Comparable Search"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Property Details"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Address: "}),e.jsx("span",{className:"font-medium",children:C(n.address)})]}),n.listPrice&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"List Price: "}),e.jsxs("span",{className:"font-medium",children:["$",n.listPrice.toLocaleString()]})]}),n.soldPrice&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Sold Price: "}),e.jsxs("span",{className:"font-bold text-md text-green-600",children:["$",n.soldPrice.toLocaleString()]})]}),n&&(()=>{let a;if(n.taxes?a=n.taxes.annualAmount||n.taxes.annual||n.taxes.yearly||n.taxes.total||n.taxes.amount||n.taxes:n.propertyTaxes?a=n.propertyTaxes:n.annualTaxes?a=n.annualTaxes:n.yearlyTaxes?a=n.yearlyTaxes:n.details&&n.details.taxes?a=n.details.taxes.annualAmount||n.details.taxes.annual||n.details.taxes.yearly||n.details.taxes.total||n.details.taxes.amount||n.details.taxes:n.financials&&n.financials.taxes&&(a=n.financials.taxes),a&&typeof a!="number"){const r=parseFloat(a);a=isNaN(r)?void 0:r}return a?e.jsxs("div",{children:[e.jsxs("span",{className:"text-gray-600",children:["Property Taxes:"," "]}),e.jsxs("span",{className:"font-medium",children:["$",a.toLocaleString(),"/year"]})]}):null})(),u.numBedrooms&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Bedrooms: "}),e.jsx("span",{className:"font-medium",children:u.numBedrooms})]}),u.numBathrooms&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Bathrooms: "}),e.jsx("span",{className:"font-medium",children:u.numBathrooms})]}),u.sqft&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Square Footage: "}),e.jsx("span",{className:"font-medium",children:u.sqft.toLocaleString()})]}),u.propertyType&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Property Type: "}),e.jsx("span",{className:"font-medium",children:u.propertyType})]}),u.city&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"City: "}),e.jsx("span",{className:"font-medium",children:u.city})]}),u.type&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Listing Type: "}),e.jsx("span",{className:"font-medium capitalize",children:u.type})]}),u.lat&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Latitude: "}),e.jsx("span",{className:"font-medium",children:u.lat.toFixed(6)})]}),u.long&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Longitude: "}),e.jsx("span",{className:"font-medium",children:u.long.toFixed(6)})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Search Parameters"}),e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs font-semibold text-gray-800 uppercase tracking-wide mb-2 border-b border-gray-200 pb-1",children:"Price/Financial Filters"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Min Price:"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 text-sm",children:"$"}),e.jsx("input",{type:"number",value:t.minPrice||"",onChange:a=>p({...t,minPrice:a.target.value?Number(a.target.value):void 0}),className:"h-8 text-sm border border-gray-300 rounded-md pl-6 pr-2 w-full",min:"0",max:"1000000000",step:"100",placeholder:"500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Max Price:"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 text-sm",children:"$"}),e.jsx("input",{type:"number",value:t.maxPrice||"",onChange:a=>p({...t,maxPrice:a.target.value?Number(a.target.value):void 0}),className:"h-8 text-sm border border-gray-300 rounded-md pl-6 pr-2 w-full",min:"0",max:"1000000000",step:"100",placeholder:"1000000"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Max Property Taxes/year:"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 text-sm",children:"$"}),e.jsx("input",{type:"number",value:t.maxTaxes||"",onChange:a=>p({...t,maxTaxes:a.target.value?Number(a.target.value):void 0}),className:"h-8 text-sm border border-gray-300 rounded-md pl-6 pr-2 w-full",min:"1000",max:"50000",step:"100",placeholder:"9000"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs font-semibold text-gray-800 uppercase tracking-wide mb-2 border-b border-gray-200 pb-1",children:"Status/Type Filters"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Status:"}),e.jsxs("select",{value:t.status||"A",onChange:a=>{const r=a.target.value||void 0;p({...t,status:r,lastStatus:r==="A"?void 0:t.lastStatus})},className:"h-8 text-sm border border-gray-300 rounded-md px-2 w-full",children:[e.jsx("option",{value:"A",children:"A - Available"}),e.jsx("option",{value:"U",children:"U - Unavailable (Sold/Leased)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Last Status:"}),e.jsxs("select",{value:t.lastStatus||"",onChange:a=>p({...t,lastStatus:a.target.value||void 0}),disabled:t.status==="A",className:`h-8 text-sm border border-gray-300 rounded-md px-2 w-full ${t.status==="A"?"bg-gray-100 text-gray-400 cursor-not-allowed":""}`,children:[e.jsx("option",{value:"",children:"Select Last Status"}),e.jsx("option",{value:"Sld",children:"Sld - Sold"}),e.jsx("option",{value:"Lsd",children:"Lsd - Leased"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Listing Type:"}),e.jsxs("select",{value:t.type||"sale",onChange:a=>p({...t,type:a.target.value||void 0}),className:"h-8 text-sm border border-gray-300 rounded-md px-2 w-full",children:[e.jsx("option",{value:"sale",children:"Sale"}),e.jsx("option",{value:"lease",children:"Lease"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs font-semibold text-gray-800 uppercase tracking-wide mb-2 border-b border-gray-200 pb-1",children:"Property Characteristics"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Property Type:"}),e.jsxs("select",{value:t.propertyType||"",onChange:a=>p({...t,propertyType:a.target.value||void 0}),disabled:U,className:`h-8 text-sm border border-gray-300 rounded-md px-2 w-full ${U?"bg-gray-100 text-gray-400":""}`,children:[e.jsx("option",{value:"",children:U?"Loading...":"Select Property Type"}),I.map(a=>e.jsx("option",{value:a,children:a},a))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Min Beds:"}),e.jsx(N,{type:"number",value:t.minBeds||"",onChange:a=>p({...t,minBeds:a.target.value?Number(a.target.value):void 0}),className:"h-8 text-sm",min:"0",max:"20"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Max Beds:"}),e.jsx(N,{type:"number",value:t.maxBeds||"",onChange:a=>p({...t,maxBeds:a.target.value?Number(a.target.value):void 0}),className:"h-8 text-sm",min:"0",max:"20"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Min Baths:"}),e.jsx(N,{type:"number",value:t.minBaths||"",onChange:a=>p({...t,minBaths:a.target.value?Number(a.target.value):void 0}),className:"h-8 text-sm",min:"0",max:"20",step:"0.5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Max Baths:"}),e.jsx(N,{type:"number",value:t.maxBaths||"",onChange:a=>p({...t,maxBaths:a.target.value?Number(a.target.value):void 0}),className:"h-8 text-sm",min:"0",max:"20",step:"0.5"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Min Sqft:"}),e.jsx(N,{type:"number",value:t.minSqft||"",onChange:a=>p({...t,minSqft:a.target.value?Number(a.target.value):void 0}),className:"h-8 text-sm",min:"0",max:"50000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Max Sqft:"}),e.jsx(N,{type:"number",value:t.maxSqft||"",onChange:a=>p({...t,maxSqft:a.target.value?Number(a.target.value):void 0}),className:"h-8 text-sm",min:"0",max:"50000"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs font-semibold text-gray-800 uppercase tracking-wide mb-2 border-b border-gray-200 pb-1",children:"Location Parameters"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"City:"}),e.jsx(N,{type:"text",value:t.city||"",onChange:a=>p({...t,city:a.target.value||void 0}),className:"h-8 text-sm"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Latitude:"}),e.jsx(N,{type:"number",value:t.lat!==void 0?t.lat.toFixed(6):"",onChange:a=>p({...t,lat:a.target.value?Number(a.target.value):void 0}),className:"h-8 text-sm",step:"0.000001",min:"-90",max:"90"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Longitude:"}),e.jsx(N,{type:"number",value:t.long!==void 0?t.long.toFixed(6):"",onChange:a=>p({...t,long:a.target.value?Number(a.target.value):void 0}),className:"h-8 text-sm",step:"0.000001",min:"-180",max:"180"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Search Radius (km):"}),e.jsx(N,{type:"number",value:t.radius||"",onChange:a=>p({...t,radius:a.target.value?Number(a.target.value):void 0}),className:"h-8 text-sm",min:"1",max:"100",step:"1"})]})]})]})]})]})]})]}),n&&t&&e.jsx("div",{className:"flex justify-center",children:e.jsx(ve,{type:"submit",disabled:k,className:"px-8 py-2",children:k?"Searching...":"Find Comparables"})}),D&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-800",children:D})}),k&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Searching for comparable properties..."})]}),B.length>0&&!k&&e.jsxs("div",{id:"comparable-results",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-xl font-semibold",children:["Comparable Properties (",B.length,")"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Within ",t.radius||w," km"]})]}),e.jsx("p",{className:"text-sm text-blue-600 bg-blue-50 p-2 rounded-lg border border-blue-200",children:"üí° Click on any property card to view detailed information in a new tab"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:B.map(a=>(console.log(`üè† Property ${a.id} UI render - propertyTaxes:`,a.propertyTaxes,"Should show:",!!a.propertyTaxes),e.jsxs("div",{className:"bg-white border border-gray-200 rounded p-3 hover:shadow-md transition-all duration-200 hover:border-blue-300 cursor-pointer relative group",onClick:()=>fe(a),title:"Click to view detailed property information in a new tab",children:[e.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:e.jsx("div",{className:"bg-blue-600 text-white p-1 rounded-full",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-2/5 flex-shrink-0",children:e.jsx("div",{className:"w-full aspect-square rounded overflow-hidden bg-gray-100 flex items-center justify-center",children:a.imageUrl?e.jsx("img",{src:a.imageUrl,alt:"Property",className:"w-full h-full object-cover",onLoad:()=>{console.log(`‚úÖ Image loaded successfully for property ${a.id}:`,a.imageUrl)},onError:r=>{console.log(`‚ùå Image failed to load for property ${a.id}:`,a.imageUrl);const i=r.target;i.style.display="none";const d=i.parentElement;d&&(d.innerHTML=`
                                  <svg className="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                                  </svg>
                                `)}}):e.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("p",{className:"text-lg font-bold text-green-600",children:K(a.price)}),e.jsx("span",{className:"px-1.5 py-0.5 text-xs font-medium bg-blue-100 text-blue-800 rounded",children:a.propertyType})]}),e.jsx("h4",{className:"text-sm font-semibold text-gray-900 leading-tight break-words",children:C(a.address)})]}),e.jsxs("div",{className:"space-y-0.5 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-600 min-w-fit",children:"Beds/Baths:"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[a.beds," bed, ",a.baths," bath"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-600 min-w-fit",children:"Square Feet:"}),e.jsx("span",{className:"font-medium text-gray-900",children:a.sqft?a.sqft.toLocaleString():"N/A"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-600 min-w-fit",children:"Listed Date:"}),e.jsx("span",{className:"font-medium text-gray-900",children:he(a.lastSoldDate)})]}),a.propertyTaxes?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-600 min-w-fit",children:"Property Taxes:"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[K(a.propertyTaxes),"/yr"]})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-600 min-w-fit",children:"Property Taxes:"}),e.jsx("span",{className:"font-medium text-gray-500",children:"Not available"})]})]})]})]})]},a.id)))})]}),B.length===0&&!k&&n&&me&&D===null&&e.jsx("div",{className:"text-center py-8",children:e.jsxs("p",{className:"text-gray-600",children:["No comparable properties found within"," ",t.radius||w," km. Try increasing the search radius."]})})]})})}ne.__docgenInfo={description:`ComparablesByAddressSearch Component

@description A component that allows users to search for comparable properties by address using Google Places API
@param props - The component props
@returns JSX.Element`,methods:[],displayName:"ComparablesByAddressSearch",props:{className:{required:!1,tsType:{name:"string"},description:""},onComparablesFound:{required:!1,tsType:{name:"signature",type:"function",raw:"(comparables: ComparableProperty[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"ComparableProperty"}],raw:"ComparableProperty[]"},name:"comparables"}],return:{name:"void"}}},description:""},searchRadius:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"2.0",computed:!1}}}};const Ce={title:"POCS/Comparables/ComparablesByAddressSearch",component:ne,parameters:{layout:"padded",docs:{description:{component:"A comprehensive component for searching comparable properties by address using Google Places API integration."}}},tags:["autodocs"],argTypes:{className:{control:"text",description:"Additional CSS classes to apply to the component"},onComparablesFound:{action:"comparables-found",description:"Callback function called when comparable properties are found"},searchRadius:{control:{type:"number",min:.1,max:5,step:.1},description:"Search radius in miles"}}},L={args:{searchRadius:2},decorators:[q=>e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsx(q,{})})],parameters:{docs:{description:{story:"The default configuration with standard search parameters. Users can search for an address and find comparable properties within 2 km."}}}};var re,le,oe;L.parameters={...L.parameters,docs:{...(re=L.parameters)==null?void 0:re.docs,source:{originalSource:`{
  args: {
    searchRadius: 2.0
  },
  decorators: [Story => <div className="max-w-4xl mx-auto p-6">
        <Story />
      </div>],
  parameters: {
    docs: {
      description: {
        story: "The default configuration with standard search parameters. Users can search for an address and find comparable properties within 2 km."
      }
    }
  }
}`,...(oe=(le=L.parameters)==null?void 0:le.docs)==null?void 0:oe.source}}};const Le=["Default"];export{L as Default,Le as __namedExportsOrder,Ce as default};
