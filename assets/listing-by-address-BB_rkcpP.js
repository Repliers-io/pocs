import{j as r}from"./jsx-runtime-CBjAUaf4.js";import{r as p}from"./index-CoAThXCU.js";import{A as M}from"./api-input-Dr_LPgA6.js";import{U as _}from"./unified-address-search-Czsw31PV.js";function Z({className:T,onListingSelected:f,showDetails:I=!0}){const[H,O]=p.useState(null),[b,y]=p.useState([]),[d,w]=p.useState(null),[C,$]=p.useState(!1),[P,u]=p.useState(null),[S,q]=p.useState(""),[v,N]=p.useState(null),D=p.useMemo(()=>d?Object.entries(d).filter(([,e])=>e!=null).length:0,[d]),x=e=>`$${e.toLocaleString()}`,A=e=>{if(typeof e=="string")return e;if(typeof e=="object"&&e!==null){const t=[];return e.streetNumber&&t.push(e.streetNumber),e.streetName&&t.push(e.streetName),e.streetSuffix&&t.push(e.streetSuffix),e.city&&t.push(e.city),e.state&&t.push(e.state),(e.zip||e.postalCode)&&t.push(e.zip||e.postalCode),t.length>0?t.join(" "):"Address not available"}return"Address not available"},L=e=>{if(!e)return"Not available";try{let t;if(typeof e=="number")t=e>1e12?new Date(e):new Date(e*1e3);else if(typeof e=="string")t=new Date(e);else return String(e);return isNaN(t.getTime())?String(e):t.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",timeZoneName:"short"})}catch{return String(e)}},B=e=>e.replace(/class=\w+/,"class=large").replace(new RegExp("(?<!\\?)class=large"),"?class=large"),U=async(e,t)=>{const c=new URLSearchParams({streetName:e.streetName,streetNumber:e.streetNumber,city:e.city});c.append("status","A"),c.append("status","U");const j=`https://api.repliers.io/listings?${c}`;console.log("🔍 Making API request to:",j),console.log("📍 Address components:",e),console.log("🔑 API Key (first 10 chars):",t.substring(0,10)+"...");const i=await fetch(j,{headers:{"REPLIERS-API-KEY":t}});if(console.log("📡 Response status:",i.status,i.statusText),!i.ok){const n=await i.text();throw console.error("❌ API Error Response:",n),new Error(`API request failed: ${i.status} ${i.statusText} - ${n}`)}const s=await i.json();console.log("📦 API Response data:",s),console.log("📊 Data type:",typeof s,"Is array:",Array.isArray(s)),console.log("🔍 Response properties:",Object.keys(s)),console.log("🔍 Full response structure:",JSON.stringify(s,null,2));let a=[];if(s.data&&Array.isArray(s.data))a=s.data;else if(s.results&&Array.isArray(s.results))a=s.results;else if(s.listings&&Array.isArray(s.listings))a=s.listings;else if(s.items&&Array.isArray(s.items))a=s.items;else if(s.properties&&Array.isArray(s.properties))a=s.properties;else if(Array.isArray(s))a=s;else if(s.count>0){for(const n of Object.keys(s))if(typeof s[n]=="object"&&s[n]!==null&&!["apiVersion","page","numPages","pageSize","count"].includes(n))if(console.log(`🎯 Trying property '${n}' as potential listing data:`,s[n]),Array.isArray(s[n])){a=s[n];break}else{a=[s[n]];break}}return console.log("📋 Extracted listings:",a),console.log("📋 Listings array length:",a.length),(!a||a.length===0)&&s.count>0?(console.warn("⚠️ API reports",s.count,"listings but we couldn't extract them!"),console.warn("⚠️ Available properties:",Object.keys(s)),console.warn("🚨 Last resort: treating entire response as single listing"),[s]):a},F=async e=>{if(O(e),y([]),w(null),u(null),!S.trim()){u("API key is required to search for property listings.");return}$(!0);try{console.log("🚀 Starting property listing search...");const t=await U(e.address,S);if(console.log("✅ Got listings response:",t),console.log("📝 Listings count:",(t==null?void 0:t.length)||0),!t||t.length===0){console.log("⚠️ No listings found"),u("No property listings found for this address."),y([]);return}console.log("📋 Setting property listings:",t),y(t),t.length===1&&(console.log("🎯 Auto-selecting single listing:",t[0]),w(t[0]),f==null||f(t[0]))}catch(t){console.error("💥 Error in handleAddressSelect:",t),u(t instanceof Error?t.message:"Failed to fetch property listing. Please try again."),y([])}finally{$(!1)}},R=e=>{w(e),f==null||f(e),u(null)};return r.jsx("div",{className:T,children:r.jsxs("div",{className:"space-y-6",children:[r.jsx(M,{onApiKeyChange:q,isEstimates:!1}),r.jsx(_,{onPlaceSelect:F,placeholder:"Enter the property address...",className:"w-full"}),C&&r.jsxs("div",{className:"text-center py-8",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),r.jsx("p",{className:"mt-2 text-gray-600",children:"Searching for property listing..."})]}),b.length>1&&!C&&r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsxs("h3",{className:"text-lg font-semibold mb-2",children:["Multiple Listings Found (",b.length,")"]}),r.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Please select the correct property listing:"})]}),r.jsx("div",{className:"grid gap-3",children:b.map((e,t)=>r.jsx("div",{className:`border rounded-lg p-4 cursor-pointer transition-all ${(d==null?void 0:d.id)===e.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>R(e),children:r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("h4",{className:"font-medium text-gray-900",children:A(e.address)}),r.jsxs("div",{className:"mt-2 grid grid-cols-2 md:grid-cols-4 gap-4 text-sm text-gray-600",children:[e.price&&r.jsxs("div",{children:["Price: ",x(e.price)]}),e.beds&&r.jsxs("div",{children:["Beds: ",e.beds]}),e.baths&&r.jsxs("div",{children:["Baths: ",e.baths]}),e.sqft&&r.jsxs("div",{children:["Sqft: ",e.sqft.toLocaleString()]})]}),e.propertyType&&r.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Type: ",e.propertyType]})]}),r.jsx("div",{className:"ml-4",children:r.jsx("div",{className:`w-4 h-4 rounded-full border-2 ${(d==null?void 0:d.id)===e.id?"border-blue-500 bg-blue-500":"border-gray-300"}`,children:(d==null?void 0:d.id)===e.id&&r.jsx("div",{className:"w-2 h-2 bg-white rounded-full mx-auto mt-0.5"})})})]})},e.id||t))})]}),d&&I&&r.jsxs("div",{className:"border border-gray-200 rounded-lg p-6 bg-white shadow-sm",children:[r.jsxs("div",{className:"flex items-start justify-between mb-4",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Selected Property"}),r.jsx("p",{className:"text-sm text-gray-500",children:A(d.address)})]}),d.status&&r.jsx("span",{className:"px-3 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full",children:d.status})]}),v&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",onClick:()=>N(null),children:r.jsxs("div",{className:"relative max-w-4xl max-h-full",children:[r.jsx("img",{src:v,alt:"Property photo large view",className:"max-w-full max-h-full object-contain rounded-lg"}),r.jsx("button",{onClick:()=>N(null),className:"absolute top-4 right-4 bg-white bg-opacity-90 hover:bg-opacity-100 rounded-full p-2 transition-all",children:r.jsx("svg",{className:"w-6 h-6 text-gray-800",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),r.jsx("div",{className:"absolute bottom-4 left-4 bg-black bg-opacity-60 text-white px-3 py-1 rounded text-sm",children:"Click anywhere to close"})]})}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs("details",{className:"group",children:[r.jsxs("summary",{className:"cursor-pointer text-sm font-medium text-gray-700 hover:text-gray-900",children:["🔍 Complete Property Information (Click to expand) -"," ",D," fields"]}),r.jsx("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:Object.entries(d).map(([e,t])=>{if(t==null)return null;let c;if(typeof t=="object")if(e==="address")c=A(t);else if(Array.isArray(t))console.log("🔍 Array detected:",e,"Length:",t.length,"First item type:",typeof t[0]),e.toLowerCase()==="bathrooms"||e.toLowerCase().includes("bathroom")&&e.toLowerCase()!=="numbathrooms"&&e.toLowerCase()!=="numbathroomsplus"&&e.toLowerCase()!=="numbathroomshalf"||e.toLowerCase().includes("bath")&&e.toLowerCase()!=="numbathrooms"&&e.toLowerCase()!=="numbathroomsplus"&&e.toLowerCase()!=="numbathroomshalf"?(console.log("🛁 TOP-LEVEL Bathroom array detected:",e,"Length:",t.length,"First item:",t[0]),c=t.map((s,a)=>{if(console.log(`🛁 TOP-LEVEL Processing bathroom ${a+1}:`,s,"Type:",typeof s),typeof s=="object"&&s!==null){const o=s,l=[];if(console.log(`🛁 TOP-LEVEL Bathroom ${a+1} properties:`,Object.keys(o)),(o.type||o.bathroom_type||o.bathroomType)&&l.push(o.type||o.bathroom_type||o.bathroomType),(o.location||o.floor||o.room||o.area)&&l.push(`(${o.location||o.floor||o.room||o.area})`),(o.size||o.dimensions||o.sqft)&&l.push(o.size||o.dimensions||o.sqft),o.features||o.amenities||o.fixtures){const m=o.features||o.amenities||o.fixtures;Array.isArray(m)?l.push(`Features: ${m.join(", ")}`):m&&l.push(`Features: ${m}`)}if(o.description&&l.push(o.description),l.length===0){const E=Object.entries(o).filter(([,h])=>h!=null&&h!=="").map(([h,z])=>`${h.replace(/([A-Z])/g," $1").replace(/^./,J=>J.toUpperCase())}: ${z}`).join(", ")||`Bathroom ${a+1}`;return console.log(`🛁 TOP-LEVEL Bathroom ${a+1} final result (fallback):`,E),E}const g=l.join(" ");return console.log(`🛁 TOP-LEVEL Bathroom ${a+1} final result:`,g),g}const n=String(s);return console.log(`🛁 TOP-LEVEL Bathroom ${a+1} final result (not object):`,n),n}).join(" | "),console.log("🛁 TOP-LEVEL Final formatted bathroom value:",c)):t.every(i=>typeof i=="string"&&i.match(/^IMG-[A-Z0-9]+_\d+\.jpg$/i))?c="images":t.length>0&&typeof t[0]=="object"&&t[0]!==null?(console.log("🔧 Handling array of objects:",e,t),c=t.map((s,a)=>typeof s=="object"&&s!==null?Object.entries(s).filter(([,o])=>o!=null).map(([o,l])=>`${o.replace(/([A-Z])/g," $1").replace(/^./,m=>m.toUpperCase())}: ${l}`).join(", ")||`Item ${a+1}`:String(s)).join(" | ")):c=t.join(", ");else if(["map","details","lot","rooms","brokerage","taxes","timestamps","estimate","office","nearby","openHouse","open_house","openhouse"].includes(e)&&t!==null)c=null;else if(typeof t=="object"&&t!==null&&e.toLowerCase().includes("history")){const i=t,s=[];Object.entries(i).forEach(([a,n])=>{if(typeof n=="object"&&n!==null){const o=n,l=[];o.date&&l.push(`Date: ${L(o.date)}`),(o.value||o.estimate)&&l.push(`Value: ${x(o.value||o.estimate)}`),o.confidence&&l.push(`Confidence: ${o.confidence}%`),o.source&&l.push(`Source: ${o.source}`),o.change&&l.push(`Change: ${o.change}`),l.length>0?s.push(`${a.toUpperCase()}: ${l.join(", ")}`):s.push(`${a}: ${JSON.stringify(n)}`)}else s.push(`${a}: ${n}`)}),c=s.length>0?s.join(" | "):JSON.stringify(t,null,2)}else c=JSON.stringify(t,null,2);else typeof t=="number"&&(e.includes("price")||e.includes("Price")||e.includes("cost")||e.includes("Cost")||e.includes("value")||e.includes("Value"))?c=x(t):typeof t=="number"&&e.includes("sqft")?c=t.toLocaleString()+" sqft":typeof t=="boolean"?c=t?"Yes":"No":typeof t=="string"&&(e.toLowerCase().includes("date")||e.toLowerCase().includes("time")||e.toLowerCase()==="listdate"||e.toLowerCase()==="list date")&&(t.includes("T")||t.includes("-")||!isNaN(Date.parse(t)))?c=L(t):c=String(t);const j=e.replace(/([A-Z])/g," $1").replace(/^./,i=>i.toUpperCase());return r.jsxs("div",{className:"border-l-2 border-blue-200 pl-3",children:[r.jsx("div",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:j}),r.jsx("div",{className:"text-sm font-medium text-gray-900 mt-1 break-words",children:["map","details","lot","rooms","brokerage","taxes","timestamps","estimate","office","nearby","openHouse","open_house","openhouse"].includes(e)&&typeof t=="object"&&t!==null?r.jsx("div",{className:"space-y-1",children:Object.entries(t).map(([i,s])=>{if(e==="details"&&console.log("🔍 DETAILS Processing subKey:",i,"Type:",typeof s,"Is Array:",Array.isArray(s)),s==null)return null;const a=i.replace(/([A-Z])/g," $1").replace(/^./,o=>o.toUpperCase());let n;if(typeof s=="object"&&s!==null)if(Array.isArray(s))n=s.join(", ");else{const o=s;o.count||o.number?n=o.count||o.number:o.dimensions?n=o.dimensions:o.value?n=o.value:n=Object.entries(o).filter(([,l])=>l!=null).map(([l,g])=>`${l}: ${g}`).join(", ")}else typeof s=="number"&&(i.includes("price")||i.includes("Price")||i.includes("cost")||i.includes("Cost")||i.includes("value")||i.includes("Value"))?n=x(s):typeof s=="number"&&i.includes("sqft")?n=s.toLocaleString()+" sqft":typeof s=="boolean"?n=s?"Yes":"No":e==="timestamps"||i.toLowerCase().includes("date")||i.toLowerCase().includes("time")||i.toLowerCase().includes("created")||i.toLowerCase().includes("updated")||i.toLowerCase().includes("modified")||i.toLowerCase().includes("stamp")||i.toLowerCase().includes("list")||i.toLowerCase()==="updated on"||i.toLowerCase()==="updatedon"||i.toLowerCase()==="listdate"?n=L(s):e==="office"&&(i.toLowerCase().includes("phone")||i.toLowerCase().includes("tel")||i.toLowerCase().includes("number"))?n=String(s).replace(/(\d{3})(\d{3})(\d{4})/,"($1) $2-$3"):n=String(s);return r.jsxs("div",{className:"flex justify-between items-start py-0.5 border-b border-gray-100 last:border-b-0",children:[r.jsxs("span",{className:"text-xs text-gray-600 font-medium min-w-0 mr-2",children:[a,":"]}),r.jsx("span",{className:"text-xs text-gray-900 text-right break-words",children:n})]},i)})}):typeof t=="object"&&!Array.isArray(t)&&e!=="address"?r.jsx("pre",{className:"text-xs bg-gray-50 p-2 rounded overflow-auto max-h-32",children:c}):c==="images"&&Array.isArray(t)?r.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-2 mt-2",children:t.map((i,s)=>{const a=`https://cdn.repliers.io/${i}?class=small`;return r.jsxs("div",{className:"relative aspect-square bg-gray-100 rounded overflow-hidden cursor-pointer hover:shadow-md transition-shadow group",onClick:()=>N(B(a)),children:[r.jsx("img",{src:a,alt:`Photo ${s+1}`,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-200",loading:"lazy"}),r.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-200 flex items-center justify-center",children:r.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity bg-white bg-opacity-90 rounded-full p-1",children:r.jsx("svg",{className:"w-3 h-3 text-gray-800",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})})]},s)})}):r.jsx("span",{children:c})})]},e)})})]}),r.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:r.jsxs("details",{className:"group",children:[r.jsx("summary",{className:"cursor-pointer text-sm font-medium text-gray-700 hover:text-gray-900",children:"🔍 Raw JSON Data (Click to expand)"}),r.jsx("div",{className:"mt-2 p-4 bg-gray-50 rounded-lg",children:r.jsx("pre",{className:"text-xs text-gray-600 overflow-auto max-h-96 whitespace-pre-wrap",children:JSON.stringify(d,null,2)})})]})})]})]}),P&&r.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:r.jsx("p",{className:"text-red-800",children:P})})]})})}Z.__docgenInfo={description:`ListingByAddress Component

@description A component that allows users to search for property listings by address using Google Places API
@param props - The component props
@returns JSX.Element`,methods:[],displayName:"ListingByAddress",props:{className:{required:!1,tsType:{name:"string"},description:""},onListingSelected:{required:!1,tsType:{name:"signature",type:"function",raw:"(listing: PropertyListing | null) => void",signature:{arguments:[{type:{name:"union",raw:"PropertyListing | null",elements:[{name:"PropertyListing"},{name:"null"}]},name:"listing"}],return:{name:"void"}}},description:""},showDetails:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}}}};export{Z as L};
