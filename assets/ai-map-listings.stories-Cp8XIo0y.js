import{j as i}from"./jsx-runtime-xF634gn_.js";import{g as Kt,r as h}from"./index-C-7etoUd.js";import{m as ht}from"./mapbox-gl-vCdO7wfF.js";import{B as $n,C as Un}from"./car-CJRJwKAe.js";import{B as Wr}from"./bath-D_6pRDEi.js";import{X as Hr}from"./x-C6fJ-1bL.js";import{L as Yr}from"./loader-circle-x9Fu845P.js";import{S as Bn,M as qn}from"./search-XnQ6sKlz.js";import{B as Gn}from"./building-2-B0UuG4c1.js";import{H as Cr,B as Vn}from"./house-C1D6uJK2.js";import{c as Ct}from"./createLucideIcon-BmJP7rG3.js";import{C as Jr}from"./chevron-down-BzbnjZNy.js";/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zn=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]],Wn=Ct("ban",zn);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hn=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],Yn=Ct("dollar-sign",Hn);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jn=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],Kn=Ct("pencil",Jn);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xn=[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]],Zn=Ct("sparkles",Xn),ge={CANVAS:"mapboxgl-canvas",CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},Ee={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},ee={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},ye={POLYGON:"polygon",LINE:"line_string",POINT:"point"},P={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},B={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select"},me={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},it={MOVE:"move",CHANGE_PROPERTIES:"change_properties",CHANGE_COORDINATES:"change_coordinates"},de={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},ce={ACTIVE:"true",INACTIVE:"false"},Kr=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],Qn=-90,Gt=-85,eo=90,Vt=85,to=-270,ro=270,Xr=Object.freeze(Object.defineProperty({__proto__:null,LAT_MAX:eo,LAT_MIN:Qn,LAT_RENDERED_MAX:Vt,LAT_RENDERED_MIN:Gt,LNG_MAX:ro,LNG_MIN:to,activeStates:ce,classes:ge,cursors:ee,events:me,geojsonTypes:P,interactions:Kr,meta:de,modes:B,sources:Ee,types:ye,updateActions:it},Symbol.toStringTag,{value:"Module"}));function wt(e){return function(t){const r=t.featureTarget;return!r||!r.properties?!1:r.properties.meta===e}}function Zr(e){return!e.originalEvent||!e.originalEvent.shiftKey?!1:e.originalEvent.button===0}function Ge(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.active===ce.ACTIVE&&e.featureTarget.properties.meta===de.FEATURE}function Xt(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.active===ce.INACTIVE&&e.featureTarget.properties.meta===de.FEATURE}function Pt(e){return e.featureTarget===void 0}function Zt(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.meta===de.FEATURE}function at(e){const t=e.featureTarget;return!t||!t.properties?!1:t.properties.meta===de.VERTEX}function vt(e){return e.originalEvent?e.originalEvent.shiftKey===!0:!1}function Mt(e){return e.key==="Escape"||e.keyCode===27}function It(e){return e.key==="Enter"||e.keyCode===13}function zt(e){return e.key==="Backspace"||e.keyCode===8}function Wt(e){return e.key==="Delete"||e.keyCode===46}function Qr(e){return e.key==="1"||e.keyCode===49}function en(e){return e.key==="2"||e.keyCode===50}function tn(e){return e.key==="3"||e.keyCode===51}function rn(e){const t=e.key||String.fromCharCode(e.keyCode);return t>="0"&&t<="9"}function no(){return!0}const oo=Object.freeze(Object.defineProperty({__proto__:null,isActiveFeature:Ge,isBackspaceKey:zt,isDeleteKey:Wt,isDigit1Key:Qr,isDigit2Key:en,isDigit3Key:tn,isDigitKey:rn,isEnterKey:It,isEscapeKey:Mt,isFeature:Zt,isInactiveFeature:Xt,isOfMetaType:wt,isShiftDown:vt,isShiftMousedown:Zr,isTrue:no,isVertex:at,noTarget:Pt},Symbol.toStringTag,{value:"Module"}));var gt={},nt={},wr;function so(){return wr||(wr=1,nt.RADIUS=6378137,nt.FLATTENING=1/298.257223563,nt.POLAR_RADIUS=63567523142e-4),nt}var Pr;function io(){if(Pr)return gt;Pr=1;var e=so();gt.geometry=t,gt.ring=n;function t(s){var a=0,d;switch(s.type){case"Polygon":return r(s.coordinates);case"MultiPolygon":for(d=0;d<s.coordinates.length;d++)a+=r(s.coordinates[d]);return a;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(d=0;d<s.geometries.length;d++)a+=t(s.geometries[d]);return a}}function r(s){var a=0;if(s&&s.length>0){a+=Math.abs(n(s[0]));for(var d=1;d<s.length;d++)a-=Math.abs(n(s[d]))}return a}function n(s){var a,d,f,g,u,p,l,c=0,m=s.length;if(m>2){for(l=0;l<m;l++)l===m-2?(g=m-2,u=m-1,p=0):l===m-1?(g=m-1,u=0,p=1):(g=l,u=l+1,p=l+2),a=s[g],d=s[u],f=s[p],c+=(o(f[0])-o(a[0]))*Math.sin(o(d[1]));c=c*e.RADIUS*e.RADIUS/2}return c}function o(s){return s*Math.PI/180}return gt}var ao=io();const lo=Kt(ao),Mr={Point:0,LineString:1,MultiLineString:1,Polygon:2};function co(e,t){const r=Mr[e.geometry.type]-Mr[t.geometry.type];return r===0&&e.geometry.type===P.POLYGON?e.area-t.area:r}function nn(e){return e.map(t=>(t.geometry.type===P.POLYGON&&(t.area=lo.geometry({type:P.FEATURE,property:{},geometry:t.geometry})),t)).sort(co).map(t=>(delete t.area,t))}function on(e,t=0){return[[e.point.x-t,e.point.y-t],[e.point.x+t,e.point.y+t]]}function Ce(e){if(this._items={},this._nums={},this._length=e?e.length:0,!!e)for(let t=0,r=e.length;t<r;t++)this.add(e[t]),e[t]!==void 0&&(typeof e[t]=="string"?this._items[e[t]]=t:this._nums[e[t]]=t)}Ce.prototype.add=function(e){return this.has(e)?this:(this._length++,typeof e=="string"?this._items[e]=this._length:this._nums[e]=this._length,this)};Ce.prototype.delete=function(e){return this.has(e)===!1?this:(this._length--,delete this._items[e],delete this._nums[e],this)};Ce.prototype.has=function(e){return typeof e!="string"&&typeof e!="number"?!1:this._items[e]!==void 0||this._nums[e]!==void 0};Ce.prototype.values=function(){const e=[];return Object.keys(this._items).forEach(t=>{e.push({k:t,v:this._items[t]})}),Object.keys(this._nums).forEach(t=>{e.push({k:JSON.parse(t),v:this._nums[t]})}),e.sort((t,r)=>t.v-r.v).map(t=>t.k)};Ce.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};const uo=[de.FEATURE,de.MIDPOINT,de.VERTEX],Ye={click:po,touch:fo};function po(e,t,r){return sn(e,t,r,r.options.clickBuffer)}function fo(e,t,r){return sn(e,t,r,r.options.touchBuffer)}function sn(e,t,r,n){if(r.map===null)return[];const o=e?on(e,n):t,s={};r.options.styles&&(s.layers=r.options.styles.map(g=>g.id).filter(g=>r.map.getLayer(g)!=null));const a=r.map.queryRenderedFeatures(o,s).filter(g=>uo.indexOf(g.properties.meta)!==-1),d=new Ce,f=[];return a.forEach(g=>{const u=g.properties.id;d.has(u)||(d.add(u),f.push(g))}),nn(f)}function St(e,t){const r=Ye.click(e,null,t),n={mouse:ee.NONE};return r[0]&&(n.mouse=r[0].properties.active===ce.ACTIVE?ee.MOVE:ee.POINTER,n.feature=r[0].properties.meta),t.events.currentModeName().indexOf("draw")!==-1&&(n.mouse=ee.ADD),t.ui.queueMapClasses(n),t.ui.updateMapClasses(),r[0]}function Qt(e,t){const r=e.x-t.x,n=e.y-t.y;return Math.sqrt(r*r+n*n)}const mo=4,ho=12,go=500;function Ht(e,t,r={}){const n=r.fineTolerance!=null?r.fineTolerance:mo,o=r.grossTolerance!=null?r.grossTolerance:ho,s=r.interval!=null?r.interval:go;e.point=e.point||t.point,e.time=e.time||t.time;const a=Qt(e.point,t.point);return a<n||a<o&&t.time-e.time<s}const yo=25,bo=250;function Yt(e,t,r={}){const n=r.tolerance!=null?r.tolerance:yo,o=r.interval!=null?r.interval:bo;return e.point=e.point||t.point,e.time=e.time||t.time,Qt(e.point,t.point)<n&&t.time-e.time<o}const Jt=function(e,t){const r={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},n={on(s,a,d){if(r[s]===void 0)throw new Error(`Invalid event type: ${s}`);r[s].push({selector:a,fn:d})},render(s){t.store.featureChanged(s)}},o=function(s,a){const d=r[s];let f=d.length;for(;f--;){const g=d[f];if(g.selector(a)){g.fn.call(n,a)||t.store.render(),t.ui.updateMapClasses();break}}};return e.start.call(n),{render:e.render,stop(){e.stop&&e.stop()},trash(){e.trash&&(e.trash(),t.store.render())},combineFeatures(){e.combineFeatures&&e.combineFeatures()},uncombineFeatures(){e.uncombineFeatures&&e.uncombineFeatures()},drag(s){o("drag",s)},click(s){o("click",s)},mousemove(s){o("mousemove",s)},mousedown(s){o("mousedown",s)},mouseup(s){o("mouseup",s)},mouseout(s){o("mouseout",s)},keydown(s){o("keydown",s)},keyup(s){o("keyup",s)},touchstart(s){o("touchstart",s)},touchmove(s){o("touchmove",s)},touchend(s){o("touchend",s)},tap(s){o("tap",s)}}};let xo=(e,t=21)=>(r=t)=>{let n="",o=r|0;for(;o--;)n+=e[Math.random()*e.length|0];return n};const So=xo("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",32);function er(){return So()}const he=function(e,t){this.ctx=e,this.properties=t.properties||{},this.coordinates=t.geometry.coordinates,this.id=t.id||er(),this.type=t.geometry.type};he.prototype.changed=function(){this.ctx.store.featureChanged(this.id)};he.prototype.incomingCoords=function(e){this.setCoordinates(e)};he.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()};he.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))};he.prototype.setProperty=function(e,t){this.properties[e]=t};he.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:P.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))};he.prototype.internal=function(e){const t={id:this.id,meta:de.FEATURE,"meta:type":this.type,active:ce.INACTIVE,mode:e};if(this.ctx.options.userProperties)for(const r in this.properties)t[`user_${r}`]=this.properties[r];return{type:P.FEATURE,properties:t,geometry:{coordinates:this.getCoordinates(),type:this.type}}};const $e=function(e,t){he.call(this,e,t)};$e.prototype=Object.create(he.prototype);$e.prototype.isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"};$e.prototype.updateCoordinate=function(e,t,r){arguments.length===3?this.coordinates=[t,r]:this.coordinates=[e,t],this.changed()};$e.prototype.getCoordinate=function(){return this.getCoordinates()};const De=function(e,t){he.call(this,e,t)};De.prototype=Object.create(he.prototype);De.prototype.isValid=function(){return this.coordinates.length>1};De.prototype.addCoordinate=function(e,t,r){this.changed();const n=parseInt(e,10);this.coordinates.splice(n,0,[t,r])};De.prototype.getCoordinate=function(e){const t=parseInt(e,10);return JSON.parse(JSON.stringify(this.coordinates[t]))};De.prototype.removeCoordinate=function(e){this.changed(),this.coordinates.splice(parseInt(e,10),1)};De.prototype.updateCoordinate=function(e,t,r){const n=parseInt(e,10);this.coordinates[n]=[t,r],this.changed()};const xe=function(e,t){he.call(this,e,t),this.coordinates=this.coordinates.map(r=>r.slice(0,-1))};xe.prototype=Object.create(he.prototype);xe.prototype.isValid=function(){return this.coordinates.length===0?!1:this.coordinates.every(e=>e.length>2)};xe.prototype.incomingCoords=function(e){this.coordinates=e.map(t=>t.slice(0,-1)),this.changed()};xe.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()};xe.prototype.addCoordinate=function(e,t,r){this.changed();const n=e.split(".").map(s=>parseInt(s,10));this.coordinates[n[0]].splice(n[1],0,[t,r])};xe.prototype.removeCoordinate=function(e){this.changed();const t=e.split(".").map(n=>parseInt(n,10)),r=this.coordinates[t[0]];r&&(r.splice(t[1],1),r.length<3&&this.coordinates.splice(t[0],1))};xe.prototype.getCoordinate=function(e){const t=e.split(".").map(n=>parseInt(n,10)),r=this.coordinates[t[0]];return JSON.parse(JSON.stringify(r[t[1]]))};xe.prototype.getCoordinates=function(){return this.coordinates.map(e=>e.concat([e[0]]))};xe.prototype.updateCoordinate=function(e,t,r){this.changed();const n=e.split("."),o=parseInt(n[0],10),s=parseInt(n[1],10);this.coordinates[o]===void 0&&(this.coordinates[o]=[]),this.coordinates[o][s]=[t,r]};const vo={MultiPoint:$e,MultiLineString:De,MultiPolygon:xe},Nt=(e,t,r,n,o)=>{const s=r.split("."),a=parseInt(s[0],10),d=s[1]?s.slice(1).join("."):null;return e[a][t](d,n,o)},fe=function(e,t){if(he.call(this,e,t),delete this.coordinates,this.model=vo[t.geometry.type],this.model===void 0)throw new TypeError(`${t.geometry.type} is not a valid type`);this.features=this._coordinatesToFeatures(t.geometry.coordinates)};fe.prototype=Object.create(he.prototype);fe.prototype._coordinatesToFeatures=function(e){const t=this.model.bind(this);return e.map(r=>new t(this.ctx,{id:er(),type:P.FEATURE,properties:{},geometry:{coordinates:r,type:this.type.replace("Multi","")}}))};fe.prototype.isValid=function(){return this.features.every(e=>e.isValid())};fe.prototype.setCoordinates=function(e){this.features=this._coordinatesToFeatures(e),this.changed()};fe.prototype.getCoordinate=function(e){return Nt(this.features,"getCoordinate",e)};fe.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(e=>e.type===P.POLYGON?e.getCoordinates():e.coordinates)))};fe.prototype.updateCoordinate=function(e,t,r){Nt(this.features,"updateCoordinate",e,t,r),this.changed()};fe.prototype.addCoordinate=function(e,t,r){Nt(this.features,"addCoordinate",e,t,r),this.changed()};fe.prototype.removeCoordinate=function(e){Nt(this.features,"removeCoordinate",e),this.changed()};fe.prototype.getFeatures=function(){return this.features};function j(e){this.map=e.map,this.drawConfig=JSON.parse(JSON.stringify(e.options||{})),this._ctx=e}j.prototype.setSelected=function(e){return this._ctx.store.setSelected(e)};j.prototype.setSelectedCoordinates=function(e){this._ctx.store.setSelectedCoordinates(e),e.reduce((t,r)=>(t[r.feature_id]===void 0&&(t[r.feature_id]=!0,this._ctx.store.get(r.feature_id).changed()),t),{})};j.prototype.getSelected=function(){return this._ctx.store.getSelected()};j.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()};j.prototype.isSelected=function(e){return this._ctx.store.isSelected(e)};j.prototype.getFeature=function(e){return this._ctx.store.get(e)};j.prototype.select=function(e){return this._ctx.store.select(e)};j.prototype.deselect=function(e){return this._ctx.store.deselect(e)};j.prototype.deleteFeature=function(e,t={}){return this._ctx.store.delete(e,t)};j.prototype.addFeature=function(e,t={}){return this._ctx.store.add(e,t)};j.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()};j.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()};j.prototype.setActionableState=function(e={}){const t={trash:e.trash||!1,combineFeatures:e.combineFeatures||!1,uncombineFeatures:e.uncombineFeatures||!1};return this._ctx.events.actionable(t)};j.prototype.changeMode=function(e,t={},r={}){return this._ctx.events.changeMode(e,t,r)};j.prototype.fire=function(e,t){return this._ctx.events.fire(e,t)};j.prototype.updateUIClasses=function(e){return this._ctx.ui.queueMapClasses(e)};j.prototype.activateUIButton=function(e){return this._ctx.ui.setActiveButton(e)};j.prototype.featuresAt=function(e,t,r="click"){if(r!=="click"&&r!=="touch")throw new Error("invalid buffer type");return Ye[r](e,t,this._ctx)};j.prototype.newFeature=function(e){const t=e.geometry.type;return t===P.POINT?new $e(this._ctx,e):t===P.LINE_STRING?new De(this._ctx,e):t===P.POLYGON?new xe(this._ctx,e):new fe(this._ctx,e)};j.prototype.isInstanceOf=function(e,t){if(e===P.POINT)return t instanceof $e;if(e===P.LINE_STRING)return t instanceof De;if(e===P.POLYGON)return t instanceof xe;if(e==="MultiFeature")return t instanceof fe;throw new Error(`Unknown feature class: ${e}`)};j.prototype.doRender=function(e){return this._ctx.store.featureChanged(e)};j.prototype.onSetup=function(){};j.prototype.onDrag=function(){};j.prototype.onClick=function(){};j.prototype.onMouseMove=function(){};j.prototype.onMouseDown=function(){};j.prototype.onMouseUp=function(){};j.prototype.onMouseOut=function(){};j.prototype.onKeyUp=function(){};j.prototype.onKeyDown=function(){};j.prototype.onTouchStart=function(){};j.prototype.onTouchMove=function(){};j.prototype.onTouchEnd=function(){};j.prototype.onTap=function(){};j.prototype.onStop=function(){};j.prototype.onTrash=function(){};j.prototype.onCombineFeature=function(){};j.prototype.onUncombineFeature=function(){};j.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};const an={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},To=Object.keys(an);function Eo(e){const t=Object.keys(e);return function(r,n={}){let o={};const s=t.reduce((d,f)=>(d[f]=e[f],d),new j(r));function a(d){return f=>s[d](o,f)}return{start(){o=s.onSetup(n),To.forEach(d=>{const f=an[d];let g=()=>!1;e[f]&&(g=()=>!0),this.on(d,g,a(f))})},stop(){s.onStop(o)},trash(){s.onTrash(o)},combineFeatures(){s.onCombineFeatures(o)},uncombineFeatures(){s.onUncombineFeatures(o)},render(d,f){s.toDisplayFeatures(o,d,f)}}}}function Co(e){const t=Object.keys(e.options.modes).reduce((l,c)=>(l[c]=Eo(e.options.modes[c]),l),{});let r={},n={};const o={};let s=null,a=null;o.drag=function(l,c){c({point:l.point,time:new Date().getTime()})?(e.ui.queueMapClasses({mouse:ee.DRAG}),a.drag(l)):l.originalEvent.stopPropagation()},o.mousedrag=function(l){o.drag(l,c=>!Ht(r,c))},o.touchdrag=function(l){o.drag(l,c=>!Yt(n,c))},o.mousemove=function(l){if((l.originalEvent.buttons!==void 0?l.originalEvent.buttons:l.originalEvent.which)===1)return o.mousedrag(l);const m=St(l,e);l.featureTarget=m,a.mousemove(l)},o.mousedown=function(l){r={time:new Date().getTime(),point:l.point};const c=St(l,e);l.featureTarget=c,a.mousedown(l)},o.mouseup=function(l){const c=St(l,e);l.featureTarget=c,Ht(r,{point:l.point,time:new Date().getTime()})?a.click(l):a.mouseup(l)},o.mouseout=function(l){a.mouseout(l)},o.touchstart=function(l){if(!e.options.touchEnabled)return;n={time:new Date().getTime(),point:l.point};const c=Ye.touch(l,null,e)[0];l.featureTarget=c,a.touchstart(l)},o.touchmove=function(l){if(e.options.touchEnabled)return a.touchmove(l),o.touchdrag(l)},o.touchend=function(l){if(l.originalEvent.preventDefault(),!e.options.touchEnabled)return;const c=Ye.touch(l,null,e)[0];l.featureTarget=c,Yt(n,{time:new Date().getTime(),point:l.point})?a.tap(l):a.touchend(l)};const d=l=>{const c=zt(l),m=Wt(l),T=rn(l);return!(c||m||T)};o.keydown=function(l){(l.srcElement||l.target).classList.contains(ge.CANVAS)&&((zt(l)||Wt(l))&&e.options.controls.trash?(l.preventDefault(),a.trash()):d(l)?a.keydown(l):Qr(l)&&e.options.controls.point?f(B.DRAW_POINT):en(l)&&e.options.controls.line_string?f(B.DRAW_LINE_STRING):tn(l)&&e.options.controls.polygon&&f(B.DRAW_POLYGON))},o.keyup=function(l){d(l)&&a.keyup(l)},o.zoomend=function(){e.store.changeZoom()},o.data=function(l){if(l.dataType==="style"){const{setup:c,map:m,options:T,store:E}=e;T.styles.some(N=>m.getLayer(N.id))||(c.addLayers(),E.setDirty(),E.render())}};function f(l,c,m={}){a.stop();const T=t[l];if(T===void 0)throw new Error(`${l} is not valid`);s=l;const E=T(e,c);a=Jt(E,e),m.silent||e.map.fire(me.MODE_CHANGE,{mode:l}),e.store.setDirty(),e.store.render()}const g={trash:!1,combineFeatures:!1,uncombineFeatures:!1};function u(l){let c=!1;Object.keys(l).forEach(m=>{if(g[m]===void 0)throw new Error("Invalid action type");g[m]!==l[m]&&(c=!0),g[m]=l[m]}),c&&e.map.fire(me.ACTIONABLE,{actions:g})}return{start(){s=e.options.defaultMode,a=Jt(t[s](e),e)},changeMode:f,actionable:u,currentModeName(){return s},currentModeRender(l,c){return a.render(l,c)},fire(l,c){e.map&&e.map.fire(l,c)},addEventListeners(){e.map.on("mousemove",o.mousemove),e.map.on("mousedown",o.mousedown),e.map.on("mouseup",o.mouseup),e.map.on("data",o.data),e.map.on("touchmove",o.touchmove),e.map.on("touchstart",o.touchstart),e.map.on("touchend",o.touchend),e.container.addEventListener("mouseout",o.mouseout),e.options.keybindings&&(e.container.addEventListener("keydown",o.keydown),e.container.addEventListener("keyup",o.keyup))},removeEventListeners(){e.map.off("mousemove",o.mousemove),e.map.off("mousedown",o.mousedown),e.map.off("mouseup",o.mouseup),e.map.off("data",o.data),e.map.off("touchmove",o.touchmove),e.map.off("touchstart",o.touchstart),e.map.off("touchend",o.touchend),e.container.removeEventListener("mouseout",o.mouseout),e.options.keybindings&&(e.container.removeEventListener("keydown",o.keydown),e.container.removeEventListener("keyup",o.keyup))},trash(l){a.trash(l)},combineFeatures(){a.combineFeatures()},uncombineFeatures(){a.uncombineFeatures()},getMode(){return s}}}function lt(e){return[].concat(e).filter(t=>t!==void 0)}function wo(){const e=this;if(!(e.ctx.map&&e.ctx.map.getSource(Ee.HOT)!==void 0))return f();const r=e.ctx.events.currentModeName();e.ctx.ui.queueMapClasses({mode:r});let n=[],o=[];e.isDirty?o=e.getAllIds():(n=e.getChangedIds().filter(g=>e.get(g)!==void 0),o=e.sources.hot.filter(g=>g.properties.id&&n.indexOf(g.properties.id)===-1&&e.get(g.properties.id)!==void 0).map(g=>g.properties.id)),e.sources.hot=[];const s=e.sources.cold.length;e.sources.cold=e.isDirty?[]:e.sources.cold.filter(g=>{const u=g.properties.id||g.properties.parent;return n.indexOf(u)===-1});const a=s!==e.sources.cold.length||o.length>0;n.forEach(g=>d(g,"hot")),o.forEach(g=>d(g,"cold"));function d(g,u){const l=e.get(g).internal(r);e.ctx.events.currentModeRender(l,c=>{c.properties.mode=r,e.sources[u].push(c)})}a&&e.ctx.map.getSource(Ee.COLD).setData({type:P.FEATURE_COLLECTION,features:e.sources.cold}),e.ctx.map.getSource(Ee.HOT).setData({type:P.FEATURE_COLLECTION,features:e.sources.hot}),f();function f(){e.isDirty=!1,e.clearChangedIds()}}function K(e){this._features={},this._featureIds=new Ce,this._selectedFeatureIds=new Ce,this._selectedCoordinates=[],this._changedFeatureIds=new Ce,this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=e,this.sources={hot:[],cold:[]};let t;this.render=()=>{t||(t=requestAnimationFrame(()=>{t=null,wo.call(this),this._emitSelectionChange&&(this.ctx.events.fire(me.SELECTION_CHANGE,{features:this.getSelected().map(r=>r.toGeoJSON()),points:this.getSelectedCoordinates().map(r=>({type:P.FEATURE,properties:{},geometry:{type:P.POINT,coordinates:r.coordinates}}))}),this._emitSelectionChange=!1),this.ctx.events.fire(me.RENDER,{})}))},this.isDirty=!1}K.prototype.createRenderBatch=function(){const e=this.render;let t=0;return this.render=function(){t++},()=>{this.render=e,t>0&&this.render()}};K.prototype.setDirty=function(){return this.isDirty=!0,this};K.prototype.featureCreated=function(e,t={}){if(this._changedFeatureIds.add(e),(t.silent!=null?t.silent:this.ctx.options.suppressAPIEvents)!==!0){const n=this.get(e);this.ctx.events.fire(me.CREATE,{features:[n.toGeoJSON()]})}return this};K.prototype.featureChanged=function(e,t={}){return this._changedFeatureIds.add(e),(t.silent!=null?t.silent:this.ctx.options.suppressAPIEvents)!==!0&&this.ctx.events.fire(me.UPDATE,{action:t.action?t.action:it.CHANGE_COORDINATES,features:[this.get(e).toGeoJSON()]}),this};K.prototype.getChangedIds=function(){return this._changedFeatureIds.values()};K.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this};K.prototype.getAllIds=function(){return this._featureIds.values()};K.prototype.add=function(e,t={}){return this._features[e.id]=e,this._featureIds.add(e.id),this.featureCreated(e.id,{silent:t.silent}),this};K.prototype.delete=function(e,t={}){const r=[];return lt(e).forEach(n=>{this._featureIds.has(n)&&(this._featureIds.delete(n),this._selectedFeatureIds.delete(n),t.silent||r.indexOf(this._features[n])===-1&&r.push(this._features[n].toGeoJSON()),delete this._features[n],this.isDirty=!0)}),r.length&&this.ctx.events.fire(me.DELETE,{features:r}),ln(this,t),this};K.prototype.get=function(e){return this._features[e]};K.prototype.getAll=function(){return Object.keys(this._features).map(e=>this._features[e])};K.prototype.select=function(e,t={}){return lt(e).forEach(r=>{this._selectedFeatureIds.has(r)||(this._selectedFeatureIds.add(r),this._changedFeatureIds.add(r),t.silent||(this._emitSelectionChange=!0))}),this};K.prototype.deselect=function(e,t={}){return lt(e).forEach(r=>{this._selectedFeatureIds.has(r)&&(this._selectedFeatureIds.delete(r),this._changedFeatureIds.add(r),t.silent||(this._emitSelectionChange=!0))}),ln(this,t),this};K.prototype.clearSelected=function(e={}){return this.deselect(this._selectedFeatureIds.values(),{silent:e.silent}),this};K.prototype.setSelected=function(e,t={}){return e=lt(e),this.deselect(this._selectedFeatureIds.values().filter(r=>e.indexOf(r)===-1),{silent:t.silent}),this.select(e.filter(r=>!this._selectedFeatureIds.has(r)),{silent:t.silent}),this};K.prototype.setSelectedCoordinates=function(e){return this._selectedCoordinates=e,this._emitSelectionChange=!0,this};K.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this};K.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()};K.prototype.getSelected=function(){return this.getSelectedIds().map(e=>this.get(e))};K.prototype.getSelectedCoordinates=function(){return this._selectedCoordinates.map(t=>({coordinates:this.get(t.feature_id).getCoordinate(t.coord_path)}))};K.prototype.isSelected=function(e){return this._selectedFeatureIds.has(e)};K.prototype.setFeatureProperty=function(e,t,r,n={}){this.get(e).setProperty(t,r),this.featureChanged(e,{silent:n.silent,action:it.CHANGE_PROPERTIES})};function ln(e,t={}){const r=e._selectedCoordinates.filter(n=>e._selectedFeatureIds.has(n.feature_id));e._selectedCoordinates.length!==r.length&&!t.silent&&(e._emitSelectionChange=!0),e._selectedCoordinates=r}K.prototype.storeMapConfig=function(){Kr.forEach(e=>{this.ctx.map[e]&&(this._mapInitialConfig[e]=this.ctx.map[e].isEnabled())})};K.prototype.restoreMapConfig=function(){Object.keys(this._mapInitialConfig).forEach(e=>{this._mapInitialConfig[e]?this.ctx.map[e].enable():this.ctx.map[e].disable()})};K.prototype.getInitialConfigValue=function(e){return this._mapInitialConfig[e]!==void 0?this._mapInitialConfig[e]:!0};const Po=["mode","feature","mouse"];function Mo(e){const t={};let r=null,n={mode:null,feature:null,mouse:null},o={mode:null,feature:null,mouse:null};function s(){a({mode:null,feature:null,mouse:null}),d()}function a(c){o=Object.assign(o,c)}function d(){if(!e.container)return;const c=[],m=[];Po.forEach(T=>{o[T]!==n[T]&&(c.push(`${T}-${n[T]}`),o[T]!==null&&m.push(`${T}-${o[T]}`))}),c.length>0&&e.container.classList.remove(...c),m.length>0&&e.container.classList.add(...m),n=Object.assign(n,o)}function f(c,m={}){const T=document.createElement("button");return T.className=`${ge.CONTROL_BUTTON} ${m.className}`,T.setAttribute("title",m.title),m.container.appendChild(T),T.addEventListener("click",E=>{if(E.preventDefault(),E.stopPropagation(),E.target===r){g(),m.onDeactivate();return}u(c),m.onActivate()},!0),T}function g(){r&&(r.classList.remove(ge.ACTIVE_BUTTON),r=null)}function u(c){g();const m=t[c];m&&m&&c!=="trash"&&(m.classList.add(ge.ACTIVE_BUTTON),r=m)}function p(){const c=e.options.controls,m=document.createElement("div");return m.className=`${ge.CONTROL_GROUP} ${ge.CONTROL_BASE}`,c&&(c[ye.POINT]&&(t[ye.POINT]=f(ye.POINT,{container:m,className:ge.CONTROL_BUTTON_POINT,title:`Marker tool ${e.options.keybindings?"(1)":""}`,onActivate:()=>e.events.changeMode(B.DRAW_POINT),onDeactivate:()=>e.events.trash()})),c[ye.LINE]&&(t[ye.LINE]=f(ye.LINE,{container:m,className:ge.CONTROL_BUTTON_LINE,title:`LineString tool ${e.options.keybindings?"(2)":""}`,onActivate:()=>e.events.changeMode(B.DRAW_LINE_STRING),onDeactivate:()=>e.events.trash()})),c[ye.POLYGON]&&(t[ye.POLYGON]=f(ye.POLYGON,{container:m,className:ge.CONTROL_BUTTON_POLYGON,title:`Polygon tool ${e.options.keybindings?"(3)":""}`,onActivate:()=>e.events.changeMode(B.DRAW_POLYGON),onDeactivate:()=>e.events.trash()})),c.trash&&(t.trash=f("trash",{container:m,className:ge.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:()=>{e.events.trash()}})),c.combine_features&&(t.combine_features=f("combineFeatures",{container:m,className:ge.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:()=>{e.events.combineFeatures()}})),c.uncombine_features&&(t.uncombine_features=f("uncombineFeatures",{container:m,className:ge.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:()=>{e.events.uncombineFeatures()}}))),m}function l(){Object.keys(t).forEach(c=>{const m=t[c];m.parentNode&&m.parentNode.removeChild(m),delete t[c]})}return{setActiveButton:u,queueMapClasses:a,updateMapClasses:d,clearMapClasses:s,addButtons:p,removeButtons:l}}function Io(e){let t=null,r=null;const n={onRemove(){return e.map.off("load",n.connect),clearInterval(r),n.removeLayers(),e.store.restoreMapConfig(),e.ui.removeButtons(),e.events.removeEventListeners(),e.ui.clearMapClasses(),e.boxZoomInitial&&e.map.boxZoom.enable(),e.map=null,e.container=null,e.store=null,t&&t.parentNode&&t.parentNode.removeChild(t),t=null,this},connect(){e.map.off("load",n.connect),clearInterval(r),n.addLayers(),e.store.storeMapConfig(),e.events.addEventListeners()},onAdd(o){if(e.map=o,e.events=Co(e),e.ui=Mo(e),e.container=o.getContainer(),e.store=new K(e),t=e.ui.addButtons(),e.options.boxSelect){e.boxZoomInitial=o.boxZoom.isEnabled(),o.boxZoom.disable();const s=o.dragPan.isEnabled();o.dragPan.disable(),o.dragPan.enable(),s||o.dragPan.disable()}return o.loaded()?n.connect():(o.on("load",n.connect),r=setInterval(()=>{o.loaded()&&n.connect()},16)),e.events.start(),t},addLayers(){e.map.addSource(Ee.COLD,{data:{type:P.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.map.addSource(Ee.HOT,{data:{type:P.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.options.styles.forEach(o=>{e.map.addLayer(o)}),e.store.setDirty(!0),e.store.render()},removeLayers(){e.options.styles.forEach(o=>{e.map.getLayer(o.id)&&e.map.removeLayer(o.id)}),e.map.getSource(Ee.COLD)&&e.map.removeSource(Ee.COLD),e.map.getSource(Ee.HOT)&&e.map.removeSource(Ee.HOT)}};return e.setup=n,n}const Ut="#3bb2d0",ot="#fbb03b",Ir="#fff",cn=[{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"]],paint:{"fill-color":["case",["==",["get","active"],"true"],ot,Ut],"fill-opacity":.1}},{id:"gl-draw-lines",type:"line",filter:["any",["==","$type","LineString"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["case",["==",["get","active"],"true"],ot,Ut],"line-dasharray":["case",["==",["get","active"],"true"],[.2,2],[2,0]],"line-width":2}},{id:"gl-draw-point-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":Ir}},{id:"gl-draw-point-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":["case",["==",["get","active"],"true"],ot,Ut]}},{id:"gl-draw-vertex-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":Ir}},{id:"gl-draw-vertex-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":ot}},{id:"gl-draw-midpoint",type:"circle",filter:["all",["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":ot}}];function je(e,t){this.x=e,this.y=t}je.prototype={clone(){return new je(this.x,this.y)},add(e){return this.clone()._add(e)},sub(e){return this.clone()._sub(e)},multByPoint(e){return this.clone()._multByPoint(e)},divByPoint(e){return this.clone()._divByPoint(e)},mult(e){return this.clone()._mult(e)},div(e){return this.clone()._div(e)},rotate(e){return this.clone()._rotate(e)},rotateAround(e,t){return this.clone()._rotateAround(e,t)},matMult(e){return this.clone()._matMult(e)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(e){return this.x===e.x&&this.y===e.y},dist(e){return Math.sqrt(this.distSqr(e))},distSqr(e){const t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle(){return Math.atan2(this.y,this.x)},angleTo(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith(e){return this.angleWithSep(e.x,e.y)},angleWithSep(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult(e){const t=e[0]*this.x+e[1]*this.y,r=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=r,this},_add(e){return this.x+=e.x,this.y+=e.y,this},_sub(e){return this.x-=e.x,this.y-=e.y,this},_mult(e){return this.x*=e,this.y*=e,this},_div(e){return this.x/=e,this.y/=e,this},_multByPoint(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint(e){return this.x/=e.x,this.y/=e.y,this},_unit(){return this._div(this.mag()),this},_perp(){const e=this.y;return this.y=this.x,this.x=-e,this},_rotate(e){const t=Math.cos(e),r=Math.sin(e),n=t*this.x-r*this.y,o=r*this.x+t*this.y;return this.x=n,this.y=o,this},_rotateAround(e,t){const r=Math.cos(e),n=Math.sin(e),o=t.x+r*(this.x-t.x)-n*(this.y-t.y),s=t.y+n*(this.x-t.x)+r*(this.y-t.y);return this.x=o,this.y=s,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:je};je.convert=function(e){if(e instanceof je)return e;if(Array.isArray(e))return new je(+e[0],+e[1]);if(e.x!==void 0&&e.y!==void 0)return new je(+e.x,+e.y);throw new Error("Expected [x, y] or {x, y} point format")};function tr(e,t){const r=t.getBoundingClientRect();return new je(e.clientX-r.left-(t.clientLeft||0),e.clientY-r.top-(t.clientTop||0))}function Je(e,t,r,n){return{type:P.FEATURE,properties:{meta:de.VERTEX,parent:e,coord_path:r,active:n?ce.ACTIVE:ce.INACTIVE},geometry:{type:P.POINT,coordinates:t}}}function No(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function un(e,t,r){if(e!==null)for(var n,o,s,a,d,f,g,u=0,p=0,l,c=e.type,m=c==="FeatureCollection",T=c==="Feature",E=m?e.features.length:1,v=0;v<E;v++){g=m?e.features[v].geometry:T?e.geometry:e,l=g?g.type==="GeometryCollection":!1,d=l?g.geometries.length:1;for(var N=0;N<d;N++){var _=0,O=0;if(a=l?g.geometries[N]:g,a!==null){f=a.coordinates;var I=a.type;switch(u=0,I){case null:break;case"Point":if(t(f,p,v,_,O)===!1)return!1;p++,_++;break;case"LineString":case"MultiPoint":for(n=0;n<f.length;n++){if(t(f[n],p,v,_,O)===!1)return!1;p++,I==="MultiPoint"&&_++}I==="LineString"&&_++;break;case"Polygon":case"MultiLineString":for(n=0;n<f.length;n++){for(o=0;o<f[n].length-u;o++){if(t(f[n][o],p,v,_,O)===!1)return!1;p++}I==="MultiLineString"&&_++,I==="Polygon"&&O++}I==="Polygon"&&_++;break;case"MultiPolygon":for(n=0;n<f.length;n++){for(O=0,o=0;o<f[n].length;o++){for(s=0;s<f[n][o].length-u;s++){if(t(f[n][o][s],p,v,_,O)===!1)return!1;p++}O++}_++}break;case"GeometryCollection":for(n=0;n<a.geometries.length;n++)if(un(a.geometries[n],t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Lo(e){if(!e)throw new Error("geojson is required");switch(e.type){case"Feature":return dn(e);case"FeatureCollection":return _o(e);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return rr(e);default:throw new Error("unknown GeoJSON type")}}function dn(e){const t={type:"Feature"};return Object.keys(e).forEach(r=>{switch(r){case"type":case"properties":case"geometry":return;default:t[r]=e[r]}}),t.properties=pn(e.properties),e.geometry==null?t.geometry=null:t.geometry=rr(e.geometry),t}function pn(e){const t={};return e&&Object.keys(e).forEach(r=>{const n=e[r];typeof n=="object"?n===null?t[r]=null:Array.isArray(n)?t[r]=n.map(o=>o):t[r]=pn(n):t[r]=n}),t}function _o(e){const t={type:"FeatureCollection"};return Object.keys(e).forEach(r=>{switch(r){case"type":case"features":return;default:t[r]=e[r]}}),t.features=e.features.map(r=>dn(r)),t}function rr(e){const t={type:e.type};return e.bbox&&(t.bbox=e.bbox),e.type==="GeometryCollection"?(t.geometries=e.geometries.map(r=>rr(r)),t):(t.coordinates=fn(e.coordinates),t)}function fn(e){const t=e;return typeof t[0]!="object"?t.slice():t.map(r=>fn(r))}function Nr(e,t={}){return mn(e,"mercator",t)}function Ao(e,t={}){return mn(e,"wgs84",t)}function mn(e,t,r={}){r=r||{};var n=r.mutate;if(!e)throw new Error("geojson is required");return Array.isArray(e)&&No(e[0])?e=t==="mercator"?Lr(e):_r(e):(n!==!0&&(e=Lo(e)),un(e,function(o){var s=t==="mercator"?Lr(o):_r(o);o[0]=s[0],o[1]=s[1]})),e}function Lr(e){var t=Math.PI/180,r=6378137,n=20037508342789244e-9,o=Math.abs(e[0])<=180?e[0]:e[0]-Oo(e[0])*360,s=[r*o*t,r*Math.log(Math.tan(Math.PI*.25+.5*e[1]*t))];return s[0]>n&&(s[0]=n),s[0]<-n&&(s[0]=-n),s[1]>n&&(s[1]=n),s[1]<-n&&(s[1]=-n),s}function _r(e){var t=180/Math.PI,r=6378137;return[e[0]*t/r,(Math.PI*.5-2*Math.atan(Math.exp(-e[1]/r)))*t]}function Oo(e){return e<0?-1:e>0?1:0}function hn(e,t,r){const n=t.geometry.coordinates,o=r.geometry.coordinates;if(n[1]>Vt||n[1]<Gt||o[1]>Vt||o[1]<Gt)return null;const s=Nr(n),a=Nr(o),d=p=>Number(p.toFixed(8)),f=(p,l)=>(p+l)/2,g=Ao([f(s[0],a[0]),f(s[1],a[1])]),u=[d(g[0]),d(g[1])];return{type:P.FEATURE,properties:{meta:de.MIDPOINT,parent:e,lng:u[0],lat:u[1],coord_path:r.properties.coord_path},geometry:{type:P.POINT,coordinates:u}}}function Lt(e,t={},r=null){const{type:n,coordinates:o}=e.geometry,s=e.properties&&e.properties.id;let a=[];n===P.POINT?a.push(Je(s,o,r,f(r))):n===P.POLYGON?o.forEach((u,p)=>{d(u,r!==null?`${r}.${p}`:String(p))}):n===P.LINE_STRING?d(o,r):n.indexOf(P.MULTI_PREFIX)===0&&g();function d(u,p){let l="",c=null;u.forEach((m,T)=>{const E=p!=null?`${p}.${T}`:String(T),v=Je(s,m,E,f(E));if(t.midpoints&&c){const _=hn(s,c,v);_&&a.push(_)}c=v;const N=JSON.stringify(m);l!==N&&a.push(v),T===0&&(l=N)})}function f(u){return t.selectedPaths?t.selectedPaths.indexOf(u)!==-1:!1}function g(){const u=n.replace(P.MULTI_PREFIX,"");o.forEach((p,l)=>{const c={type:P.FEATURE,properties:e.properties,geometry:{type:u,coordinates:p}};a=a.concat(Lt(c,t,l))})}return a}const Me={enable(e){setTimeout(()=>{!e.map||!e.map.doubleClickZoom||!e._ctx||!e._ctx.store||!e._ctx.store.getInitialConfigValue||e._ctx.store.getInitialConfigValue("doubleClickZoom")&&e.map.doubleClickZoom.enable()},0)},disable(e){setTimeout(()=>{!e.map||!e.map.doubleClickZoom||e.map.doubleClickZoom.disable()},0)}},{LAT_MIN:yt,LAT_MAX:bt,LAT_RENDERED_MIN:Ar,LAT_RENDERED_MAX:Or,LNG_MIN:kr,LNG_MAX:Dr}=Xr;function ko(e){const t={Point:0,LineString:1,Polygon:2,MultiPoint:1,MultiLineString:2,MultiPolygon:3}[e.geometry.type],r=[e.geometry.coordinates].flat(t),n=r.map(d=>d[0]),o=r.map(d=>d[1]),s=d=>Math.min.apply(null,d),a=d=>Math.max.apply(null,d);return[s(n),s(o),a(n),a(o)]}function nr(e,t){let r=yt,n=bt,o=yt,s=bt,a=Dr,d=kr;e.forEach(g=>{const u=ko(g),p=u[1],l=u[3],c=u[0],m=u[2];p>r&&(r=p),l<n&&(n=l),l>o&&(o=l),p<s&&(s=p),c<a&&(a=c),m>d&&(d=m)});const f=t;return r+f.lat>Or&&(f.lat=Or-r),o+f.lat>bt&&(f.lat=bt-o),n+f.lat<Ar&&(f.lat=Ar-n),s+f.lat<yt&&(f.lat=yt-s),a+f.lng<=kr&&(f.lng+=Math.ceil(Math.abs(f.lng)/360)*360),d+f.lng>=Dr&&(f.lng-=Math.ceil(Math.abs(f.lng)/360)*360),f}function or(e,t){const r=nr(e.map(n=>n.toGeoJSON()),t);e.forEach(n=>{const o=n.getCoordinates(),s=g=>{const u={lng:g[0]+r.lng,lat:g[1]+r.lat};return[u.lng,u.lat]},a=g=>g.map(u=>s(u)),d=g=>g.map(u=>a(u));let f;n.type===P.POINT?f=s(o):n.type===P.LINE_STRING||n.type===P.MULTI_POINT?f=o.map(s):n.type===P.POLYGON||n.type===P.MULTI_LINE_STRING?f=o.map(a):n.type===P.MULTI_POLYGON&&(f=o.map(d)),n.incomingCoords(f)})}const Y={};Y.onSetup=function(e){const t={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initialDragPanState:this.map.dragPan.isEnabled(),initiallySelectedFeatureIds:e.featureIds||[]};return this.setSelected(t.initiallySelectedFeatureIds.filter(r=>this.getFeature(r)!==void 0)),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),t};Y.fireUpdate=function(){this.fire(me.UPDATE,{action:it.MOVE,features:this.getSelected().map(e=>e.toGeoJSON())})};Y.fireActionable=function(){const e=this.getSelected(),t=e.filter(s=>this.isInstanceOf("MultiFeature",s));let r=!1;if(e.length>1){r=!0;const s=e[0].type.replace("Multi","");e.forEach(a=>{a.type.replace("Multi","")!==s&&(r=!1)})}const n=t.length>0,o=e.length>0;this.setActionableState({combineFeatures:r,uncombineFeatures:n,trash:o})};Y.getUniqueIds=function(e){return e.length?e.map(r=>r.properties.id).filter(r=>r!==void 0).reduce((r,n)=>(r.add(n),r),new Ce).values():[]};Y.stopExtendedInteractions=function(e){e.boxSelectElement&&(e.boxSelectElement.parentNode&&e.boxSelectElement.parentNode.removeChild(e.boxSelectElement),e.boxSelectElement=null),(e.canDragMove||e.canBoxSelect)&&e.initialDragPanState===!0&&this.map.dragPan.enable(),e.boxSelecting=!1,e.canBoxSelect=!1,e.dragMoving=!1,e.canDragMove=!1};Y.onStop=function(){Me.enable(this)};Y.onMouseMove=function(e,t){return Zt(t)&&e.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(e),!0};Y.onMouseOut=function(e){return e.dragMoving?this.fireUpdate():!0};Y.onTap=Y.onClick=function(e,t){if(Pt(t))return this.clickAnywhere(e,t);if(wt(de.VERTEX)(t))return this.clickOnVertex(e,t);if(Zt(t))return this.clickOnFeature(e,t)};Y.clickAnywhere=function(e){const t=this.getSelectedIds();t.length&&(this.clearSelectedFeatures(),t.forEach(r=>this.doRender(r))),Me.enable(this),this.stopExtendedInteractions(e)};Y.clickOnVertex=function(e,t){this.changeMode(B.DIRECT_SELECT,{featureId:t.featureTarget.properties.parent,coordPath:t.featureTarget.properties.coord_path,startPos:t.lngLat}),this.updateUIClasses({mouse:ee.MOVE})};Y.startOnActiveFeature=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),this.doRender(t.featureTarget.properties.id),e.canDragMove=!0,e.dragMoveLocation=t.lngLat};Y.clickOnFeature=function(e,t){Me.disable(this),this.stopExtendedInteractions(e);const r=vt(t),n=this.getSelectedIds(),o=t.featureTarget.properties.id,s=this.isSelected(o);if(!r&&s&&this.getFeature(o).type!==P.POINT)return this.changeMode(B.DIRECT_SELECT,{featureId:o});s&&r?(this.deselect(o),this.updateUIClasses({mouse:ee.POINTER}),n.length===1&&Me.enable(this)):!s&&r?(this.select(o),this.updateUIClasses({mouse:ee.MOVE})):!s&&!r&&(n.forEach(a=>this.doRender(a)),this.setSelected(o),this.updateUIClasses({mouse:ee.MOVE})),this.doRender(o)};Y.onMouseDown=function(e,t){if(e.initialDragPanState=this.map.dragPan.isEnabled(),Ge(t))return this.startOnActiveFeature(e,t);if(this.drawConfig.boxSelect&&Zr(t))return this.startBoxSelect(e,t)};Y.startBoxSelect=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),e.boxSelectStartLocation=tr(t.originalEvent,this.map.getContainer()),e.canBoxSelect=!0};Y.onTouchStart=function(e,t){if(Ge(t))return this.startOnActiveFeature(e,t)};Y.onDrag=function(e,t){if(e.canDragMove)return this.dragMove(e,t);if(this.drawConfig.boxSelect&&e.canBoxSelect)return this.whileBoxSelect(e,t)};Y.whileBoxSelect=function(e,t){e.boxSelecting=!0,this.updateUIClasses({mouse:ee.ADD}),e.boxSelectElement||(e.boxSelectElement=document.createElement("div"),e.boxSelectElement.classList.add(ge.BOX_SELECT),this.map.getContainer().appendChild(e.boxSelectElement));const r=tr(t.originalEvent,this.map.getContainer()),n=Math.min(e.boxSelectStartLocation.x,r.x),o=Math.max(e.boxSelectStartLocation.x,r.x),s=Math.min(e.boxSelectStartLocation.y,r.y),a=Math.max(e.boxSelectStartLocation.y,r.y),d=`translate(${n}px, ${s}px)`;e.boxSelectElement.style.transform=d,e.boxSelectElement.style.WebkitTransform=d,e.boxSelectElement.style.width=`${o-n}px`,e.boxSelectElement.style.height=`${a-s}px`};Y.dragMove=function(e,t){e.dragMoving=!0,t.originalEvent.stopPropagation();const r={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};or(this.getSelected(),r),e.dragMoveLocation=t.lngLat};Y.onTouchEnd=Y.onMouseUp=function(e,t){if(e.dragMoving)this.fireUpdate();else if(e.boxSelecting){const r=[e.boxSelectStartLocation,tr(t.originalEvent,this.map.getContainer())],n=this.featuresAt(null,r,"click"),o=this.getUniqueIds(n).filter(s=>!this.isSelected(s));o.length&&(this.select(o),o.forEach(s=>this.doRender(s)),this.updateUIClasses({mouse:ee.MOVE}))}this.stopExtendedInteractions(e)};Y.toDisplayFeatures=function(e,t,r){t.properties.active=this.isSelected(t.properties.id)?ce.ACTIVE:ce.INACTIVE,r(t),this.fireActionable(),!(t.properties.active!==ce.ACTIVE||t.geometry.type===P.POINT)&&Lt(t).forEach(r)};Y.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()};Y.onCombineFeatures=function(){const e=this.getSelected();if(e.length===0||e.length<2)return;const t=[],r=[],n=e[0].type.replace("Multi","");for(let o=0;o<e.length;o++){const s=e[o];if(s.type.replace("Multi","")!==n)return;s.type.includes("Multi")?s.getCoordinates().forEach(a=>{t.push(a)}):t.push(s.getCoordinates()),r.push(s.toGeoJSON())}if(r.length>1){const o=this.newFeature({type:P.FEATURE,properties:r[0].properties,geometry:{type:`Multi${n}`,coordinates:t}});this.addFeature(o),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([o.id]),this.fire(me.COMBINE_FEATURES,{createdFeatures:[o.toGeoJSON()],deletedFeatures:r})}this.fireActionable()};Y.onUncombineFeatures=function(){const e=this.getSelected();if(e.length===0)return;const t=[],r=[];for(let n=0;n<e.length;n++){const o=e[n];this.isInstanceOf("MultiFeature",o)&&(o.getFeatures().forEach(s=>{this.addFeature(s),s.properties=o.properties,t.push(s.toGeoJSON()),this.select([s.id])}),this.deleteFeature(o.id,{silent:!0}),r.push(o.toGeoJSON()))}t.length>1&&this.fire(me.UNCOMBINE_FEATURES,{createdFeatures:t,deletedFeatures:r}),this.fireActionable()};const gn=wt(de.VERTEX),yn=wt(de.MIDPOINT),J={};J.fireUpdate=function(){this.fire(me.UPDATE,{action:it.CHANGE_COORDINATES,features:this.getSelected().map(e=>e.toGeoJSON())})};J.fireActionable=function(e){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:e.selectedCoordPaths.length>0})};J.startDragging=function(e,t){e.initialDragPanState==null&&(e.initialDragPanState=this.map.dragPan.isEnabled()),this.map.dragPan.disable(),e.canDragMove=!0,e.dragMoveLocation=t.lngLat};J.stopDragging=function(e){e.canDragMove&&e.initialDragPanState===!0&&this.map.dragPan.enable(),e.initialDragPanState=null,e.dragMoving=!1,e.canDragMove=!1,e.dragMoveLocation=null};J.onVertex=function(e,t){this.startDragging(e,t);const r=t.featureTarget.properties,n=e.selectedCoordPaths.indexOf(r.coord_path);!vt(t)&&n===-1?e.selectedCoordPaths=[r.coord_path]:vt(t)&&n===-1&&e.selectedCoordPaths.push(r.coord_path);const o=this.pathsToCoordinates(e.featureId,e.selectedCoordPaths);this.setSelectedCoordinates(o)};J.onMidpoint=function(e,t){this.startDragging(e,t);const r=t.featureTarget.properties;e.feature.addCoordinate(r.coord_path,r.lng,r.lat),this.fireUpdate(),e.selectedCoordPaths=[r.coord_path]};J.pathsToCoordinates=function(e,t){return t.map(r=>({feature_id:e,coord_path:r}))};J.onFeature=function(e,t){e.selectedCoordPaths.length===0?this.startDragging(e,t):this.stopDragging(e)};J.dragFeature=function(e,t,r){or(this.getSelected(),r),e.dragMoveLocation=t.lngLat};J.dragVertex=function(e,t,r){const n=e.selectedCoordPaths.map(a=>e.feature.getCoordinate(a)),o=n.map(a=>({type:P.FEATURE,properties:{},geometry:{type:P.POINT,coordinates:a}})),s=nr(o,r);for(let a=0;a<n.length;a++){const d=n[a];e.feature.updateCoordinate(e.selectedCoordPaths[a],d[0]+s.lng,d[1]+s.lat)}};J.clickNoTarget=function(){this.changeMode(B.SIMPLE_SELECT)};J.clickInactive=function(){this.changeMode(B.SIMPLE_SELECT)};J.clickActiveFeature=function(e){e.selectedCoordPaths=[],this.clearSelectedCoordinates(),e.feature.changed()};J.onSetup=function(e){const t=e.featureId,r=this.getFeature(t);if(!r)throw new Error("You must provide a featureId to enter direct_select mode");if(r.type===P.POINT)throw new TypeError("direct_select mode doesn't handle point features");const n={featureId:t,feature:r,dragMoveLocation:e.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:e.coordPath?[e.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(t,n.selectedCoordPaths)),this.setSelected(t),Me.disable(this),this.setActionableState({trash:!0}),n};J.onStop=function(){Me.enable(this),this.clearSelectedCoordinates()};J.toDisplayFeatures=function(e,t,r){e.featureId===t.properties.id?(t.properties.active=ce.ACTIVE,r(t),Lt(t,{map:this.map,midpoints:!0,selectedPaths:e.selectedCoordPaths}).forEach(r)):(t.properties.active=ce.INACTIVE,r(t)),this.fireActionable(e)};J.onTrash=function(e){e.selectedCoordPaths.sort((t,r)=>r.localeCompare(t,"en",{numeric:!0})).forEach(t=>e.feature.removeCoordinate(t)),this.fireUpdate(),e.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(e),e.feature.isValid()===!1&&(this.deleteFeature([e.featureId]),this.changeMode(B.SIMPLE_SELECT,{}))};J.onMouseMove=function(e,t){const r=Ge(t),n=gn(t),o=yn(t),s=e.selectedCoordPaths.length===0;return r&&s?this.updateUIClasses({mouse:ee.MOVE}):n&&!s?this.updateUIClasses({mouse:ee.MOVE}):this.updateUIClasses({mouse:ee.NONE}),(n||r||o)&&e.dragMoving&&this.fireUpdate(),this.stopDragging(e),!0};J.onMouseOut=function(e){return e.dragMoving&&this.fireUpdate(),!0};J.onTouchStart=J.onMouseDown=function(e,t){if(gn(t))return this.onVertex(e,t);if(Ge(t))return this.onFeature(e,t);if(yn(t))return this.onMidpoint(e,t)};J.onDrag=function(e,t){if(e.canDragMove!==!0)return;e.dragMoving=!0,t.originalEvent.stopPropagation();const r={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};e.selectedCoordPaths.length>0?this.dragVertex(e,t,r):this.dragFeature(e,t,r),e.dragMoveLocation=t.lngLat};J.onClick=function(e,t){if(Pt(t))return this.clickNoTarget(e,t);if(Ge(t))return this.clickActiveFeature(e,t);if(Xt(t))return this.clickInactive(e,t);this.stopDragging(e)};J.onTap=function(e,t){if(Pt(t))return this.clickNoTarget(e,t);if(Ge(t))return this.clickActiveFeature(e,t);if(Xt(t))return this.clickInactive(e,t)};J.onTouchEnd=J.onMouseUp=function(e){e.dragMoving&&this.fireUpdate(),this.stopDragging(e)};const ke={};ke.onSetup=function(){const e=this.newFeature({type:P.FEATURE,properties:{},geometry:{type:P.POINT,coordinates:[]}});return this.addFeature(e),this.clearSelectedFeatures(),this.updateUIClasses({mouse:ee.ADD}),this.activateUIButton(ye.POINT),this.setActionableState({trash:!0}),{point:e}};ke.stopDrawingAndRemove=function(e){this.deleteFeature([e.point.id],{silent:!0}),this.changeMode(B.SIMPLE_SELECT)};ke.onTap=ke.onClick=function(e,t){this.updateUIClasses({mouse:ee.MOVE}),e.point.updateCoordinate("",t.lngLat.lng,t.lngLat.lat),this.fire(me.CREATE,{features:[e.point.toGeoJSON()]}),this.changeMode(B.SIMPLE_SELECT,{featureIds:[e.point.id]})};ke.onStop=function(e){this.activateUIButton(),e.point.getCoordinate().length||this.deleteFeature([e.point.id],{silent:!0})};ke.toDisplayFeatures=function(e,t,r){const n=t.properties.id===e.point.id;if(t.properties.active=n?ce.ACTIVE:ce.INACTIVE,!n)return r(t)};ke.onTrash=ke.stopDrawingAndRemove;ke.onKeyUp=function(e,t){if(Mt(t)||It(t))return this.stopDrawingAndRemove(e,t)};function Tt(e,t){return e.lngLat?e.lngLat.lng===t[0]&&e.lngLat.lat===t[1]:!1}const Ie={};Ie.onSetup=function(){const e=this.newFeature({type:P.FEATURE,properties:{},geometry:{type:P.POLYGON,coordinates:[[]]}});return this.addFeature(e),this.clearSelectedFeatures(),Me.disable(this),this.updateUIClasses({mouse:ee.ADD}),this.activateUIButton(ye.POLYGON),this.setActionableState({trash:!0}),{polygon:e,currentVertexPosition:0}};Ie.clickAnywhere=function(e,t){if(e.currentVertexPosition>0&&Tt(t,e.polygon.coordinates[0][e.currentVertexPosition-1]))return this.changeMode(B.SIMPLE_SELECT,{featureIds:[e.polygon.id]});this.updateUIClasses({mouse:ee.ADD}),e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat),e.currentVertexPosition++,e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat)};Ie.clickOnVertex=function(e){return this.changeMode(B.SIMPLE_SELECT,{featureIds:[e.polygon.id]})};Ie.onMouseMove=function(e,t){e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat),at(t)&&this.updateUIClasses({mouse:ee.POINTER})};Ie.onTap=Ie.onClick=function(e,t){return at(t)?this.clickOnVertex(e,t):this.clickAnywhere(e,t)};Ie.onKeyUp=function(e,t){Mt(t)?(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(B.SIMPLE_SELECT)):It(t)&&this.changeMode(B.SIMPLE_SELECT,{featureIds:[e.polygon.id]})};Ie.onStop=function(e){this.updateUIClasses({mouse:ee.NONE}),Me.enable(this),this.activateUIButton(),this.getFeature(e.polygon.id)!==void 0&&(e.polygon.removeCoordinate(`0.${e.currentVertexPosition}`),e.polygon.isValid()?this.fire(me.CREATE,{features:[e.polygon.toGeoJSON()]}):(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(B.SIMPLE_SELECT,{},{silent:!0})))};Ie.toDisplayFeatures=function(e,t,r){const n=t.properties.id===e.polygon.id;if(t.properties.active=n?ce.ACTIVE:ce.INACTIVE,!n)return r(t);if(t.geometry.coordinates.length===0)return;const o=t.geometry.coordinates[0].length;if(!(o<3)){if(t.properties.meta=de.FEATURE,r(Je(e.polygon.id,t.geometry.coordinates[0][0],"0.0",!1)),o>3){const s=t.geometry.coordinates[0].length-3;r(Je(e.polygon.id,t.geometry.coordinates[0][s],`0.${s}`,!1))}if(o<=4){const s=[[t.geometry.coordinates[0][0][0],t.geometry.coordinates[0][0][1]],[t.geometry.coordinates[0][1][0],t.geometry.coordinates[0][1][1]]];if(r({type:P.FEATURE,properties:t.properties,geometry:{coordinates:s,type:P.LINE_STRING}}),o===3)return}return r(t)}};Ie.onTrash=function(e){this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(B.SIMPLE_SELECT)};const Ne={};Ne.onSetup=function(e){e=e||{};const t=e.featureId;let r,n,o="forward";if(t){if(r=this.getFeature(t),!r)throw new Error("Could not find a feature with the provided featureId");let s=e.from;if(s&&s.type==="Feature"&&s.geometry&&s.geometry.type==="Point"&&(s=s.geometry),s&&s.type==="Point"&&s.coordinates&&s.coordinates.length===2&&(s=s.coordinates),!s||!Array.isArray(s))throw new Error("Please use the `from` property to indicate which point to continue the line from");const a=r.coordinates.length-1;if(r.coordinates[a][0]===s[0]&&r.coordinates[a][1]===s[1])n=a+1,r.addCoordinate(n,...r.coordinates[a]);else if(r.coordinates[0][0]===s[0]&&r.coordinates[0][1]===s[1])o="backwards",n=0,r.addCoordinate(n,...r.coordinates[0]);else throw new Error("`from` should match the point at either the start or the end of the provided LineString")}else r=this.newFeature({type:P.FEATURE,properties:{},geometry:{type:P.LINE_STRING,coordinates:[]}}),n=0,this.addFeature(r);return this.clearSelectedFeatures(),Me.disable(this),this.updateUIClasses({mouse:ee.ADD}),this.activateUIButton(ye.LINE),this.setActionableState({trash:!0}),{line:r,currentVertexPosition:n,direction:o}};Ne.clickAnywhere=function(e,t){if(e.currentVertexPosition>0&&Tt(t,e.line.coordinates[e.currentVertexPosition-1])||e.direction==="backwards"&&Tt(t,e.line.coordinates[e.currentVertexPosition+1]))return this.changeMode(B.SIMPLE_SELECT,{featureIds:[e.line.id]});this.updateUIClasses({mouse:ee.ADD}),e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),e.direction==="forward"?(e.currentVertexPosition++,e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)):e.line.addCoordinate(0,t.lngLat.lng,t.lngLat.lat)};Ne.clickOnVertex=function(e){return this.changeMode(B.SIMPLE_SELECT,{featureIds:[e.line.id]})};Ne.onMouseMove=function(e,t){e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),at(t)&&this.updateUIClasses({mouse:ee.POINTER})};Ne.onTap=Ne.onClick=function(e,t){if(at(t))return this.clickOnVertex(e,t);this.clickAnywhere(e,t)};Ne.onKeyUp=function(e,t){It(t)?this.changeMode(B.SIMPLE_SELECT,{featureIds:[e.line.id]}):Mt(t)&&(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(B.SIMPLE_SELECT))};Ne.onStop=function(e){Me.enable(this),this.activateUIButton(),this.getFeature(e.line.id)!==void 0&&(e.line.removeCoordinate(`${e.currentVertexPosition}`),e.line.isValid()?this.fire(me.CREATE,{features:[e.line.toGeoJSON()]}):(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(B.SIMPLE_SELECT,{},{silent:!0})))};Ne.onTrash=function(e){this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(B.SIMPLE_SELECT)};Ne.toDisplayFeatures=function(e,t,r){const n=t.properties.id===e.line.id;if(t.properties.active=n?ce.ACTIVE:ce.INACTIVE,!n)return r(t);t.geometry.coordinates.length<2||(t.properties.meta=de.FEATURE,r(Je(e.line.id,t.geometry.coordinates[e.direction==="forward"?t.geometry.coordinates.length-2:1],`${e.direction==="forward"?t.geometry.coordinates.length-2:1}`,!1)),r(t))};const bn={simple_select:Y,direct_select:J,draw_point:ke,draw_polygon:Ie,draw_line_string:Ne},Do={defaultMode:B.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:cn,modes:bn,controls:{},userProperties:!1,suppressAPIEvents:!0},Fo={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},Ro={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function Fr(e,t){return e.map(r=>r.source?r:Object.assign({},r,{id:`${r.id}.${t}`,source:t==="hot"?Ee.HOT:Ee.COLD}))}function jo(e={}){let t=Object.assign({},e);return e.controls||(t.controls={}),e.displayControlsDefault===!1?t.controls=Object.assign({},Ro,e.controls):t.controls=Object.assign({},Fo,e.controls),t=Object.assign({},Do,t),t.styles=Fr(t.styles,"cold").concat(Fr(t.styles,"hot")),t}var Bt,Rr;function $o(){return Rr||(Rr=1,Bt=function e(t,r){if(t===r)return!0;if(t&&r&&typeof t=="object"&&typeof r=="object"){if(t.constructor!==r.constructor)return!1;var n,o,s;if(Array.isArray(t)){if(n=t.length,n!=r.length)return!1;for(o=n;o--!==0;)if(!e(t[o],r[o]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if(s=Object.keys(t),n=s.length,n!==Object.keys(r).length)return!1;for(o=n;o--!==0;)if(!Object.prototype.hasOwnProperty.call(r,s[o]))return!1;for(o=n;o--!==0;){var a=s[o];if(!e(t[a],r[a]))return!1}return!0}return t!==t&&r!==r}),Bt}var Uo=$o();const jr=Kt(Uo);var qt,$r;function Bo(){if($r)return qt;$r=1,qt=t;var e={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function t(r){if(!r||!r.type)return null;var n=e[r.type];if(!n)return null;if(n==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:r}]};if(n==="feature")return{type:"FeatureCollection",features:[r]};if(n==="featurecollection")return r}return qt}var qo=Bo();const Go=Kt(qo);function xn(e,t){return e.length!==t.length?!1:JSON.stringify(e.map(r=>r).sort())===JSON.stringify(t.map(r=>r).sort())}const Vo={Polygon:xe,LineString:De,Point:$e,MultiPolygon:fe,MultiLineString:fe,MultiPoint:fe};function zo(e,t){t.modes=B;const r=e.options.suppressAPIEvents!==void 0?!!e.options.suppressAPIEvents:!0;return t.getFeatureIdsAt=function(n){return Ye.click({point:n},null,e).map(s=>s.properties.id)},t.getSelectedIds=function(){return e.store.getSelectedIds()},t.getSelected=function(){return{type:P.FEATURE_COLLECTION,features:e.store.getSelectedIds().map(n=>e.store.get(n)).map(n=>n.toGeoJSON())}},t.getSelectedPoints=function(){return{type:P.FEATURE_COLLECTION,features:e.store.getSelectedCoordinates().map(n=>({type:P.FEATURE,properties:{},geometry:{type:P.POINT,coordinates:n.coordinates}}))}},t.set=function(n){if(n.type===void 0||n.type!==P.FEATURE_COLLECTION||!Array.isArray(n.features))throw new Error("Invalid FeatureCollection");const o=e.store.createRenderBatch();let s=e.store.getAllIds().slice();const a=t.add(n),d=new Ce(a);return s=s.filter(f=>!d.has(f)),s.length&&t.delete(s),o(),a},t.add=function(n){const s=JSON.parse(JSON.stringify(Go(n))).features.map(a=>{if(a.id=a.id||er(),a.geometry===null)throw new Error("Invalid geometry: null");if(e.store.get(a.id)===void 0||e.store.get(a.id).type!==a.geometry.type){const d=Vo[a.geometry.type];if(d===void 0)throw new Error(`Invalid geometry type: ${a.geometry.type}.`);const f=new d(e,a);e.store.add(f,{silent:r})}else{const d=e.store.get(a.id),f=d.properties;d.properties=a.properties,jr(f,a.properties)||e.store.featureChanged(d.id,{silent:r}),jr(d.getCoordinates(),a.geometry.coordinates)||d.incomingCoords(a.geometry.coordinates)}return a.id});return e.store.render(),s},t.get=function(n){const o=e.store.get(n);if(o)return o.toGeoJSON()},t.getAll=function(){return{type:P.FEATURE_COLLECTION,features:e.store.getAll().map(n=>n.toGeoJSON())}},t.delete=function(n){return e.store.delete(n,{silent:r}),t.getMode()===B.DIRECT_SELECT&&!e.store.getSelectedIds().length?e.events.changeMode(B.SIMPLE_SELECT,void 0,{silent:r}):e.store.render(),t},t.deleteAll=function(){return e.store.delete(e.store.getAllIds(),{silent:r}),t.getMode()===B.DIRECT_SELECT?e.events.changeMode(B.SIMPLE_SELECT,void 0,{silent:r}):e.store.render(),t},t.changeMode=function(n,o={}){return n===B.SIMPLE_SELECT&&t.getMode()===B.SIMPLE_SELECT?(xn(o.featureIds||[],e.store.getSelectedIds())||(e.store.setSelected(o.featureIds,{silent:r}),e.store.render()),t):(n===B.DIRECT_SELECT&&t.getMode()===B.DIRECT_SELECT&&o.featureId===e.store.getSelectedIds()[0]||e.events.changeMode(n,o,{silent:r}),t)},t.getMode=function(){return e.events.getMode()},t.trash=function(){return e.events.trash({silent:r}),t},t.combineFeatures=function(){return e.events.combineFeatures({silent:r}),t},t.uncombineFeatures=function(){return e.events.uncombineFeatures({silent:r}),t},t.setFeatureProperty=function(n,o,s){return e.store.setFeatureProperty(n,o,s,{silent:r}),t},t}const Wo=Object.freeze(Object.defineProperty({__proto__:null,CommonSelectors:oo,ModeHandler:Jt,StringSet:Ce,constrainFeatureMovement:nr,createMidPoint:hn,createSupplementaryPoints:Lt,createVertex:Je,doubleClickZoom:Me,euclideanDistance:Qt,featuresAt:Ye,getFeatureAtAndSetCursors:St,isClick:Ht,isEventAtCoordinates:Tt,isTap:Yt,mapEventToBoundingBox:on,moveFeatures:or,sortFeatures:nn,stringSetsAreEqual:xn,theme:cn,toDenseArray:lt},Symbol.toStringTag,{value:"Module"})),Ho=function(e,t){e=jo(e);const r={options:e};t=zo(r,t),r.api=t;const n=Io(r);return t.onAdd=n.onAdd,t.onRemove=n.onRemove,t.types=ye,t.options=e,t};function _t(e){Ho(e,this)}_t.modes=bn;_t.constants=Xr;_t.lib=Wo;const Yo=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),Jo=e=>{if(!e)return"N/A";const t=e.numBedrooms,r=e.numBedroomsPlus;return t&&r&&r>0?`${t} + ${r}`:(t==null?void 0:t.toString())||"N/A"},Ko=e=>{if(!e)return"N/A";const t=e.numBathrooms,r=e.numBathroomsPlus;return t&&r&&r>0?`${t} + ${r}`:(t==null?void 0:t.toString())||"N/A"},Xo=e=>{var t;return e&&((t=e.numGarageSpaces)==null?void 0:t.toString())||"N/A"},Zo=(e,t)=>t==="New"||t==="Pc"||t==="Ext"?e==="Sale"?"For Sale":e==="Lease"?"For Lease":e||null:t?{Sus:"Suspended",Exp:"Expired",Sld:"Sold",Ter:"Terminated",Dft:"Deal Fell Through",Lsd:"Leased",Sc:"Sold Conditionally",Sce:"Sold Conditionally (Escape Clause)",Lc:"Leased Conditionally",Cs:"Coming Soon"}[t]||t:null,Qo=e=>{if(!e)return"Address not available";const r=[e.streetNumber,e.streetDirection,e.streetName,e.streetSuffix].filter(Boolean).join(" "),n=[e.city,e.state].filter(Boolean).join(", ");return[r,n].filter(Boolean).join(", ")},Sn=({type:e,lastStatus:t,size:r="sm"})=>{const n=Zo(e,t);if(!n)return null;let o="bg-green-100 text-green-600";switch(n){case"For Sale":o="bg-green-100 text-green-600";break;case"For Lease":o="bg-purple-100 text-purple-600";break;case"Sold":o="bg-blue-100 text-blue-600";break;case"Leased":o="bg-purple-100 text-purple-600";break;case"Sold Conditionally":case"Sold Conditionally (Escape Clause)":case"Leased Conditionally":o="bg-amber-100 text-amber-600";break;case"Coming Soon":o="bg-indigo-100 text-indigo-600";break;case"Suspended":o="bg-orange-100 text-orange-600";break;case"Expired":o="bg-gray-100 text-gray-500";break;case"Terminated":case"Deal Fell Through":o="bg-red-100 text-red-600";break;default:o="bg-gray-100 text-gray-500"}const s=r==="xs"?"text-xs":"text-sm";return i.jsx("span",{className:`${s} px-2 py-1 rounded-md font-medium ${o}`,children:n})};Sn.__docgenInfo={description:"",methods:[],displayName:"StatusTag",props:{type:{required:!1,tsType:{name:"string"},description:""},lastStatus:{required:!1,tsType:{name:"string"},description:""},size:{required:!1,tsType:{name:"union",raw:'"xs" | "sm"',elements:[{name:"literal",value:'"xs"'},{name:"literal",value:'"sm"'}]},description:"",defaultValue:{value:'"sm"',computed:!1}}}};function sr({listing:e,onClick:t}){var r,n;return i.jsx("div",{className:"p-4 cursor-pointer hover:bg-gray-50 transition-colors duration-200",onClick:t,children:i.jsxs("div",{className:"flex items-start gap-4",children:[i.jsx("div",{className:"bg-gray-100 rounded-md overflow-hidden flex-shrink-0 h-20 aspect-[4/3]",children:(r=e.images)!=null&&r[0]?i.jsx("img",{src:`https://cdn.repliers.io/${e.images[0]}?class=small`,alt:"Property",className:"object-cover w-full h-full"}):i.jsx("div",{className:"flex items-center justify-center h-full text-gray-400 text-sm",children:"No Image"})}),i.jsxs("div",{className:"flex-grow min-w-0",children:[i.jsxs("div",{className:"flex justify-between items-start mb-2",children:[i.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[i.jsx("h4",{className:"font-semibold text-gray-800 truncate text-base",children:e.listPrice?Yo(e.listPrice):"Price N/A"}),i.jsx("span",{className:"text-gray-400 text-sm",children:"|"}),i.jsx("span",{className:"text-gray-600 truncate text-sm",children:e.mlsNumber})]}),i.jsx("div",{className:"flex-shrink-0 ml-2",children:i.jsx(Sn,{type:e.type,lastStatus:e.lastStatus,size:"sm"})})]}),i.jsx("p",{className:"text-gray-600 leading-relaxed text-sm mb-2",children:Qo(e.address)}),i.jsxs("div",{className:"flex items-center text-gray-500 space-x-3 flex-wrap text-sm",children:[i.jsxs("span",{className:"flex items-center gap-1",children:[i.jsx($n,{className:"w-4 h-4"}),Jo(e.details)]}),i.jsxs("span",{className:"flex items-center gap-1",children:[i.jsx(Wr,{className:"w-4 h-4"}),Ko(e.details)]}),i.jsxs("span",{className:"flex items-center gap-1",children:[i.jsx(Un,{className:"w-4 h-4"}),Xo(e.details)]}),((n=e.details)==null?void 0:n.propertyType)&&i.jsxs("span",{className:"text-gray-400",children:["| ",e.details.propertyType]})]})]})]})})}sr.__docgenInfo={description:"",methods:[],displayName:"ListingPreview",props:{listing:{required:!0,tsType:{name:"ListingResult"},description:""},onClick:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};function vn({open:e,onClose:t,listing:r,position:n,mapContainer:o}){const s=h.useRef(null),[a,d]=h.useState({x:0,y:0}),[f,g]=h.useState("bottom"),[u,p]=h.useState(!1);if(h.useEffect(()=>{p(!1)},[e]),h.useEffect(()=>{if(!e||!s.current||!o)return;const m=s.current.getBoundingClientRect(),T=n.x,E=n.y,v=450,N=m.height||200,_=16,O=window.innerWidth,I=window.innerHeight;let S=T-v/2,C=E-N-16,k="bottom";S<_?S=_:S+v>O-_&&(S=O-v-_),C<_&&(C=E+32,k="top"),C+N>I-_&&(T>O/2?(S=T-v-16,C=E-N/2,k="right"):(S=T+16,C=E-N/2,k="left"),C<_&&(C=_),C+N>I-_&&(C=I-N-_)),d({x:S,y:C}),g(k),p(!0)},[e,n,o]),h.useEffect(()=>{const c=m=>{s.current&&!s.current.contains(m.target)&&t()};return e&&document.addEventListener("mousedown",c),()=>{document.removeEventListener("mousedown",c)}},[e,t]),!e||!r)return null;const l=()=>{const c="absolute w-3 h-3 bg-white transform rotate-45 border";switch(f){case"bottom":return`${c} -bottom-1.5 left-1/2 -translate-x-1/2 border-r border-b border-gray-200`;case"top":return`${c} -top-1.5 left-1/2 -translate-x-1/2 border-l border-t border-gray-200`;case"left":return`${c} -left-1.5 top-1/2 -translate-y-1/2 border-l border-b border-gray-200`;case"right":return`${c} -right-1.5 top-1/2 -translate-y-1/2 border-r border-t border-gray-200`;default:return`${c} -bottom-1.5 left-1/2 -translate-x-1/2 border-r border-b border-gray-200`}};return i.jsx("div",{ref:s,className:"fixed w-[450px]",style:{zIndex:9999,left:`${a.x}px`,top:`${a.y}px`,visibility:u?"visible":"hidden",opacity:u?1:0,transition:"opacity 150ms ease-in-out"},children:i.jsxs("div",{className:"bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden relative",children:[i.jsx("div",{className:l()}),i.jsx("button",{onClick:t,className:"absolute top-2 right-2 z-10 p-1 rounded-full bg-white hover:bg-gray-100 transition-colors shadow-sm border border-gray-200","aria-label":"Close",children:i.jsx(Hr,{size:16,className:"text-gray-600"})}),i.jsx(sr,{listing:r,onClick:()=>{}})]})})}vn.__docgenInfo={description:"",methods:[],displayName:"PropertyTooltip",props:{open:{required:!0,tsType:{name:"boolean"},description:""},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},listing:{required:!0,tsType:{name:"union",raw:"ListingResult | null",elements:[{name:"ListingResult"},{name:"null"}]},description:""},position:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  x: number;
  y: number;
}`,signature:{properties:[{key:"x",value:{name:"number",required:!0}},{key:"y",value:{name:"number",required:!0}}]}},description:""},mapContainer:{required:!0,tsType:{name:"union",raw:"HTMLElement | null",elements:[{name:"HTMLElement"},{name:"null"}]},description:""}}};function Tn({open:e,onClose:t,properties:r,position:n,mapContainer:o}){const s=h.useRef(null),[a,d]=h.useState({x:0,y:0}),[f,g]=h.useState("bottom"),[u,p]=h.useState(!1);if(h.useEffect(()=>{if(!e){p(!1);return}},[e]),h.useEffect(()=>{if(!e||!o)return;const c=n.x,m=n.y,T=480,E=Math.min(r.length*120+80,400),v=16,N=window.innerWidth,_=window.innerHeight;let O=c-T/2,I=m-E-16,S="bottom";O<v?O=v:O+T>N-v&&(O=N-T-v),I<v&&(I=m+32,S="top"),I+E>_-v&&(c>N/2?(O=c-T-16,I=m-E/2,S="right"):(O=c+16,I=m-E/2,S="left"),I<v&&(I=v),I+E>_-v&&(I=_-E-v)),d({x:O,y:I}),g(S),p(!0)},[e,n,o,r.length]),h.useEffect(()=>{const c=m=>{s.current&&!s.current.contains(m.target)&&t()};return e&&document.addEventListener("mousedown",c),()=>{document.removeEventListener("mousedown",c)}},[e,t]),!e||r.length===0)return null;const l=()=>{const c="absolute w-3 h-3 bg-white transform rotate-45 border";switch(f){case"bottom":return`${c} -bottom-1.5 left-1/2 -translate-x-1/2 border-r border-b border-gray-200`;case"top":return`${c} -top-1.5 left-1/2 -translate-x-1/2 border-l border-t border-gray-200`;case"left":return`${c} -left-1.5 top-1/2 -translate-y-1/2 border-l border-b border-gray-200`;case"right":return`${c} -right-1.5 top-1/2 -translate-y-1/2 border-r border-t border-gray-200`;default:return`${c} -bottom-1.5 left-1/2 -translate-x-1/2 border-r border-b border-gray-200`}};return i.jsx("div",{ref:s,className:"fixed w-[480px]",style:{zIndex:9999,left:`${a.x}px`,top:`${a.y}px`,visibility:u?"visible":"hidden",opacity:u?1:0,transition:"opacity 150ms ease-in-out"},children:i.jsxs("div",{className:"bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden relative",children:[i.jsx("div",{className:l()}),i.jsxs("div",{className:"px-4 py-3 border-b border-gray-100 bg-gray-50 relative",children:[i.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:r.length===1?"1 Property":`${r.length} Properties`}),i.jsx("button",{onClick:t,className:"absolute top-2 right-2 p-1 rounded-full bg-white hover:bg-gray-100 transition-colors shadow-sm border border-gray-200","aria-label":"Close",children:i.jsx(Hr,{size:16,className:"text-gray-600"})})]}),i.jsx("div",{className:"max-h-[400px] overflow-y-auto",children:r.map((c,m)=>i.jsx("div",{className:"border-b border-gray-100 last:border-b-0",children:i.jsx(sr,{listing:c,onClick:()=>{}})},`${c.mlsNumber}-${m}`))})]})})}Tn.__docgenInfo={description:"",methods:[],displayName:"ClusterTooltip",props:{open:{required:!0,tsType:{name:"boolean"},description:""},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},properties:{required:!0,tsType:{name:"Array",elements:[{name:"ListingResult"}],raw:"ListingResult[]"},description:""},position:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  x: number;
  y: number;
}`,signature:{properties:[{key:"x",value:{name:"number",required:!0}},{key:"y",value:{name:"number",required:!0}}]}},description:""},mapContainer:{required:!0,tsType:{name:"union",raw:"HTMLElement | null",elements:[{name:"HTMLElement"},{name:"null"}]},description:""}}};const Ur="i'm looking for a 2 bedroom 2 bathroom condo to rent in rosedale",es=50;function En({value:e,onChange:t,onFocus:r,onSearch:n,isSearching:o,placeholder:s}){const[a,d]=h.useState(""),[f,g]=h.useState(!0);h.useEffect(()=>{e.length>0&&g(!1)},[e]),h.useEffect(()=>{if(f)if(a.length<Ur.length){const p=setTimeout(()=>{d(Ur.slice(0,a.length+1))},es);return()=>clearTimeout(p)}else{const p=setTimeout(()=>{d("")},2e3);return()=>clearTimeout(p)}},[a,f]);const u=p=>{p.key==="Enter"&&!p.shiftKey&&(p.preventDefault(),n())};return i.jsxs("div",{style:{position:"relative"},children:[i.jsx("textarea",{value:e,onChange:p=>t(p.target.value),onKeyDown:u,placeholder:a,rows:1,style:{width:"100%",height:"120px",padding:"20px 60px 20px 20px",fontSize:"16px",border:"2px solid #e5e7eb",borderRadius:"12px",background:"#f9fafb",outline:"none",transition:"all 200ms ease",resize:"none",fontFamily:"inherit",lineHeight:"1.5",verticalAlign:"top"},onFocus:p=>{p.currentTarget.style.borderColor="#6366f1",p.currentTarget.style.background="white",p.currentTarget.style.boxShadow="0 0 0 3px rgba(99, 102, 241, 0.1)",r()},onBlur:p=>{p.currentTarget.style.borderColor="#e5e7eb",p.currentTarget.style.background="#f9fafb",p.currentTarget.style.boxShadow="none"}}),i.jsx("button",{onClick:n,disabled:o||!e.trim(),style:{position:"absolute",right:"16px",bottom:"16px",width:"32px",height:"32px",background:o||!e.trim()?"#d1d5db":"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)",border:"none",borderRadius:"6px",boxShadow:"0 2px 8px rgba(79, 70, 229, 0.3)",cursor:o||!e.trim()?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 200ms ease",color:"white"},onMouseEnter:p=>{!o&&e.trim()&&(p.currentTarget.style.transform="scale(1.05)",p.currentTarget.style.boxShadow="0 4px 12px rgba(79, 70, 229, 0.4)")},onMouseLeave:p=>{p.currentTarget.style.transform="scale(1)",p.currentTarget.style.boxShadow="0 2px 8px rgba(79, 70, 229, 0.3)"},children:o?i.jsx(Yr,{size:14,className:"animate-spin"}):i.jsx(Bn,{size:14})})]})}En.__docgenInfo={description:"",methods:[],displayName:"SearchInput",props:{value:{required:!0,tsType:{name:"string"},description:""},onChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(value: string) => void",signature:{arguments:[{type:{name:"string"},name:"value"}],return:{name:"void"}}},description:""},onFocus:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onSearch:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},isSearching:{required:!0,tsType:{name:"boolean"},description:""},placeholder:{required:!1,tsType:{name:"string"},description:""}}};function st(e){const t=e.getHours(),r=e.getMinutes(),n=t>=12?"PM":"AM",o=t%12||12,s=r.toString().padStart(2,"0");return`${o}:${s} ${n}`}function Br(e,t){if(!e)return null;const r=[];if(e.neighborhood&&r.push(i.jsxs("button",{onClick:t,className:"inline-flex items-center gap-1.5 px-3 py-1.5 bg-white border border-indigo-200 rounded-full text-sm font-medium shadow-sm border-indigo-200 text-indigo-700 hover:bg-indigo-50 transition-colors cursor-pointer",children:[i.jsx(qn,{className:"w-3.5 h-3.5"}),i.jsx("span",{className:"text-gray-500",children:"Neighborhood:"}),i.jsx("span",{children:e.neighborhood})]},"neighborhood")),e.city&&r.push(i.jsxs("button",{onClick:t,className:"inline-flex items-center gap-1.5 px-3 py-1.5 bg-white border border-indigo-200 rounded-full text-sm font-medium shadow-sm border-indigo-200 text-indigo-700 hover:bg-indigo-50 transition-colors cursor-pointer",children:[i.jsx(Gn,{className:"w-3.5 h-3.5"}),i.jsx("span",{className:"text-gray-500",children:"City:"}),i.jsx("span",{children:e.city})]},"city")),e.propertyTypes&&e.propertyTypes.length>0&&r.push(i.jsxs("button",{onClick:t,className:"inline-flex items-center gap-1.5 px-3 py-1.5 bg-white border border-indigo-200 rounded-full text-sm font-medium shadow-sm border-indigo-200 text-indigo-700 hover:bg-indigo-50 transition-colors cursor-pointer",children:[i.jsx(Cr,{className:"w-3.5 h-3.5"}),i.jsx("span",{className:"text-gray-500",children:"Type:"}),i.jsx("span",{children:e.propertyTypes.join(", ")})]},"propertyTypes")),e.bedrooms&&e.bedrooms!=="all"&&r.push(i.jsxs("button",{onClick:t,className:"inline-flex items-center gap-1.5 px-3 py-1.5 bg-white border border-indigo-200 rounded-full text-sm font-medium shadow-sm border-indigo-200 text-indigo-700 hover:bg-indigo-50 transition-colors cursor-pointer",children:[i.jsx(Vn,{className:"w-3.5 h-3.5"}),i.jsx("span",{className:"text-gray-500",children:"Bedrooms:"}),i.jsx("span",{children:e.bedrooms})]},"bedrooms")),e.bathrooms&&e.bathrooms!=="all"&&r.push(i.jsxs("button",{onClick:t,className:"inline-flex items-center gap-1.5 px-3 py-1.5 bg-white border border-indigo-200 rounded-full text-sm font-medium shadow-sm border-indigo-200 text-indigo-700 hover:bg-indigo-50 transition-colors cursor-pointer",children:[i.jsx(Wr,{className:"w-3.5 h-3.5"}),i.jsx("span",{className:"text-gray-500",children:"Bathrooms:"}),i.jsx("span",{children:e.bathrooms})]},"bathrooms")),e.minPrice||e.maxPrice){const n=e.minPrice?`$${(e.minPrice/1e3).toFixed(0)}K`:"$0",o=e.maxPrice?`$${(e.maxPrice/1e3).toFixed(0)}K`:"Max";r.push(i.jsxs("button",{onClick:t,className:"inline-flex items-center gap-1.5 px-3 py-1.5 bg-white border border-indigo-200 rounded-full text-sm font-medium shadow-sm border-indigo-200 text-indigo-700 hover:bg-indigo-50 transition-colors cursor-pointer",children:[i.jsx(Yn,{className:"w-3.5 h-3.5"}),i.jsx("span",{className:"text-gray-500",children:"Price:"}),i.jsx("span",{children:`${n} - ${o}`})]},"price"))}return e.listingType&&r.push(i.jsxs("button",{onClick:t,className:"inline-flex items-center gap-1.5 px-3 py-1.5 bg-white border border-indigo-200 rounded-full text-sm font-medium shadow-sm border-indigo-200 text-indigo-700 hover:bg-indigo-50 transition-colors cursor-pointer",children:[i.jsx(Cr,{className:"w-3.5 h-3.5"}),i.jsx("span",{className:"text-gray-500",children:"For:"}),i.jsx("span",{children:e.listingType==="sale"?"Sale":"Lease"})]},"listingType")),r.length>0?i.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:r}):null}function Cn({entry:e,onChipClick:t}){const{type:r,timestamp:n,data:o}=e;return r==="search"?i.jsxs("div",{className:"mb-2 animate-fadeIn",children:[i.jsx("div",{className:"text-xs text-gray-400 mb-1",children:st(n)}),i.jsxs("div",{className:"text-sm text-gray-600",children:["Searching for: ",i.jsxs("span",{className:"font-semibold text-gray-800",children:['"',o.query,'"']})]})]}):r==="status"?i.jsxs("div",{className:"mb-3 animate-fadeIn",children:[i.jsx("div",{className:"text-xs text-gray-400 mb-1",children:st(n)}),i.jsxs("div",{className:"flex items-center gap-2 text-sm text-indigo-600",children:[i.jsx(Yr,{className:"w-4 h-4 animate-spin"}),i.jsx("span",{className:"italic",children:o.message||"Processing..."})]})]}):r==="understood"?i.jsxs("div",{className:"mb-4 animate-fadeIn",children:[i.jsx("div",{className:"text-xs text-gray-400 mb-1",children:st(n)}),i.jsx("div",{className:"text-sm text-gray-700 mb-2 leading-relaxed",children:"I was able to process the following search criteria from your original prompt:"}),i.jsx("div",{className:"text-sm text-gray-800 font-medium mb-2",children:o.summary||"Search understood"}),Br(o.filters,t),o.filters&&i.jsx("div",{className:"mt-3",children:i.jsx("button",{onClick:t,className:"text-xs text-indigo-600 hover:text-indigo-700 hover:underline font-medium",children:"Click on a parameter to fine tune your search further "})})]}):r==="update"?i.jsxs("div",{className:"mb-3 animate-fadeIn",children:[i.jsx("div",{className:"text-xs text-gray-400 mb-1",children:st(n)}),i.jsx("div",{className:"text-sm text-gray-700 mb-1",children:o.message}),Br(o.filters,t)]}):r==="polygon"?i.jsxs("div",{className:"mb-3 animate-fadeIn",children:[i.jsx("div",{className:"text-xs text-gray-400 mb-1",children:st(n)}),i.jsx("div",{className:"text-sm text-gray-700",children:o.message})]}):null}Cn.__docgenInfo={description:"",methods:[],displayName:"LogEntry",props:{entry:{required:!0,tsType:{name:"ActivityLogEntry"},description:""},onChipClick:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};function wn({entries:e,maxHeight:t="400px",onChipClick:r}){const n=h.useRef(null);return h.useEffect(()=>{n.current&&n.current.scrollIntoView({behavior:"smooth",block:"end"})},[e]),e.length===0?i.jsx("div",{className:"text-center py-6 text-gray-400 text-sm",children:"No activity yet. Start by searching for properties above."}):i.jsxs("div",{className:"space-y-1 overflow-y-auto pr-2",style:{maxHeight:t},children:[e.map(o=>i.jsx(Cn,{entry:o,onChipClick:r},o.id)),i.jsx("div",{ref:n})]})}wn.__docgenInfo={description:"",methods:[],displayName:"ActivityLog",props:{entries:{required:!0,tsType:{name:"Array",elements:[{name:"ActivityLogEntry"}],raw:"ActivityLogEntry[]"},description:""},maxHeight:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:'"400px"',computed:!1}},onChipClick:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};function ts(e){const[t,r]=h.useState(!1),[n,o]=h.useState(null),[s,a]=h.useState(null);return{processSearch:async g=>{var u;if(!g.trim())return o("Please enter a search query"),null;r(!0),o(null);try{const p={prompt:g.trim(),...s&&{nlpId:s}};console.log(" NLP Request:",p);const l=await fetch("https://api.repliers.io/nlp",{method:"POST",headers:{"REPLIERS-API-KEY":e,"Content-Type":"application/json"},body:JSON.stringify(p)});if(l.status===406)throw new Error(`That doesn't seem to be a property search. Try something like "2 bedroom condo in Toronto"`);if(l.status===401)throw new Error("Invalid API key. Please check your Repliers API key.");if(l.status===429)throw new Error("Too many requests. Please wait a moment and try again.");if(!l.ok)throw new Error(`Search failed: ${l.status} ${l.statusText}`);const c=await l.json();return console.log(" FULL NLP RESPONSE:",JSON.stringify(c,null,2)),console.log(" NLP Response Breakdown:",{nlpId:c.nlpId,url:c.request.url,summary:c.request.summary,body:c.request.body,imageSearchItems:(u=c.request.body)==null?void 0:u.imageSearchItems,locations:c.request.locations,fullResponse:c}),a(c.nlpId),c}catch(p){const l=p instanceof Error?p.message:"Search failed";return o(l),null}finally{r(!1)}},isProcessing:t,error:n,nlpId:s,resetNlpId:()=>{a(null)}}}function rs(e){const r=new URL(e).searchParams,n={},o=r.get("propertyType");o&&(n.propertyTypes=o.split(",").map(v=>v.trim()));const s=r.get("minBeds");if(s){const v=parseInt(s);v===0?n.bedrooms="0":v===1?n.bedrooms="1":v===2?n.bedrooms="2":v===3?n.bedrooms="3":v===4?n.bedrooms="4":v>=5&&(n.bedrooms="5+")}const a=r.get("minBaths");if(a){const v=parseInt(a);v===1?n.bathrooms="1+":v===2?n.bathrooms="2+":v===3?n.bathrooms="3+":v===4?n.bathrooms="4+":v>=5&&(n.bathrooms="5+")}const d=r.get("minPrice");d&&(n.minPrice=parseInt(d));const f=r.get("maxPrice");f&&(n.maxPrice=parseInt(f));const g=r.get("minSqft");g&&(n.minSqft=parseInt(g));const u=r.get("maxSqft");u&&(n.maxSqft=parseInt(u));const p=r.get("minParkingSpaces");p&&(n.garageSpaces=`${p}+`);const l=r.get("type");l==="sale"||l==="Sale"?n.listingType="sale":(l==="lease"||l==="Lease")&&(n.listingType="lease");const c=r.get("status");c==="A"?n.activeListingDays="all":c==="U"?n.unavailableListingDays="all":c==="S"&&(n.soldListingDays="all");const m=r.get("city");m&&(n.city=m);const T=r.get("neighborhood");T&&(n.neighborhood=T);const E=r.get("map");if(E)try{const v=JSON.parse(E);Array.isArray(v)&&(n.map=v)}catch{}return n}function ns(e){return e.request.summary||""}function os(e){const t=e.request.locations;if(!t||t.length===0)return console.log("No locations in NLP response"),null;const r=t[0],n=r.map;if(!n)return console.log("No map data in NLP location"),null;const o=[parseFloat(n.longitude),parseFloat(n.latitude)];let s;n.boundary&&Array.isArray(n.boundary)&&(s=n.boundary);const a=r.type==="neighborhood"?14:r.type==="city"?11:r.type==="area"?10:12;return console.log(" Extracted location from NLP response:",{name:r.name,type:r.type,center:o,zoom:a,hasBounds:!!s}),{center:o,bounds:s,zoom:a}}function Pn({bedrooms:e,bathrooms:t,onBedroomsChange:r,onBathroomsChange:n}){const o=["all","0","1","2","3","4","5+"],s=["all","1+","2+","3+","4+","5+"];return i.jsxs("div",{children:[i.jsxs("div",{style:{marginBottom:"12px"},children:[i.jsx("div",{style:{fontSize:"11px",fontWeight:"600",color:"#6b7280",marginBottom:"6px",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Bedrooms"}),i.jsx("div",{style:{display:"flex",gap:"6px",flexWrap:"wrap"},children:o.map(a=>i.jsx("button",{onClick:()=>r(a),style:{padding:"6px 12px",background:e===a?"#6366f1":"white",color:e===a?"white":"#374151",border:`1px solid ${e===a?"#6366f1":"#d1d5db"}`,borderRadius:"6px",fontSize:"13px",fontWeight:e===a?"600":"400",cursor:"pointer",transition:"all 200ms ease"},onMouseEnter:d=>{e!==a&&(d.currentTarget.style.background="#f9fafb")},onMouseLeave:d=>{e!==a&&(d.currentTarget.style.background="white")},children:a==="all"?"Any":a},a))})]}),i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"11px",fontWeight:"600",color:"#6b7280",marginBottom:"6px",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Bathrooms"}),i.jsx("div",{style:{display:"flex",gap:"6px",flexWrap:"wrap"},children:s.map(a=>i.jsx("button",{onClick:()=>n(a),style:{padding:"6px 12px",background:t===a?"#6366f1":"white",color:t===a?"white":"#374151",border:`1px solid ${t===a?"#6366f1":"#d1d5db"}`,borderRadius:"6px",fontSize:"13px",fontWeight:t===a?"600":"400",cursor:"pointer",transition:"all 200ms ease"},onMouseEnter:d=>{t!==a&&(d.currentTarget.style.background="#f9fafb")},onMouseLeave:d=>{t!==a&&(d.currentTarget.style.background="white")},children:a==="all"?"Any":a},a))})]})]})}Pn.__docgenInfo={description:"",methods:[],displayName:"BedroomBathroomFilter",props:{bedrooms:{required:!0,tsType:{name:"string"},description:""},bathrooms:{required:!0,tsType:{name:"string"},description:""},onBedroomsChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(value: string) => void",signature:{arguments:[{type:{name:"string"},name:"value"}],return:{name:"void"}}},description:""},onBathroomsChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(value: string) => void",signature:{arguments:[{type:{name:"string"},name:"value"}],return:{name:"void"}}},description:""}}};function Mn({filters:e,onFiltersChange:t,apiKey:r}){const[n,o]=h.useState([]),[s,a]=h.useState(!0),[d,f]=h.useState(!1);h.useEffect(()=>{(async()=>{var m,T;try{const E=new URL("https://api.repliers.io/listings");E.searchParams.set("aggregates","details.propertyType"),E.searchParams.set("listings","false"),E.searchParams.set("status","A");const v=await fetch(E.toString(),{headers:{"REPLIERS-API-KEY":r,"Content-Type":"application/json"}});if(!v.ok)throw new Error(`Failed to fetch property types: ${v.status}`);const _=((T=(m=(await v.json()).aggregates)==null?void 0:m.details)==null?void 0:T.propertyType)||{},O=Object.entries(_).sort(([,I],[,S])=>S-I).map(([I])=>I);o(O)}catch{}finally{a(!1)}})()},[r]);const g=c=>{const T=e.propertyTypes.includes(c)?e.propertyTypes.filter(E=>E!==c):[...e.propertyTypes,c];t({...e,propertyTypes:T})},u=()=>{const c=e.propertyTypes.length===n.length;t({...e,propertyTypes:c?[]:[...n]})};if(s)return i.jsx("div",{style:{position:"relative",marginBottom:"12px"},children:i.jsx("div",{style:{padding:"8px 12px",fontSize:"12px",color:"#6b7280",fontStyle:"italic"},children:"Loading property types..."})});const p=e.propertyTypes.length===0||e.propertyTypes.length===n.length,l=e.propertyTypes.length>0&&e.propertyTypes.length<n.length;return i.jsxs("div",{style:{position:"relative",marginBottom:"12px"},children:[i.jsxs("button",{onClick:()=>f(!d),style:{width:"100%",padding:"8px 12px",backgroundColor:"white",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",textAlign:"left"},children:[i.jsx("span",{children:p?"All property types":l?`${e.propertyTypes.length} selected`:"Select property types"}),i.jsx(Jr,{size:16,style:{transform:d?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"}})]}),d&&i.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:"white",border:"1px solid #d1d5db",borderRadius:"6px",marginTop:"4px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",zIndex:1002,maxHeight:"300px",overflowY:"auto"},children:[i.jsxs("div",{onClick:u,style:{padding:"8px 12px",fontSize:"14px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",backgroundColor:p?"#f3f4f6":"white",borderBottom:"1px solid #f3f4f6"},onMouseEnter:c=>{p||(c.currentTarget.style.backgroundColor="#f9fafb")},onMouseLeave:c=>{p||(c.currentTarget.style.backgroundColor="white")},children:[i.jsx("div",{style:{width:"16px",height:"16px",border:"2px solid #d1d5db",borderRadius:"3px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:p?"#10b981":"white",borderColor:p?"#10b981":"#d1d5db"},children:p&&i.jsx("svg",{width:"10",height:"8",viewBox:"0 0 10 8",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:i.jsx("path",{d:"M8.5 1L3.5 6L1.5 4",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),"All property types"]}),n.map(c=>{const m=e.propertyTypes.includes(c);return i.jsxs("div",{onClick:()=>g(c),style:{padding:"8px 12px",fontSize:"14px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",backgroundColor:m?"#f3f4f6":"white"},onMouseEnter:T=>{m||(T.currentTarget.style.backgroundColor="#f9fafb")},onMouseLeave:T=>{m||(T.currentTarget.style.backgroundColor="white")},children:[i.jsx("div",{style:{width:"16px",height:"16px",border:"2px solid #d1d5db",borderRadius:"3px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:m?"#10b981":"white",borderColor:m?"#10b981":"#d1d5db"},children:m&&i.jsx("svg",{width:"10",height:"8",viewBox:"0 0 10 8",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:i.jsx("path",{d:"M8.5 1L3.5 6L1.5 4",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),c]},c)})]})]})}Mn.__docgenInfo={description:"",methods:[],displayName:"PropertyTypeFilter",props:{filters:{required:!0,tsType:{name:"MapFilters"},description:""},onFiltersChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(filters: MapFilters) => void",signature:{arguments:[{type:{name:"MapFilters"},name:"filters"}],return:{name:"void"}}},description:""},apiKey:{required:!0,tsType:{name:"string"},description:""}}};function In({initialMin:e,initialMax:t,onApply:r,priceBreakpoints:n=[0,5e5,1e6,2e6,4e6,1/0]}){const[o,s]=h.useState(e),[a,d]=h.useState(t),[f,g]=h.useState(null),u=h.useRef(null),p=h.useRef(null);h.useEffect(()=>{s(e),d(t)},[e,t]);const l=h.useCallback((S,C)=>{p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{r(S,C)},300)},[r]);h.useEffect(()=>()=>{p.current&&clearTimeout(p.current)},[]);const c=h.useCallback(S=>{if(S===null||S===1/0)return"Max";if(S===0)return"$0";if(S>=1e6){const C=S/1e6;return C>=10?`$${Math.round(C)}M`:`$${Math.round(C*10)/10}M`}if(S>=1e3){const C=S/1e3;return`$${Math.round(C)}K`}return`$${Math.round(S)}`},[]),m=h.useCallback(S=>{if(S===null||S===1/0)return 100;const C=n[n.length-2];if(S>=C)return 100;if(S<=0)return 0;for(let k=0;k<n.length-1;k++){const q=n[k],V=n[k+1];if(S>=q&&S<=V){const z=100/(n.length-1),y=k*z,D=V===1/0?0:(S-q)/(V-q);return y+D*z}}return 0},[n]),T=h.useCallback(S=>{if(S>=100)return null;if(S<=0)return 0;const C=100/(n.length-1),k=Math.floor(S/C),q=S%C/C;if(k>=n.length-2)return null;const V=n[k],z=n[k+1];return z===1/0?null:Math.round(V+q*(z-V))},[n]),E=h.useCallback(S=>C=>{C.preventDefault(),g(S)},[]),v=h.useCallback(S=>{if(!f||!u.current)return;const C=u.current.getBoundingClientRect(),k=Math.max(0,Math.min(100,(S.clientX-C.left)/C.width*100)),q=T(k);if(f==="min"){const V=a===null?1/0:a,z=q===null?V:Math.min(q,V),y=z===1/0?0:z;s(y),l(y,a)}else if(f==="max"){const V=q===null?null:Math.max(q,o);d(V),l(o,V)}},[f,o,a,T,l]),N=h.useCallback(()=>{g(null)},[]);h.useEffect(()=>{if(f)return document.addEventListener("mousemove",v),document.addEventListener("mouseup",N),()=>{document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",N)}},[f,v,N]);const _=h.useCallback(S=>C=>{if(C.key==="ArrowLeft"||C.key==="ArrowRight"){C.preventDefault();const k=C.key==="ArrowLeft"?-1:1,V=m(S==="min"?o:a),z=Math.max(0,Math.min(100,V+k*2)),y=T(z);if(S==="min"){const D=a===null?1/0:a,Q=y===null?D:Math.min(y,D),Se=Q===1/0?0:Q;s(Se),l(Se,a)}else{const D=y===null?null:Math.max(y||0,o);d(D),l(o,D)}}},[o,a,m,T,l]),O=m(o),I=m(a);return i.jsxs("div",{style:{marginTop:"6px",padding:"12px",backgroundColor:"#f9fafb",borderRadius:"6px",border:"1px solid #e5e7eb"},children:[i.jsxs("div",{style:{textAlign:"center",fontSize:"13px",fontWeight:"600",color:"#374151",marginBottom:"12px"},children:[c(o)," - ",c(a)]}),i.jsxs("div",{children:[i.jsxs("div",{ref:u,style:{position:"relative",height:"6px",backgroundColor:"#e5e7eb",borderRadius:"3px",marginBottom:"10px"},children:[i.jsx("div",{style:{position:"absolute",top:0,left:`${O}%`,width:`${I-O}%`,height:"100%",backgroundColor:"#3b82f6",borderRadius:"4px"}}),i.jsx("div",{style:{position:"absolute",left:`${O}%`,top:"50%",transform:"translate(-50%, -50%)",width:"16px",height:"16px",backgroundColor:"white",border:"2px solid #3b82f6",borderRadius:"50%",cursor:f==="min"?"grabbing":"grab",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},onMouseDown:E("min"),onKeyDown:_("min"),tabIndex:0,role:"slider","aria-label":"Minimum price","aria-valuemin":0,"aria-valuemax":a===null?n[n.length-2]:a,"aria-valuenow":o,"aria-valuetext":c(o)}),i.jsx("div",{style:{position:"absolute",left:`${I}%`,top:"50%",transform:"translate(-50%, -50%)",width:"16px",height:"16px",backgroundColor:"white",border:"2px solid #3b82f6",borderRadius:"50%",cursor:f==="max"?"grabbing":"grab",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},onMouseDown:E("max"),onKeyDown:_("max"),tabIndex:0,role:"slider","aria-label":"Maximum price","aria-valuemin":o,"aria-valuemax":n[n.length-2],"aria-valuenow":a===null?n[n.length-2]:a,"aria-valuetext":c(a)})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"10px",color:"#6b7280"},children:[n.slice(0,-1).map((S,C)=>i.jsx("span",{children:c(S)},C)),i.jsx("span",{children:"Max"})]})]})]})}In.__docgenInfo={description:"",methods:[],displayName:"PriceRangeFilter",props:{initialMin:{required:!0,tsType:{name:"number"},description:""},initialMax:{required:!0,tsType:{name:"union",raw:"number | null",elements:[{name:"number"},{name:"null"}]},description:""},onApply:{required:!0,tsType:{name:"signature",type:"function",raw:"(min: number, max: number | null) => void",signature:{arguments:[{type:{name:"number"},name:"min"},{type:{name:"union",raw:"number | null",elements:[{name:"number"},{name:"null"}]},name:"max"}],return:{name:"void"}}},description:""},priceBreakpoints:{required:!1,tsType:{name:"Array",elements:[{name:"number"}],raw:"number[]"},description:"",defaultValue:{value:"[0, 500000, 1000000, 2000000, 4000000, Infinity]",computed:!1}}}};function Nn({initialMin:e,initialMax:t,onApply:r,sqftBreakpoints:n=[0,1e3,2e3,3e3,5e3,1/0]}){const[o,s]=h.useState(e),[a,d]=h.useState(t),[f,g]=h.useState(null),u=h.useRef(null),p=h.useRef(null);h.useEffect(()=>{s(e),d(t)},[e,t]);const l=h.useCallback((S,C)=>{p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{r(S,C)},300)},[r]);h.useEffect(()=>()=>{p.current&&clearTimeout(p.current)},[]);const c=h.useCallback(S=>{if(S===null||S===1/0)return"Max";if(S===0)return"0";if(S>=1e3){const C=S/1e3;return`${Math.round(C*10)/10}K`}return`${Math.round(S)}`},[]),m=h.useCallback(S=>{if(S===null||S===1/0)return 100;const C=n[n.length-2];if(S>=C)return 100;if(S<=0)return 0;for(let k=0;k<n.length-1;k++){const q=n[k],V=n[k+1];if(S>=q&&S<=V){const z=100/(n.length-1),y=k*z,D=V===1/0?0:(S-q)/(V-q);return y+D*z}}return 0},[n]),T=h.useCallback(S=>{if(S>=100)return null;if(S<=0)return 0;const C=100/(n.length-1),k=Math.floor(S/C),q=S%C/C;if(k>=n.length-2)return null;const V=n[k],z=n[k+1];return z===1/0?null:Math.round(V+q*(z-V))},[n]),E=h.useCallback(S=>C=>{C.preventDefault(),g(S)},[]),v=h.useCallback(S=>{if(!f||!u.current)return;const C=u.current.getBoundingClientRect(),k=Math.max(0,Math.min(100,(S.clientX-C.left)/C.width*100)),q=T(k);if(f==="min"){const V=a===null?1/0:a,z=q===null?V:Math.min(q,V),y=z===1/0?0:z;s(y),l(y,a)}else if(f==="max"){const V=q===null?null:Math.max(q,o);d(V),l(o,V)}},[f,o,a,T,l]),N=h.useCallback(()=>{g(null)},[]);h.useEffect(()=>{if(f)return document.addEventListener("mousemove",v),document.addEventListener("mouseup",N),()=>{document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",N)}},[f,v,N]);const _=h.useCallback(S=>C=>{if(C.key==="ArrowLeft"||C.key==="ArrowRight"){C.preventDefault();const k=C.key==="ArrowLeft"?-1:1,V=m(S==="min"?o:a),z=Math.max(0,Math.min(100,V+k*2)),y=T(z);if(S==="min"){const D=a===null?1/0:a,Q=y===null?D:Math.min(y,D),Se=Q===1/0?0:Q;s(Se),l(Se,a)}else{const D=y===null?null:Math.max(y||0,o);d(D),l(o,D)}}},[o,a,m,T,l]),O=m(o),I=m(a);return i.jsxs("div",{style:{marginTop:"6px",padding:"12px",backgroundColor:"#f9fafb",borderRadius:"6px",border:"1px solid #e5e7eb"},children:[i.jsxs("div",{style:{textAlign:"center",fontSize:"13px",fontWeight:"600",color:"#374151",marginBottom:"12px"},children:[c(o)," - ",c(a)," sq ft"]}),i.jsxs("div",{children:[i.jsxs("div",{ref:u,style:{position:"relative",height:"6px",backgroundColor:"#e5e7eb",borderRadius:"3px",marginBottom:"10px"},children:[i.jsx("div",{style:{position:"absolute",top:0,left:`${O}%`,width:`${I-O}%`,height:"100%",backgroundColor:"#3b82f6",borderRadius:"3px"}}),i.jsx("div",{style:{position:"absolute",left:`${O}%`,top:"50%",transform:"translate(-50%, -50%)",width:"16px",height:"16px",backgroundColor:"white",border:"2px solid #3b82f6",borderRadius:"50%",cursor:f==="min"?"grabbing":"grab",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},onMouseDown:E("min"),onKeyDown:_("min"),tabIndex:0,role:"slider","aria-label":"Minimum square footage","aria-valuemin":0,"aria-valuemax":a===null?n[n.length-2]:a,"aria-valuenow":o,"aria-valuetext":c(o)}),i.jsx("div",{style:{position:"absolute",left:`${I}%`,top:"50%",transform:"translate(-50%, -50%)",width:"16px",height:"16px",backgroundColor:"white",border:"2px solid #3b82f6",borderRadius:"50%",cursor:f==="max"?"grabbing":"grab",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},onMouseDown:E("max"),onKeyDown:_("max"),tabIndex:0,role:"slider","aria-label":"Maximum square footage","aria-valuemin":o,"aria-valuemax":n[n.length-2],"aria-valuenow":a===null?n[n.length-2]:a,"aria-valuetext":c(a)})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"10px",color:"#6b7280"},children:[n.slice(0,-1).map((S,C)=>i.jsx("span",{children:c(S)},C)),i.jsx("span",{children:"Max"})]})]})]})}Nn.__docgenInfo={description:"",methods:[],displayName:"SquareFootageFilter",props:{initialMin:{required:!0,tsType:{name:"number"},description:""},initialMax:{required:!0,tsType:{name:"union",raw:"number | null",elements:[{name:"number"},{name:"null"}]},description:""},onApply:{required:!0,tsType:{name:"signature",type:"function",raw:"(min: number, max: number | null) => void",signature:{arguments:[{type:{name:"number"},name:"min"},{type:{name:"union",raw:"number | null",elements:[{name:"number"},{name:"null"}]},name:"max"}],return:{name:"void"}}},description:""},sqftBreakpoints:{required:!1,tsType:{name:"Array",elements:[{name:"number"}],raw:"number[]"},description:"",defaultValue:{value:"[0, 1000, 2000, 3000, 5000, Infinity]",computed:!1}}}};const ss=["2 bedroom 2 bath condo in rosedale","3+ bed house in north york close to the highway","waterfront properties for rent in downtown toronto"];function Ln({filters:e,onFiltersChange:t,onSearch:r,apiKey:n,onMapUpdate:o,onPolygonChange:s,onDrawStart:a,onDrawClear:d,onCancelDraw:f,hasPolygon:g=!1,isDrawing:u=!1}){const[p,l]=h.useState(!1),[c,m]=h.useState(!1),[T,E]=h.useState(""),[v,N]=h.useState([]),_=h.useRef(null),{processSearch:O,isProcessing:I,error:S,resetNlpId:C}=ts(n),k=h.useCallback((y,D)=>{const Q={id:`${Date.now()}-${Math.random()}`,timestamp:new Date,type:y,data:D};N(Se=>[...y==="understood"?Se.filter(Ke=>Ke.type!=="status"):Se,Q].slice(-100))},[]);h.useEffect(()=>{},[s,k]);const q=y=>{E(y),y!==T&&C()};h.useEffect(()=>{const y=D=>{_.current&&!_.current.contains(D.target)&&l(!1)};return p&&document.addEventListener("mousedown",y),()=>{document.removeEventListener("mousedown",y)}},[p]),h.useEffect(()=>{const y=D=>{D.key==="Escape"&&p&&l(!1)};return document.addEventListener("keydown",y),()=>{document.removeEventListener("keydown",y)}},[p]);const V=()=>{l(!0)},z=async y=>{const D=y||T;if(!D.trim())return;y&&E(y),k("search",{query:D});const Q=["Crunching the numbers...","Consulting with the property spirits...","Asking the real estate gods...","Searching high and low...","Scouring the neighborhoods..."],Se=Q[Math.floor(Math.random()*Q.length)];k("status",{message:Se});const Ue=await O(D);if(Ue){const Le=rs(Ue.request.url),Ke={...e,...Le};if(t(Ke),o)if(Le.map){const we=Le.map[0];if(we&&we.length>0){const Xe=we.map(Qe=>Qe[0]),ze=we.map(Qe=>Qe[1]),Fe=Math.min(...Xe),L=Math.max(...Xe),Ze=Math.min(...ze),At=Math.max(...ze),Ot=(Fe+L)/2,pe=(Ze+At)/2;o({center:[Ot,pe],bounds:Le.map,zoom:12})}}else{const we=os(Ue);we&&o({center:we.center,bounds:we.bounds,zoom:we.zoom})}const Ve=ns(Ue);Ve&&E(Ve),k("understood",{summary:Ve||"Search understood",filters:Le}),await(r==null?void 0:r(T))}};return i.jsxs("div",{ref:_,style:{position:"absolute",top:"16px",left:"16px",width:"600px",maxWidth:"calc(100vw - 32px)",background:"white",borderRadius:"16px",padding:"0",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.08)",zIndex:1e3,transition:"all 300ms ease-out",maxHeight:p?"calc(100vh - 32px)":"auto",overflow:p?"hidden":"visible"},children:[i.jsxs("div",{style:{position:"relative"},children:[i.jsx(En,{value:T,onChange:q,onFocus:V,onSearch:z,isSearching:I,placeholder:"Search properties..."}),a&&i.jsx("div",{style:{position:"absolute",top:"12px",right:"12px",display:"flex",flexDirection:"column",gap:"8px",alignItems:"center"},children:i.jsxs("button",{onClick:u||g?u?f:d:a,disabled:!1,style:{width:"36px",height:"36px",borderRadius:"8px",border:`1px solid ${u||g?"#fecaca":"#e5e7eb"}`,background:"white",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 200ms",boxShadow:"0 2px 4px rgba(0,0,0,0.05)",position:"relative"},title:u?"Cancel drawing":g?"Clear custom search area":"Draw custom search area on map",onMouseEnter:y=>{u||g?(y.currentTarget.style.background="#fef2f2",y.currentTarget.style.borderColor="#f87171"):(y.currentTarget.style.background="#f9fafb",y.currentTarget.style.borderColor="#6366f1")},onMouseLeave:y=>{y.currentTarget.style.background="white",y.currentTarget.style.borderColor=u||g?"#fecaca":"#e5e7eb"},children:[i.jsx(Kn,{size:16,color:"#6366f1"}),(u||g)&&i.jsx(Wn,{size:14,color:"#ef4444",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}})]})})]}),S&&i.jsx("div",{style:{margin:"12px 16px",padding:"12px 16px",background:"#fef2f2",border:"1px solid #fecaca",borderRadius:"8px",color:"#dc2626",fontSize:"14px"},children:S}),i.jsxs("div",{style:{maxHeight:p?"calc(100vh - 160px)":"0",opacity:p?1:0,overflow:p?"auto":"hidden",transition:"max-height 300ms ease-out, opacity 300ms ease-out",marginTop:p?"20px":"0",padding:p?"0 16px 16px 16px":"0"},children:[!c&&v.length===0&&i.jsxs("div",{children:[i.jsxs("div",{style:{fontSize:"11px",fontWeight:"700",color:"#9ca3af",marginBottom:"12px",textTransform:"uppercase",letterSpacing:"1px",display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx(Zn,{size:14}),"Try These Searches"]}),i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:ss.map((y,D)=>i.jsx("button",{onClick:()=>z(y),disabled:I,style:{padding:"12px 16px",background:"linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%)",border:"1px solid #e5e7eb",borderRadius:"12px",fontSize:"14px",color:"#374151",textAlign:"left",cursor:I?"not-allowed":"pointer",transition:"all 200ms ease",fontWeight:"500"},onMouseEnter:Q=>{I||(Q.currentTarget.style.background="linear-gradient(135deg, #eef2ff 0%, #e0e7ff 100%)",Q.currentTarget.style.borderColor="#c7d2fe",Q.currentTarget.style.transform="translateX(4px)")},onMouseLeave:Q=>{Q.currentTarget.style.background="linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%)",Q.currentTarget.style.borderColor="#e5e7eb",Q.currentTarget.style.transform="translateX(0)"},children:y},D))}),i.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, #e5e7eb 50%, transparent)",margin:"16px 0"}})]}),!c&&v.length>0&&i.jsxs("div",{children:[i.jsx(wn,{entries:v,onChipClick:()=>m(!0)}),i.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, #e5e7eb 50%, transparent)",margin:"16px 0"}})]}),i.jsxs("button",{onClick:()=>m(!c),style:{width:"100%",padding:"12px 16px",background:"transparent",border:"1px solid #e5e7eb",borderRadius:"10px",fontSize:"14px",fontWeight:"600",color:"#6366f1",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",transition:"all 200ms ease"},onMouseEnter:y=>{y.currentTarget.style.background="#f9fafb",y.currentTarget.style.borderColor="#6366f1"},onMouseLeave:y=>{y.currentTarget.style.background="transparent",y.currentTarget.style.borderColor="#e5e7eb"},children:[i.jsxs("span",{children:[c?"Hide":"Show"," Advanced Filters"]}),i.jsx(Jr,{size:18,style:{transform:c?"rotate(180deg)":"rotate(0deg)",transition:"transform 200ms ease"}})]}),c&&i.jsxs("div",{style:{marginTop:"12px"},children:[i.jsx("div",{style:{marginBottom:"12px"},children:i.jsxs("div",{style:{display:"flex",gap:"6px"},children:[i.jsx("button",{onClick:()=>t({...e,listingType:"sale"}),style:{flex:1,padding:"6px 12px",backgroundColor:(e.listingType||"sale")==="sale"?"#6366f1":"white",color:(e.listingType||"sale")==="sale"?"white":"#374151",border:`1px solid ${(e.listingType||"sale")==="sale"?"#6366f1":"#d1d5db"}`,borderRadius:"6px",fontSize:"13px",fontWeight:(e.listingType||"sale")==="sale"?"600":"400",cursor:"pointer",transition:"all 200ms ease"},onMouseEnter:y=>{(e.listingType||"sale")!=="sale"&&(y.currentTarget.style.backgroundColor="#f9fafb")},onMouseLeave:y=>{(e.listingType||"sale")!=="sale"&&(y.currentTarget.style.backgroundColor="white")},children:"For Sale"}),i.jsx("button",{onClick:()=>t({...e,listingType:"lease"}),style:{flex:1,padding:"6px 12px",backgroundColor:e.listingType==="lease"?"#6366f1":"white",color:e.listingType==="lease"?"white":"#374151",border:`1px solid ${e.listingType==="lease"?"#6366f1":"#d1d5db"}`,borderRadius:"6px",fontSize:"13px",fontWeight:e.listingType==="lease"?"600":"400",cursor:"pointer",transition:"all 200ms ease"},onMouseEnter:y=>{e.listingType!=="lease"&&(y.currentTarget.style.backgroundColor="#f9fafb")},onMouseLeave:y=>{e.listingType!=="lease"&&(y.currentTarget.style.backgroundColor="white")},children:"For Lease"})]})}),i.jsx("div",{style:{marginBottom:"12px"},children:i.jsx(Mn,{filters:e,onFiltersChange:t,apiKey:n})}),i.jsxs("div",{style:{marginBottom:"12px"},children:[i.jsx("div",{style:{fontSize:"11px",fontWeight:"600",color:"#6b7280",marginBottom:"6px",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Price Range"}),i.jsx(In,{initialMin:e.minPrice||0,initialMax:e.maxPrice||null,onApply:(y,D)=>{t({...e,minPrice:y||void 0,maxPrice:D||void 0})}})]}),i.jsx("div",{style:{marginBottom:"12px"},children:i.jsx(Pn,{bedrooms:e.bedrooms||"all",bathrooms:e.bathrooms||"all",onBedroomsChange:y=>t({...e,bedrooms:y}),onBathroomsChange:y=>t({...e,bathrooms:y})})}),i.jsxs("div",{style:{marginBottom:"12px"},children:[i.jsx("div",{style:{fontSize:"11px",fontWeight:"600",color:"#6b7280",marginBottom:"6px",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Garage / Parking"}),i.jsx("div",{style:{display:"flex",gap:"6px",flexWrap:"wrap"},children:["all","1+","2+","3+","4+","5+"].map(y=>i.jsx("button",{onClick:()=>t({...e,garageSpaces:y}),style:{padding:"6px 12px",backgroundColor:e.garageSpaces===y?"#6366f1":"white",color:e.garageSpaces===y?"white":"#374151",border:`1px solid ${e.garageSpaces===y?"#6366f1":"#d1d5db"}`,borderRadius:"6px",fontSize:"13px",fontWeight:e.garageSpaces===y?"600":"400",cursor:"pointer",transition:"all 200ms ease"},onMouseEnter:D=>{e.garageSpaces!==y&&(D.currentTarget.style.backgroundColor="#f9fafb")},onMouseLeave:D=>{e.garageSpaces!==y&&(D.currentTarget.style.backgroundColor="white")},children:y==="all"?"All":y},y))})]}),i.jsxs("div",{style:{marginBottom:"12px"},children:[i.jsx("div",{style:{fontSize:"11px",fontWeight:"600",color:"#6b7280",marginBottom:"6px",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Square Footage"}),i.jsx(Nn,{initialMin:e.minSqft||0,initialMax:e.maxSqft||null,onApply:(y,D)=>{t({...e,minSqft:y||void 0,maxSqft:D||void 0})}})]}),i.jsxs("div",{style:{marginBottom:"12px"},children:[i.jsx("div",{style:{fontSize:"11px",fontWeight:"600",color:"#6b7280",marginBottom:"6px",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Open House"}),i.jsx("div",{style:{display:"flex",gap:"6px",flexWrap:"wrap"},children:[{value:"all",label:"All"},{value:"today",label:"Today"},{value:"thisWeekend",label:"This Weekend"},{value:"thisWeek",label:"This Week"},{value:"anytime",label:"Anytime"}].map(({value:y,label:D})=>i.jsx("button",{onClick:()=>t({...e,openHouse:y}),style:{padding:"6px 12px",backgroundColor:e.openHouse===y?"#6366f1":"white",color:e.openHouse===y?"white":"#374151",border:`1px solid ${e.openHouse===y?"#6366f1":"#d1d5db"}`,borderRadius:"6px",fontSize:"13px",fontWeight:e.openHouse===y?"600":"400",cursor:"pointer",transition:"all 200ms ease"},onMouseEnter:Q=>{e.openHouse!==y&&(Q.currentTarget.style.backgroundColor="#f9fafb")},onMouseLeave:Q=>{e.openHouse!==y&&(Q.currentTarget.style.backgroundColor="white")},children:D},y))})]}),i.jsxs("div",{style:{marginBottom:"12px"},children:[i.jsx("div",{style:{fontSize:"11px",fontWeight:"600",color:"#6b7280",marginBottom:"6px",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Max Maintenance Fee"}),i.jsx("input",{type:"number",placeholder:"Enter max fee",value:e.maxMaintenanceFee||"",onChange:y=>t({...e,maxMaintenanceFee:y.target.value?parseInt(y.target.value):void 0}),style:{width:"100%",padding:"8px 10px",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"13px",outline:"none"}})]}),i.jsxs("div",{style:{marginBottom:"12px"},children:[i.jsx("div",{style:{fontSize:"11px",fontWeight:"600",color:"#6b7280",marginBottom:"6px",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Active Listings"}),i.jsxs("select",{value:e.activeListingDays||"all",onChange:y=>t({...e,activeListingDays:y.target.value==="off"?void 0:y.target.value}),style:{width:"100%",padding:"8px 10px",background:"white",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"13px",color:"#374151",cursor:"pointer"},children:[i.jsx("option",{value:"off",children:"Off"}),i.jsx("option",{value:"all",children:"All"}),i.jsx("option",{value:"1",children:"Last 24 hours"}),i.jsx("option",{value:"3",children:"Last 3 days"}),i.jsx("option",{value:"7",children:"Last 7 days"}),i.jsx("option",{value:"30",children:"Last 30 days"}),i.jsx("option",{value:"90",children:"Last 90 days"}),i.jsx("option",{value:"15+",children:"More than 15 days"}),i.jsx("option",{value:"30+",children:"More than 30 days"}),i.jsx("option",{value:"60+",children:"More than 60 days"}),i.jsx("option",{value:"90+",children:"More than 90 days"})]})]}),i.jsxs("div",{style:{marginBottom:"12px"},children:[i.jsx("div",{style:{fontSize:"11px",fontWeight:"600",color:"#6b7280",marginBottom:"6px",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Sold Listings"}),i.jsxs("select",{value:e.soldListingDays||"off",onChange:y=>t({...e,soldListingDays:y.target.value==="off"?void 0:y.target.value}),style:{width:"100%",padding:"8px 10px",background:"white",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"13px",color:"#374151",cursor:"pointer"},children:[i.jsx("option",{value:"off",children:"Off"}),i.jsx("option",{value:"1",children:"Last 24 hours"}),i.jsx("option",{value:"3",children:"Last 3 days"}),i.jsx("option",{value:"7",children:"Last 7 days"}),i.jsx("option",{value:"30",children:"Last 30 days"}),i.jsx("option",{value:"90",children:"Last 90 days"}),i.jsx("option",{value:"180",children:"Last 180 days"}),i.jsx("option",{value:"360",children:"Last 360 days"}),i.jsx("option",{value:"2025",children:"Year 2025"}),i.jsx("option",{value:"2024",children:"Year 2024"}),i.jsx("option",{value:"2023",children:"Year 2023"}),i.jsx("option",{value:"2022",children:"Year 2022"}),i.jsx("option",{value:"2021",children:"Year 2021"}),i.jsx("option",{value:"2020",children:"Year 2020"})]})]}),i.jsxs("div",{style:{marginBottom:"12px"},children:[i.jsx("div",{style:{fontSize:"11px",fontWeight:"600",color:"#6b7280",marginBottom:"6px",textTransform:"uppercase",letterSpacing:"0.5px"},children:"De-listed Listings"}),i.jsxs("select",{value:e.unavailableListingDays||"off",onChange:y=>t({...e,unavailableListingDays:y.target.value==="off"?void 0:y.target.value}),style:{width:"100%",padding:"8px 10px",background:"white",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"13px",color:"#374151",cursor:"pointer"},children:[i.jsx("option",{value:"off",children:"Off"}),i.jsx("option",{value:"1",children:"Last 24 hours"}),i.jsx("option",{value:"3",children:"Last 3 days"}),i.jsx("option",{value:"7",children:"Last 7 days"}),i.jsx("option",{value:"30",children:"Last 30 days"}),i.jsx("option",{value:"90",children:"Last 90 days"}),i.jsx("option",{value:"180",children:"Last 180 days"}),i.jsx("option",{value:"360",children:"Last 360 days"}),i.jsx("option",{value:"2025",children:"Year 2025"}),i.jsx("option",{value:"2024",children:"Year 2024"}),i.jsx("option",{value:"2023",children:"Year 2023"}),i.jsx("option",{value:"2022",children:"Year 2022"}),i.jsx("option",{value:"2021",children:"Year 2021"}),i.jsx("option",{value:"2020",children:"Year 2020"})]})]})]})]})]})}Ln.__docgenInfo={description:"",methods:[],displayName:"SearchPanel",props:{filters:{required:!0,tsType:{name:"MapFilters"},description:""},onFiltersChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(filters: MapFilters) => void",signature:{arguments:[{type:{name:"MapFilters"},name:"filters"}],return:{name:"void"}}},description:""},apiKey:{required:!0,tsType:{name:"string"},description:""},onSearch:{required:!1,tsType:{name:"signature",type:"function",raw:"(query: string) => void",signature:{arguments:[{type:{name:"string"},name:"query"}],return:{name:"void"}}},description:""},onMapUpdate:{required:!1,tsType:{name:"signature",type:"function",raw:"(update: { center?: [number, number]; bounds?: number[][][]; zoom?: number }) => void",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{ center?: [number, number]; bounds?: number[][][]; zoom?: number }",signature:{properties:[{key:"center",value:{name:"tuple",raw:"[number, number]",elements:[{name:"number"},{name:"number"}],required:!1}},{key:"bounds",value:{name:"Array",elements:[{name:"Array",elements:[{name:"Array",elements:[{name:"number"}],raw:"number[]"}],raw:"number[][]"}],raw:"number[][][]",required:!1}},{key:"zoom",value:{name:"number",required:!1}}]}},name:"update"}],return:{name:"void"}}},description:""},onPolygonChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(action: 'create' | 'update' | 'delete', polygon: number[][][] | null) => void",signature:{arguments:[{type:{name:"union",raw:"'create' | 'update' | 'delete'",elements:[{name:"literal",value:"'create'"},{name:"literal",value:"'update'"},{name:"literal",value:"'delete'"}]},name:"action"},{type:{name:"union",raw:"number[][][] | null",elements:[{name:"Array",elements:[{name:"Array",elements:[{name:"Array",elements:[{name:"number"}],raw:"number[]"}],raw:"number[][]"}],raw:"number[][][]"},{name:"null"}]},name:"polygon"}],return:{name:"void"}}},description:""},onDrawStart:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onDrawClear:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onCancelDraw:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},hasPolygon:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},isDrawing:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}}}};const is=(e,t)=>{const r=(n,o)=>n>=100?`${Math.round(n)}${o}`:n>=10?`${Math.round(n*10)/10}${o}`:`${Math.round(n*100)/100}${o}`;if(t==="Lease"){if(e>=1e3){const n=e/1e3;return r(n,"K")}return Math.round(e).toString()}else{if(e>=999500){const n=e/1e6;return r(n,"M")}else if(e>=1e3){const n=e/1e3;return r(n,"K")}return Math.round(e).toString()}},as=(e,t,r)=>e==="U"&&(t==="Sld"||t==="Sc")?"#8b7fa8":e==="U"?"#f59e0b":r==="Lease"?"#a855f7":"#22c55e",ls=(e,t,r,n)=>{const o=is(e,t),s=as(r,n,t),a=document.createElement("div");return a.style.cssText=`
    background-color: ${s};
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 600;
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    white-space: nowrap;
    pointer-events: auto;
    cursor: pointer;
  `,a.textContent=o,a},ir=e=>{var t,r,n,o,s,a,d,f;return(t=e.coordinates)!=null&&t.lat&&((r=e.coordinates)!=null&&r.lng)?{lat:e.coordinates.lat,lng:e.coordinates.lng}:e.latitude&&e.longitude?{lat:e.latitude,lng:e.longitude}:(n=e.map)!=null&&n.latitude&&((o=e.map)!=null&&o.longitude)?{lat:e.map.latitude,lng:e.map.longitude}:(s=e.location)!=null&&s.latitude&&((a=e.location)!=null&&a.longitude)?{lat:e.location.latitude,lng:e.location.longitude}:(d=e.center)!=null&&d.lat&&((f=e.center)!=null&&f.lng)?{lat:e.center.lat,lng:e.center.lng}:null},ar=e=>{if(e.length===0)return null;let t=e[0].lat,r=e[0].lat,n=e[0].lng,o=e[0].lng;return e.forEach(s=>{t=Math.max(t,s.lat),r=Math.min(r,s.lat),n=Math.max(n,s.lng),o=Math.min(o,s.lng)}),{north:t,south:r,east:n,west:o}},lr=(e,t)=>{const{north:r,south:n,east:o,west:s}=t,a=20,d=(r-n)/a,f=(o-s)/a,g=Array(a).fill(0).map(()=>Array(a).fill(0));e.forEach(m=>{const T=Math.floor((m.lat-n)/d),E=Math.floor((m.lng-s)/f),v=Math.max(0,Math.min(a-1,T)),N=Math.max(0,Math.min(a-1,E));g[v][N]++});let u=0,p=0,l=0;for(let m=0;m<a;m++)for(let T=0;T<a;T++)g[m][T]>u&&(u=g[m][T],p=n+(m+.5)*d,l=s+(T+.5)*f);return u>0?[l,p]:[(o+s)/2,(r+n)/2]},cs=e=>{try{const t=localStorage.getItem(`mapListings-autoCenter-${e}`);if(t){const r=JSON.parse(t);if(Date.now()-r.timestamp<1440*60*1e3)return{center:r.center}}}catch{}return null},Et=(e,t)=>{try{const r={...t,timestamp:Date.now()};localStorage.setItem(`mapListings-autoCenter-${e}`,JSON.stringify(r))}catch{}},us=async(e,t="average")=>{var r,n,o,s,a,d,f,g;try{const p=await fetch("https://api.repliers.io/listings",{method:"POST",headers:{"REPLIERS-API-KEY":e,"Content-Type":"application/json"},body:JSON.stringify({queries:[{cluster:!0,clusterPrecision:8,clusterLimit:50,status:"A"},{cluster:!1,listings:!0,pageSize:500,status:"A"}]})});if(p.status===400)return qr(e,t);if(!p.ok)throw new Error(`Bundled auto-center API Error: ${p.status} ${p.statusText}`);const l=await p.json(),c=l[0]||{},m=l[1]||{},T=((n=(r=c.aggregates)==null?void 0:r.map)==null?void 0:n.clusters)||c.clusters||[],E=m.listings||m.results||[];if(t==="city"&&T.length>0){let I=null,S=0;if(T.forEach(C=>{const k=C.count||0;k>S&&(S=k,I=C)}),I){const C=[((o=I.location)==null?void 0:o.longitude)||((s=I.coordinates)==null?void 0:s.lng)||I.longitude||((a=I.center)==null?void 0:a.lng),((d=I.location)==null?void 0:d.latitude)||((f=I.coordinates)==null?void 0:f.lat)||I.latitude||((g=I.center)==null?void 0:g.lat)];if(C[0]&&C[1]){const q={center:[C[0],C[1]]};return Et(`${e}-${t}`,q),q}}}if(E.length===0)return null;const v=[];if(E.forEach(I=>{const S=ir(I);S&&v.push(S)}),v.length===0)return null;const N=ar(v);if(!N)return null;const O={center:lr(v,N)};return Et(`${e}-${t}`,O),O}catch{return qr(e,t)}},qr=async(e,t="average")=>{var r,n,o,s,a,d,f,g;try{let u=[],p=[];if(t==="city")try{const E=new URL("https://api.repliers.io/listings");E.searchParams.set("cluster","true"),E.searchParams.set("clusterPrecision","8"),E.searchParams.set("clusterLimit","50"),E.searchParams.set("status","A");const v=await fetch(E.toString(),{headers:{"REPLIERS-API-KEY":e,"Content-Type":"application/json"}});if(v.ok){const N=await v.json();u=((n=(r=N.aggregates)==null?void 0:r.map)==null?void 0:n.clusters)||N.clusters||[]}}catch{}try{const E=new URL("https://api.repliers.io/listings");E.searchParams.set("pageSize","500"),E.searchParams.set("status","A");const v=await fetch(E.toString(),{headers:{"REPLIERS-API-KEY":e,"Content-Type":"application/json"}});if(v.ok){const N=await v.json();p=N.listings||N.results||[]}}catch{}if(t==="city"&&u.length>0){let E=null,v=0;if(u.forEach(N=>{const _=N.count||0;_>v&&(v=_,E=N)}),E){const N=[((o=E.location)==null?void 0:o.longitude)||((s=E.coordinates)==null?void 0:s.lng)||E.longitude||((a=E.center)==null?void 0:a.lng),((d=E.location)==null?void 0:d.latitude)||((f=E.coordinates)==null?void 0:f.lat)||E.latitude||((g=E.center)==null?void 0:g.lat)];if(N[0]&&N[1]){const O={center:[N[0],N[1]]};return Et(`${e}-${t}`,O),O}}}if(p.length===0)return null;const l=[];if(p.forEach(E=>{const v=ir(E);v&&l.push(v)}),l.length===0)return null;const c=ar(l);if(!c)return null;const T={center:lr(l,c)};return Et(`${e}-${t}`,T),T}catch{return null}};function _n({apiKey:e,mapboxToken:t,initialCenter:r,initialZoom:n,height:o="100%",width:s="100%",mapStyle:a="mapbox://styles/mapbox/streets-v12",centerCalculation:d="average",showPropertyCount:f=!0}){const g=h.useRef(null),u=h.useRef(null),p=h.useRef(null),[l,c]=h.useState(null),[m,T]=h.useState(null),[E,v]=h.useState(!1),[N,_]=h.useState(0),[O,I]=h.useState(r||null),[S,C]=h.useState(n||null),k=h.useRef(null),q=h.useRef(null),[V,z]=h.useState(!1),[y,D]=h.useState(null),[Q,Se]=h.useState({x:0,y:0}),[Ue,Le]=h.useState(!1),[Ke,Ve]=h.useState([]),[we,Xe]=h.useState({x:0,y:0}),ze=h.useRef([]),Fe=h.useRef(null),[L,Ze]=h.useState({listingType:"sale",propertyTypes:[],bedrooms:"all",bathrooms:"all",garageSpaces:"all",openHouse:"all"}),At=h.useCallback(w=>{Ze(w)},[]),Ot=h.useCallback(w=>{u.current&&w.center&&u.current.easeTo({center:w.center,zoom:w.zoom||u.current.getZoom(),duration:1e3})},[]),pe=h.useRef(null);h.useCallback(w=>{pe.current=w},[]);const Qe=h.useCallback(w=>{var $;const x=w.features[0];if(x&&x.geometry.type==="Polygon"){const M=x.geometry.coordinates;T(M),v(!1),($=pe.current)==null||$.call(pe,"create",M)}},[]),An=h.useCallback(w=>{var $;const x=w.features[0];if(x&&x.geometry.type==="Polygon"){const M=x.geometry.coordinates;T(M),($=pe.current)==null||$.call(pe,"update",M)}},[]),On=h.useCallback(()=>{var w;T(null),v(!1),(w=pe.current)==null||w.call(pe,"delete",null)},[]),kn=h.useCallback(()=>{p.current&&(p.current.changeMode("draw_polygon"),v(!0))},[]),Dn=h.useCallback(()=>{p.current&&(p.current.changeMode("simple_select"),v(!1))},[]),cr=h.useCallback(()=>{p.current&&(p.current.deleteAll(),T(null),v(!1))},[]),Fn=h.useCallback(()=>{var w;cr(),(w=pe.current)==null||w.call(pe,"delete",null)},[cr]);h.useEffect(()=>{Ze(m?w=>({...w,map:m}):w=>{const{map:x,...$}=w;return $})},[m]);const ct=h.useCallback(()=>{ze.current.forEach(w=>w.remove()),ze.current=[]},[]),kt=h.useCallback(w=>{u.current&&(ct(),w.forEach(x=>{if("isProperty"in x.properties&&x.properties.isProperty&&x.properties.listPrice){const{listPrice:$,status:M,lastStatus:R}=x.properties,G=x.properties.type||"Sale",[U,te]=x.geometry.coordinates;if(isNaN(U)||isNaN(te)||U===null||te===null)return;const A=typeof $=="string"?parseFloat($):$;if(isNaN(A))return;const re=ls(A,G,M,R),oe=new ht.Marker({element:re,anchor:"bottom",offset:[0,-5]}).setLngLat([U,te]).addTo(u.current);re.addEventListener("click",async _e=>{var We;const ie=_e.clientX,ne=_e.clientY;if(Se({x:ie,y:ne}),x.properties.address&&x.properties.images){const Ae={mlsNumber:x.properties.mlsNumber||"N/A",listPrice:A,address:x.properties.address,details:x.properties.details,images:x.properties.images,type:x.properties.type,lastStatus:x.properties.lastStatus,status:x.properties.status};D(Ae),z(!0);return}try{const Ae=await fetch(`https://api.repliers.io/listings?mlsNumber=${x.properties.mlsNumber}&fields=address.*,details.*,images,type,lastStatus,status,class`,{headers:{"REPLIERS-API-KEY":e,"Content-Type":"application/json"}});if(!Ae.ok)throw new Error(`Failed to fetch property details: ${Ae.status}`);const Oe=(We=(await Ae.json()).listings)==null?void 0:We[0];if(Oe){const Re={mlsNumber:x.properties.mlsNumber||"N/A",listPrice:A,address:Oe.address,details:Oe.details,images:Oe.images,type:Oe.type||x.properties.type,lastStatus:Oe.lastStatus,status:Oe.status};D(Re),z(!0)}else{const Re={mlsNumber:x.properties.mlsNumber||"N/A",listPrice:A,address:x.properties.address,details:x.properties.details,images:x.properties.images,type:x.properties.type,lastStatus:x.properties.lastStatus,status:x.properties.status};D(Re),z(!0)}}catch{const et={mlsNumber:x.properties.mlsNumber||"N/A",listPrice:A,address:x.properties.address,details:x.properties.details,images:x.properties.images,type:x.properties.type,lastStatus:x.properties.lastStatus,status:x.properties.status};D(et),z(!0)}}),ze.current.push(oe)}}))},[ct,e]);h.useEffect(()=>{(async()=>{if(O&&S)return;const x=cs(`${e}-${d}`);if(x){I(x.center),C(n||10);return}const $=await us(e,d);$?(I($.center),C(n||10)):(I([-98.5795,39.8283]),C(n||10))})()},[e,O,S,d,n]);const ur=h.useCallback(w=>w<=6?5:w<=8?8:w<=10?12:w<=12?16:w<=14?20:w<=17?25:29,[]),ut=h.useCallback(w=>{const x=w.getSouthWest(),$=w.getNorthEast();return[[[x.lng,x.lat],[$.lng,x.lat],[$.lng,$.lat],[x.lng,$.lat],[x.lng,x.lat]]]},[]),Dt=h.useCallback((w,x,$)=>{const M={};if(w==="active"){if(M.status="A",x!=="all"){const R=new Date;if(x.endsWith("+")){const G=parseInt(x.replace("+","")),U=new Date(R);U.setDate(U.getDate()-G),M.maxListDate=U.toISOString().split("T")[0]}else{const G=parseInt(x),U=new Date(R);U.setDate(U.getDate()-G),M.minListDate=U.toISOString().split("T")[0]}}}else if(w==="sold"){M.status="U",M.lastStatus="Sld";const R=parseInt(x);if(R>=2007&&R<=2025)M.minSoldDate=`${x}-01-01`,M.maxSoldDate=`${x}-12-31`;else{const G=new Date,U=new Date(G);U.setDate(U.getDate()-R),M.minSoldDate=U.toISOString().split("T")[0],M.maxSoldDate=G.toISOString().split("T")[0]}}else if(w==="unavailable"){M.status="U";const R=parseInt(x);if(R>=2007&&R<=2025)M.minUnavailableDate=`${x}-01-01`,M.maxUnavailableDate=`${x}-12-31`;else{const G=new Date,U=new Date(G);U.setDate(U.getDate()-R),M.minUnavailableDate=U.toISOString().split("T")[0],M.maxUnavailableDate=G.toISOString().split("T")[0]}}if(L.listingType==="sale"?M.type="Sale":L.listingType==="lease"&&(M.type="Lease"),L.propertyTypes.length===1&&(M["details.propertyType"]=L.propertyTypes[0]),L.minPrice&&L.minPrice>0&&(M.minPrice=L.minPrice),L.maxPrice&&L.maxPrice>0&&(M.maxPrice=L.maxPrice),L.bedrooms&&L.bedrooms!=="all"&&(L.bedrooms==="5+"?M.minBedrooms=5:(M.minBedrooms=parseInt(L.bedrooms),M.maxBedrooms=parseInt(L.bedrooms))),L.bathrooms&&L.bathrooms!=="all"&&(M.minBaths=parseInt(L.bathrooms.replace("+",""))),L.garageSpaces&&L.garageSpaces!=="all"&&(M.minGarageSpaces=parseInt(L.garageSpaces.replace("+",""))),L.minSqft&&L.minSqft>0&&(M.minSqft=L.minSqft),L.maxSqft&&L.maxSqft>0&&(M.maxSqft=L.maxSqft),L.openHouse&&L.openHouse!=="all"){const R=new Date;R.setHours(0,0,0,0);let G=null,U=null;if(L.openHouse==="today")G=R,U=R;else if(L.openHouse==="thisWeekend"){const te=R.getDay(),A=te===0?6:6-te,re=new Date(R);re.setDate(R.getDate()+A);const oe=new Date(re);oe.setDate(re.getDate()+1),G=re,U=oe}else if(L.openHouse==="thisWeek"){G=R;const te=new Date(R);te.setDate(R.getDate()+(7-R.getDay())),U=te}else L.openHouse==="anytime"&&(G=R);G&&(M.minOpenHouseDate=G.toISOString().split("T")[0],U&&(M.maxOpenHouseDate=U.toISOString().split("T")[0]))}return M},[L]),Ft=h.useCallback((w,x)=>{const[$,M]=w,[R,G]=x,U=6371e3,te=(G-M)*Math.PI/180,A=(R-$)*Math.PI/180,re=Math.sin(te/2)*Math.sin(te/2)+Math.cos(M*Math.PI/180)*Math.cos(G*Math.PI/180)*Math.sin(A/2)*Math.sin(A/2),oe=2*Math.atan2(Math.sqrt(re),Math.sqrt(1-re));return U*oe},[]),dt=h.useCallback((w,x)=>{const $=[],M=new Set;return w.forEach((R,G)=>{if(M.has(G))return;const U=[R];M.add(G);const te=R.geometry.coordinates;w.forEach((A,re)=>{if(M.has(re)||G===re)return;const oe=A.geometry.coordinates;Ft(te,oe)<=x&&(U.push(A),M.add(re))}),$.push(U)}),$},[Ft]),dr=h.useCallback((w,x)=>{const $=x<=10?30:x<=12?60:x<=13?100:30,M=x<=10?500:x<=12?300:x<=13?200:100,R=w.filter(A=>A.properties.count<=$),G=w.filter(A=>A.properties.count>$);if(R.length===0)return w;const te=dt(R,M).map(A=>{if(A.length===1)return A[0];const re=A.reduce((ie,ne)=>ie+ne.properties.count,0),oe=A.reduce((ie,ne)=>ie+ne.geometry.coordinates[0],0)/A.length,_e=A.reduce((ie,ne)=>ie+ne.geometry.coordinates[1],0)/A.length;return{type:"Feature",properties:{count:re,precision:A[0].properties.precision,id:`merged-${A.map(ie=>ie.properties.id).join("-")}`,members:[]},geometry:{type:"Point",coordinates:[oe,_e]}}});return[...G,...te]},[dt]),pt=h.useCallback(async w=>{var U,te;if(!u.current)return;const x=u.current.getZoom(),$=ur(x),M=JSON.stringify(ut(w)),R=Math.round(x*2)/2,G=JSON.stringify(L);if(!(q.current&&q.current.bounds===M&&Math.abs(q.current.zoom-R)<.5&&q.current.filters===G)){q.current={bounds:M,zoom:R,filters:G},k.current=x,c(null);try{const A=[];L.activeListingDays!==void 0&&A.push({type:"active",value:L.activeListingDays}),L.soldListingDays!==void 0&&A.push({type:"sold",value:L.soldListingDays}),L.unavailableListingDays!==void 0&&A.push({type:"unavailable",value:L.unavailableListingDays}),A.length===0&&A.push({type:"active",value:"all"});const re=A.length>1;let oe;if(re){const b=A.map(({type:Z,value:ae})=>{const le=Dt(Z,ae,x);return le.map=L.map||ut(w),le}),W=new URL("https://api.repliers.io/listings");x>=18?(W.searchParams.set("cluster","false"),W.searchParams.set("listings","true"),W.searchParams.set("fields","address.*,mlsNumber,listPrice,details.numBedrooms,details.numBedroomsPlus,details.numBathrooms,details.numBathroomsPlus,details.numGarageSpaces,details.propertyType,type,lastStatus,images,status,class,coordinates,latitude,longitude,geo,location,map"),W.searchParams.set("pageSize","500")):(W.searchParams.set("cluster","true"),W.searchParams.set("clusterPrecision",$.toString()),W.searchParams.set("clusterLimit","500"),W.searchParams.set("clusterFields","mlsNumber,listPrice,coordinates,type,address.*,details.numBedrooms,details.numBedroomsPlus,details.numBathrooms,details.numBathroomsPlus,details.numGarageSpaces,details.propertyType,lastStatus,images,status,class"),x>=14?(W.searchParams.set("listings","true"),W.searchParams.set("fields","address.*,mlsNumber,listPrice,details.numBedrooms,details.numBedroomsPlus,details.numBathrooms,details.numBathroomsPlus,details.numGarageSpaces,details.propertyType,type,lastStatus,images,status,class,coordinates,latitude,longitude,geo,location,map"),W.searchParams.set("pageSize","500")):W.searchParams.set("listings","false"));const F={queries:b},X=await fetch(W.toString(),{method:"POST",headers:{"REPLIERS-API-KEY":e,"Content-Type":"application/json"},body:JSON.stringify(F)});if(!X.ok){const Z=await X.text();throw new Error(`Bundled API Error: ${X.status} ${X.statusText} - ${Z}`)}oe=await X.json()}else{const{type:b,value:W}=A[0],F=new URL("https://api.repliers.io/listings"),X=Dt(b,W,x);Object.entries(X).forEach(([le,H])=>{Array.isArray(H)?H.forEach(se=>F.searchParams.append(le,se.toString())):F.searchParams.set(le,H.toString())});const Z=L.map||ut(w);F.searchParams.set("map",JSON.stringify(Z)),F.searchParams.set("key",e),x>=18?(F.searchParams.set("cluster","false"),F.searchParams.set("listings","true"),F.searchParams.set("fields","address.*,mlsNumber,listPrice,details.numBedrooms,details.numBedroomsPlus,details.numBathrooms,details.numBathroomsPlus,details.numGarageSpaces,details.propertyType,type,lastStatus,images,status,class,coordinates,latitude,longitude,geo,location,map"),F.searchParams.set("pageSize","500")):(F.searchParams.set("cluster","true"),F.searchParams.set("clusterPrecision",$.toString()),F.searchParams.set("clusterLimit","500"),F.searchParams.set("clusterFields","mlsNumber,listPrice,coordinates,type,address.*,details.numBedrooms,details.numBedroomsPlus,details.numBathrooms,details.numBathroomsPlus,details.numGarageSpaces,details.propertyType,lastStatus,images,status,class"),x>=14?(F.searchParams.set("listings","true"),F.searchParams.set("fields","address.*,mlsNumber,listPrice,details.numBedrooms,details.numBedroomsPlus,details.numBathrooms,details.numBathroomsPlus,details.numGarageSpaces,details.propertyType,type,lastStatus,images,status,class,coordinates,latitude,longitude,geo,location,map"),F.searchParams.set("pageSize","500")):F.searchParams.set("listings","false"));const ae=await fetch(F.toString(),{headers:{"REPLIERS-API-KEY":e,"Content-Type":"application/json"}});if(!ae.ok)throw new Error(`API Error: ${ae.status} ${ae.statusText}`);oe=await ae.json()}const _e=((te=(U=oe.aggregates)==null?void 0:U.map)==null?void 0:te.clusters)||oe.clusters||[],ie=[],ne=[],We=oe.listings||oe.results||[],Ae=b=>L.propertyTypes.length===0?!0:b?L.propertyTypes.includes(b):!1;_e.forEach((b,W)=>{var X,Z,ae,le,H,se,ue,Te,rt,fr,mr,hr,gr,yr,br,xr,Sr,vr,Tr,Er;const F=[((X=b.location)==null?void 0:X.longitude)||((Z=b.coordinates)==null?void 0:Z.lng)||b.longitude||((ae=b.center)==null?void 0:ae.lng),((le=b.location)==null?void 0:le.latitude)||((H=b.coordinates)==null?void 0:H.lat)||b.latitude||((se=b.center)==null?void 0:se.lat)];if(b.count===1&&x>=14){const qe=((ue=b.listing)==null?void 0:ue.listPrice)||b.listPrice||b.map&&((Te=b.map[0])==null?void 0:Te.listPrice),jt=((fr=(rt=b.listing)==null?void 0:rt.details)==null?void 0:fr.propertyType)||((mr=b.details)==null?void 0:mr.propertyType);Ae(jt)&&ne.push({type:"Feature",properties:{mlsNumber:b.mlsNumber||((hr=b.listing)==null?void 0:hr.mlsNumber)||`single-${W}`,listPrice:typeof qe=="string"?parseFloat(qe):qe,propertyType:b.propertyType||((gr=b.listing)==null?void 0:gr.propertyType)||b.status||"Sale",type:((yr=b.listing)==null?void 0:yr.type)||b.type,isProperty:!0,address:((br=b.listing)==null?void 0:br.address)||b.address,details:((xr=b.listing)==null?void 0:xr.details)||b.details,images:((Sr=b.listing)==null?void 0:Sr.images)||b.images,lastStatus:((vr=b.listing)==null?void 0:vr.lastStatus)||b.lastStatus,status:((Tr=b.listing)==null?void 0:Tr.status)||b.status,class:((Er=b.listing)==null?void 0:Er.class)||b.class},geometry:{type:"Point",coordinates:[F[0],F[1]]}})}else if(b.count===1)ie.push({type:"Feature",properties:{count:b.count||1,apiCount:b.count||1,precision:b.precision||$,id:`cluster-${W}`,members:b.properties||b.map||[]},geometry:{type:"Point",coordinates:[F[0],F[1]]}});else{let qe=F;if(b.properties&&Array.isArray(b.properties)){const ft=[];if(b.properties.forEach(mt=>{const $t=ir(mt);$t&&ft.push($t)}),ft.length>0){const mt=ar(ft);mt&&(qe=lr(ft,mt))}}const jt=b.properties||b.map||[],jn=b.count||1;ie.push({type:"Feature",properties:{count:jn,apiCount:b.count||1,precision:b.precision||$,id:`cluster-${W}`,members:jt},geometry:{type:"Point",coordinates:[qe[0],qe[1]]}})}});const et=new Set(ne.map(b=>b.properties.mlsNumber));let Oe=0,Re=0,Pe=0;const be=We.filter(b=>{var ae,le,H,se,ue,Te,rt;if(et.has(b.mlsNumber))return Oe++,!1;const W=((ae=b.map)==null?void 0:ae.longitude)||((le=b.coordinates)==null?void 0:le.lng)||((H=b.coordinates)==null?void 0:H.longitude)||b.longitude||b.lng,F=((se=b.map)==null?void 0:se.latitude)||((ue=b.coordinates)==null?void 0:ue.lat)||((Te=b.coordinates)==null?void 0:Te.latitude)||b.latitude||b.lat;return W!==void 0&&F!==void 0&&!isNaN(W)&&!isNaN(F)?Ae((rt=b.details)==null?void 0:rt.propertyType)?!0:(Pe++,!1):(Re++,!1)}).map(b=>{var Z,ae,le,H,se;const W={mlsNumber:b.mlsNumber,listPrice:typeof b.listPrice=="string"?parseFloat(b.listPrice):b.listPrice,propertyType:b.propertyType||((Z=b.details)==null?void 0:Z.propertyType)||b.type||b.status||"Sale",type:b.type,isProperty:!0},F=x>=13?{address:b.address,details:b.details,images:b.images,type:b.type,lastStatus:b.lastStatus,status:b.status,class:b.class}:{};return{type:"Feature",properties:{...W,...F},geometry:{type:"Point",coordinates:[((ae=b.coordinates)==null?void 0:ae.lng)||b.longitude||((le=b.map)==null?void 0:le.longitude),((H=b.coordinates)==null?void 0:H.lat)||b.latitude||((se=b.map)==null?void 0:se.latitude)]}}}),tt=(b,W,F)=>{const X=[...W,...F];return b.map(Z=>{const ae=Z.geometry.coordinates,le=X.filter(se=>{const ue=se.geometry.coordinates;return Ft(ae,ue)<=50}),H=le.length>0?le.length:Z.properties.count;return{...Z,properties:{...Z.properties,count:H}}})},Be=be.length>0||ne.length>0,ve=x>=14&&Be?tt(ie,be,ne):ie;let He;if(x>=14){const b=[...ve.map(F=>({...F,type:"cluster"})),...ne.map(F=>({...F,type:"singleProperty"})),...be.map(F=>({...F,type:"property"}))];He=dt(b,50).map(F=>{const X=F.filter(H=>H.type==="cluster"),Z=F.filter(H=>H.type==="property"||H.type==="singleProperty"),ae=X.reduce((H,se)=>{var ue;return H+(((ue=se.properties)==null?void 0:ue.count)||0)},0),le=Z.length;return x>=17?Z.length>0?Z:X.length>0?X[0]:null:Z.length>3?X.length>0?X.reduce((H,se)=>{var ue,Te;return(((ue=se.properties)==null?void 0:ue.count)||0)>(((Te=H.properties)==null?void 0:Te.count)||0)?se:H}):Z[0]:ae>le&&X.length>0?X.reduce((H,se)=>{var ue,Te;return(((ue=se.properties)==null?void 0:ue.count)||0)>(((Te=H.properties)==null?void 0:Te.count)||0)?se:H}):Z.length>0?Z:X.length>0&&X[0].properties.count>0?X[0]:null}).flat().filter(Boolean)}else He=dr([...ie,...ne],x);const Rt={type:"FeatureCollection",features:He},pr=u.current.getSource("listings");pr&&(pr.setData(Rt),kt(He));const Rn=oe.count||ie.reduce((b,W)=>b+W.properties.count,0);_(Rn)}catch(A){const re=A instanceof Error?A.message:"Failed to load listings";c(re)}}},[e,ur,ut,kt,L,Dt,dt,dr]);return h.useEffect(()=>{Fe.current=pt},[pt]),h.useEffect(()=>{if(!(!g.current||u.current||!O||S===null))return ht.accessToken=t,u.current=new ht.Map({container:g.current,style:a,center:O,zoom:S}),u.current.on("load",()=>{var x;if(!u.current)return;u.current.addControl(new ht.NavigationControl),p.current=new _t({displayControlsDefault:!1,controls:{polygon:!1,trash:!1},styles:[{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"]],paint:{"fill-color":"#6366f1","fill-opacity":.15}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","$type","Polygon"],["==","active","true"]],paint:{"line-color":"#6366f1","line-width":2}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","$type","Polygon"],["==","active","false"]],paint:{"line-color":"#6366f1","line-width":2}},{id:"gl-draw-polygon-and-line-vertex-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#fff","circle-stroke-color":"#6366f1","circle-stroke-width":2}}]}),u.current.addControl(p.current),u.current.on("draw.create",Qe),u.current.on("draw.update",An),u.current.on("draw.delete",On),u.current.addSource("listings",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),u.current.addLayer({id:"clusters",type:"circle",source:"listings",filter:["has","count"],paint:{"circle-color":["step",["get","count"],"#51bbd6",30,"#f1c40f",60,"#f39c12",150,"#f28cb1",500,"#e74c3c"],"circle-radius":["step",["get","count"],10,30,12,60,14,150,18,500,22],"circle-stroke-width":2,"circle-stroke-color":"#fff","circle-opacity":.8}}),u.current.addLayer({id:"cluster-count",type:"symbol",source:"listings",filter:["has","count"],layout:{"text-field":["get","count"],"text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":["step",["get","count"],10,30,11,60,12,150,14,500,16]},paint:{"text-color":"#ffffff"}}),u.current.addLayer({id:"property-dots",type:"circle",source:"listings",filter:["has","isProperty"],paint:{"circle-color":"#374151","circle-radius":3,"circle-stroke-width":1,"circle-stroke-color":"#fff","circle-opacity":.9}}),u.current.on("click","clusters",async $=>{var _e,ie;if(!u.current||!((_e=$.features)!=null&&_e[0]))return;const M=$.features[0],R=M.geometry.coordinates,G=M.properties.count;M.properties.apiCount;const U=$.originalEvent.clientX,te=$.originalEvent.clientY,A=u.current.getZoom();if(A>=18){u.current.easeTo({center:R,zoom:Math.min(A+1,22),duration:500});return}if(A>=14){const ne=u.current.getSource("listings");if(ne&&ne._data){const Re=(((ie=ne._data.features)==null?void 0:ie.filter(Pe=>{var be;return((be=Pe.properties)==null?void 0:be.isProperty)===!0}))||[]).map(Pe=>{const be=Pe.geometry.coordinates,tt=Math.sqrt(Math.pow(be[0]-R[0],2)+Math.pow(be[1]-R[1],2));return{feature:Pe,distance:tt}}).sort((Pe,be)=>Pe.distance-be.distance).slice(0,G);if(Re.length>0){const Pe=Re.map(({feature:Be})=>{const ve=Be.properties;return{mlsNumber:ve.mlsNumber||"N/A",listPrice:ve.listPrice||0,address:ve.address||{streetNumber:"Unknown",streetName:"Address",city:"Unknown",state:"Unknown"},details:ve.details||{numBedrooms:0,numBathrooms:0,numGarageSpaces:0,propertyType:"Unknown"},images:ve.images||[],type:ve.type||"Sale",lastStatus:ve.lastStatus||"New",status:ve.status||"A"}}),be=Pe.map(Be=>Be.mlsNumber);new Set(be);const tt=Pe.filter((Be,ve,He)=>ve===He.findIndex(Rt=>Rt.mlsNumber===Be.mlsNumber));Ve(tt),Xe({x:U,y:te}),Le(!0),z(!1);return}}const We=[{mlsNumber:`Cluster-${G}`,listPrice:0,address:{streetNumber:"Multiple",streetName:"Properties",city:"Available",state:""},details:{numBedrooms:0,numBathrooms:0,numGarageSpaces:0,propertyType:`${G} Properties in Cluster`},images:[],type:"Sale",lastStatus:"Available",status:"A"}];Ve(We),Xe({x:U,y:te}),Le(!0),z(!1);return}const re=A>=14?2:A>=12?3:4,oe=Math.min(A+re,16);u.current.easeTo({center:R,zoom:oe,duration:1e3,easing:ne=>ne*(2-ne)})}),u.current.on("mouseenter","clusters",()=>{u.current&&(u.current.getCanvas().style.cursor="pointer")}),u.current.on("mouseleave","clusters",()=>{u.current&&(u.current.getCanvas().style.cursor="")}),u.current.on("mouseenter","property-dots",()=>{u.current&&(u.current.getCanvas().style.cursor="pointer")}),u.current.on("mouseleave","property-dots",()=>{u.current&&(u.current.getCanvas().style.cursor="")});const w=u.current.getBounds();w&&((x=Fe.current)==null||x.call(Fe,w))}),u.current.on("moveend",()=>{var x;if(!u.current)return;const w=u.current.getBounds();w&&((x=Fe.current)==null||x.call(Fe,w))}),()=>{ct(),u.current&&(u.current.remove(),u.current=null)}},[t,a,O,S,ct,kt]),h.useEffect(()=>{if(u.current){q.current=null;const w=u.current.getBounds();w&&pt(w)}},[L,pt]),i.jsxs("div",{style:{width:s,height:o,position:"relative"},children:[i.jsx("div",{ref:g,style:{width:"100%",height:"100%"},className:"rounded-lg overflow-hidden"}),i.jsx(Ln,{filters:L,onFiltersChange:At,apiKey:e,onMapUpdate:Ot,onDrawStart:kn,onDrawClear:Fn,onCancelDraw:Dn,hasPolygon:!!m,isDrawing:E}),f&&i.jsx("div",{style:{position:"absolute",bottom:"16px",right:"16px",backgroundColor:"rgba(255, 255, 255, 0.95)",padding:"8px 12px",borderRadius:"6px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.15)",fontSize:"14px",fontWeight:"600",color:"#374151"},children:l?i.jsx("span",{style:{color:"#ef4444"},children:"Error"}):i.jsxs("span",{children:[N.toLocaleString()," properties"]})}),l&&i.jsx("div",{style:{position:"absolute",bottom:"16px",left:"16px",right:"16px",backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"6px",padding:"12px",color:"#b91c1c",fontSize:"14px"},children:l}),i.jsx(vn,{open:V,onClose:()=>z(!1),listing:y,position:Q,mapContainer:g.current}),i.jsx(Tn,{open:Ue,onClose:()=>Le(!1),properties:Ke,position:we,mapContainer:g.current})]})}_n.__docgenInfo={description:"",methods:[],displayName:"AIMapListings",props:{apiKey:{required:!0,tsType:{name:"string"},description:"Repliers API key - required"},mapboxToken:{required:!0,tsType:{name:"string"},description:"MapBox access token - required"},initialCenter:{required:!1,tsType:{name:"tuple",raw:"[number, number]",elements:[{name:"number"},{name:"number"}]},description:"Initial map center coordinates [lng, lat] - auto-detects if not provided"},initialZoom:{required:!1,tsType:{name:"number"},description:"Initial zoom level - auto-calculates if not provided"},height:{required:!1,tsType:{name:"string"},description:"Map container height",defaultValue:{value:'"100%"',computed:!1}},width:{required:!1,tsType:{name:"string"},description:"Map container width",defaultValue:{value:'"100%"',computed:!1}},mapStyle:{required:!1,tsType:{name:"string"},description:"Map style",defaultValue:{value:'"mapbox://styles/mapbox/streets-v12"',computed:!1}},centerCalculation:{required:!1,tsType:{name:"union",raw:'"average" | "city"',elements:[{name:"literal",value:'"average"'},{name:"literal",value:'"city"'}]},description:"Center calculation method",defaultValue:{value:'"average"',computed:!1}},showPropertyCount:{required:!1,tsType:{name:"boolean"},description:"Show property count display",defaultValue:{value:"true",computed:!1}}}};const ws={title:"POCS/AI-MapListings",component:_n,parameters:{layout:"fullscreen"}},ds="pxI19UMy9zfw9vz5lRxoGpjJWXrMnm",ps="pk.eyJ1IjoibWlsYW5zb21hIiwiYSI6ImNtZWJrODZmajBwMWQya3B3cHE1M2Y3anoifQ.HMDLOc-6V9K3-mHKeTHHxw",xt={args:{apiKey:ds,mapboxToken:ps,height:"100vh",width:"100vw",mapStyle:"mapbox://styles/mapbox/streets-v12",centerCalculation:"city"}};var Gr,Vr,zr;xt.parameters={...xt.parameters,docs:{...(Gr=xt.parameters)==null?void 0:Gr.docs,source:{originalSource:`{
  args: {
    apiKey: SAMPLE_API_KEY,
    mapboxToken: SAMPLE_MAPBOX_TOKEN,
    height: "100vh",
    width: "100vw",
    mapStyle: "mapbox://styles/mapbox/streets-v12",
    centerCalculation: "city"
  }
}`,...(zr=(Vr=xt.parameters)==null?void 0:Vr.docs)==null?void 0:zr.source}}};const Ps=["Default"];export{xt as Default,Ps as __namedExportsOrder,ws as default};
