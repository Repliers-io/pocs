import{j as n}from"./jsx-runtime-xF634gn_.js";import{r as g}from"./index-C-7etoUd.js";import{m as Pe}from"./mapbox-gl-vCdO7wfF.js";import{B as xt,C as St}from"./car-CJRJwKAe.js";import{B as wt}from"./bath-D_6pRDEi.js";import{X as nt}from"./x-C6fJ-1bL.js";import{L as Pt}from"./loader-circle-x9Fu845P.js";import{S as vt}from"./search-DVhWTIqa.js";import{C as Tt}from"./chevron-down-BzbnjZNy.js";import"./createLucideIcon-BmJP7rG3.js";const Ct=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),jt=e=>{if(!e)return"N/A";const t=e.numBedrooms,o=e.numBedroomsPlus;return t&&o&&o>0?`${t} + ${o}`:(t==null?void 0:t.toString())||"N/A"},Nt=e=>{if(!e)return"N/A";const t=e.numBathrooms,o=e.numBathroomsPlus;return t&&o&&o>0?`${t} + ${o}`:(t==null?void 0:t.toString())||"N/A"},kt=e=>{var t;return e&&((t=e.numGarageSpaces)==null?void 0:t.toString())||"N/A"},Lt=(e,t)=>t==="New"||t==="Pc"||t==="Ext"?e==="Sale"?"For Sale":e==="Lease"?"For Lease":e||null:t?{Sus:"Suspended",Exp:"Expired",Sld:"Sold",Ter:"Terminated",Dft:"Deal Fell Through",Lsd:"Leased",Sc:"Sold Conditionally",Sce:"Sold Conditionally (Escape Clause)",Lc:"Leased Conditionally",Cs:"Coming Soon"}[t]||t:null,Et=e=>{if(!e)return"Address not available";const o=[e.streetNumber,e.streetDirection,e.streetName,e.streetSuffix].filter(Boolean).join(" "),r=[e.city,e.state].filter(Boolean).join(", ");return[o,r].filter(Boolean).join(", ")},ot=({type:e,lastStatus:t,size:o="sm"})=>{const r=Lt(e,t);if(!r)return null;let c="bg-green-100 text-green-600";switch(r){case"For Sale":c="bg-green-100 text-green-600";break;case"For Lease":c="bg-purple-100 text-purple-600";break;case"Sold":c="bg-blue-100 text-blue-600";break;case"Leased":c="bg-purple-100 text-purple-600";break;case"Sold Conditionally":case"Sold Conditionally (Escape Clause)":case"Leased Conditionally":c="bg-amber-100 text-amber-600";break;case"Coming Soon":c="bg-indigo-100 text-indigo-600";break;case"Suspended":c="bg-orange-100 text-orange-600";break;case"Expired":c="bg-gray-100 text-gray-500";break;case"Terminated":case"Deal Fell Through":c="bg-red-100 text-red-600";break;default:c="bg-gray-100 text-gray-500"}const p=o==="xs"?"text-xs":"text-sm";return n.jsx("span",{className:`${p} px-2 py-1 rounded-md font-medium ${c}`,children:r})};ot.__docgenInfo={description:"",methods:[],displayName:"StatusTag",props:{type:{required:!1,tsType:{name:"string"},description:""},lastStatus:{required:!1,tsType:{name:"string"},description:""},size:{required:!1,tsType:{name:"union",raw:'"xs" | "sm"',elements:[{name:"literal",value:'"xs"'},{name:"literal",value:'"sm"'}]},description:"",defaultValue:{value:'"sm"',computed:!1}}}};function Ae({listing:e,onClick:t}){var o,r;return n.jsx("div",{className:"p-4 cursor-pointer hover:bg-gray-50 transition-colors duration-200",onClick:t,children:n.jsxs("div",{className:"flex items-start gap-4",children:[n.jsx("div",{className:"bg-gray-100 rounded-md overflow-hidden flex-shrink-0 h-20 aspect-[4/3]",children:(o=e.images)!=null&&o[0]?n.jsx("img",{src:`https://cdn.repliers.io/${e.images[0]}?class=small`,alt:"Property",className:"object-cover w-full h-full"}):n.jsx("div",{className:"flex items-center justify-center h-full text-gray-400 text-sm",children:"No Image"})}),n.jsxs("div",{className:"flex-grow min-w-0",children:[n.jsxs("div",{className:"flex justify-between items-start mb-2",children:[n.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[n.jsx("h4",{className:"font-semibold text-gray-800 truncate text-base",children:e.listPrice?Ct(e.listPrice):"Price N/A"}),n.jsx("span",{className:"text-gray-400 text-sm",children:"|"}),n.jsx("span",{className:"text-gray-600 truncate text-sm",children:e.mlsNumber})]}),n.jsx("div",{className:"flex-shrink-0 ml-2",children:n.jsx(ot,{type:e.type,lastStatus:e.lastStatus,size:"sm"})})]}),n.jsx("p",{className:"text-gray-600 leading-relaxed text-sm mb-2",children:Et(e.address)}),n.jsxs("div",{className:"flex items-center text-gray-500 space-x-3 flex-wrap text-sm",children:[n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(xt,{className:"w-4 h-4"}),jt(e.details)]}),n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(wt,{className:"w-4 h-4"}),Nt(e.details)]}),n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(St,{className:"w-4 h-4"}),kt(e.details)]}),((r=e.details)==null?void 0:r.propertyType)&&n.jsxs("span",{className:"text-gray-400",children:["| ",e.details.propertyType]})]})]})]})})}Ae.__docgenInfo={description:"",methods:[],displayName:"ListingPreview",props:{listing:{required:!0,tsType:{name:"ListingResult"},description:""},onClick:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};function at({open:e,onClose:t,listing:o,position:r,mapContainer:c}){const p=g.useRef(null),[u,d]=g.useState({x:0,y:0}),[I,j]=g.useState("bottom"),[l,y]=g.useState(!1);if(g.useEffect(()=>{y(!1)},[e]),g.useEffect(()=>{if(!e||!p.current||!c)return;const P=p.current.getBoundingClientRect(),v=r.x,m=r.y,a=450,b=P.height||200,R=16,D=window.innerWidth,T=window.innerHeight;let M=v-a/2,z=m-b-16,Q="bottom";M<R?M=R:M+a>D-R&&(M=D-a-R),z<R&&(z=m+32,Q="top"),z+b>T-R&&(v>D/2?(M=v-a-16,z=m-b/2,Q="right"):(M=v+16,z=m-b/2,Q="left"),z<R&&(z=R),z+b>T-R&&(z=T-b-R)),d({x:M,y:z}),j(Q),y(!0)},[e,r,c]),g.useEffect(()=>{const f=P=>{p.current&&!p.current.contains(P.target)&&t()};return e&&document.addEventListener("mousedown",f),()=>{document.removeEventListener("mousedown",f)}},[e,t]),!e||!o)return null;const k=()=>{const f="absolute w-3 h-3 bg-white transform rotate-45 border";switch(I){case"bottom":return`${f} -bottom-1.5 left-1/2 -translate-x-1/2 border-r border-b border-gray-200`;case"top":return`${f} -top-1.5 left-1/2 -translate-x-1/2 border-l border-t border-gray-200`;case"left":return`${f} -left-1.5 top-1/2 -translate-y-1/2 border-l border-b border-gray-200`;case"right":return`${f} -right-1.5 top-1/2 -translate-y-1/2 border-r border-t border-gray-200`;default:return`${f} -bottom-1.5 left-1/2 -translate-x-1/2 border-r border-b border-gray-200`}};return n.jsx("div",{ref:p,className:"fixed w-[450px]",style:{zIndex:9999,left:`${u.x}px`,top:`${u.y}px`,visibility:l?"visible":"hidden",opacity:l?1:0,transition:"opacity 150ms ease-in-out"},children:n.jsxs("div",{className:"bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden relative",children:[n.jsx("div",{className:k()}),n.jsx("button",{onClick:t,className:"absolute top-2 right-2 z-10 p-1 rounded-full bg-white hover:bg-gray-100 transition-colors shadow-sm border border-gray-200","aria-label":"Close",children:n.jsx(nt,{size:16,className:"text-gray-600"})}),n.jsx(Ae,{listing:o,onClick:()=>{}})]})})}at.__docgenInfo={description:"",methods:[],displayName:"PropertyTooltip",props:{open:{required:!0,tsType:{name:"boolean"},description:""},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},listing:{required:!0,tsType:{name:"union",raw:"ListingResult | null",elements:[{name:"ListingResult"},{name:"null"}]},description:""},position:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  x: number;
  y: number;
}`,signature:{properties:[{key:"x",value:{name:"number",required:!0}},{key:"y",value:{name:"number",required:!0}}]}},description:""},mapContainer:{required:!0,tsType:{name:"union",raw:"HTMLElement | null",elements:[{name:"HTMLElement"},{name:"null"}]},description:""}}};function it({open:e,onClose:t,properties:o,position:r,mapContainer:c}){const p=g.useRef(null),[u,d]=g.useState({x:0,y:0}),[I,j]=g.useState("bottom"),[l,y]=g.useState(!1);if(g.useEffect(()=>{if(!e){y(!1);return}},[e]),g.useEffect(()=>{if(!e||!c)return;const f=r.x,P=r.y,v=480,m=Math.min(o.length*120+80,400),a=16,b=window.innerWidth,R=window.innerHeight;let D=f-v/2,T=P-m-16,M="bottom";D<a?D=a:D+v>b-a&&(D=b-v-a),T<a&&(T=P+32,M="top"),T+m>R-a&&(f>b/2?(D=f-v-16,T=P-m/2,M="right"):(D=f+16,T=P-m/2,M="left"),T<a&&(T=a),T+m>R-a&&(T=R-m-a)),d({x:D,y:T}),j(M),y(!0)},[e,r,c,o.length]),g.useEffect(()=>{const f=P=>{p.current&&!p.current.contains(P.target)&&t()};return e&&document.addEventListener("mousedown",f),()=>{document.removeEventListener("mousedown",f)}},[e,t]),!e||o.length===0)return null;const k=()=>{const f="absolute w-3 h-3 bg-white transform rotate-45 border";switch(I){case"bottom":return`${f} -bottom-1.5 left-1/2 -translate-x-1/2 border-r border-b border-gray-200`;case"top":return`${f} -top-1.5 left-1/2 -translate-x-1/2 border-l border-t border-gray-200`;case"left":return`${f} -left-1.5 top-1/2 -translate-y-1/2 border-l border-b border-gray-200`;case"right":return`${f} -right-1.5 top-1/2 -translate-y-1/2 border-r border-t border-gray-200`;default:return`${f} -bottom-1.5 left-1/2 -translate-x-1/2 border-r border-b border-gray-200`}};return n.jsx("div",{ref:p,className:"fixed w-[480px]",style:{zIndex:9999,left:`${u.x}px`,top:`${u.y}px`,visibility:l?"visible":"hidden",opacity:l?1:0,transition:"opacity 150ms ease-in-out"},children:n.jsxs("div",{className:"bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden relative",children:[n.jsx("div",{className:k()}),n.jsxs("div",{className:"px-4 py-3 border-b border-gray-100 bg-gray-50 relative",children:[n.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:o.length===1?"1 Property":`${o.length} Properties`}),n.jsx("button",{onClick:t,className:"absolute top-2 right-2 p-1 rounded-full bg-white hover:bg-gray-100 transition-colors shadow-sm border border-gray-200","aria-label":"Close",children:n.jsx(nt,{size:16,className:"text-gray-600"})})]}),n.jsx("div",{className:"max-h-[400px] overflow-y-auto",children:o.map((f,P)=>n.jsx("div",{className:"border-b border-gray-100 last:border-b-0",children:n.jsx(Ae,{listing:f,onClick:()=>{}})},`${f.mlsNumber}-${P}`))})]})})}it.__docgenInfo={description:"",methods:[],displayName:"ClusterTooltip",props:{open:{required:!0,tsType:{name:"boolean"},description:""},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},properties:{required:!0,tsType:{name:"Array",elements:[{name:"ListingResult"}],raw:"ListingResult[]"},description:""},position:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  x: number;
  y: number;
}`,signature:{properties:[{key:"x",value:{name:"number",required:!0}},{key:"y",value:{name:"number",required:!0}}]}},description:""},mapContainer:{required:!0,tsType:{name:"union",raw:"HTMLElement | null",elements:[{name:"HTMLElement"},{name:"null"}]},description:""}}};function lt({value:e,onChange:t,onFocus:o,onSearch:r,isSearching:c,placeholder:p="Search properties..."}){const u=d=>{d.key==="Enter"&&r()};return n.jsxs("div",{style:{position:"relative"},children:[n.jsx("input",{type:"text",value:e,onChange:d=>t(d.target.value),onKeyDown:u,placeholder:p,style:{width:"100%",height:"56px",padding:"16px 60px 16px 20px",fontSize:"16px",border:"2px solid #e5e7eb",borderRadius:"28px",background:"#f9fafb",outline:"none",transition:"all 200ms ease"},onFocus:d=>{d.currentTarget.style.borderColor="#6366f1",d.currentTarget.style.background="white",d.currentTarget.style.boxShadow="0 0 0 3px rgba(99, 102, 241, 0.1)",o()},onBlur:d=>{d.currentTarget.style.borderColor="#e5e7eb",d.currentTarget.style.background="#f9fafb",d.currentTarget.style.boxShadow="none"}}),n.jsx("button",{onClick:r,disabled:c||!e.trim(),style:{position:"absolute",right:"4px",top:"4px",width:"48px",height:"48px",background:c||!e.trim()?"#d1d5db":"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)",border:"none",borderRadius:"50%",boxShadow:"0 4px 16px rgba(79, 70, 229, 0.3)",cursor:c||!e.trim()?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 200ms ease",color:"white"},onMouseEnter:d=>{!c&&e.trim()&&(d.currentTarget.style.transform="scale(1.05)",d.currentTarget.style.boxShadow="0 6px 20px rgba(79, 70, 229, 0.4)")},onMouseLeave:d=>{d.currentTarget.style.transform="scale(1)",d.currentTarget.style.boxShadow="0 4px 16px rgba(79, 70, 229, 0.3)"},children:c?n.jsx(Pt,{size:20,className:"animate-spin"}):n.jsx(vt,{size:20})})]})}lt.__docgenInfo={description:"",methods:[],displayName:"SearchInput",props:{value:{required:!0,tsType:{name:"string"},description:""},onChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(value: string) => void",signature:{arguments:[{type:{name:"string"},name:"value"}],return:{name:"void"}}},description:""},onFocus:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onSearch:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},isSearching:{required:!0,tsType:{name:"boolean"},description:""},placeholder:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:'"Search properties..."',computed:!1}}}};function It(e){const[t,o]=g.useState(!1),[r,c]=g.useState(null),[p,u]=g.useState(null);return{processSearch:async j=>{if(!j.trim())return c("Please enter a search query"),null;o(!0),c(null);try{const l={prompt:j.trim(),...p&&{nlpId:p}};console.log("ðŸ” NLP Request:",l);const y=await fetch("https://api.repliers.io/nlp",{method:"POST",headers:{"REPLIERS-API-KEY":e,"Content-Type":"application/json"},body:JSON.stringify(l)});if(y.status===406)throw new Error(`That doesn't seem to be a property search. Try something like "2 bedroom condo in Toronto"`);if(y.status===401)throw new Error("Invalid API key. Please check your Repliers API key.");if(y.status===429)throw new Error("Too many requests. Please wait a moment and try again.");if(!y.ok)throw new Error(`Search failed: ${y.status} ${y.statusText}`);const k=await y.json();return console.log("âœ… NLP Response:",{nlpId:k.nlpId,url:k.request.url,summary:k.request.summary,body:k.request.body,fullResponse:k}),u(k.nlpId),k}catch(l){const y=l instanceof Error?l.message:"Search failed";return c(y),null}finally{o(!1)}},isProcessing:t,error:r,nlpId:p,resetNlpId:()=>{u(null)}}}function Mt(e){const o=new URL(e).searchParams,r={},c=o.get("propertyType");c&&(r.propertyTypes=c.split(",").map(a=>a.trim()));const p=o.get("minBeds");if(p){const a=parseInt(p);a===0?r.bedrooms="0":a===1?r.bedrooms="1":a===2?r.bedrooms="2":a===3?r.bedrooms="3":a===4?r.bedrooms="4":a>=5&&(r.bedrooms="5+")}const u=o.get("minBaths");if(u){const a=parseInt(u);a===1?r.bathrooms="1+":a===2?r.bathrooms="2+":a===3?r.bathrooms="3+":a===4?r.bathrooms="4+":a>=5&&(r.bathrooms="5+")}const d=o.get("minPrice");d&&(r.minPrice=parseInt(d));const I=o.get("maxPrice");I&&(r.maxPrice=parseInt(I));const j=o.get("minSqft");j&&(r.minSqft=parseInt(j));const l=o.get("maxSqft");l&&(r.maxSqft=parseInt(l));const y=o.get("minParkingSpaces");y&&(r.garageSpaces=`${y}+`);const k=o.get("type");k==="sale"||k==="Sale"?r.listingType="sale":(k==="lease"||k==="Lease")&&(r.listingType="lease");const f=o.get("status");f==="A"?r.activeListingDays="all":f==="U"?r.unavailableListingDays="all":f==="S"&&(r.soldListingDays="all");const P=o.get("city");P&&(r.city=P);const v=o.get("neighborhood");v&&(r.neighborhood=v);const m=o.get("map");if(m)try{const a=JSON.parse(m);Array.isArray(a)&&(r.map=a)}catch{}return r}function Bt(e){return e.request.summary||""}async function Dt(e,t){var o,r;try{const c=new URL("https://api.repliers.io/locations");t.neighborhood&&(c.searchParams.set("name",t.neighborhood),c.searchParams.set("type","neighborhood")),t.city&&c.searchParams.set("city",t.city),t.area&&c.searchParams.set("area",t.area),c.searchParams.set("fields","name,type,locationId,map");const p=await fetch(c.toString(),{headers:{"REPLIERS-API-KEY":e,"Content-Type":"application/json"}});if(!p.ok)return console.error("Locations API error:",p.status,p.statusText),null;const d=(await p.json()).locations||[];if(d.length===0)return console.log("No locations found for:",t),null;const I=d[0],j=I.map;if(!j)return console.log("No map data in location response"),null;const l=[j.longitude||((o=j.point)==null?void 0:o[0]),j.latitude||((r=j.point)==null?void 0:r[1])];let y;j.boundary&&Array.isArray(j.boundary)&&(y=[j.boundary]);const k=I.type==="neighborhood"?14:I.type==="city"?11:I.type==="area"?10:12;return console.log("ðŸ“ Geocoded location:",{name:I.name,type:I.type,center:l,zoom:k,hasBounds:!!y}),{center:l,bounds:y,zoom:k}}catch(c){return console.error("Failed to geocode location:",c),null}}function ct({bedrooms:e,bathrooms:t,onBedroomsChange:o,onBathroomsChange:r}){const c=["all","0","1","2","3","4","5+"],p=["all","1+","2+","3+","4+","5+"];return n.jsxs("div",{children:[n.jsxs("div",{style:{marginBottom:"16px"},children:[n.jsx("div",{style:{fontSize:"12px",fontWeight:"600",color:"#6b7280",marginBottom:"8px",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Bedrooms"}),n.jsx("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:c.map(u=>n.jsx("button",{onClick:()=>o(u),style:{padding:"10px 18px",background:e===u?"#6366f1":"white",color:e===u?"white":"#374151",border:`1px solid ${e===u?"#6366f1":"#d1d5db"}`,borderRadius:"8px",fontSize:"14px",fontWeight:e===u?"600":"400",cursor:"pointer",transition:"all 200ms ease",minWidth:"48px"},onMouseEnter:d=>{e!==u&&(d.currentTarget.style.background="#f3f4f6",d.currentTarget.style.borderColor="#9ca3af")},onMouseLeave:d=>{e!==u&&(d.currentTarget.style.background="white",d.currentTarget.style.borderColor="#d1d5db")},children:u==="all"?"Any":u},u))})]}),n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:"12px",fontWeight:"600",color:"#6b7280",marginBottom:"8px",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Bathrooms"}),n.jsx("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:p.map(u=>n.jsx("button",{onClick:()=>r(u),style:{padding:"10px 18px",background:t===u?"#6366f1":"white",color:t===u?"white":"#374151",border:`1px solid ${t===u?"#6366f1":"#d1d5db"}`,borderRadius:"8px",fontSize:"14px",fontWeight:t===u?"600":"400",cursor:"pointer",transition:"all 200ms ease",minWidth:"48px"},onMouseEnter:d=>{t!==u&&(d.currentTarget.style.background="#f3f4f6",d.currentTarget.style.borderColor="#9ca3af")},onMouseLeave:d=>{t!==u&&(d.currentTarget.style.background="white",d.currentTarget.style.borderColor="#d1d5db")},children:u==="all"?"Any":u},u))})]})]})}ct.__docgenInfo={description:"",methods:[],displayName:"BedroomBathroomFilter",props:{bedrooms:{required:!0,tsType:{name:"string"},description:""},bathrooms:{required:!0,tsType:{name:"string"},description:""},onBedroomsChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(value: string) => void",signature:{arguments:[{type:{name:"string"},name:"value"}],return:{name:"void"}}},description:""},onBathroomsChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(value: string) => void",signature:{arguments:[{type:{name:"string"},name:"value"}],return:{name:"void"}}},description:""}}};function ut({filters:e,onFiltersChange:t,apiKey:o}){const[r,c]=g.useState([]),[p,u]=g.useState(!0),[d,I]=g.useState(!1);g.useEffect(()=>{(async()=>{var P,v;try{const m=new URL("https://api.repliers.io/listings");m.searchParams.set("aggregates","details.propertyType"),m.searchParams.set("listings","false"),m.searchParams.set("status","A");const a=await fetch(m.toString(),{headers:{"REPLIERS-API-KEY":o,"Content-Type":"application/json"}});if(!a.ok)throw new Error(`Failed to fetch property types: ${a.status}`);const R=((v=(P=(await a.json()).aggregates)==null?void 0:P.details)==null?void 0:v.propertyType)||{},D=Object.entries(R).sort(([,T],[,M])=>M-T).map(([T])=>T);c(D)}catch{}finally{u(!1)}})()},[o]);const j=f=>{const v=e.propertyTypes.includes(f)?e.propertyTypes.filter(m=>m!==f):[...e.propertyTypes,f];t({...e,propertyTypes:v})},l=()=>{const f=e.propertyTypes.length===r.length;t({...e,propertyTypes:f?[]:[...r]})};if(p)return n.jsx("div",{style:{position:"relative",marginBottom:"12px"},children:n.jsx("div",{style:{padding:"8px 12px",fontSize:"12px",color:"#6b7280",fontStyle:"italic"},children:"Loading property types..."})});const y=e.propertyTypes.length===0||e.propertyTypes.length===r.length,k=e.propertyTypes.length>0&&e.propertyTypes.length<r.length;return n.jsxs("div",{style:{position:"relative",marginBottom:"12px"},children:[n.jsxs("button",{onClick:()=>I(!d),style:{width:"100%",padding:"8px 12px",backgroundColor:"white",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",textAlign:"left"},children:[n.jsx("span",{children:y?"All property types":k?`${e.propertyTypes.length} selected`:"Select property types"}),n.jsx(Tt,{size:16,style:{transform:d?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"}})]}),d&&n.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:"white",border:"1px solid #d1d5db",borderRadius:"6px",marginTop:"4px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",zIndex:1002,maxHeight:"300px",overflowY:"auto"},children:[n.jsxs("div",{onClick:l,style:{padding:"8px 12px",fontSize:"14px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",backgroundColor:y?"#f3f4f6":"white",borderBottom:"1px solid #f3f4f6"},onMouseEnter:f=>{y||(f.currentTarget.style.backgroundColor="#f9fafb")},onMouseLeave:f=>{y||(f.currentTarget.style.backgroundColor="white")},children:[n.jsx("div",{style:{width:"16px",height:"16px",border:"2px solid #d1d5db",borderRadius:"3px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:y?"#10b981":"white",borderColor:y?"#10b981":"#d1d5db"},children:y&&n.jsx("svg",{width:"10",height:"8",viewBox:"0 0 10 8",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M8.5 1L3.5 6L1.5 4",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),"All property types"]}),r.map(f=>{const P=e.propertyTypes.includes(f);return n.jsxs("div",{onClick:()=>j(f),style:{padding:"8px 12px",fontSize:"14px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",backgroundColor:P?"#f3f4f6":"white"},onMouseEnter:v=>{P||(v.currentTarget.style.backgroundColor="#f9fafb")},onMouseLeave:v=>{P||(v.currentTarget.style.backgroundColor="white")},children:[n.jsx("div",{style:{width:"16px",height:"16px",border:"2px solid #d1d5db",borderRadius:"3px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:P?"#10b981":"white",borderColor:P?"#10b981":"#d1d5db"},children:P&&n.jsx("svg",{width:"10",height:"8",viewBox:"0 0 10 8",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M8.5 1L3.5 6L1.5 4",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),f]},f)})]})]})}ut.__docgenInfo={description:"",methods:[],displayName:"PropertyTypeFilter",props:{filters:{required:!0,tsType:{name:"MapFilters"},description:""},onFiltersChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(filters: MapFilters) => void",signature:{arguments:[{type:{name:"MapFilters"},name:"filters"}],return:{name:"void"}}},description:""},apiKey:{required:!0,tsType:{name:"string"},description:""}}};function dt({filters:e,onFiltersChange:t,onSearch:o,apiKey:r,onMapUpdate:c}){const[p,u]=g.useState(!1),[d,I]=g.useState(""),j=g.useRef(null),{processSearch:l,isProcessing:y,error:k,resetNlpId:f}=It(r),P=a=>{I(a),a!==d&&f()};g.useEffect(()=>{const a=b=>{j.current&&!j.current.contains(b.target)&&u(!1)};return p&&document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[p]),g.useEffect(()=>{const a=b=>{b.key==="Escape"&&p&&u(!1)};return document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)}},[p]);const v=()=>{u(!0)},m=async()=>{if(!d.trim())return;const a=await l(d);if(a){const b=Mt(a.request.url),R={...e,...b};if(t(R),c){if(b.map){const T=b.map[0];if(T&&T.length>0){const M=T.map(ce=>ce[0]),z=T.map(ce=>ce[1]),Q=Math.min(...M),le=Math.max(...M),Ce=Math.min(...z),je=Math.max(...z),pe=(Q+le)/2,Ne=(Ce+je)/2;c({center:[pe,Ne],bounds:b.map,zoom:12})}}else if(b.neighborhood||b.city){const T=await Dt(r,{neighborhood:b.neighborhood,city:b.city});T&&c({center:T.center,bounds:T.bounds,zoom:T.zoom})}}const D=Bt(a);D&&I(D),await(o==null?void 0:o(d))}};return n.jsxs("div",{ref:j,style:{position:"absolute",top:"16px",left:"16px",width:"600px",maxWidth:"calc(100vw - 32px)",background:"white",borderRadius:p?"24px":"32px",padding:"0",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.08)",zIndex:1e3,transition:"all 300ms ease-out",maxHeight:p?"90vh":"auto",overflowY:p?"auto":"visible"},children:[n.jsx(lt,{value:d,onChange:P,onFocus:v,onSearch:m,isSearching:y,placeholder:"Search properties..."}),k&&n.jsx("div",{style:{margin:"12px 16px",padding:"12px 16px",background:"#fef2f2",border:"1px solid #fecaca",borderRadius:"8px",color:"#dc2626",fontSize:"14px"},children:k}),n.jsxs("div",{style:{maxHeight:p?"600px":"0",opacity:p?1:0,overflow:"hidden",transition:"max-height 300ms ease-out, opacity 300ms ease-out",marginTop:p?"20px":"0",padding:p?"0 16px 16px 16px":"0"},children:[n.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, #e5e7eb 50%, transparent)",margin:"16px 0"}}),n.jsx("div",{style:{fontSize:"11px",fontWeight:"700",color:"#9ca3af",marginBottom:"16px",textTransform:"uppercase",letterSpacing:"1px"},children:"Refine Your Search"}),n.jsx("div",{style:{marginBottom:"16px"},children:n.jsxs("select",{value:e.listingType||"sale",onChange:a=>t({...e,listingType:a.target.value}),style:{width:"100%",padding:"10px 12px",background:"white",border:"1px solid #d1d5db",borderRadius:"8px",fontSize:"14px",color:"#374151",cursor:"pointer"},children:[n.jsx("option",{value:"sale",children:"For Sale"}),n.jsx("option",{value:"lease",children:"For Lease"})]})}),n.jsx("div",{style:{marginBottom:"16px"},children:n.jsx(ut,{filters:e,onFiltersChange:t,apiKey:r})}),n.jsxs("div",{style:{marginBottom:"16px"},children:[n.jsx("div",{style:{fontSize:"12px",fontWeight:"600",color:"#6b7280",marginBottom:"8px",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Price Range"}),n.jsxs("div",{style:{display:"flex",gap:"8px"},children:[n.jsx("input",{type:"number",placeholder:"Min",value:e.minPrice||"",onChange:a=>t({...e,minPrice:a.target.value?parseInt(a.target.value):void 0}),style:{flex:1,padding:"10px 12px",border:"1px solid #d1d5db",borderRadius:"8px",fontSize:"14px",outline:"none"}}),n.jsx("input",{type:"number",placeholder:"Max",value:e.maxPrice||"",onChange:a=>t({...e,maxPrice:a.target.value?parseInt(a.target.value):void 0}),style:{flex:1,padding:"10px 12px",border:"1px solid #d1d5db",borderRadius:"8px",fontSize:"14px",outline:"none"}})]})]}),n.jsx("div",{style:{marginBottom:"16px"},children:n.jsx(ct,{bedrooms:e.bedrooms||"all",bathrooms:e.bathrooms||"all",onBedroomsChange:a=>t({...e,bedrooms:a}),onBathroomsChange:a=>t({...e,bathrooms:a})})})]})]})}dt.__docgenInfo={description:"",methods:[],displayName:"SearchPanel",props:{filters:{required:!0,tsType:{name:"MapFilters"},description:""},onFiltersChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(filters: MapFilters) => void",signature:{arguments:[{type:{name:"MapFilters"},name:"filters"}],return:{name:"void"}}},description:""},apiKey:{required:!0,tsType:{name:"string"},description:""},onSearch:{required:!1,tsType:{name:"signature",type:"function",raw:"(query: string) => void",signature:{arguments:[{type:{name:"string"},name:"query"}],return:{name:"void"}}},description:""},onMapUpdate:{required:!1,tsType:{name:"signature",type:"function",raw:"(update: { center?: [number, number]; bounds?: number[][][]; zoom?: number }) => void",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{ center?: [number, number]; bounds?: number[][][]; zoom?: number }",signature:{properties:[{key:"center",value:{name:"tuple",raw:"[number, number]",elements:[{name:"number"},{name:"number"}],required:!1}},{key:"bounds",value:{name:"Array",elements:[{name:"Array",elements:[{name:"Array",elements:[{name:"number"}],raw:"number[]"}],raw:"number[][]"}],raw:"number[][][]",required:!1}},{key:"zoom",value:{name:"number",required:!1}}]}},name:"update"}],return:{name:"void"}}},description:""}}};const At=(e,t)=>{const o=(r,c)=>r>=100?`${Math.round(r)}${c}`:r>=10?`${Math.round(r*10)/10}${c}`:`${Math.round(r*100)/100}${c}`;if(t==="Lease"){if(e>=1e3){const r=e/1e3;return o(r,"K")}return Math.round(e).toString()}else{if(e>=999500){const r=e/1e6;return o(r,"M")}else if(e>=1e3){const r=e/1e3;return o(r,"K")}return Math.round(e).toString()}},qt=(e,t,o)=>e==="U"&&(t==="Sld"||t==="Sc")?"#8b7fa8":e==="U"?"#f59e0b":o==="Lease"?"#a855f7":"#22c55e",Rt=(e,t,o,r)=>{const c=At(e,t),p=qt(o,r,t),u=document.createElement("div");return u.style.cssText=`
    background-color: ${p};
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 600;
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    white-space: nowrap;
    pointer-events: auto;
    cursor: pointer;
  `,u.textContent=c,u},qe=e=>{var t,o,r,c,p,u,d,I;return(t=e.coordinates)!=null&&t.lat&&((o=e.coordinates)!=null&&o.lng)?{lat:e.coordinates.lat,lng:e.coordinates.lng}:e.latitude&&e.longitude?{lat:e.latitude,lng:e.longitude}:(r=e.map)!=null&&r.latitude&&((c=e.map)!=null&&c.longitude)?{lat:e.map.latitude,lng:e.map.longitude}:(p=e.location)!=null&&p.latitude&&((u=e.location)!=null&&u.longitude)?{lat:e.location.latitude,lng:e.location.longitude}:(d=e.center)!=null&&d.lat&&((I=e.center)!=null&&I.lng)?{lat:e.center.lat,lng:e.center.lng}:null},Re=e=>{if(e.length===0)return null;let t=e[0].lat,o=e[0].lat,r=e[0].lng,c=e[0].lng;return e.forEach(p=>{t=Math.max(t,p.lat),o=Math.min(o,p.lat),r=Math.max(r,p.lng),c=Math.min(c,p.lng)}),{north:t,south:o,east:r,west:c}},$e=(e,t)=>{const{north:o,south:r,east:c,west:p}=t,u=20,d=(o-r)/u,I=(c-p)/u,j=Array(u).fill(0).map(()=>Array(u).fill(0));e.forEach(P=>{const v=Math.floor((P.lat-r)/d),m=Math.floor((P.lng-p)/I),a=Math.max(0,Math.min(u-1,v)),b=Math.max(0,Math.min(u-1,m));j[a][b]++});let l=0,y=0,k=0;for(let P=0;P<u;P++)for(let v=0;v<u;v++)j[P][v]>l&&(l=j[P][v],y=r+(P+.5)*d,k=p+(v+.5)*I);return l>0?[k,y]:[(c+p)/2,(o+r)/2]},$t=e=>{try{const t=localStorage.getItem(`mapListings-autoCenter-${e}`);if(t){const o=JSON.parse(t);if(Date.now()-o.timestamp<1440*60*1e3)return{center:o.center}}}catch{}return null},Te=(e,t)=>{try{const o={...t,timestamp:Date.now()};localStorage.setItem(`mapListings-autoCenter-${e}`,JSON.stringify(o))}catch{}},Ft=async(e,t="average")=>{var o,r,c,p,u,d,I,j;try{const y=await fetch("https://api.repliers.io/listings",{method:"POST",headers:{"REPLIERS-API-KEY":e,"Content-Type":"application/json"},body:JSON.stringify({queries:[{cluster:!0,clusterPrecision:8,clusterLimit:50,status:"A"},{cluster:!1,listings:!0,pageSize:500,status:"A"}]})});if(y.status===400)return et(e,t);if(!y.ok)throw new Error(`Bundled auto-center API Error: ${y.status} ${y.statusText}`);const k=await y.json(),f=k[0]||{},P=k[1]||{},v=((r=(o=f.aggregates)==null?void 0:o.map)==null?void 0:r.clusters)||f.clusters||[],m=P.listings||P.results||[];if(t==="city"&&v.length>0){let T=null,M=0;if(v.forEach(z=>{const Q=z.count||0;Q>M&&(M=Q,T=z)}),T){const z=[((c=T.location)==null?void 0:c.longitude)||((p=T.coordinates)==null?void 0:p.lng)||T.longitude||((u=T.center)==null?void 0:u.lng),((d=T.location)==null?void 0:d.latitude)||((I=T.coordinates)==null?void 0:I.lat)||T.latitude||((j=T.center)==null?void 0:j.lat)];if(z[0]&&z[1]){const le={center:[z[0],z[1]]};return Te(`${e}-${t}`,le),le}}}if(m.length===0)return null;const a=[];if(m.forEach(T=>{const M=qe(T);M&&a.push(M)}),a.length===0)return null;const b=Re(a);if(!b)return null;const D={center:$e(a,b)};return Te(`${e}-${t}`,D),D}catch{return et(e,t)}},et=async(e,t="average")=>{var o,r,c,p,u,d,I,j;try{let l=[],y=[];if(t==="city")try{const m=new URL("https://api.repliers.io/listings");m.searchParams.set("cluster","true"),m.searchParams.set("clusterPrecision","8"),m.searchParams.set("clusterLimit","50"),m.searchParams.set("status","A");const a=await fetch(m.toString(),{headers:{"REPLIERS-API-KEY":e,"Content-Type":"application/json"}});if(a.ok){const b=await a.json();l=((r=(o=b.aggregates)==null?void 0:o.map)==null?void 0:r.clusters)||b.clusters||[]}}catch{}try{const m=new URL("https://api.repliers.io/listings");m.searchParams.set("pageSize","500"),m.searchParams.set("status","A");const a=await fetch(m.toString(),{headers:{"REPLIERS-API-KEY":e,"Content-Type":"application/json"}});if(a.ok){const b=await a.json();y=b.listings||b.results||[]}}catch{}if(t==="city"&&l.length>0){let m=null,a=0;if(l.forEach(b=>{const R=b.count||0;R>a&&(a=R,m=b)}),m){const b=[((c=m.location)==null?void 0:c.longitude)||((p=m.coordinates)==null?void 0:p.lng)||m.longitude||((u=m.center)==null?void 0:u.lng),((d=m.location)==null?void 0:d.latitude)||((I=m.coordinates)==null?void 0:I.lat)||m.latitude||((j=m.center)==null?void 0:j.lat)];if(b[0]&&b[1]){const D={center:[b[0],b[1]]};return Te(`${e}-${t}`,D),D}}}if(y.length===0)return null;const k=[];if(y.forEach(m=>{const a=qe(m);a&&k.push(a)}),k.length===0)return null;const f=Re(k);if(!f)return null;const v={center:$e(k,f)};return Te(`${e}-${t}`,v),v}catch{return null}};function pt({apiKey:e,mapboxToken:t,initialCenter:o,initialZoom:r,height:c="100%",width:p="100%",mapStyle:u="mapbox://styles/mapbox/streets-v12",centerCalculation:d="average",showPropertyCount:I=!0}){const j=g.useRef(null),l=g.useRef(null),[y,k]=g.useState(null),[f,P]=g.useState(0),[v,m]=g.useState(o||null),[a,b]=g.useState(r||null),R=g.useRef(null),D=g.useRef(null),[T,M]=g.useState(!1),[z,Q]=g.useState(null),[le,Ce]=g.useState({x:0,y:0}),[je,pe]=g.useState(!1),[Ne,ce]=g.useState([]),[mt,Fe]=g.useState({x:0,y:0}),ke=g.useRef([]),oe=g.useRef(null),[S,gt]=g.useState({listingType:"sale",propertyTypes:[],bedrooms:"all",bathrooms:"all",garageSpaces:"all",openHouse:"all"}),ft=g.useCallback(w=>{gt(w)},[]),yt=g.useCallback(w=>{l.current&&w.center&&l.current.easeTo({center:w.center,zoom:w.zoom||l.current.getZoom(),duration:1e3})},[]),ye=g.useCallback(()=>{ke.current.forEach(w=>w.remove()),ke.current=[]},[]),Le=g.useCallback(w=>{l.current&&(ye(),w.forEach(i=>{if("isProperty"in i.properties&&i.properties.isProperty&&i.properties.listPrice){const{listPrice:B,status:h,lastStatus:N}=i.properties,E=i.properties.type||"Sale",[L,O]=i.geometry.coordinates;if(isNaN(L)||isNaN(O)||L===null||O===null)return;const x=typeof B=="string"?parseFloat(B):B;if(isNaN(x))return;const W=Rt(x,E,h,N),U=new Pe.Marker({element:W,anchor:"bottom",offset:[0,-5]}).setLngLat([L,O]).addTo(l.current);W.addEventListener("click",async te=>{var ue;const Y=te.clientX,_=te.clientY;if(Ce({x:Y,y:_}),i.properties.address&&i.properties.images){const re={mlsNumber:i.properties.mlsNumber||"N/A",listPrice:x,address:i.properties.address,details:i.properties.details,images:i.properties.images,type:i.properties.type,lastStatus:i.properties.lastStatus,status:i.properties.status};Q(re),M(!0);return}try{const re=await fetch(`https://api.repliers.io/listings?mlsNumber=${i.properties.mlsNumber}&fields=address.*,details.*,images,type,lastStatus,status,class`,{headers:{"REPLIERS-API-KEY":e,"Content-Type":"application/json"}});if(!re.ok)throw new Error(`Failed to fetch property details: ${re.status}`);const se=(ue=(await re.json()).listings)==null?void 0:ue[0];if(se){const ne={mlsNumber:i.properties.mlsNumber||"N/A",listPrice:x,address:se.address,details:se.details,images:se.images,type:se.type||i.properties.type,lastStatus:se.lastStatus,status:se.status};Q(ne),M(!0)}else{const ne={mlsNumber:i.properties.mlsNumber||"N/A",listPrice:x,address:i.properties.address,details:i.properties.details,images:i.properties.images,type:i.properties.type,lastStatus:i.properties.lastStatus,status:i.properties.status};Q(ne),M(!0)}}catch{const me={mlsNumber:i.properties.mlsNumber||"N/A",listPrice:x,address:i.properties.address,details:i.properties.details,images:i.properties.images,type:i.properties.type,lastStatus:i.properties.lastStatus,status:i.properties.status};Q(me),M(!0)}}),ke.current.push(U)}}))},[ye,e]);g.useEffect(()=>{(async()=>{if(v&&a)return;const i=$t(`${e}-${d}`);if(i){m(i.center),b(r||10);return}const B=await Ft(e,d);B?(m(B.center),b(r||10)):(m([-98.5795,39.8283]),b(r||10))})()},[e,v,a,d,r]);const ze=g.useCallback(w=>w<=6?5:w<=8?8:w<=10?12:w<=12?16:w<=14?20:w<=17?25:29,[]),he=g.useCallback(w=>{const i=w.getSouthWest(),B=w.getNorthEast();return[[[i.lng,i.lat],[B.lng,i.lat],[B.lng,B.lat],[i.lng,B.lat],[i.lng,i.lat]]]},[]),Ee=g.useCallback((w,i,B)=>{const h={};if(w==="active"){if(h.status="A",i!=="all"){const N=new Date;if(i.endsWith("+")){const E=parseInt(i.replace("+","")),L=new Date(N);L.setDate(L.getDate()-E),h.maxListDate=L.toISOString().split("T")[0]}else{const E=parseInt(i),L=new Date(N);L.setDate(L.getDate()-E),h.minListDate=L.toISOString().split("T")[0]}}}else if(w==="sold"){h.status="U",h.lastStatus="Sld";const N=parseInt(i);if(N>=2007&&N<=2025)h.minSoldDate=`${i}-01-01`,h.maxSoldDate=`${i}-12-31`;else{const E=new Date,L=new Date(E);L.setDate(L.getDate()-N),h.minSoldDate=L.toISOString().split("T")[0],h.maxSoldDate=E.toISOString().split("T")[0]}}else if(w==="unavailable"){h.status="U";const N=parseInt(i);if(N>=2007&&N<=2025)h.minUnavailableDate=`${i}-01-01`,h.maxUnavailableDate=`${i}-12-31`;else{const E=new Date,L=new Date(E);L.setDate(L.getDate()-N),h.minUnavailableDate=L.toISOString().split("T")[0],h.maxUnavailableDate=E.toISOString().split("T")[0]}}if(S.listingType==="sale"?h.type="Sale":S.listingType==="lease"&&(h.type="Lease"),S.propertyTypes.length===1&&(h["details.propertyType"]=S.propertyTypes[0]),S.minPrice&&S.minPrice>0&&(h.minPrice=S.minPrice),S.maxPrice&&S.maxPrice>0&&(h.maxPrice=S.maxPrice),S.bedrooms&&S.bedrooms!=="all"&&(S.bedrooms==="5+"?h.minBedrooms=5:(h.minBedrooms=parseInt(S.bedrooms),h.maxBedrooms=parseInt(S.bedrooms))),S.bathrooms&&S.bathrooms!=="all"&&(h.minBaths=parseInt(S.bathrooms.replace("+",""))),S.garageSpaces&&S.garageSpaces!=="all"&&(h.minGarageSpaces=parseInt(S.garageSpaces.replace("+",""))),S.minSqft&&S.minSqft>0&&(h.minSqft=S.minSqft),S.maxSqft&&S.maxSqft>0&&(h.maxSqft=S.maxSqft),S.openHouse&&S.openHouse!=="all"){const N=new Date;N.setHours(0,0,0,0);let E=null,L=null;if(S.openHouse==="today")E=N,L=N;else if(S.openHouse==="thisWeekend"){const O=N.getDay(),x=O===0?6:6-O,W=new Date(N);W.setDate(N.getDate()+x);const U=new Date(W);U.setDate(W.getDate()+1),E=W,L=U}else if(S.openHouse==="thisWeek"){E=N;const O=new Date(N);O.setDate(N.getDate()+(7-N.getDay())),L=O}else S.openHouse==="anytime"&&(E=N);E&&(h.minOpenHouseDate=E.toISOString().split("T")[0],L&&(h.maxOpenHouseDate=L.toISOString().split("T")[0]))}return h},[S]),Ie=g.useCallback((w,i)=>{const[B,h]=w,[N,E]=i,L=6371e3,O=(E-h)*Math.PI/180,x=(N-B)*Math.PI/180,W=Math.sin(O/2)*Math.sin(O/2)+Math.cos(h*Math.PI/180)*Math.cos(E*Math.PI/180)*Math.sin(x/2)*Math.sin(x/2),U=2*Math.atan2(Math.sqrt(W),Math.sqrt(1-W));return L*U},[]),be=g.useCallback((w,i)=>{const B=[],h=new Set;return w.forEach((N,E)=>{if(h.has(E))return;const L=[N];h.add(E);const O=N.geometry.coordinates;w.forEach((x,W)=>{if(h.has(W)||E===W)return;const U=x.geometry.coordinates;Ie(O,U)<=i&&(L.push(x),h.add(W))}),B.push(L)}),B},[Ie]),Oe=g.useCallback((w,i)=>{const B=i<=10?30:i<=12?60:i<=13?100:30,h=i<=10?500:i<=12?300:i<=13?200:100,N=w.filter(x=>x.properties.count<=B),E=w.filter(x=>x.properties.count>B);if(N.length===0)return w;const O=be(N,h).map(x=>{if(x.length===1)return x[0];const W=x.reduce((Y,_)=>Y+_.properties.count,0),U=x.reduce((Y,_)=>Y+_.geometry.coordinates[0],0)/x.length,te=x.reduce((Y,_)=>Y+_.geometry.coordinates[1],0)/x.length;return{type:"Feature",properties:{count:W,precision:x[0].properties.precision,id:`merged-${x.map(Y=>Y.properties.id).join("-")}`,members:[]},geometry:{type:"Point",coordinates:[U,te]}}});return[...E,...O]},[be]),xe=g.useCallback(async w=>{var L,O;if(!l.current)return;const i=l.current.getZoom(),B=ze(i),h=JSON.stringify(he(w)),N=Math.round(i*2)/2,E=JSON.stringify(S);if(!(D.current&&D.current.bounds===h&&Math.abs(D.current.zoom-N)<.5&&D.current.filters===E)){D.current={bounds:h,zoom:N,filters:E},R.current=i,k(null);try{const x=[];S.activeListingDays!==void 0&&x.push({type:"active",value:S.activeListingDays}),S.soldListingDays!==void 0&&x.push({type:"sold",value:S.soldListingDays}),S.unavailableListingDays!==void 0&&x.push({type:"unavailable",value:S.unavailableListingDays}),x.length===0&&x.push({type:"active",value:"all"});const W=x.length>1;let U;if(W){const s=x.map(({type:q,value:J})=>{const H=Ee(q,J,i);return H.map=he(w),H}),A=new URL("https://api.repliers.io/listings");i>=18?(A.searchParams.set("cluster","false"),A.searchParams.set("listings","true"),A.searchParams.set("fields","address.*,mlsNumber,listPrice,details.numBedrooms,details.numBedroomsPlus,details.numBathrooms,details.numBathroomsPlus,details.numGarageSpaces,details.propertyType,type,lastStatus,images,status,class,coordinates,latitude,longitude,geo,location,map"),A.searchParams.set("pageSize","500")):(A.searchParams.set("cluster","true"),A.searchParams.set("clusterPrecision",B.toString()),A.searchParams.set("clusterLimit","500"),A.searchParams.set("clusterFields","mlsNumber,listPrice,coordinates,type,address.*,details.numBedrooms,details.numBedroomsPlus,details.numBathrooms,details.numBathroomsPlus,details.numGarageSpaces,details.propertyType,lastStatus,images,status,class"),i>=14?(A.searchParams.set("listings","true"),A.searchParams.set("fields","address.*,mlsNumber,listPrice,details.numBedrooms,details.numBedroomsPlus,details.numBathrooms,details.numBathroomsPlus,details.numGarageSpaces,details.propertyType,type,lastStatus,images,status,class,coordinates,latitude,longitude,geo,location,map"),A.searchParams.set("pageSize","500")):A.searchParams.set("listings","false"));const C={queries:s},$=await fetch(A.toString(),{method:"POST",headers:{"REPLIERS-API-KEY":e,"Content-Type":"application/json"},body:JSON.stringify(C)});if(!$.ok){const q=await $.text();throw new Error(`Bundled API Error: ${$.status} ${$.statusText} - ${q}`)}U=await $.json()}else{const{type:s,value:A}=x[0],C=new URL("https://api.repliers.io/listings"),$=Ee(s,A,i);Object.entries($).forEach(([J,H])=>{Array.isArray(H)?H.forEach(F=>C.searchParams.append(J,F.toString())):C.searchParams.set(J,H.toString())}),C.searchParams.set("map",JSON.stringify(he(w))),C.searchParams.set("key",e),i>=18?(C.searchParams.set("cluster","false"),C.searchParams.set("listings","true"),C.searchParams.set("fields","address.*,mlsNumber,listPrice,details.numBedrooms,details.numBedroomsPlus,details.numBathrooms,details.numBathroomsPlus,details.numGarageSpaces,details.propertyType,type,lastStatus,images,status,class,coordinates,latitude,longitude,geo,location,map"),C.searchParams.set("pageSize","500")):(C.searchParams.set("cluster","true"),C.searchParams.set("clusterPrecision",B.toString()),C.searchParams.set("clusterLimit","500"),C.searchParams.set("clusterFields","mlsNumber,listPrice,coordinates,type,address.*,details.numBedrooms,details.numBedroomsPlus,details.numBathrooms,details.numBathroomsPlus,details.numGarageSpaces,details.propertyType,lastStatus,images,status,class"),i>=14?(C.searchParams.set("listings","true"),C.searchParams.set("fields","address.*,mlsNumber,listPrice,details.numBedrooms,details.numBedroomsPlus,details.numBathrooms,details.numBathroomsPlus,details.numGarageSpaces,details.propertyType,type,lastStatus,images,status,class,coordinates,latitude,longitude,geo,location,map"),C.searchParams.set("pageSize","500")):C.searchParams.set("listings","false"));const q=await fetch(C.toString(),{headers:{"REPLIERS-API-KEY":e,"Content-Type":"application/json"}});if(!q.ok)throw new Error(`API Error: ${q.status} ${q.statusText}`);U=await q.json()}const te=((O=(L=U.aggregates)==null?void 0:L.map)==null?void 0:O.clusters)||U.clusters||[],Y=[],_=[],ue=U.listings||U.results||[],re=s=>S.propertyTypes.length===0?!0:s?S.propertyTypes.includes(s):!1;te.forEach((s,A)=>{var $,q,J,H,F,G,X,V,fe,_e,Ue,He,Ye,Ge,Je,Xe,Qe,Ze,Ke,Ve;const C=[(($=s.location)==null?void 0:$.longitude)||((q=s.coordinates)==null?void 0:q.lng)||s.longitude||((J=s.center)==null?void 0:J.lng),((H=s.location)==null?void 0:H.latitude)||((F=s.coordinates)==null?void 0:F.lat)||s.latitude||((G=s.center)==null?void 0:G.lat)];if(s.count===1&&i>=14){const ie=((X=s.listing)==null?void 0:X.listPrice)||s.listPrice||s.map&&((V=s.map[0])==null?void 0:V.listPrice),Be=((_e=(fe=s.listing)==null?void 0:fe.details)==null?void 0:_e.propertyType)||((Ue=s.details)==null?void 0:Ue.propertyType);re(Be)&&_.push({type:"Feature",properties:{mlsNumber:s.mlsNumber||((He=s.listing)==null?void 0:He.mlsNumber)||`single-${A}`,listPrice:typeof ie=="string"?parseFloat(ie):ie,propertyType:s.propertyType||((Ye=s.listing)==null?void 0:Ye.propertyType)||s.status||"Sale",type:((Ge=s.listing)==null?void 0:Ge.type)||s.type,isProperty:!0,address:((Je=s.listing)==null?void 0:Je.address)||s.address,details:((Xe=s.listing)==null?void 0:Xe.details)||s.details,images:((Qe=s.listing)==null?void 0:Qe.images)||s.images,lastStatus:((Ze=s.listing)==null?void 0:Ze.lastStatus)||s.lastStatus,status:((Ke=s.listing)==null?void 0:Ke.status)||s.status,class:((Ve=s.listing)==null?void 0:Ve.class)||s.class},geometry:{type:"Point",coordinates:[C[0],C[1]]}})}else if(s.count===1)Y.push({type:"Feature",properties:{count:s.count||1,apiCount:s.count||1,precision:s.precision||B,id:`cluster-${A}`,members:s.properties||s.map||[]},geometry:{type:"Point",coordinates:[C[0],C[1]]}});else{let ie=C;if(s.properties&&Array.isArray(s.properties)){const Se=[];if(s.properties.forEach(we=>{const De=qe(we);De&&Se.push(De)}),Se.length>0){const we=Re(Se);we&&(ie=$e(Se,we))}}const Be=s.properties||s.map||[],bt=s.count||1;Y.push({type:"Feature",properties:{count:bt,apiCount:s.count||1,precision:s.precision||B,id:`cluster-${A}`,members:Be},geometry:{type:"Point",coordinates:[ie[0],ie[1]]}})}});const me=new Set(_.map(s=>s.properties.mlsNumber));let se=0,ne=0,ee=0;const Z=ue.filter(s=>{var J,H,F,G,X,V,fe;if(me.has(s.mlsNumber))return se++,!1;const A=((J=s.map)==null?void 0:J.longitude)||((H=s.coordinates)==null?void 0:H.lng)||((F=s.coordinates)==null?void 0:F.longitude)||s.longitude||s.lng,C=((G=s.map)==null?void 0:G.latitude)||((X=s.coordinates)==null?void 0:X.lat)||((V=s.coordinates)==null?void 0:V.latitude)||s.latitude||s.lat;return A!==void 0&&C!==void 0&&!isNaN(A)&&!isNaN(C)?re((fe=s.details)==null?void 0:fe.propertyType)?!0:(ee++,!1):(ne++,!1)}).map(s=>{var q,J,H,F,G;const A={mlsNumber:s.mlsNumber,listPrice:typeof s.listPrice=="string"?parseFloat(s.listPrice):s.listPrice,propertyType:s.propertyType||((q=s.details)==null?void 0:q.propertyType)||s.type||s.status||"Sale",type:s.type,isProperty:!0},C=i>=13?{address:s.address,details:s.details,images:s.images,type:s.type,lastStatus:s.lastStatus,status:s.status,class:s.class}:{};return{type:"Feature",properties:{...A,...C},geometry:{type:"Point",coordinates:[((J=s.coordinates)==null?void 0:J.lng)||s.longitude||((H=s.map)==null?void 0:H.longitude),((F=s.coordinates)==null?void 0:F.lat)||s.latitude||((G=s.map)==null?void 0:G.latitude)]}}}),ge=(s,A,C)=>{const $=[...A,...C];return s.map(q=>{const J=q.geometry.coordinates,H=$.filter(G=>{const X=G.geometry.coordinates;return Ie(J,X)<=50}),F=H.length>0?H.length:q.properties.count;return{...q,properties:{...q.properties,count:F}}})},ae=Z.length>0||_.length>0,K=i>=14&&ae?ge(Y,Z,_):Y;let de;if(i>=14){const s=[...K.map(C=>({...C,type:"cluster"})),..._.map(C=>({...C,type:"singleProperty"})),...Z.map(C=>({...C,type:"property"}))];de=be(s,50).map(C=>{const $=C.filter(F=>F.type==="cluster"),q=C.filter(F=>F.type==="property"||F.type==="singleProperty"),J=$.reduce((F,G)=>{var X;return F+(((X=G.properties)==null?void 0:X.count)||0)},0),H=q.length;return i>=17?q.length>0?q:$.length>0?$[0]:null:q.length>3?$.length>0?$.reduce((F,G)=>{var X,V;return(((X=G.properties)==null?void 0:X.count)||0)>(((V=F.properties)==null?void 0:V.count)||0)?G:F}):q[0]:J>H&&$.length>0?$.reduce((F,G)=>{var X,V;return(((X=G.properties)==null?void 0:X.count)||0)>(((V=F.properties)==null?void 0:V.count)||0)?G:F}):q.length>0?q:$.length>0&&$[0].properties.count>0?$[0]:null}).flat().filter(Boolean)}else de=Oe([...Y,..._],i);const Me={type:"FeatureCollection",features:de},We=l.current.getSource("listings");We&&(We.setData(Me),Le(de));const ht=U.count||Y.reduce((s,A)=>s+A.properties.count,0);P(ht)}catch(x){const W=x instanceof Error?x.message:"Failed to load listings";k(W)}}},[e,ze,he,Le,S,Ee,be,Oe]);return g.useEffect(()=>{oe.current=xe},[xe]),g.useEffect(()=>{if(!(!j.current||l.current||!v||a===null))return Pe.accessToken=t,l.current=new Pe.Map({container:j.current,style:u,center:v,zoom:a}),l.current.on("load",()=>{var i;if(!l.current)return;l.current.addControl(new Pe.NavigationControl),l.current.addSource("listings",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),l.current.addLayer({id:"clusters",type:"circle",source:"listings",filter:["has","count"],paint:{"circle-color":["step",["get","count"],"#51bbd6",30,"#f1c40f",60,"#f39c12",150,"#f28cb1",500,"#e74c3c"],"circle-radius":["step",["get","count"],10,30,12,60,14,150,18,500,22],"circle-stroke-width":2,"circle-stroke-color":"#fff","circle-opacity":.8}}),l.current.addLayer({id:"cluster-count",type:"symbol",source:"listings",filter:["has","count"],layout:{"text-field":["get","count"],"text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":["step",["get","count"],10,30,11,60,12,150,14,500,16]},paint:{"text-color":"#ffffff"}}),l.current.addLayer({id:"property-dots",type:"circle",source:"listings",filter:["has","isProperty"],paint:{"circle-color":"#374151","circle-radius":3,"circle-stroke-width":1,"circle-stroke-color":"#fff","circle-opacity":.9}}),l.current.on("click","clusters",async B=>{var te,Y;if(!l.current||!((te=B.features)!=null&&te[0]))return;const h=B.features[0],N=h.geometry.coordinates,E=h.properties.count;h.properties.apiCount;const L=B.originalEvent.clientX,O=B.originalEvent.clientY,x=l.current.getZoom();if(x>=18){l.current.easeTo({center:N,zoom:Math.min(x+1,22),duration:500});return}if(x>=14){const _=l.current.getSource("listings");if(_&&_._data){const ne=(((Y=_._data.features)==null?void 0:Y.filter(ee=>{var Z;return((Z=ee.properties)==null?void 0:Z.isProperty)===!0}))||[]).map(ee=>{const Z=ee.geometry.coordinates,ge=Math.sqrt(Math.pow(Z[0]-N[0],2)+Math.pow(Z[1]-N[1],2));return{feature:ee,distance:ge}}).sort((ee,Z)=>ee.distance-Z.distance).slice(0,E);if(ne.length>0){const ee=ne.map(({feature:ae})=>{const K=ae.properties;return{mlsNumber:K.mlsNumber||"N/A",listPrice:K.listPrice||0,address:K.address||{streetNumber:"Unknown",streetName:"Address",city:"Unknown",state:"Unknown"},details:K.details||{numBedrooms:0,numBathrooms:0,numGarageSpaces:0,propertyType:"Unknown"},images:K.images||[],type:K.type||"Sale",lastStatus:K.lastStatus||"New",status:K.status||"A"}}),Z=ee.map(ae=>ae.mlsNumber);new Set(Z);const ge=ee.filter((ae,K,de)=>K===de.findIndex(Me=>Me.mlsNumber===ae.mlsNumber));ce(ge),Fe({x:L,y:O}),pe(!0),M(!1);return}}const ue=[{mlsNumber:`Cluster-${E}`,listPrice:0,address:{streetNumber:"Multiple",streetName:"Properties",city:"Available",state:""},details:{numBedrooms:0,numBathrooms:0,numGarageSpaces:0,propertyType:`${E} Properties in Cluster`},images:[],type:"Sale",lastStatus:"Available",status:"A"}];ce(ue),Fe({x:L,y:O}),pe(!0),M(!1);return}const W=x>=14?2:x>=12?3:4,U=Math.min(x+W,16);l.current.easeTo({center:N,zoom:U,duration:1e3,easing:_=>_*(2-_)})}),l.current.on("mouseenter","clusters",()=>{l.current&&(l.current.getCanvas().style.cursor="pointer")}),l.current.on("mouseleave","clusters",()=>{l.current&&(l.current.getCanvas().style.cursor="")}),l.current.on("mouseenter","property-dots",()=>{l.current&&(l.current.getCanvas().style.cursor="pointer")}),l.current.on("mouseleave","property-dots",()=>{l.current&&(l.current.getCanvas().style.cursor="")});const w=l.current.getBounds();w&&((i=oe.current)==null||i.call(oe,w))}),l.current.on("moveend",()=>{var i;if(!l.current)return;const w=l.current.getBounds();w&&((i=oe.current)==null||i.call(oe,w))}),()=>{ye(),l.current&&(l.current.remove(),l.current=null)}},[t,u,v,a,ye,Le]),g.useEffect(()=>{if(l.current){D.current=null;const w=l.current.getBounds();w&&xe(w)}},[S,xe]),n.jsxs("div",{style:{width:p,height:c,position:"relative"},children:[n.jsx("div",{ref:j,style:{width:"100%",height:"100%"},className:"rounded-lg overflow-hidden"}),n.jsx(dt,{filters:S,onFiltersChange:ft,apiKey:e,onMapUpdate:yt}),I&&n.jsx("div",{style:{position:"absolute",bottom:"16px",right:"16px",backgroundColor:"rgba(255, 255, 255, 0.95)",padding:"8px 12px",borderRadius:"6px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.15)",fontSize:"14px",fontWeight:"600",color:"#374151"},children:y?n.jsx("span",{style:{color:"#ef4444"},children:"Error"}):n.jsxs("span",{children:[f.toLocaleString()," properties"]})}),y&&n.jsx("div",{style:{position:"absolute",bottom:"16px",left:"16px",right:"16px",backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"6px",padding:"12px",color:"#b91c1c",fontSize:"14px"},children:y}),n.jsx(at,{open:T,onClose:()=>M(!1),listing:z,position:le,mapContainer:j.current}),n.jsx(it,{open:je,onClose:()=>pe(!1),properties:Ne,position:mt,mapContainer:j.current})]})}pt.__docgenInfo={description:"",methods:[],displayName:"AIMapListings",props:{apiKey:{required:!0,tsType:{name:"string"},description:"Repliers API key - required"},mapboxToken:{required:!0,tsType:{name:"string"},description:"MapBox access token - required"},initialCenter:{required:!1,tsType:{name:"tuple",raw:"[number, number]",elements:[{name:"number"},{name:"number"}]},description:"Initial map center coordinates [lng, lat] - auto-detects if not provided"},initialZoom:{required:!1,tsType:{name:"number"},description:"Initial zoom level - auto-calculates if not provided"},height:{required:!1,tsType:{name:"string"},description:"Map container height",defaultValue:{value:'"100%"',computed:!1}},width:{required:!1,tsType:{name:"string"},description:"Map container width",defaultValue:{value:'"100%"',computed:!1}},mapStyle:{required:!1,tsType:{name:"string"},description:"Map style",defaultValue:{value:'"mapbox://styles/mapbox/streets-v12"',computed:!1}},centerCalculation:{required:!1,tsType:{name:"union",raw:'"average" | "city"',elements:[{name:"literal",value:'"average"'},{name:"literal",value:'"city"'}]},description:"Center calculation method",defaultValue:{value:'"average"',computed:!1}},showPropertyCount:{required:!1,tsType:{name:"boolean"},description:"Show property count display",defaultValue:{value:"true",computed:!1}}}};const Kt={title:"POCS/AI-MapListings",component:pt,parameters:{layout:"fullscreen"}},zt="pxI19UMy9zfw9vz5lRxoGpjJWXrMnm",Ot="pk.eyJ1IjoibWlsYW5zb21hIiwiYSI6ImNtZWJrODZmajBwMWQya3B3cHE1M2Y3anoifQ.HMDLOc-6V9K3-mHKeTHHxw",ve={args:{apiKey:zt,mapboxToken:Ot,height:"100vh",width:"100vw",mapStyle:"mapbox://styles/mapbox/streets-v12"}};var tt,rt,st;ve.parameters={...ve.parameters,docs:{...(tt=ve.parameters)==null?void 0:tt.docs,source:{originalSource:`{
  args: {
    apiKey: SAMPLE_API_KEY,
    mapboxToken: SAMPLE_MAPBOX_TOKEN,
    height: "100vh",
    width: "100vw",
    mapStyle: "mapbox://styles/mapbox/streets-v12"
  }
}`,...(st=(rt=ve.parameters)==null?void 0:rt.docs)==null?void 0:st.source}}};const Vt=["Default"];export{ve as Default,Vt as __namedExportsOrder,Kt as default};
