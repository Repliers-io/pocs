"use strict";(self.webpackChunkpocs=self.webpackChunkpocs||[]).push([[272],{"./src/components/map-listings/map-listings.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Part1_BasicListings:()=>Part1_BasicListings,Part2_LargestClusterCenter:()=>Part2_LargestClusterCenter,Part3_MapStyles:()=>Part3_MapStyles,Part4_FilteredSearch:()=>Part4_FilteredSearch,__namedExportsOrder:()=>__namedExportsOrder,default:()=>map_listings_stories});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),mapbox_gl=__webpack_require__("./node_modules/mapbox-gl/dist/mapbox-gl.js"),mapbox_gl_default=__webpack_require__.n(mapbox_gl),bed_double=(__webpack_require__("./node_modules/mapbox-gl/dist/mapbox-gl.css"),__webpack_require__("./node_modules/lucide-react/dist/esm/icons/bed-double.js")),bath=__webpack_require__("./node_modules/lucide-react/dist/esm/icons/bath.js"),car=__webpack_require__("./node_modules/lucide-react/dist/esm/icons/car.js"),x=__webpack_require__("./node_modules/lucide-react/dist/esm/icons/x.js"),chevron_down=__webpack_require__("./node_modules/lucide-react/dist/esm/icons/chevron-down.js"),console=__webpack_require__("./node_modules/console-browserify/index.js");const formatBedrooms=details=>{if(!details)return"N/A";const total=details.numBedrooms,plus=details.numBedroomsPlus;return total&&plus&&plus>0?`${total} + ${plus}`:(null==total?void 0:total.toString())||"N/A"},formatBathrooms=details=>{if(!details)return"N/A";const total=details.numBathrooms,plus=details.numBathroomsPlus;return total&&plus&&plus>0?`${total} + ${plus}`:(null==total?void 0:total.toString())||"N/A"},StatusTag=({type,lastStatus,size="sm"})=>{const label=((type,lastStatus)=>"New"===lastStatus||"Pc"===lastStatus||"Ext"===lastStatus?"Sale"===type?"For Sale":"Lease"===type?"For Lease":type||null:lastStatus?{Sus:"Suspended",Exp:"Expired",Sld:"Sold",Ter:"Terminated",Dft:"Deal Fell Through",Lsd:"Leased",Sc:"Sold Conditionally",Sce:"Sold Conditionally (Escape Clause)",Lc:"Leased Conditionally",Cs:"Coming Soon"}[lastStatus]||lastStatus:null)(type,lastStatus);if(!label)return null;let style="bg-green-100 text-green-600";switch(label){case"For Sale":style="bg-green-100 text-green-600";break;case"For Lease":case"Leased":style="bg-purple-100 text-purple-600";break;case"Sold":style="bg-blue-100 text-blue-600";break;case"Sold Conditionally":case"Sold Conditionally (Escape Clause)":case"Leased Conditionally":style="bg-amber-100 text-amber-600";break;case"Coming Soon":style="bg-indigo-100 text-indigo-600";break;case"Suspended":style="bg-orange-100 text-orange-600";break;case"Expired":default:style="bg-gray-100 text-gray-500";break;case"Terminated":case"Deal Fell Through":style="bg-red-100 text-red-600"}const sizeClass="xs"===size?"text-xs":"text-sm";return(0,jsx_runtime.jsx)("span",{className:`${sizeClass} px-2 py-1 rounded-md font-medium ${style}`,children:label})},formatAddress=address=>{if(!address)return"Address not available";return[[address.streetNumber,address.streetDirection,address.streetName,address.streetSuffix].filter(Boolean).join(" "),[address.city,address.state].filter(Boolean).join(", ")].filter(Boolean).join(", ")};function ListingPreview({listing,onClick}){var _listing_images,_listing_details,details,_details_numGarageSpaces,price;return(0,jsx_runtime.jsx)("div",{className:"p-4 cursor-pointer hover:bg-gray-50 transition-colors duration-200",onClick,children:(0,jsx_runtime.jsxs)("div",{className:"flex items-start gap-4",children:[(0,jsx_runtime.jsx)("div",{className:"bg-gray-100 rounded-md overflow-hidden flex-shrink-0 h-20 aspect-[4/3]",children:(null===(_listing_images=listing.images)||void 0===_listing_images?void 0:_listing_images[0])?(0,jsx_runtime.jsx)("img",{src:`https://cdn.repliers.io/${listing.images[0]}?class=small`,alt:"Property",className:"object-cover w-full h-full"}):(0,jsx_runtime.jsx)("div",{className:"flex items-center justify-center h-full text-gray-400 text-sm",children:"No Image"})}),(0,jsx_runtime.jsxs)("div",{className:"flex-grow min-w-0",children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,jsx_runtime.jsx)("h4",{className:"font-semibold text-gray-800 truncate text-base",children:listing.listPrice?(price=listing.listPrice,new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(price)):"Price N/A"}),(0,jsx_runtime.jsx)("span",{className:"text-gray-400 text-sm",children:"|"}),(0,jsx_runtime.jsx)("span",{className:"text-gray-600 truncate text-sm",children:listing.mlsNumber})]}),(0,jsx_runtime.jsx)("div",{className:"flex-shrink-0 ml-2",children:(0,jsx_runtime.jsx)(StatusTag,{type:listing.type,lastStatus:listing.lastStatus,size:"sm"})})]}),(0,jsx_runtime.jsx)("p",{className:"text-gray-600 leading-relaxed text-sm mb-2",children:formatAddress(listing.address)}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center text-gray-500 space-x-3 flex-wrap text-sm",children:[(0,jsx_runtime.jsxs)("span",{className:"flex items-center gap-1",children:[(0,jsx_runtime.jsx)(bed_double.Z,{className:"w-4 h-4"}),formatBedrooms(listing.details)]}),(0,jsx_runtime.jsxs)("span",{className:"flex items-center gap-1",children:[(0,jsx_runtime.jsx)(bath.Z,{className:"w-4 h-4"}),formatBathrooms(listing.details)]}),(0,jsx_runtime.jsxs)("span",{className:"flex items-center gap-1",children:[(0,jsx_runtime.jsx)(car.Z,{className:"w-4 h-4"}),(details=listing.details,details&&(null===(_details_numGarageSpaces=details.numGarageSpaces)||void 0===_details_numGarageSpaces?void 0:_details_numGarageSpaces.toString())||"N/A")]}),(null===(_listing_details=listing.details)||void 0===_listing_details?void 0:_listing_details.propertyType)&&(0,jsx_runtime.jsxs)("span",{className:"text-gray-400",children:["| ",listing.details.propertyType]})]})]})]})})}function PropertyTooltip({open,onClose,listing,position,mapContainer}){const tooltipRef=(0,react.useRef)(null),[tooltipPosition,setTooltipPosition]=(0,react.useState)({x:0,y:0}),[arrowPosition,setArrowPosition]=(0,react.useState)("bottom"),[isPositioned,setIsPositioned]=(0,react.useState)(!1);if((0,react.useEffect)((()=>{setIsPositioned(!1)}),[open]),(0,react.useEffect)((()=>{if(!open||!tooltipRef.current||!mapContainer)return;const tooltipRect=tooltipRef.current.getBoundingClientRect(),markerX=position.x,markerY=position.y,tooltipHeight=tooltipRect.height||200,viewportWidth=window.innerWidth,viewportHeight=window.innerHeight;let x=markerX-225,y=markerY-tooltipHeight-16,arrow="bottom";x<16?x=16:x+450>viewportWidth-16&&(x=viewportWidth-450-16),y<16&&(y=markerY+32,arrow="top"),y+tooltipHeight>viewportHeight-16&&(markerX>viewportWidth/2?(x=markerX-450-16,y=markerY-tooltipHeight/2,arrow="right"):(x=markerX+16,y=markerY-tooltipHeight/2,arrow="left"),y<16&&(y=16),y+tooltipHeight>viewportHeight-16&&(y=viewportHeight-tooltipHeight-16)),setTooltipPosition({x,y}),setArrowPosition(arrow),setIsPositioned(!0)}),[open,position,mapContainer]),(0,react.useEffect)((()=>{const handleClickOutside=event=>{tooltipRef.current&&!tooltipRef.current.contains(event.target)&&onClose()};return open&&document.addEventListener("mousedown",handleClickOutside),()=>{document.removeEventListener("mousedown",handleClickOutside)}}),[open,onClose]),!open||!listing)return null;return(0,jsx_runtime.jsx)("div",{ref:tooltipRef,className:"fixed w-[450px]",style:{zIndex:9999,left:`${tooltipPosition.x}px`,top:`${tooltipPosition.y}px`,visibility:isPositioned?"visible":"hidden",opacity:isPositioned?1:0,transition:"opacity 150ms ease-in-out"},children:(0,jsx_runtime.jsxs)("div",{className:"bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden relative",children:[(0,jsx_runtime.jsx)("div",{className:(()=>{const baseClasses="absolute w-3 h-3 bg-white transform rotate-45 border";switch(arrowPosition){case"bottom":default:return`${baseClasses} -bottom-1.5 left-1/2 -translate-x-1/2 border-r border-b border-gray-200`;case"top":return`${baseClasses} -top-1.5 left-1/2 -translate-x-1/2 border-l border-t border-gray-200`;case"left":return`${baseClasses} -left-1.5 top-1/2 -translate-y-1/2 border-l border-b border-gray-200`;case"right":return`${baseClasses} -right-1.5 top-1/2 -translate-y-1/2 border-r border-t border-gray-200`}})()}),(0,jsx_runtime.jsx)("button",{onClick:onClose,className:"absolute top-2 right-2 z-10 p-1 rounded-full bg-white hover:bg-gray-100 transition-colors shadow-sm border border-gray-200","aria-label":"Close",children:(0,jsx_runtime.jsx)(x.Z,{size:16,className:"text-gray-600"})}),(0,jsx_runtime.jsx)(ListingPreview,{listing,onClick:()=>{}})]})})}function ClusterTooltip({open,onClose,properties,position,mapContainer}){const tooltipRef=(0,react.useRef)(null),[tooltipPosition,setTooltipPosition]=(0,react.useState)({x:0,y:0}),[arrowPosition,setArrowPosition]=(0,react.useState)("bottom"),[isPositioned,setIsPositioned]=(0,react.useState)(!1);if((0,react.useEffect)((()=>{open||setIsPositioned(!1)}),[open]),(0,react.useEffect)((()=>{if(!open||!mapContainer)return;const markerX=position.x,markerY=position.y,tooltipHeight=Math.min(120*properties.length+80,400),viewportWidth=window.innerWidth,viewportHeight=window.innerHeight;let x=markerX-240,y=markerY-tooltipHeight-16,arrow="bottom";x<16?x=16:x+480>viewportWidth-16&&(x=viewportWidth-480-16),y<16&&(y=markerY+32,arrow="top"),y+tooltipHeight>viewportHeight-16&&(markerX>viewportWidth/2?(x=markerX-480-16,y=markerY-tooltipHeight/2,arrow="right"):(x=markerX+16,y=markerY-tooltipHeight/2,arrow="left"),y<16&&(y=16),y+tooltipHeight>viewportHeight-16&&(y=viewportHeight-tooltipHeight-16)),setTooltipPosition({x,y}),setArrowPosition(arrow),setIsPositioned(!0)}),[open,position,mapContainer,properties.length]),(0,react.useEffect)((()=>{const handleClickOutside=event=>{tooltipRef.current&&!tooltipRef.current.contains(event.target)&&onClose()};return open&&document.addEventListener("mousedown",handleClickOutside),()=>{document.removeEventListener("mousedown",handleClickOutside)}}),[open,onClose]),!open||0===properties.length)return null;return(0,jsx_runtime.jsx)("div",{ref:tooltipRef,className:"fixed w-[480px]",style:{zIndex:9999,left:`${tooltipPosition.x}px`,top:`${tooltipPosition.y}px`,visibility:isPositioned?"visible":"hidden",opacity:isPositioned?1:0,transition:"opacity 150ms ease-in-out"},children:(0,jsx_runtime.jsxs)("div",{className:"bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden relative",children:[(0,jsx_runtime.jsx)("div",{className:(()=>{const baseClasses="absolute w-3 h-3 bg-white transform rotate-45 border";switch(arrowPosition){case"bottom":default:return`${baseClasses} -bottom-1.5 left-1/2 -translate-x-1/2 border-r border-b border-gray-200`;case"top":return`${baseClasses} -top-1.5 left-1/2 -translate-x-1/2 border-l border-t border-gray-200`;case"left":return`${baseClasses} -left-1.5 top-1/2 -translate-y-1/2 border-l border-b border-gray-200`;case"right":return`${baseClasses} -right-1.5 top-1/2 -translate-y-1/2 border-r border-t border-gray-200`}})()}),(0,jsx_runtime.jsxs)("div",{className:"px-4 py-3 border-b border-gray-100 bg-gray-50 relative",children:[(0,jsx_runtime.jsx)("h3",{className:"text-sm font-semibold text-gray-800",children:1===properties.length?"1 Property":`${properties.length} Properties`}),(0,jsx_runtime.jsx)("button",{onClick:onClose,className:"absolute top-2 right-2 p-1 rounded-full bg-white hover:bg-gray-100 transition-colors shadow-sm border border-gray-200","aria-label":"Close",children:(0,jsx_runtime.jsx)(x.Z,{size:16,className:"text-gray-600"})})]}),(0,jsx_runtime.jsx)("div",{className:"max-h-[400px] overflow-y-auto",children:properties.map(((listing,index)=>(0,jsx_runtime.jsx)("div",{className:"border-b border-gray-100 last:border-b-0",children:(0,jsx_runtime.jsx)(ListingPreview,{listing,onClick:()=>{}})},`${listing.mlsNumber}-${index}`)))})]})})}const extractCoordinates=listing=>{var _listing_coordinates,_listing_coordinates1,_listing_map,_listing_map1,_listing_location,_listing_location1,_listing_center,_listing_center1;return(null===(_listing_coordinates=listing.coordinates)||void 0===_listing_coordinates?void 0:_listing_coordinates.lat)&&(null===(_listing_coordinates1=listing.coordinates)||void 0===_listing_coordinates1?void 0:_listing_coordinates1.lng)?{lat:listing.coordinates.lat,lng:listing.coordinates.lng}:listing.latitude&&listing.longitude?{lat:listing.latitude,lng:listing.longitude}:(null===(_listing_map=listing.map)||void 0===_listing_map?void 0:_listing_map.latitude)&&(null===(_listing_map1=listing.map)||void 0===_listing_map1?void 0:_listing_map1.longitude)?{lat:listing.map.latitude,lng:listing.map.longitude}:(null===(_listing_location=listing.location)||void 0===_listing_location?void 0:_listing_location.latitude)&&(null===(_listing_location1=listing.location)||void 0===_listing_location1?void 0:_listing_location1.longitude)?{lat:listing.location.latitude,lng:listing.location.longitude}:(null===(_listing_center=listing.center)||void 0===_listing_center?void 0:_listing_center.lat)&&(null===(_listing_center1=listing.center)||void 0===_listing_center1?void 0:_listing_center1.lng)?{lat:listing.center.lat,lng:listing.center.lng}:null},getPolygonBounds=coordinates=>{if(0===coordinates.length)return null;let north=coordinates[0].lat,south=coordinates[0].lat,east=coordinates[0].lng,west=coordinates[0].lng;return coordinates.forEach((coord=>{north=Math.max(north,coord.lat),south=Math.min(south,coord.lat),east=Math.max(east,coord.lng),west=Math.min(west,coord.lng)})),{north,south,east,west}},calculateAverageCenter=(coordinates,bounds)=>{const{north,south,east,west}=bounds,latStep=(north-south)/20,lngStep=(east-west)/20,densityGrid=Array(20).fill(0).map((()=>Array(20).fill(0)));coordinates.forEach((coord=>{const latIndex=Math.floor((coord.lat-south)/latStep),lngIndex=Math.floor((coord.lng-west)/lngStep),safeLatIndex=Math.max(0,Math.min(19,latIndex)),safeLngIndex=Math.max(0,Math.min(19,lngIndex));densityGrid[safeLatIndex][safeLngIndex]++}));let maxDensity=0,densestLat=0,densestLng=0;for(let i=0;i<20;i++)for(let j=0;j<20;j++)densityGrid[i][j]>maxDensity&&(maxDensity=densityGrid[i][j],densestLat=south+(i+.5)*latStep,densestLng=west+(j+.5)*lngStep);return maxDensity>0?[densestLng,densestLat]:[(east+west)/2,(north+south)/2]},setCachedAutoCenter=(apiKey,data)=>{try{const cacheData={...data,timestamp:Date.now()};localStorage.setItem(`mapListings-autoCenter-${apiKey}`,JSON.stringify(cacheData))}catch(error){}},detectAutoCenterFallback=async(apiKey,method="average")=>{try{let clusters=[],listings=[];if("city"===method)try{const clusterUrl=new URL("https://api.repliers.io/listings");clusterUrl.searchParams.set("cluster","true"),clusterUrl.searchParams.set("clusterPrecision","8"),clusterUrl.searchParams.set("clusterLimit","50"),clusterUrl.searchParams.set("status","A");const clusterResponse=await fetch(clusterUrl.toString(),{headers:{"REPLIERS-API-KEY":apiKey,"Content-Type":"application/json"}});if(clusterResponse.ok){var _clusterData_aggregates_map,_clusterData_aggregates;const clusterData=await clusterResponse.json();clusters=(null===(_clusterData_aggregates=clusterData.aggregates)||void 0===_clusterData_aggregates||null===(_clusterData_aggregates_map=_clusterData_aggregates.map)||void 0===_clusterData_aggregates_map?void 0:_clusterData_aggregates_map.clusters)||clusterData.clusters||[]}}catch(error){}try{const listingUrl=new URL("https://api.repliers.io/listings");listingUrl.searchParams.set("pageSize","500"),listingUrl.searchParams.set("status","A");const listingResponse=await fetch(listingUrl.toString(),{headers:{"REPLIERS-API-KEY":apiKey,"Content-Type":"application/json"}});if(listingResponse.ok){const listingData=await listingResponse.json();listings=listingData.listings||listingData.results||[]}}catch(error){}if("city"===method&&clusters.length>0){let largestCluster=null,maxCount=0;if(clusters.forEach((cluster=>{const count=cluster.count||0;count>maxCount&&(maxCount=count,largestCluster=cluster)})),largestCluster){var _largestCluster_location,_largestCluster_coordinates,_largestCluster_center,_largestCluster_location1,_largestCluster_coordinates1,_largestCluster_center1;const coordinates=[(null===(_largestCluster_location=largestCluster.location)||void 0===_largestCluster_location?void 0:_largestCluster_location.longitude)||(null===(_largestCluster_coordinates=largestCluster.coordinates)||void 0===_largestCluster_coordinates?void 0:_largestCluster_coordinates.lng)||largestCluster.longitude||(null===(_largestCluster_center=largestCluster.center)||void 0===_largestCluster_center?void 0:_largestCluster_center.lng),(null===(_largestCluster_location1=largestCluster.location)||void 0===_largestCluster_location1?void 0:_largestCluster_location1.latitude)||(null===(_largestCluster_coordinates1=largestCluster.coordinates)||void 0===_largestCluster_coordinates1?void 0:_largestCluster_coordinates1.lat)||largestCluster.latitude||(null===(_largestCluster_center1=largestCluster.center)||void 0===_largestCluster_center1?void 0:_largestCluster_center1.lat)];if(coordinates[0]&&coordinates[1]){const autoCenter={center:[coordinates[0],coordinates[1]]};return setCachedAutoCenter(`${apiKey}-${method}`,autoCenter),autoCenter}}}if(0===listings.length)return null;const coordinates=[];if(listings.forEach((listing=>{const coord=extractCoordinates(listing);coord&&coordinates.push(coord)})),0===coordinates.length)return null;const bounds=getPolygonBounds(coordinates);if(!bounds)return null;const autoCenter={center:calculateAverageCenter(coordinates,bounds)};return setCachedAutoCenter(`${apiKey}-${method}`,autoCenter),autoCenter}catch(error){return null}};function PropertyTypeFilter({filters,onFiltersChange,apiKey}){const[propertyTypes,setPropertyTypes]=(0,react.useState)([]),[loading,setLoading]=(0,react.useState)(!0),[isDropdownOpen,setIsDropdownOpen]=(0,react.useState)(!1);(0,react.useEffect)((()=>{(async()=>{try{var _data_aggregates_details,_data_aggregates;const url=new URL("https://api.repliers.io/listings");url.searchParams.set("aggregates","details.propertyType"),url.searchParams.set("listings","false"),url.searchParams.set("status","A");const response=await fetch(url.toString(),{headers:{"REPLIERS-API-KEY":apiKey,"Content-Type":"application/json"}});if(!response.ok)throw new Error(`Failed to fetch property types: ${response.status}`);const propertyTypeData=(null===(_data_aggregates=(await response.json()).aggregates)||void 0===_data_aggregates||null===(_data_aggregates_details=_data_aggregates.details)||void 0===_data_aggregates_details?void 0:_data_aggregates_details.propertyType)||{},sortedPropertyTypes=Object.entries(propertyTypeData).sort((([,a],[,b])=>b-a)).map((([propertyType])=>propertyType));setPropertyTypes(sortedPropertyTypes)}catch(error){}finally{setLoading(!1)}})()}),[apiKey]);if(loading)return(0,jsx_runtime.jsx)("div",{style:{position:"relative",marginBottom:"12px"},children:(0,jsx_runtime.jsx)("div",{style:{padding:"8px 12px",fontSize:"12px",color:"#6b7280",fontStyle:"italic"},children:"Loading property types..."})});const allSelected=0===filters.propertyTypes.length||filters.propertyTypes.length===propertyTypes.length,someSelected=filters.propertyTypes.length>0&&filters.propertyTypes.length<propertyTypes.length;return(0,jsx_runtime.jsxs)("div",{style:{position:"relative",marginBottom:"12px"},children:[(0,jsx_runtime.jsxs)("button",{onClick:()=>setIsDropdownOpen(!isDropdownOpen),style:{width:"100%",padding:"8px 12px",backgroundColor:"white",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",textAlign:"left"},children:[(0,jsx_runtime.jsx)("span",{children:allSelected?"All property types":someSelected?`${filters.propertyTypes.length} selected`:"Select property types"}),(0,jsx_runtime.jsx)(chevron_down.Z,{size:16,style:{transform:isDropdownOpen?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"}})]}),isDropdownOpen&&(0,jsx_runtime.jsxs)("div",{style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:"white",border:"1px solid #d1d5db",borderRadius:"6px",marginTop:"4px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",zIndex:1002,maxHeight:"300px",overflowY:"auto"},children:[(0,jsx_runtime.jsxs)("div",{onClick:()=>{const allSelected=filters.propertyTypes.length===propertyTypes.length;onFiltersChange({...filters,propertyTypes:allSelected?[]:[...propertyTypes]})},style:{padding:"8px 12px",fontSize:"14px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",backgroundColor:allSelected?"#f3f4f6":"white",borderBottom:"1px solid #f3f4f6"},onMouseEnter:e=>{allSelected||(e.currentTarget.style.backgroundColor="#f9fafb")},onMouseLeave:e=>{allSelected||(e.currentTarget.style.backgroundColor="white")},children:[(0,jsx_runtime.jsx)("div",{style:{width:"16px",height:"16px",border:"2px solid #d1d5db",borderRadius:"3px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:allSelected?"#10b981":"white",borderColor:allSelected?"#10b981":"#d1d5db"},children:allSelected&&(0,jsx_runtime.jsx)("svg",{width:"10",height:"8",viewBox:"0 0 10 8",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,jsx_runtime.jsx)("path",{d:"M8.5 1L3.5 6L1.5 4",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),"All property types"]}),propertyTypes.map((propertyType=>{const isSelected=filters.propertyTypes.includes(propertyType);return(0,jsx_runtime.jsxs)("div",{onClick:()=>(propertyType=>{const newPropertyTypes=filters.propertyTypes.includes(propertyType)?filters.propertyTypes.filter((type=>type!==propertyType)):[...filters.propertyTypes,propertyType];onFiltersChange({...filters,propertyTypes:newPropertyTypes})})(propertyType),style:{padding:"8px 12px",fontSize:"14px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",backgroundColor:isSelected?"#f3f4f6":"white"},onMouseEnter:e=>{isSelected||(e.currentTarget.style.backgroundColor="#f9fafb")},onMouseLeave:e=>{isSelected||(e.currentTarget.style.backgroundColor="white")},children:[(0,jsx_runtime.jsx)("div",{style:{width:"16px",height:"16px",border:"2px solid #d1d5db",borderRadius:"3px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:isSelected?"#10b981":"white",borderColor:isSelected?"#10b981":"#d1d5db"},children:isSelected&&(0,jsx_runtime.jsx)("svg",{width:"10",height:"8",viewBox:"0 0 10 8",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,jsx_runtime.jsx)("path",{d:"M8.5 1L3.5 6L1.5 4",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),propertyType]},propertyType)}))]})]})}function PriceRangeFilter({isOpen,initialMin,initialMax,onApply,onCancel,priceBreakpoints=[0,5e5,1e6,2e6,4e6,1/0]}){const[tempMinPrice,setTempMinPrice]=(0,react.useState)(initialMin),[tempMaxPrice,setTempMaxPrice]=(0,react.useState)(initialMax),[isDragging,setIsDragging]=(0,react.useState)(null),sliderRef=(0,react.useRef)(null);(0,react.useEffect)((()=>{setTempMinPrice(initialMin),setTempMaxPrice(initialMax)}),[isOpen,initialMin,initialMax]);const formatDisplayPrice=(0,react.useCallback)((price=>{if(null===price||price===1/0)return"Max";if(0===price)return"$0";if(price>=1e6){const millions=price/1e6;return millions>=10?`$${Math.round(millions)}M`:`$${Math.round(10*millions)/10}M`}if(price>=1e3){const thousands=price/1e3;return`$${Math.round(thousands)}K`}return`$${Math.round(price)}`}),[]),getSliderPosition=(0,react.useCallback)((price=>{if(null===price||price===1/0)return 100;if(price>=priceBreakpoints[priceBreakpoints.length-2])return 100;if(price<=0)return 0;for(let i=0;i<priceBreakpoints.length-1;i++){const current=priceBreakpoints[i],next=priceBreakpoints[i+1];if(price>=current&&price<=next){const segmentSize=100/(priceBreakpoints.length-1);return i*segmentSize+(next===1/0?0:(price-current)/(next-current))*segmentSize}}return 0}),[priceBreakpoints]),getPriceFromPosition=(0,react.useCallback)((position=>{if(position>=100)return null;if(position<=0)return 0;const segmentSize=100/(priceBreakpoints.length-1),segmentIndex=Math.floor(position/segmentSize),progressInSegment=position%segmentSize/segmentSize;if(segmentIndex>=priceBreakpoints.length-2)return null;const current=priceBreakpoints[segmentIndex],next=priceBreakpoints[segmentIndex+1];return next===1/0?null:Math.round(current+progressInSegment*(next-current))}),[priceBreakpoints]),handleMouseDown=(0,react.useCallback)((handle=>e=>{e.preventDefault(),setIsDragging(handle)}),[]),handleMouseMove=(0,react.useCallback)((e=>{if(!isDragging||!sliderRef.current)return;const rect=sliderRef.current.getBoundingClientRect(),position=Math.max(0,Math.min(100,(e.clientX-rect.left)/rect.width*100)),newPrice=getPriceFromPosition(position);if("min"===isDragging){const maxValue=null===tempMaxPrice?1/0:tempMaxPrice,constrainedPrice=null===newPrice?maxValue:Math.min(newPrice,maxValue);setTempMinPrice(constrainedPrice===1/0?0:constrainedPrice)}else if("max"===isDragging){const constrainedPrice=null===newPrice?null:Math.max(newPrice,tempMinPrice);setTempMaxPrice(constrainedPrice)}}),[isDragging,tempMinPrice,tempMaxPrice,getPriceFromPosition]),handleMouseUp=(0,react.useCallback)((()=>{setIsDragging(null)}),[]);(0,react.useEffect)((()=>{if(isDragging)return document.addEventListener("mousemove",handleMouseMove),document.addEventListener("mouseup",handleMouseUp),()=>{document.removeEventListener("mousemove",handleMouseMove),document.removeEventListener("mouseup",handleMouseUp)}}),[isDragging,handleMouseMove,handleMouseUp]);const handleKeyDown=(0,react.useCallback)((handle=>e=>{if("ArrowLeft"===e.key||"ArrowRight"===e.key){e.preventDefault();const direction="ArrowLeft"===e.key?-1:1,currentPos=getSliderPosition("min"===handle?tempMinPrice:tempMaxPrice),newPos=Math.max(0,Math.min(100,currentPos+2*direction)),newPrice=getPriceFromPosition(newPos);if("min"===handle){const maxValue=null===tempMaxPrice?1/0:tempMaxPrice,constrainedPrice=null===newPrice?maxValue:Math.min(newPrice,maxValue);setTempMinPrice(constrainedPrice===1/0?0:constrainedPrice)}else{const constrainedPrice=null===newPrice?null:Math.max(newPrice||0,tempMinPrice);setTempMaxPrice(constrainedPrice)}}}),[tempMinPrice,tempMaxPrice,getSliderPosition,getPriceFromPosition]);if((0,react.useEffect)((()=>{const handleEsc=e=>{"Escape"===e.key&&isOpen&&onCancel()};if(isOpen)return document.addEventListener("keydown",handleEsc),()=>document.removeEventListener("keydown",handleEsc)}),[isOpen,onCancel]),!isOpen)return null;const minPosition=getSliderPosition(tempMinPrice),maxPosition=getSliderPosition(tempMaxPrice);return(0,jsx_runtime.jsxs)("div",{style:{position:"absolute",top:"100%",left:0,width:"400px",backgroundColor:"white",border:"1px solid #d1d5db",borderRadius:"6px",marginTop:"4px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",zIndex:1002,padding:"20px"},children:[(0,jsx_runtime.jsxs)("div",{style:{textAlign:"center",fontSize:"16px",fontWeight:"600",color:"#374151",marginBottom:"20px"},children:[formatDisplayPrice(tempMinPrice)," - ",formatDisplayPrice(tempMaxPrice)]}),(0,jsx_runtime.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,jsx_runtime.jsxs)("div",{ref:sliderRef,style:{position:"relative",height:"8px",backgroundColor:"#e5e7eb",borderRadius:"4px",marginBottom:"16px"},children:[(0,jsx_runtime.jsx)("div",{style:{position:"absolute",top:0,left:`${minPosition}%`,width:maxPosition-minPosition+"%",height:"100%",backgroundColor:"#3b82f6",borderRadius:"4px"}}),(0,jsx_runtime.jsx)("div",{style:{position:"absolute",left:`${minPosition}%`,top:"50%",transform:"translate(-50%, -50%)",width:"20px",height:"20px",backgroundColor:"white",border:"2px solid #3b82f6",borderRadius:"50%",cursor:"min"===isDragging?"grabbing":"grab",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"},onMouseDown:handleMouseDown("min"),onKeyDown:handleKeyDown("min"),tabIndex:0,role:"slider","aria-label":"Minimum price","aria-valuemin":0,"aria-valuemax":null===tempMaxPrice?priceBreakpoints[priceBreakpoints.length-2]:tempMaxPrice,"aria-valuenow":tempMinPrice,"aria-valuetext":formatDisplayPrice(tempMinPrice)}),(0,jsx_runtime.jsx)("div",{style:{position:"absolute",left:`${maxPosition}%`,top:"50%",transform:"translate(-50%, -50%)",width:"20px",height:"20px",backgroundColor:"white",border:"2px solid #3b82f6",borderRadius:"50%",cursor:"max"===isDragging?"grabbing":"grab",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"},onMouseDown:handleMouseDown("max"),onKeyDown:handleKeyDown("max"),tabIndex:0,role:"slider","aria-label":"Maximum price","aria-valuemin":tempMinPrice,"aria-valuemax":priceBreakpoints[priceBreakpoints.length-2],"aria-valuenow":null===tempMaxPrice?priceBreakpoints[priceBreakpoints.length-2]:tempMaxPrice,"aria-valuetext":formatDisplayPrice(tempMaxPrice)})]}),(0,jsx_runtime.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"12px",color:"#6b7280"},children:[priceBreakpoints.slice(0,-1).map(((price,index)=>(0,jsx_runtime.jsx)("span",{children:formatDisplayPrice(price)},index))),(0,jsx_runtime.jsx)("span",{children:"Max"})]})]}),(0,jsx_runtime.jsxs)("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[(0,jsx_runtime.jsx)("button",{onClick:onCancel,style:{padding:"8px 16px",fontSize:"14px",fontWeight:"500",color:"#374151",backgroundColor:"white",border:"1px solid #d1d5db",borderRadius:"6px",cursor:"pointer"},children:"Cancel"}),(0,jsx_runtime.jsx)("button",{onClick:()=>onApply(tempMinPrice,tempMaxPrice),style:{padding:"8px 16px",fontSize:"14px",fontWeight:"500",color:"white",backgroundColor:"#3b82f6",border:"none",borderRadius:"6px",cursor:"pointer"},children:"Apply"})]})]})}function SquareFootageFilter({isOpen,initialMin,initialMax,onApply,onCancel,sqftBreakpoints=[0,1e3,2e3,3e3,5e3,1/0]}){const[tempMinSqft,setTempMinSqft]=(0,react.useState)(initialMin),[tempMaxSqft,setTempMaxSqft]=(0,react.useState)(initialMax),[isDragging,setIsDragging]=(0,react.useState)(null),sliderRef=(0,react.useRef)(null);(0,react.useEffect)((()=>{setTempMinSqft(initialMin),setTempMaxSqft(initialMax)}),[isOpen,initialMin,initialMax]);const formatDisplaySqft=(0,react.useCallback)((sqft=>{if(null===sqft||sqft===1/0)return"Max";if(0===sqft)return"0";if(sqft>=1e3){const thousands=sqft/1e3;return Math.round(10*thousands)/10+"K"}return`${Math.round(sqft)}`}),[]),getSliderPosition=(0,react.useCallback)((sqft=>{if(null===sqft||sqft===1/0)return 100;if(sqft>=sqftBreakpoints[sqftBreakpoints.length-2])return 100;if(sqft<=0)return 0;for(let i=0;i<sqftBreakpoints.length-1;i++){const current=sqftBreakpoints[i],next=sqftBreakpoints[i+1];if(sqft>=current&&sqft<=next){const segmentSize=100/(sqftBreakpoints.length-1);return i*segmentSize+(next===1/0?0:(sqft-current)/(next-current))*segmentSize}}return 0}),[sqftBreakpoints]),getSqftFromPosition=(0,react.useCallback)((position=>{if(position>=100)return null;if(position<=0)return 0;const segmentSize=100/(sqftBreakpoints.length-1),segmentIndex=Math.floor(position/segmentSize),progressInSegment=position%segmentSize/segmentSize;if(segmentIndex>=sqftBreakpoints.length-2)return null;const current=sqftBreakpoints[segmentIndex],next=sqftBreakpoints[segmentIndex+1];return next===1/0?null:Math.round(current+progressInSegment*(next-current))}),[sqftBreakpoints]),handleMouseDown=(0,react.useCallback)((handle=>e=>{e.preventDefault(),setIsDragging(handle)}),[]),handleMouseMove=(0,react.useCallback)((e=>{if(!isDragging||!sliderRef.current)return;const rect=sliderRef.current.getBoundingClientRect(),position=Math.max(0,Math.min(100,(e.clientX-rect.left)/rect.width*100)),newSqft=getSqftFromPosition(position);if("min"===isDragging){const maxValue=null===tempMaxSqft?1/0:tempMaxSqft,constrainedSqft=null===newSqft?maxValue:Math.min(newSqft,maxValue);setTempMinSqft(constrainedSqft===1/0?0:constrainedSqft)}else if("max"===isDragging){const constrainedSqft=null===newSqft?null:Math.max(newSqft,tempMinSqft);setTempMaxSqft(constrainedSqft)}}),[isDragging,tempMinSqft,tempMaxSqft,getSqftFromPosition]),handleMouseUp=(0,react.useCallback)((()=>{setIsDragging(null)}),[]);(0,react.useEffect)((()=>{if(isDragging)return document.addEventListener("mousemove",handleMouseMove),document.addEventListener("mouseup",handleMouseUp),()=>{document.removeEventListener("mousemove",handleMouseMove),document.removeEventListener("mouseup",handleMouseUp)}}),[isDragging,handleMouseMove,handleMouseUp]);const handleKeyDown=(0,react.useCallback)((handle=>e=>{if("ArrowLeft"===e.key||"ArrowRight"===e.key){e.preventDefault();const direction="ArrowLeft"===e.key?-1:1,currentPos=getSliderPosition("min"===handle?tempMinSqft:tempMaxSqft),newPos=Math.max(0,Math.min(100,currentPos+2*direction)),newSqft=getSqftFromPosition(newPos);if("min"===handle){const maxValue=null===tempMaxSqft?1/0:tempMaxSqft,constrainedSqft=null===newSqft?maxValue:Math.min(newSqft,maxValue);setTempMinSqft(constrainedSqft===1/0?0:constrainedSqft)}else{const constrainedSqft=null===newSqft?null:Math.max(newSqft||0,tempMinSqft);setTempMaxSqft(constrainedSqft)}}}),[tempMinSqft,tempMaxSqft,getSliderPosition,getSqftFromPosition]);if((0,react.useEffect)((()=>{const handleEsc=e=>{"Escape"===e.key&&isOpen&&onCancel()};if(isOpen)return document.addEventListener("keydown",handleEsc),()=>document.removeEventListener("keydown",handleEsc)}),[isOpen,onCancel]),!isOpen)return null;const minPosition=getSliderPosition(tempMinSqft),maxPosition=getSliderPosition(tempMaxSqft);return(0,jsx_runtime.jsxs)("div",{style:{marginTop:"16px",padding:"16px",backgroundColor:"#f9fafb",borderRadius:"6px",border:"1px solid #e5e7eb"},children:[(0,jsx_runtime.jsxs)("div",{style:{textAlign:"center",fontSize:"14px",fontWeight:"600",color:"#374151",marginBottom:"16px"},children:[formatDisplaySqft(tempMinSqft)," - ",formatDisplaySqft(tempMaxSqft)," sq ft"]}),(0,jsx_runtime.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,jsx_runtime.jsxs)("div",{ref:sliderRef,style:{position:"relative",height:"6px",backgroundColor:"#e5e7eb",borderRadius:"3px",marginBottom:"12px"},children:[(0,jsx_runtime.jsx)("div",{style:{position:"absolute",top:0,left:`${minPosition}%`,width:maxPosition-minPosition+"%",height:"100%",backgroundColor:"#3b82f6",borderRadius:"3px"}}),(0,jsx_runtime.jsx)("div",{style:{position:"absolute",left:`${minPosition}%`,top:"50%",transform:"translate(-50%, -50%)",width:"18px",height:"18px",backgroundColor:"white",border:"2px solid #3b82f6",borderRadius:"50%",cursor:"min"===isDragging?"grabbing":"grab",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},onMouseDown:handleMouseDown("min"),onKeyDown:handleKeyDown("min"),tabIndex:0,role:"slider","aria-label":"Minimum square footage","aria-valuemin":0,"aria-valuemax":null===tempMaxSqft?sqftBreakpoints[sqftBreakpoints.length-2]:tempMaxSqft,"aria-valuenow":tempMinSqft,"aria-valuetext":formatDisplaySqft(tempMinSqft)}),(0,jsx_runtime.jsx)("div",{style:{position:"absolute",left:`${maxPosition}%`,top:"50%",transform:"translate(-50%, -50%)",width:"18px",height:"18px",backgroundColor:"white",border:"2px solid #3b82f6",borderRadius:"50%",cursor:"max"===isDragging?"grabbing":"grab",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},onMouseDown:handleMouseDown("max"),onKeyDown:handleKeyDown("max"),tabIndex:0,role:"slider","aria-label":"Maximum square footage","aria-valuemin":tempMinSqft,"aria-valuemax":sqftBreakpoints[sqftBreakpoints.length-2],"aria-valuenow":null===tempMaxSqft?sqftBreakpoints[sqftBreakpoints.length-2]:tempMaxSqft,"aria-valuetext":formatDisplaySqft(tempMaxSqft)})]}),(0,jsx_runtime.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"11px",color:"#6b7280"},children:[sqftBreakpoints.slice(0,-1).map(((sqft,index)=>(0,jsx_runtime.jsx)("span",{children:formatDisplaySqft(sqft)},index))),(0,jsx_runtime.jsx)("span",{children:"Max"})]})]}),(0,jsx_runtime.jsxs)("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:[(0,jsx_runtime.jsx)("button",{onClick:onCancel,style:{padding:"6px 12px",fontSize:"13px",fontWeight:"500",color:"#374151",backgroundColor:"white",border:"1px solid #d1d5db",borderRadius:"6px",cursor:"pointer"},children:"Cancel"}),(0,jsx_runtime.jsx)("button",{onClick:()=>onApply(tempMinSqft,tempMaxSqft),style:{padding:"6px 12px",fontSize:"13px",fontWeight:"500",color:"white",backgroundColor:"#3b82f6",border:"none",borderRadius:"6px",cursor:"pointer"},children:"Apply"})]})]})}function FilterPanel({filters,onFiltersChange,apiKey}){const[isDropdownOpen,setIsDropdownOpen]=(0,react.useState)(!1),[isPriceFilterOpen,setIsPriceFilterOpen]=(0,react.useState)(!1),[isMoreOpen,setIsMoreOpen]=(0,react.useState)(!1),[isSqftFilterOpen,setIsSqftFilterOpen]=(0,react.useState)(!1),priceFilterRef=(0,react.useRef)(null),moreFiltersRef=(0,react.useRef)(null),listingTypeOptions=[{value:"all",label:"All"},{value:"sale",label:"For Sale"},{value:"lease",label:"For Lease"}],selectedOption=listingTypeOptions.find((option=>option.value===filters.listingType));return(0,react.useEffect)((()=>{const handleClickOutside=event=>{priceFilterRef.current&&!priceFilterRef.current.contains(event.target)&&setIsPriceFilterOpen(!1)};if(isPriceFilterOpen)return document.addEventListener("mousedown",handleClickOutside),()=>document.removeEventListener("mousedown",handleClickOutside)}),[isPriceFilterOpen]),(0,react.useEffect)((()=>{const handleClickOutside=event=>{moreFiltersRef.current&&!moreFiltersRef.current.contains(event.target)&&setIsMoreOpen(!1)};if(isMoreOpen)return document.addEventListener("mousedown",handleClickOutside),()=>document.removeEventListener("mousedown",handleClickOutside)}),[isMoreOpen]),(0,jsx_runtime.jsxs)("div",{style:{position:"absolute",top:"16px",left:"60px",backgroundColor:"rgba(255, 255, 255, 0.95)",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.15)",padding:"12px",fontSize:"14px",fontWeight:"500",color:"#374151",zIndex:1e3,minWidth:"200px"},children:[(0,jsx_runtime.jsx)("div",{style:{marginBottom:"8px",fontSize:"12px",fontWeight:"600",color:"#6b7280"},children:"FILTERS"}),(0,jsx_runtime.jsxs)("div",{style:{position:"relative",marginBottom:"12px"},children:[(0,jsx_runtime.jsxs)("button",{onClick:()=>setIsDropdownOpen(!isDropdownOpen),style:{width:"100%",padding:"8px 12px",backgroundColor:"white",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,jsx_runtime.jsx)("span",{children:null==selectedOption?void 0:selectedOption.label}),(0,jsx_runtime.jsx)(chevron_down.Z,{size:16,style:{transform:isDropdownOpen?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"}})]}),isDropdownOpen&&(0,jsx_runtime.jsx)("div",{style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:"white",border:"1px solid #d1d5db",borderRadius:"6px",marginTop:"4px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",zIndex:1001},children:listingTypeOptions.map((option=>(0,jsx_runtime.jsx)("button",{onClick:()=>{return value=option.value,onFiltersChange({...filters,listingType:value}),void setIsDropdownOpen(!1);var value},style:{width:"100%",padding:"8px 12px",backgroundColor:filters.listingType===option.value?"#f3f4f6":"white",border:"none",fontSize:"14px",cursor:"pointer",textAlign:"left",borderRadius:option===listingTypeOptions[0]?"6px 6px 0 0":option===listingTypeOptions[listingTypeOptions.length-1]?"0 0 6px 6px":"0"},onMouseEnter:e=>{filters.listingType!==option.value&&(e.currentTarget.style.backgroundColor="#f9fafb")},onMouseLeave:e=>{filters.listingType!==option.value&&(e.currentTarget.style.backgroundColor="white")},children:option.label},option.value)))})]}),(0,jsx_runtime.jsx)(PropertyTypeFilter,{filters,onFiltersChange,apiKey}),(0,jsx_runtime.jsxs)("div",{ref:priceFilterRef,style:{position:"relative",marginBottom:"12px"},children:[(0,jsx_runtime.jsxs)("button",{onClick:()=>setIsPriceFilterOpen(!isPriceFilterOpen),style:{width:"100%",padding:"8px 12px",backgroundColor:filters.minPrice||filters.maxPrice?"#f3f4f6":"white",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",textAlign:"left",color:filters.minPrice||filters.maxPrice?"#1f2937":"#374151",fontWeight:filters.minPrice||filters.maxPrice?"500":"400"},children:[(0,jsx_runtime.jsx)("span",{children:(()=>{const hasMinPrice=filters.minPrice&&filters.minPrice>0,hasMaxPrice=filters.maxPrice&&null!==filters.maxPrice;if(!hasMinPrice&&!hasMaxPrice)return"Price";const formatPrice=price=>{if(price>=1e6){const millions=price/1e6;return`$${millions>=10?Math.round(millions):Math.round(10*millions)/10}M`}return price>=1e3?`$${Math.round(price/1e3)}K`:`$${price}`};return`${hasMinPrice?formatPrice(filters.minPrice):"$0"} - ${hasMaxPrice?formatPrice(filters.maxPrice):"Max"}`})()}),(0,jsx_runtime.jsx)(chevron_down.Z,{size:16,style:{transform:isPriceFilterOpen?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"}})]}),isPriceFilterOpen&&(0,jsx_runtime.jsx)(PriceRangeFilter,{isOpen:isPriceFilterOpen,initialMin:filters.minPrice||0,initialMax:filters.maxPrice||null,onApply:(minPrice,maxPrice)=>{onFiltersChange({...filters,minPrice:minPrice||void 0,maxPrice:maxPrice||void 0}),setIsPriceFilterOpen(!1)},onCancel:()=>{setIsPriceFilterOpen(!1)}})]}),(0,jsx_runtime.jsxs)("div",{ref:moreFiltersRef,style:{position:"relative",marginBottom:"12px"},children:[(0,jsx_runtime.jsxs)("button",{onClick:()=>setIsMoreOpen(!isMoreOpen),style:{width:"100%",padding:"8px 12px",backgroundColor:"all"!==filters.bedrooms||"all"!==filters.bathrooms||"all"!==filters.garageSpaces||filters.minSqft||filters.maxSqft||filters.openHouse&&"all"!==filters.openHouse||filters.maxMaintenanceFee?"#f3f4f6":"white",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",textAlign:"left",color:"#374151",fontWeight:"all"!==filters.bedrooms||"all"!==filters.bathrooms||"all"!==filters.garageSpaces||filters.minSqft||filters.maxSqft||filters.openHouse&&"all"!==filters.openHouse||filters.maxMaintenanceFee?"500":"400"},children:[(0,jsx_runtime.jsx)("span",{children:"More Filters"}),(0,jsx_runtime.jsx)(chevron_down.Z,{size:16,style:{transform:isMoreOpen?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"}})]}),isMoreOpen&&(0,jsx_runtime.jsxs)("div",{style:{position:"absolute",top:"100%",left:0,width:"400px",backgroundColor:"white",border:"1px solid #d1d5db",borderRadius:"6px",marginTop:"4px",padding:"20px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",zIndex:1001},children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{style:{fontSize:"12px",fontWeight:"600",color:"#6b7280",marginBottom:"8px"},children:"BEDROOMS"}),(0,jsx_runtime.jsx)("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:["all","0","1","2","3","4","5+"].map((value=>(0,jsx_runtime.jsx)("button",{onClick:()=>onFiltersChange({...filters,bedrooms:value}),style:{padding:"8px 16px",backgroundColor:filters.bedrooms===value?"#3b82f6":"white",color:filters.bedrooms===value?"white":"#374151",border:"1px solid "+(filters.bedrooms===value?"#3b82f6":"#d1d5db"),borderRadius:"6px",fontSize:"14px",fontWeight:filters.bedrooms===value?"600":"400",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:e=>{filters.bedrooms!==value&&(e.currentTarget.style.backgroundColor="#f3f4f6")},onMouseLeave:e=>{filters.bedrooms!==value&&(e.currentTarget.style.backgroundColor="white")},children:"all"===value?"All":value},value)))})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{style:{fontSize:"12px",fontWeight:"600",color:"#6b7280",marginBottom:"8px"},children:"BATHROOMS"}),(0,jsx_runtime.jsx)("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:["all","1+","2+","3+","4+","5+"].map((value=>(0,jsx_runtime.jsx)("button",{onClick:()=>onFiltersChange({...filters,bathrooms:value}),style:{padding:"8px 16px",backgroundColor:filters.bathrooms===value?"#3b82f6":"white",color:filters.bathrooms===value?"white":"#374151",border:"1px solid "+(filters.bathrooms===value?"#3b82f6":"#d1d5db"),borderRadius:"6px",fontSize:"14px",fontWeight:filters.bathrooms===value?"600":"400",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:e=>{filters.bathrooms!==value&&(e.currentTarget.style.backgroundColor="#f3f4f6")},onMouseLeave:e=>{filters.bathrooms!==value&&(e.currentTarget.style.backgroundColor="white")},children:"all"===value?"All":value},value)))})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{style:{fontSize:"12px",fontWeight:"600",color:"#6b7280",marginBottom:"8px"},children:"GARAGE / PARKING"}),(0,jsx_runtime.jsx)("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:["all","1+","2+","3+","4+","5+"].map((value=>(0,jsx_runtime.jsx)("button",{onClick:()=>onFiltersChange({...filters,garageSpaces:value}),style:{padding:"8px 16px",backgroundColor:filters.garageSpaces===value?"#3b82f6":"white",color:filters.garageSpaces===value?"white":"#374151",border:"1px solid "+(filters.garageSpaces===value?"#3b82f6":"#d1d5db"),borderRadius:"6px",fontSize:"14px",fontWeight:filters.garageSpaces===value?"600":"400",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:e=>{filters.garageSpaces!==value&&(e.currentTarget.style.backgroundColor="#f3f4f6")},onMouseLeave:e=>{filters.garageSpaces!==value&&(e.currentTarget.style.backgroundColor="white")},children:"all"===value?"All":value},value)))})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{style:{fontSize:"12px",fontWeight:"600",color:"#6b7280",marginBottom:"8px"},children:"SQUARE FOOTAGE"}),(0,jsx_runtime.jsx)(SquareFootageFilter,{isOpen:!0,initialMin:filters.minSqft||0,initialMax:filters.maxSqft||null,onApply:(minSqft,maxSqft)=>{onFiltersChange({...filters,minSqft:minSqft||void 0,maxSqft:maxSqft||void 0}),setIsSqftFilterOpen(!1)},onCancel:()=>{setIsSqftFilterOpen(!1)}})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{style:{fontSize:"12px",fontWeight:"600",color:"#6b7280",marginBottom:"8px"},children:"OPEN HOUSE"}),(0,jsx_runtime.jsx)("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:[{value:"all",label:"All"},{value:"today",label:"Today"},{value:"thisWeekend",label:"This Weekend"},{value:"thisWeek",label:"This Week"},{value:"anytime",label:"Anytime"}].map((({value,label})=>(0,jsx_runtime.jsx)("button",{onClick:()=>onFiltersChange({...filters,openHouse:value}),style:{padding:"8px 16px",backgroundColor:filters.openHouse===value?"#3b82f6":"white",color:filters.openHouse===value?"white":"#374151",border:"1px solid "+(filters.openHouse===value?"#3b82f6":"#d1d5db"),borderRadius:"6px",fontSize:"14px",fontWeight:filters.openHouse===value?"600":"400",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:e=>{filters.openHouse!==value&&(e.currentTarget.style.backgroundColor="#f3f4f6")},onMouseLeave:e=>{filters.openHouse!==value&&(e.currentTarget.style.backgroundColor="white")},children:label},value)))})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{style:{fontSize:"12px",fontWeight:"600",color:"#6b7280",marginBottom:"8px"},children:"MAX MAINTENANCE FEE"}),(0,jsx_runtime.jsxs)("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[(0,jsx_runtime.jsx)("input",{type:"number",placeholder:"Enter max fee",value:filters.maxMaintenanceFee||"",onChange:e=>{const value=e.target.value?parseInt(e.target.value):void 0;onFiltersChange({...filters,maxMaintenanceFee:value||null})},onKeyDown:e=>{if("Enter"===e.key){const value=e.currentTarget.value?parseInt(e.currentTarget.value):void 0;onFiltersChange({...filters,maxMaintenanceFee:value||null})}},style:{flex:1,padding:"8px 12px",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px",color:"#374151"}}),(0,jsx_runtime.jsx)("button",{onClick:()=>{onFiltersChange({...filters})},style:{padding:"8px 16px",fontSize:"14px",fontWeight:"500",color:"white",backgroundColor:"#3b82f6",border:"none",borderRadius:"6px",cursor:"pointer",whiteSpace:"nowrap"},children:"Apply"})]})]})]})]})]})}function MapListings({apiKey,mapboxToken,initialCenter,initialZoom,height="100%",width="100%",mapStyle="mapbox://styles/mapbox/streets-v12",centerCalculation="average",showPropertyCount=!0}){const mapContainer=(0,react.useRef)(null),map=(0,react.useRef)(null),[error,setError]=(0,react.useState)(null),[totalCount,setTotalCount]=(0,react.useState)(0),[mapCenter,setMapCenter]=(0,react.useState)(initialCenter||null),[mapZoom,setMapZoom]=(0,react.useState)(initialZoom||null),currentZoomLevel=(0,react.useRef)(null),lastFetchParams=(0,react.useRef)(null),[tooltipOpen,setTooltipOpen]=(0,react.useState)(!1),[selectedListing,setSelectedListing]=(0,react.useState)(null),[tooltipPosition,setTooltipPosition]=(0,react.useState)({x:0,y:0}),[clusterTooltipOpen,setClusterTooltipOpen]=(0,react.useState)(!1),[clusterProperties,setClusterProperties]=(0,react.useState)([]),[clusterTooltipPosition,setClusterTooltipPosition]=(0,react.useState)({x:0,y:0}),priceMarkers=(0,react.useRef)([]),fetchClustersRef=(0,react.useRef)(null),[filters,setFilters]=(0,react.useState)({listingType:"all",propertyTypes:[],bedrooms:"all",bathrooms:"all",garageSpaces:"all",openHouse:"all"}),handleFiltersChange=(0,react.useCallback)((newFilters=>{setFilters(newFilters)}),[]),formatPrice=(0,react.useCallback)(((price,type)=>{const formatToMaxDigits=(value,suffix)=>value>=100?`${Math.round(value)}${suffix}`:value>=10?`${Math.round(10*value)/10}${suffix}`:`${Math.round(100*value)/100}${suffix}`;if("Lease"===type){if(price>=1e3){return formatToMaxDigits(price/1e3,"K")}return Math.round(price).toString()}if(price>=999500){return formatToMaxDigits(price/1e6,"M")}if(price>=1e3){return formatToMaxDigits(price/1e3,"K")}return Math.round(price).toString()}),[]),createPriceBubble=(0,react.useCallback)(((price,type)=>{const formattedPrice=formatPrice(price,type),isLease="Lease"===type,bubble=document.createElement("div");return bubble.style.cssText=`\n      background-color: ${isLease?"#a855f7":"#22c55e"};\n      color: white;\n      padding: 4px 8px;\n      border-radius: 4px;\n      font-size: 11px;\n      font-weight: 600;\n      font-family: -apple-system, BlinkMacSystemFont, sans-serif;\n      box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n      white-space: nowrap;\n      pointer-events: auto;\n      cursor: pointer;\n    `,bubble.textContent=formattedPrice,bubble}),[formatPrice]),clearPriceMarkers=(0,react.useCallback)((()=>{priceMarkers.current.forEach((marker=>marker.remove())),priceMarkers.current=[]}),[]),addPriceMarkers=(0,react.useCallback)((features=>{map.current&&(clearPriceMarkers(),features.forEach((feature=>{if("isProperty"in feature.properties&&feature.properties.isProperty&&feature.properties.listPrice){const{listPrice}=feature.properties,type=feature.properties.type||"Sale",[lng,lat]=feature.geometry.coordinates;if(isNaN(lng)||isNaN(lat)||null===lng||null===lat)return;const numericPrice="string"==typeof listPrice?parseFloat(listPrice):listPrice;if(isNaN(numericPrice))return;const bubble=createPriceBubble(numericPrice,type),marker=new(mapbox_gl_default().Marker)({element:bubble,anchor:"bottom",offset:[0,-5]}).setLngLat([lng,lat]).addTo(map.current);bubble.addEventListener("click",(async event=>{const clickX=event.clientX,clickY=event.clientY;if(setTooltipPosition({x:clickX,y:clickY}),feature.properties.address&&feature.properties.images){const listing={mlsNumber:feature.properties.mlsNumber||"N/A",listPrice:numericPrice,address:feature.properties.address,details:feature.properties.details,images:feature.properties.images,type:feature.properties.type,lastStatus:feature.properties.lastStatus,status:feature.properties.status};return setSelectedListing(listing),void setTooltipOpen(!0)}try{var _data_listings;const response=await fetch(`https://api.repliers.io/listings?mlsNumber=${feature.properties.mlsNumber}&fields=address.*,details.*,images,type,lastStatus,status,class`,{headers:{"REPLIERS-API-KEY":apiKey,"Content-Type":"application/json"}});if(!response.ok)throw new Error(`Failed to fetch property details: ${response.status}`);const propertyData=null===(_data_listings=(await response.json()).listings)||void 0===_data_listings?void 0:_data_listings[0];if(propertyData){const listing={mlsNumber:feature.properties.mlsNumber||"N/A",listPrice:numericPrice,address:propertyData.address,details:propertyData.details,images:propertyData.images,type:propertyData.type||feature.properties.type,lastStatus:propertyData.lastStatus,status:propertyData.status};setSelectedListing(listing),setTooltipOpen(!0)}else{const listing={mlsNumber:feature.properties.mlsNumber||"N/A",listPrice:numericPrice,address:feature.properties.address,details:feature.properties.details,images:feature.properties.images,type:feature.properties.type,lastStatus:feature.properties.lastStatus,status:feature.properties.status};setSelectedListing(listing),setTooltipOpen(!0)}}catch(error){const listing={mlsNumber:feature.properties.mlsNumber||"N/A",listPrice:numericPrice,address:feature.properties.address,details:feature.properties.details,images:feature.properties.images,type:feature.properties.type,lastStatus:feature.properties.lastStatus,status:feature.properties.status};setSelectedListing(listing),setTooltipOpen(!0)}})),priceMarkers.current.push(marker)}})))}),[clearPriceMarkers,createPriceBubble,apiKey]);(0,react.useEffect)((()=>{(async()=>{if(mapCenter&&mapZoom)return;const cached=(apiKey=>{try{const cached=localStorage.getItem(`mapListings-autoCenter-${apiKey}`);if(cached){const data=JSON.parse(cached);if(Date.now()-data.timestamp<864e5)return{center:data.center}}}catch(error){}return null})(`${apiKey}-${centerCalculation}`);if(cached)return setMapCenter(cached.center),void setMapZoom(initialZoom||10);const detected=await(async(apiKey,method="average")=>{try{var _clusterData_aggregates_map,_clusterData_aggregates;const bundledQuery={queries:[{cluster:!0,clusterPrecision:8,clusterLimit:50,status:"A"},{cluster:!1,listings:!0,pageSize:500,status:"A"}]},response=await fetch("https://api.repliers.io/listings",{method:"POST",headers:{"REPLIERS-API-KEY":apiKey,"Content-Type":"application/json"},body:JSON.stringify(bundledQuery)});if(400===response.status)return detectAutoCenterFallback(apiKey,method);if(!response.ok)throw new Error(`Bundled auto-center API Error: ${response.status} ${response.statusText}`);const data=await response.json(),clusterData=data[0]||{},listingData=data[1]||{},clusters=(null===(_clusterData_aggregates=clusterData.aggregates)||void 0===_clusterData_aggregates||null===(_clusterData_aggregates_map=_clusterData_aggregates.map)||void 0===_clusterData_aggregates_map?void 0:_clusterData_aggregates_map.clusters)||clusterData.clusters||[],listings=listingData.listings||listingData.results||[];if("city"===method&&clusters.length>0){let largestCluster=null,maxCount=0;if(clusters.forEach((cluster=>{const count=cluster.count||0;count>maxCount&&(maxCount=count,largestCluster=cluster)})),largestCluster){var _largestCluster_location,_largestCluster_coordinates,_largestCluster_center,_largestCluster_location1,_largestCluster_coordinates1,_largestCluster_center1;const coordinates=[(null===(_largestCluster_location=largestCluster.location)||void 0===_largestCluster_location?void 0:_largestCluster_location.longitude)||(null===(_largestCluster_coordinates=largestCluster.coordinates)||void 0===_largestCluster_coordinates?void 0:_largestCluster_coordinates.lng)||largestCluster.longitude||(null===(_largestCluster_center=largestCluster.center)||void 0===_largestCluster_center?void 0:_largestCluster_center.lng),(null===(_largestCluster_location1=largestCluster.location)||void 0===_largestCluster_location1?void 0:_largestCluster_location1.latitude)||(null===(_largestCluster_coordinates1=largestCluster.coordinates)||void 0===_largestCluster_coordinates1?void 0:_largestCluster_coordinates1.lat)||largestCluster.latitude||(null===(_largestCluster_center1=largestCluster.center)||void 0===_largestCluster_center1?void 0:_largestCluster_center1.lat)];if(coordinates[0]&&coordinates[1]){const autoCenter={center:[coordinates[0],coordinates[1]]};return setCachedAutoCenter(`${apiKey}-${method}`,autoCenter),autoCenter}}}if(0===listings.length)return null;const coordinates=[];if(listings.forEach((listing=>{const coord=extractCoordinates(listing);coord&&coordinates.push(coord)})),0===coordinates.length)return null;const bounds=getPolygonBounds(coordinates);if(!bounds)return null;const autoCenter={center:calculateAverageCenter(coordinates,bounds)};return setCachedAutoCenter(`${apiKey}-${method}`,autoCenter),autoCenter}catch(error){return detectAutoCenterFallback(apiKey,method)}})(apiKey,centerCalculation);detected?(setMapCenter(detected.center),setMapZoom(initialZoom||10)):(setMapCenter([-98.5795,39.8283]),setMapZoom(initialZoom||10))})()}),[apiKey,mapCenter,mapZoom,centerCalculation,initialZoom]);const getClusterPrecision=(0,react.useCallback)((zoom=>zoom<=6?5:zoom<=8?8:zoom<=10?12:zoom<=12?16:zoom<=14?20:25),[]),boundsToPolygon=(0,react.useCallback)((bounds=>{const sw=bounds.getSouthWest(),ne=bounds.getNorthEast();return[[[sw.lng,sw.lat],[ne.lng,sw.lat],[ne.lng,ne.lat],[sw.lng,ne.lat],[sw.lng,sw.lat]]]}),[]),fetchClusters=(0,react.useCallback)((async bounds=>{if(!map.current)return;const zoom=map.current.getZoom(),precision=getClusterPrecision(zoom),boundsKey=JSON.stringify(boundsToPolygon(bounds)),roundedZoom=Math.round(2*zoom)/2,filtersKey=JSON.stringify(filters);if(!(lastFetchParams.current&&lastFetchParams.current.bounds===boundsKey&&Math.abs(lastFetchParams.current.zoom-roundedZoom)<.5&&lastFetchParams.current.filters===filtersKey)){lastFetchParams.current={bounds:boundsKey,zoom:roundedZoom,filters:filtersKey},currentZoomLevel.current=zoom,setError(null);try{var _data_aggregates_map,_data_aggregates;const url=new URL("https://api.repliers.io/listings");if(url.searchParams.set("cluster","true"),url.searchParams.set("clusterPrecision",precision.toString()),url.searchParams.set("clusterLimit","500"),url.searchParams.set("status","A"),url.searchParams.set("map",JSON.stringify(boundsToPolygon(bounds))),url.searchParams.set("key",apiKey),"all"!==filters.listingType&&("sale"===filters.listingType?url.searchParams.set("type","Sale"):"lease"===filters.listingType&&url.searchParams.set("type","Lease")),1===filters.propertyTypes.length?url.searchParams.set("details.propertyType",filters.propertyTypes[0]):filters.propertyTypes.length,filters.minPrice&&filters.minPrice>0&&url.searchParams.set("minPrice",filters.minPrice.toString()),filters.maxPrice&&filters.maxPrice>0&&url.searchParams.set("maxPrice",filters.maxPrice.toString()),filters.bedrooms&&"all"!==filters.bedrooms&&("5+"===filters.bedrooms?url.searchParams.set("minBedrooms","5"):(url.searchParams.set("minBedrooms",filters.bedrooms),url.searchParams.set("maxBedrooms",filters.bedrooms))),filters.bathrooms&&"all"!==filters.bathrooms){const minBaths=filters.bathrooms.replace("+","");url.searchParams.set("minBaths",minBaths)}if(filters.garageSpaces&&"all"!==filters.garageSpaces){const minGarageSpaces=filters.garageSpaces.replace("+","");url.searchParams.set("minGarageSpaces",minGarageSpaces)}if(filters.minSqft&&filters.minSqft>0&&url.searchParams.set("minSqft",filters.minSqft.toString()),filters.maxSqft&&filters.maxSqft>0&&url.searchParams.set("maxSqft",filters.maxSqft.toString()),filters.openHouse&&"all"!==filters.openHouse){const today=new Date;today.setHours(0,0,0,0);let minDate=null,maxDate=null;if("today"===filters.openHouse)minDate=today,maxDate=today;else if("thisWeekend"===filters.openHouse){const dayOfWeek=today.getDay(),daysUntilSaturday=0===dayOfWeek?6:6-dayOfWeek,saturday=new Date(today);saturday.setDate(today.getDate()+daysUntilSaturday);const sunday=new Date(saturday);sunday.setDate(saturday.getDate()+1),minDate=saturday,maxDate=sunday}else if("thisWeek"===filters.openHouse){minDate=today;const endOfWeek=new Date(today);endOfWeek.setDate(today.getDate()+(7-today.getDay())),maxDate=endOfWeek}else"anytime"===filters.openHouse&&(minDate=today);if(minDate){const formatDate=date=>date.toISOString().split("T")[0];url.searchParams.set("minOpenHouseDate",formatDate(minDate)),maxDate&&url.searchParams.set("maxOpenHouseDate",formatDate(maxDate))}}url.searchParams.set("clusterFields","mlsNumber,listPrice,coordinates,type,address.*,details.numBedrooms,details.numBedroomsPlus,details.numBathrooms,details.numBathroomsPlus,details.numGarageSpaces,details.propertyType,lastStatus,images,status,class"),zoom>=14?(url.searchParams.set("listings","true"),url.searchParams.set("fields","address.*,mlsNumber,listPrice,details.numBedrooms,details.numBedroomsPlus,details.numBathrooms,details.numBathroomsPlus,details.numGarageSpaces,details.propertyType,type,lastStatus,images,status,class,coordinates,latitude,longitude,geo,location,map"),url.searchParams.set("pageSize","500")):url.searchParams.set("listings","false");const response=await fetch(url.toString(),{headers:{"REPLIERS-API-KEY":apiKey,"Content-Type":"application/json"}});if(!response.ok)throw new Error(`API Error: ${response.status} ${response.statusText}`);const data=await response.json(),clusters=(null===(_data_aggregates=data.aggregates)||void 0===_data_aggregates||null===(_data_aggregates_map=_data_aggregates.map)||void 0===_data_aggregates_map?void 0:_data_aggregates_map.clusters)||data.clusters||[],clusterFeatures=[],singlePropertyFeatures=[],rawListings=data.listings||data.results||[];console.log(`\n📦 API RESPONSE DEBUG (zoom: ${zoom.toFixed(2)})`),console.log(`   Total clusters from API: ${clusters.length}`),console.log(`   Total raw listings from API: ${rawListings.length}`);const mlsNumbers=rawListings.map((l=>l.mlsNumber)).filter(Boolean),uniqueMlsNumbers=new Set(mlsNumbers);var _clusters__properties,_clusters__map;if(mlsNumbers.length!==uniqueMlsNumbers.size&&console.log(`   ⚠️ DUPLICATES DETECTED: ${mlsNumbers.length} total, ${uniqueMlsNumbers.size} unique (${mlsNumbers.length-uniqueMlsNumbers.size} duplicates)`),clusters.length>0)console.log("   First cluster structure:",{count:clusters[0].count,propertiesLength:(null===(_clusters__properties=clusters[0].properties)||void 0===_clusters__properties?void 0:_clusters__properties.length)||0,mapLength:(null===(_clusters__map=clusters[0].map)||void 0===_clusters__map?void 0:_clusters__map.length)||0,hasMembers:!(!clusters[0].properties&&!clusters[0].map)});const matchesPropertyTypeFilter=propertyType=>0===filters.propertyTypes.length||!!propertyType&&filters.propertyTypes.includes(propertyType);clusters.forEach(((cluster,index)=>{var _cluster_location,_cluster_coordinates,_cluster_center,_cluster_location1,_cluster_coordinates1,_cluster_center1;const originalCoordinates=[(null===(_cluster_location=cluster.location)||void 0===_cluster_location?void 0:_cluster_location.longitude)||(null===(_cluster_coordinates=cluster.coordinates)||void 0===_cluster_coordinates?void 0:_cluster_coordinates.lng)||cluster.longitude||(null===(_cluster_center=cluster.center)||void 0===_cluster_center?void 0:_cluster_center.lng),(null===(_cluster_location1=cluster.location)||void 0===_cluster_location1?void 0:_cluster_location1.latitude)||(null===(_cluster_coordinates1=cluster.coordinates)||void 0===_cluster_coordinates1?void 0:_cluster_coordinates1.lat)||cluster.latitude||(null===(_cluster_center1=cluster.center)||void 0===_cluster_center1?void 0:_cluster_center1.lat)];if(1===cluster.count&&zoom>=14){var _cluster_listing,_cluster_map_,_cluster_listing_details,_cluster_listing1,_cluster_details;const listPrice=(null===(_cluster_listing=cluster.listing)||void 0===_cluster_listing?void 0:_cluster_listing.listPrice)||cluster.listPrice||cluster.map&&(null===(_cluster_map_=cluster.map[0])||void 0===_cluster_map_?void 0:_cluster_map_.listPrice),clusterPropertyType=(null===(_cluster_listing1=cluster.listing)||void 0===_cluster_listing1||null===(_cluster_listing_details=_cluster_listing1.details)||void 0===_cluster_listing_details?void 0:_cluster_listing_details.propertyType)||(null===(_cluster_details=cluster.details)||void 0===_cluster_details?void 0:_cluster_details.propertyType);var _cluster_listing2,_cluster_listing3,_cluster_listing4,_cluster_listing5,_cluster_listing6,_cluster_listing7,_cluster_listing8,_cluster_listing9,_cluster_listing10;if(matchesPropertyTypeFilter(clusterPropertyType))singlePropertyFeatures.push({type:"Feature",properties:{mlsNumber:cluster.mlsNumber||(null===(_cluster_listing2=cluster.listing)||void 0===_cluster_listing2?void 0:_cluster_listing2.mlsNumber)||`single-${index}`,listPrice:"string"==typeof listPrice?parseFloat(listPrice):listPrice,propertyType:cluster.propertyType||(null===(_cluster_listing3=cluster.listing)||void 0===_cluster_listing3?void 0:_cluster_listing3.propertyType)||cluster.status||"Sale",type:(null===(_cluster_listing4=cluster.listing)||void 0===_cluster_listing4?void 0:_cluster_listing4.type)||cluster.type,isProperty:!0,address:(null===(_cluster_listing5=cluster.listing)||void 0===_cluster_listing5?void 0:_cluster_listing5.address)||cluster.address,details:(null===(_cluster_listing6=cluster.listing)||void 0===_cluster_listing6?void 0:_cluster_listing6.details)||cluster.details,images:(null===(_cluster_listing7=cluster.listing)||void 0===_cluster_listing7?void 0:_cluster_listing7.images)||cluster.images,lastStatus:(null===(_cluster_listing8=cluster.listing)||void 0===_cluster_listing8?void 0:_cluster_listing8.lastStatus)||cluster.lastStatus,status:(null===(_cluster_listing9=cluster.listing)||void 0===_cluster_listing9?void 0:_cluster_listing9.status)||cluster.status,class:(null===(_cluster_listing10=cluster.listing)||void 0===_cluster_listing10?void 0:_cluster_listing10.class)||cluster.class},geometry:{type:"Point",coordinates:[originalCoordinates[0],originalCoordinates[1]]}})}else if(1===cluster.count)clusterFeatures.push({type:"Feature",properties:{count:cluster.count||1,apiCount:cluster.count||1,precision:cluster.precision||precision,id:`cluster-${index}`,members:cluster.properties||cluster.map||[]},geometry:{type:"Point",coordinates:[originalCoordinates[0],originalCoordinates[1]]}});else{let clusterCoordinates=originalCoordinates;if(cluster.properties&&Array.isArray(cluster.properties)){const subCoords=[];if(cluster.properties.forEach((prop=>{const coord=extractCoordinates(prop);coord&&subCoords.push(coord)})),subCoords.length>0){const clusterBounds=getPolygonBounds(subCoords);if(clusterBounds){clusterCoordinates=calculateAverageCenter(subCoords,clusterBounds)}}}const clusterMembers=cluster.properties||cluster.map||[];clusterFeatures.push({type:"Feature",properties:{count:cluster.count||1,apiCount:cluster.count||1,precision:cluster.precision||precision,id:`cluster-${index}`,members:clusterMembers},geometry:{type:"Point",coordinates:[clusterCoordinates[0],clusterCoordinates[1]]}})}}));const singlePropertyMlsNumbers=new Set(singlePropertyFeatures.map((f=>f.properties.mlsNumber))),propertyFeatures=rawListings.filter((listing=>{var _listing_map,_listing_coordinates,_listing_coordinates1,_listing_map1,_listing_coordinates2,_listing_coordinates3,_listing_details;if(singlePropertyMlsNumbers.has(listing.mlsNumber))return!1;const lng=(null===(_listing_map=listing.map)||void 0===_listing_map?void 0:_listing_map.longitude)||(null===(_listing_coordinates=listing.coordinates)||void 0===_listing_coordinates?void 0:_listing_coordinates.lng)||(null===(_listing_coordinates1=listing.coordinates)||void 0===_listing_coordinates1?void 0:_listing_coordinates1.longitude)||listing.longitude||listing.lng,lat=(null===(_listing_map1=listing.map)||void 0===_listing_map1?void 0:_listing_map1.latitude)||(null===(_listing_coordinates2=listing.coordinates)||void 0===_listing_coordinates2?void 0:_listing_coordinates2.lat)||(null===(_listing_coordinates3=listing.coordinates)||void 0===_listing_coordinates3?void 0:_listing_coordinates3.latitude)||listing.latitude||listing.lat,hasValidCoords=void 0!==lng&&void 0!==lat&&!isNaN(lng)&&!isNaN(lat),matchesFilter=matchesPropertyTypeFilter(null===(_listing_details=listing.details)||void 0===_listing_details?void 0:_listing_details.propertyType);return hasValidCoords&&matchesFilter})).map((listing=>{var _listing_details,_listing_coordinates,_listing_map,_listing_coordinates1,_listing_map1;return{type:"Feature",properties:{...{mlsNumber:listing.mlsNumber,listPrice:"string"==typeof listing.listPrice?parseFloat(listing.listPrice):listing.listPrice,propertyType:listing.propertyType||(null===(_listing_details=listing.details)||void 0===_listing_details?void 0:_listing_details.propertyType)||listing.type||listing.status||"Sale",type:listing.type,isProperty:!0},...zoom>=13?{address:listing.address,details:listing.details,images:listing.images,type:listing.type,lastStatus:listing.lastStatus,status:listing.status,class:listing.class}:{}},geometry:{type:"Point",coordinates:[(null===(_listing_coordinates=listing.coordinates)||void 0===_listing_coordinates?void 0:_listing_coordinates.lng)||listing.longitude||(null===(_listing_map=listing.map)||void 0===_listing_map?void 0:_listing_map.longitude),(null===(_listing_coordinates1=listing.coordinates)||void 0===_listing_coordinates1?void 0:_listing_coordinates1.lat)||listing.latitude||(null===(_listing_map1=listing.map)||void 0===_listing_map1?void 0:_listing_map1.latitude)]}}})),recalculateClusterCounts=(clusters,allProperties,singleProps)=>{const allAvailableProperties=[...allProperties,...singleProps];return clusters.map((cluster=>{const clusterCoords=cluster.geometry.coordinates,nearbyProperties=allAvailableProperties.filter((prop=>{const propCoords=prop.geometry.coordinates;return Math.sqrt(Math.pow(propCoords[0]-clusterCoords[0],2)+Math.pow(propCoords[1]-clusterCoords[1],2))<.001})),newCount=nearbyProperties.length>0?nearbyProperties.length:cluster.properties.count;return{...cluster,properties:{...cluster.properties,count:newCount}}}))},hasProperties=propertyFeatures.length>0||singlePropertyFeatures.length>0,updatedClusterFeatures=zoom>=14&&hasProperties?recalculateClusterCounts(clusterFeatures,propertyFeatures,singlePropertyFeatures):clusterFeatures;let allFeatures;if(zoom>=14){const allPotentialFeatures=[...updatedClusterFeatures.map((f=>({...f,type:"cluster"}))),...singlePropertyFeatures.map((f=>({...f,type:"singleProperty"}))),...propertyFeatures.map((f=>({...f,type:"property"})))];allFeatures=groupFeaturesByProximity(allPotentialFeatures,50).map((group=>{const clusters=group.filter((f=>"cluster"===f.type)),properties=group.filter((f=>"property"===f.type||"singleProperty"===f.type)),clusterPropertyCount=clusters.reduce(((sum,c)=>{var _c_properties;return sum+((null===(_c_properties=c.properties)||void 0===_c_properties?void 0:_c_properties.count)||0)}),0),individualPropertyCount=properties.length;return properties.length>3?clusters.length>0?clusters.reduce(((largest,current)=>{var _current_properties,_largest_properties;return((null===(_current_properties=current.properties)||void 0===_current_properties?void 0:_current_properties.count)||0)>((null===(_largest_properties=largest.properties)||void 0===_largest_properties?void 0:_largest_properties.count)||0)?current:largest})):properties[0]:clusterPropertyCount>individualPropertyCount&&clusters.length>0?clusters.reduce(((largest,current)=>{var _current_properties,_largest_properties;return((null===(_current_properties=current.properties)||void 0===_current_properties?void 0:_current_properties.count)||0)>((null===(_largest_properties=largest.properties)||void 0===_largest_properties?void 0:_largest_properties.count)||0)?current:largest})):properties.length>0?properties:clusters.length>0&&clusters[0].properties.count>0?clusters[0]:null})).flat().filter(Boolean)}else{allFeatures=mergeSmallClusters([...clusterFeatures,...singlePropertyFeatures],zoom)}const geoJsonData={type:"FeatureCollection",features:allFeatures},source=map.current.getSource("listings");source&&(source.setData(geoJsonData),addPriceMarkers(allFeatures));const total=data.count||clusterFeatures.reduce(((sum,feature)=>sum+feature.properties.count),0);setTotalCount(total)}catch(err){const errorMessage=err instanceof Error?err.message:"Failed to load listings";setError(errorMessage)}}}),[apiKey,getClusterPrecision,boundsToPolygon,addPriceMarkers,filters]);(0,react.useEffect)((()=>{fetchClustersRef.current=fetchClusters}),[fetchClusters]);const calculateDistance=(0,react.useCallback)(((coord1,coord2)=>{const[lng1,lat1]=coord1,[lng2,lat2]=coord2,dLat=(lat2-lat1)*Math.PI/180,dLng=(lng2-lng1)*Math.PI/180,a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLng/2)*Math.sin(dLng/2);return 6371e3*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)))}),[]),groupFeaturesByProximity=(0,react.useCallback)(((features,radiusMeters)=>{const groups=[],processed=new Set;return features.forEach(((feature,index)=>{if(processed.has(index))return;const group=[feature];processed.add(index);const featureCoords=feature.geometry.coordinates;features.forEach(((otherFeature,otherIndex)=>{if(processed.has(otherIndex)||index===otherIndex)return;const otherCoords=otherFeature.geometry.coordinates;calculateDistance(featureCoords,otherCoords)<=radiusMeters&&(group.push(otherFeature),processed.add(otherIndex))})),groups.push(group)})),groups}),[calculateDistance]),mergeSmallClusters=(0,react.useCallback)(((features,zoom)=>{const smallClusterThreshold=zoom<=10?30:zoom<=12?60:zoom<=13?100:30,mergeRadius=zoom<=10?500:zoom<=12?300:zoom<=13?200:100,smallClusters=features.filter((f=>f.properties.count<=smallClusterThreshold)),largeClusters=features.filter((f=>f.properties.count>smallClusterThreshold));if(0===smallClusters.length)return features;const mergedFeatures=groupFeaturesByProximity(smallClusters,mergeRadius).map((group=>{if(1===group.length)return group[0];const totalCount=group.reduce(((sum,cluster)=>sum+cluster.properties.count),0),avgLng=group.reduce(((sum,cluster)=>sum+cluster.geometry.coordinates[0]),0)/group.length,avgLat=group.reduce(((sum,cluster)=>sum+cluster.geometry.coordinates[1]),0)/group.length;return{type:"Feature",properties:{count:totalCount,precision:group[0].properties.precision,id:`merged-${group.map((c=>c.properties.id)).join("-")}`,members:[]},geometry:{type:"Point",coordinates:[avgLng,avgLat]}}}));return[...largeClusters,...mergedFeatures]}),[groupFeaturesByProximity]);(0,react.useCallback)(((clusterCoords,radiusMeters,maxCount)=>{if(!map.current)return[];try{const source=map.current.getSource("listings");if(!source||!source._data)return[];const allFeatures=source._data.features||[];return allFeatures.filter((feature=>{var _feature_properties;return!0===(null===(_feature_properties=feature.properties)||void 0===_feature_properties?void 0:_feature_properties.isProperty)})).map((feature=>{const featureCoords=feature.geometry.coordinates;return{feature,distance:calculateDistance(clusterCoords,featureCoords),listing:feature.properties}})).filter((item=>item.distance<=radiusMeters)).sort(((a,b)=>a.distance-b.distance)).slice(0,maxCount).map((item=>item.listing))}catch(error){return[]}}),[calculateDistance]);return(0,react.useEffect)((()=>{if(mapContainer.current&&!map.current&&mapCenter&&null!==mapZoom)return mapbox_gl_default().accessToken=mapboxToken,map.current=new(mapbox_gl_default().Map)({container:mapContainer.current,style:mapStyle,center:mapCenter,zoom:mapZoom}),map.current.on("load",(()=>{if(!map.current)return;map.current.addControl(new(mapbox_gl_default().NavigationControl)),map.current.addSource("listings",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),map.current.addLayer({id:"clusters",type:"circle",source:"listings",filter:["has","count"],paint:{"circle-color":["step",["get","count"],"#51bbd6",30,"#f1c40f",60,"#f39c12",150,"#f28cb1",500,"#e74c3c"],"circle-radius":["step",["get","count"],10,30,12,60,14,150,18,500,22],"circle-stroke-width":2,"circle-stroke-color":"#fff","circle-opacity":.8}}),map.current.addLayer({id:"cluster-count",type:"symbol",source:"listings",filter:["has","count"],layout:{"text-field":["get","count"],"text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":["step",["get","count"],10,30,11,60,12,150,14,500,16]},paint:{"text-color":"#ffffff"}}),map.current.addLayer({id:"property-dots",type:"circle",source:"listings",filter:["has","isProperty"],paint:{"circle-color":"#374151","circle-radius":3,"circle-stroke-width":1,"circle-stroke-color":"#fff","circle-opacity":.9}}),map.current.on("click","clusters",(async e=>{var _e_features;if(!map.current||!(null===(_e_features=e.features)||void 0===_e_features?void 0:_e_features[0]))return;const feature=e.features[0],coordinates=feature.geometry.coordinates,clusterCount=feature.properties.count,apiCount=feature.properties.apiCount,clickX=e.originalEvent.clientX,clickY=e.originalEvent.clientY,currentZoom=map.current.getZoom();if(console.log("\n🎯 CLUSTER CLICKED"),console.log(`   Zoom Level: ${currentZoom.toFixed(2)}`),console.log(`   Display Count: ${clusterCount}`),console.log(`   API Count (unfiltered): ${apiCount||clusterCount}`),currentZoom>=14){const source=map.current.getSource("listings");if(source&&source._data){var _sourceData_features;const allPropertyFeatures=(null===(_sourceData_features=source._data.features)||void 0===_sourceData_features?void 0:_sourceData_features.filter((f=>{var _f_properties;return!0===(null===(_f_properties=f.properties)||void 0===_f_properties?void 0:_f_properties.isProperty)})))||[];console.log(`   Total Properties Available: ${allPropertyFeatures.length}`);const allMlsNumbers=allPropertyFeatures.map((f=>{var _f_properties;return null===(_f_properties=f.properties)||void 0===_f_properties?void 0:_f_properties.mlsNumber})).filter(Boolean),uniqueAllMls=new Set(allMlsNumbers);allMlsNumbers.length!==uniqueAllMls.size&&console.log(`   ⚠️ DUPLICATES IN MAP DATA: ${allMlsNumbers.length} total properties, ${uniqueAllMls.size} unique MLSNumbers`);const closestProperties=allPropertyFeatures.map((f=>{const featureCoords=f.geometry.coordinates;return{feature:f,distance:Math.sqrt(Math.pow(featureCoords[0]-coordinates[0],2)+Math.pow(featureCoords[1]-coordinates[1],2))}})).sort(((a,b)=>a.distance-b.distance)).slice(0,clusterCount);if(console.log(`   Actual Properties in Cluster: ${closestProperties.length}`),console.log("   Discrepancy: "+(clusterCount!==closestProperties.length?`⚠️ ${clusterCount-closestProperties.length} missing`:"✅ Match")),closestProperties.length>0){const realProperties=closestProperties.map((({feature})=>{const props=feature.properties;return{mlsNumber:props.mlsNumber||"N/A",listPrice:props.listPrice||0,address:props.address||{streetNumber:"Unknown",streetName:"Address",city:"Unknown",state:"Unknown"},details:props.details||{numBedrooms:0,numBathrooms:0,numGarageSpaces:0,propertyType:"Unknown"},images:props.images||[],type:props.type||"Sale",lastStatus:props.lastStatus||"New",status:props.status||"A"}})),mlsNumbers=realProperties.map((p=>p.mlsNumber)),uniqueMlsNumbers=new Set(mlsNumbers);if(mlsNumbers.length!==uniqueMlsNumbers.size){console.log(`   ⚠️ DUPLICATES IN CLUSTER TOOLTIP: ${mlsNumbers.length} total, ${uniqueMlsNumbers.size} unique`);const counts=mlsNumbers.reduce(((acc,mls)=>(acc[mls]=(acc[mls]||0)+1,acc)),{}),duplicates=Object.entries(counts).filter((([_,count])=>count>1)).map((([mls,count])=>`${mls} (${count}x)`));console.log("   Duplicate MLSNumbers:",duplicates)}else console.log("   ✅ No duplicates in cluster tooltip");const uniqueProperties=realProperties.filter(((property,index,self)=>index===self.findIndex((p=>p.mlsNumber===property.mlsNumber))));return setClusterProperties(uniqueProperties),setClusterTooltipPosition({x:clickX,y:clickY}),setClusterTooltipOpen(!0),void setTooltipOpen(!1)}}return setClusterProperties([{mlsNumber:`Cluster-${clusterCount}`,listPrice:0,address:{streetNumber:"Multiple",streetName:"Properties",city:"Available",state:""},details:{numBedrooms:0,numBathrooms:0,numGarageSpaces:0,propertyType:`${clusterCount} Properties in Cluster`},images:[],type:"Sale",lastStatus:"Available",status:"A"}]),setClusterTooltipPosition({x:clickX,y:clickY}),setClusterTooltipOpen(!0),void setTooltipOpen(!1)}const zoomIncrement=currentZoom>=14?2:currentZoom>=12?3:4,targetZoom=Math.min(currentZoom+zoomIncrement,16);map.current.easeTo({center:coordinates,zoom:targetZoom,duration:1e3,easing:t=>t*(2-t)})})),map.current.on("mouseenter","clusters",(()=>{map.current&&(map.current.getCanvas().style.cursor="pointer")})),map.current.on("mouseleave","clusters",(()=>{map.current&&(map.current.getCanvas().style.cursor="")})),map.current.on("mouseenter","property-dots",(()=>{map.current&&(map.current.getCanvas().style.cursor="pointer")})),map.current.on("mouseleave","property-dots",(()=>{map.current&&(map.current.getCanvas().style.cursor="")}));const bounds=map.current.getBounds();var _fetchClustersRef_current;bounds&&(null===(_fetchClustersRef_current=fetchClustersRef.current)||void 0===_fetchClustersRef_current||_fetchClustersRef_current.call(fetchClustersRef,bounds))})),map.current.on("moveend",(()=>{if(!map.current)return;const bounds=map.current.getBounds();var _fetchClustersRef_current;bounds&&(null===(_fetchClustersRef_current=fetchClustersRef.current)||void 0===_fetchClustersRef_current||_fetchClustersRef_current.call(fetchClustersRef,bounds))})),()=>{clearPriceMarkers(),map.current&&(map.current.remove(),map.current=null)}}),[mapboxToken,mapStyle,mapCenter,mapZoom,clearPriceMarkers,addPriceMarkers]),(0,react.useEffect)((()=>{if(map.current){lastFetchParams.current=null;const bounds=map.current.getBounds();bounds&&fetchClusters(bounds)}}),[filters,fetchClusters]),(0,jsx_runtime.jsxs)("div",{style:{width,height,position:"relative"},children:[(0,jsx_runtime.jsx)("div",{ref:mapContainer,style:{width:"100%",height:"100%"},className:"rounded-lg overflow-hidden"}),(0,jsx_runtime.jsx)(FilterPanel,{filters,onFiltersChange:handleFiltersChange,apiKey}),showPropertyCount&&(0,jsx_runtime.jsx)("div",{style:{position:"absolute",bottom:"16px",right:"16px",backgroundColor:"rgba(255, 255, 255, 0.95)",padding:"8px 12px",borderRadius:"6px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.15)",fontSize:"14px",fontWeight:"600",color:"#374151"},children:error?(0,jsx_runtime.jsx)("span",{style:{color:"#ef4444"},children:"Error"}):(0,jsx_runtime.jsxs)("span",{children:[totalCount.toLocaleString()," properties"]})}),error&&(0,jsx_runtime.jsx)("div",{style:{position:"absolute",bottom:"16px",left:"16px",right:"16px",backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"6px",padding:"12px",color:"#b91c1c",fontSize:"14px"},children:error}),(0,jsx_runtime.jsx)(PropertyTooltip,{open:tooltipOpen,onClose:()=>setTooltipOpen(!1),listing:selectedListing,position:tooltipPosition,mapContainer:mapContainer.current}),(0,jsx_runtime.jsx)(ClusterTooltip,{open:clusterTooltipOpen,onClose:()=>setClusterTooltipOpen(!1),properties:clusterProperties,position:clusterTooltipPosition,mapContainer:mapContainer.current})]})}MapListings.__docgenInfo={description:"MapListings Component\n\nA high-performance real estate map component that displays property listings\nusing server-side clustering from the Repliers API. Automatically adjusts\ncluster precision based on zoom level for optimal user experience.\n\nFeatures:\n- Server-side clustering for optimal performance\n- Zoom-based precision adjustment\n- Hierarchical cluster drilling\n- Minimal API calls\n- Property count display\n- Filter panel for search refinement",methods:[],displayName:"MapListings",props:{apiKey:{required:!0,tsType:{name:"string"},description:"Repliers API key - required"},mapboxToken:{required:!0,tsType:{name:"string"},description:"MapBox access token - required"},initialCenter:{required:!1,tsType:{name:"tuple",raw:"[number, number]",elements:[{name:"number"},{name:"number"}]},description:"Initial map center coordinates [lng, lat] - auto-detects if not provided"},initialZoom:{required:!1,tsType:{name:"number"},description:"Initial zoom level - auto-calculates if not provided"},height:{required:!1,tsType:{name:"string"},description:"Map container height",defaultValue:{value:'"100%"',computed:!1}},width:{required:!1,tsType:{name:"string"},description:"Map container width",defaultValue:{value:'"100%"',computed:!1}},mapStyle:{required:!1,tsType:{name:"string"},description:"Map style",defaultValue:{value:'"mapbox://styles/mapbox/streets-v12"',computed:!1}},centerCalculation:{required:!1,tsType:{name:"union",raw:'"average" | "city"',elements:[{name:"literal",value:'"average"'},{name:"literal",value:'"city"'}]},description:"Center calculation method",defaultValue:{value:'"average"',computed:!1}},showPropertyCount:{required:!1,tsType:{name:"boolean"},description:"Show property count display",defaultValue:{value:"true",computed:!1}}}};const map_listings_stories={title:"Tutorials/Configuring the MapListings Component with the Repliers API (WIP)",component:MapListings,parameters:{layout:"fullscreen",docs:{page:()=>null}},argTypes:{apiKey:{control:"text",description:"Repliers API key (required)"},mapboxToken:{control:"text",description:"MapBox access token (required)"},initialCenter:{control:"object",description:"Initial map center coordinates [lng, lat]"},initialZoom:{control:{type:"range",min:1,max:20,step:1},description:"Initial zoom level"},height:{control:"text",description:"Map container height"},width:{control:"text",description:"Map container width"},mapStyle:{control:"select",options:["mapbox://styles/mapbox/streets-v12","mapbox://styles/mapbox/light-v11","mapbox://styles/mapbox/dark-v11","mapbox://styles/mapbox/satellite-v9","mapbox://styles/mapbox/satellite-streets-v12"],description:"MapBox map style"}}},SAMPLE_API_KEY="pxI19UMy9zfw9vz5lRxoGpjJWXrMnm",SAMPLE_MAPBOX_TOKEN="pk.eyJ1IjoibWlsYW5zb21hIiwiYSI6ImNtZWJrODZmajBwMWQya3B3cHE1M2Y3anoifQ.HMDLOc-6V9K3-mHKeTHHxw",Part1_BasicListings={args:{apiKey:SAMPLE_API_KEY,mapboxToken:SAMPLE_MAPBOX_TOKEN,initialZoom:8,height:"100vh",width:"100vw",mapStyle:"mapbox://styles/mapbox/streets-v12"},parameters:{docs:{description:{story:"\n🎯 **This is the main interactive demo!** This example demonstrates server-side clustering\nwith the Repliers API using the default 'average' center calculation method.\n\n**Cluster Precision Levels:**\n- **Zoom 6 and below**: Continental-level clusters (precision 3)\n- **Zoom 7-8**: State/Province-level clusters (precision 5)\n- **Zoom 9-10**: Metropolitan-level clusters (precision 8)\n- **Zoom 11-12**: City-level clusters (precision 12)\n- **Zoom 13-14**: District-level clusters (precision 16)\n- **Zoom 15+**: Street-level clusters (precision 20)\n\n**Center Calculation:**\nUses the largest cluster method to find the area with the most listings and centers the map on it.\n\n**Performance Features:**\n- Server-side clustering reduces data transfer\n- Only one API call per map movement\n- Cluster limit reduced to 100 for better distribution\n        "}}}},Part2_LargestClusterCenter={args:{apiKey:SAMPLE_API_KEY,mapboxToken:SAMPLE_MAPBOX_TOKEN,initialZoom:10,height:"100vh",width:"100vw",mapStyle:"mapbox://styles/mapbox/streets-v12"},parameters:{docs:{description:{story:"\n🏆 **Largest Cluster Center Calculation**\n\nThis method finds the largest cluster of listings and centers the map on it for optimal viewing.\n\n**How it works:**\n- Calls the clustering API with low precision to get the biggest clusters\n- Identifies the cluster with the highest number of listings\n- Centers the map on that cluster's location\n\n**Best for:**\n- Focusing on the most active area in your dataset\n- Automatic centering on the densest listing concentration\n- Quick identification of market hotspots\n\n**Console output:** `🏆 Largest cluster: 24938 listings at [-79.3832, 43.6532]`\n        "}}}},Part3_MapStyles={args:{apiKey:SAMPLE_API_KEY,mapboxToken:SAMPLE_MAPBOX_TOKEN,initialZoom:10,height:"100vh",width:"100vw",mapStyle:"mapbox://styles/mapbox/dark-v11"},parameters:{docs:{description:{story:"\n🎨 **Map Style Customization**\n\nThis example showcases the dark theme map style, demonstrating how you can customize\nthe visual appearance of your MapListings component.\n\n**Available styles:**\n- `mapbox://styles/mapbox/streets-v12` - Default streets view\n- `mapbox://styles/mapbox/light-v11` - Light theme\n- `mapbox://styles/mapbox/dark-v11` - Dark theme (shown here)\n- `mapbox://styles/mapbox/satellite-v9` - Satellite imagery\n- `mapbox://styles/mapbox/satellite-streets-v12` - Satellite with street labels\n\n**Best for:**\n- Matching your application's design theme\n- Providing user choice for map appearance\n- Better visibility in different lighting conditions\n\n**Note:** The clustering and listing functionality remains the same across all styles.\n        "}}}},Part4_FilteredSearch={args:{apiKey:SAMPLE_API_KEY,mapboxToken:SAMPLE_MAPBOX_TOKEN,initialCenter:[-98.5795,39.8283],initialZoom:4,height:"100vh",width:"100vw",mapStyle:"mapbox://styles/mapbox/streets-v12"},parameters:{docs:{disable:!0}}},__namedExportsOrder=["Part1_BasicListings","Part2_LargestClusterCenter","Part3_MapStyles","Part4_FilteredSearch"];Part1_BasicListings.parameters={...Part1_BasicListings.parameters,docs:{...Part1_BasicListings.parameters?.docs,source:{originalSource:'{\n  args: {\n    apiKey: SAMPLE_API_KEY,\n    mapboxToken: SAMPLE_MAPBOX_TOKEN,\n    initialZoom: 8,\n    height: "100vh",\n    width: "100vw",\n    mapStyle: "mapbox://styles/mapbox/streets-v12"\n  },\n  parameters: {\n    docs: {\n      description: {\n        story: `\n🎯 **This is the main interactive demo!** This example demonstrates server-side clustering\nwith the Repliers API using the default \'average\' center calculation method.\n\n**Cluster Precision Levels:**\n- **Zoom 6 and below**: Continental-level clusters (precision 3)\n- **Zoom 7-8**: State/Province-level clusters (precision 5)\n- **Zoom 9-10**: Metropolitan-level clusters (precision 8)\n- **Zoom 11-12**: City-level clusters (precision 12)\n- **Zoom 13-14**: District-level clusters (precision 16)\n- **Zoom 15+**: Street-level clusters (precision 20)\n\n**Center Calculation:**\nUses the largest cluster method to find the area with the most listings and centers the map on it.\n\n**Performance Features:**\n- Server-side clustering reduces data transfer\n- Only one API call per map movement\n- Cluster limit reduced to 100 for better distribution\n        `\n      }\n    }\n  }\n}',...Part1_BasicListings.parameters?.docs?.source},description:{story:"**Part 1: Basic Map Listings Display**\n\nThis example shows the core functionality of displaying clustered real estate\nlistings on a map. Different API keys will show different datasets.\n\n**Try this:**\n1. Notice the large cluster numbers (hundreds/thousands of properties)\n2. Click any cluster to zoom in and see it break into smaller sub-clusters\n3. Continue drilling down until you reach individual blue property dots\n4. Click individual properties to see basic listing details\n5. Watch the property count update in the top-right corner",...Part1_BasicListings.parameters?.docs?.description}}},Part2_LargestClusterCenter.parameters={...Part2_LargestClusterCenter.parameters,docs:{...Part2_LargestClusterCenter.parameters?.docs,source:{originalSource:'{\n  args: {\n    apiKey: SAMPLE_API_KEY,\n    mapboxToken: SAMPLE_MAPBOX_TOKEN,\n    initialZoom: 10,\n    height: "100vh",\n    width: "100vw",\n    mapStyle: "mapbox://styles/mapbox/streets-v12"\n  },\n  parameters: {\n    docs: {\n      description: {\n        story: `\n🏆 **Largest Cluster Center Calculation**\n\nThis method finds the largest cluster of listings and centers the map on it for optimal viewing.\n\n**How it works:**\n- Calls the clustering API with low precision to get the biggest clusters\n- Identifies the cluster with the highest number of listings\n- Centers the map on that cluster\'s location\n\n**Best for:**\n- Focusing on the most active area in your dataset\n- Automatic centering on the densest listing concentration\n- Quick identification of market hotspots\n\n**Console output:** \\`🏆 Largest cluster: 24938 listings at [-79.3832, 43.6532]\\`\n        `\n      }\n    }\n  }\n}',...Part2_LargestClusterCenter.parameters?.docs?.source},description:{story:"**Part 2: Largest Cluster Center Calculation**\n\nThis example demonstrates the largest cluster center calculation method, which\nfinds the cluster with the most listings and centers the map on it.\nThis provides optimal viewing of the most active areas.",...Part2_LargestClusterCenter.parameters?.docs?.description}}},Part3_MapStyles.parameters={...Part3_MapStyles.parameters,docs:{...Part3_MapStyles.parameters?.docs,source:{originalSource:'{\n  args: {\n    apiKey: SAMPLE_API_KEY,\n    mapboxToken: SAMPLE_MAPBOX_TOKEN,\n    initialZoom: 10,\n    height: "100vh",\n    width: "100vw",\n    mapStyle: "mapbox://styles/mapbox/dark-v11"\n  },\n  parameters: {\n    docs: {\n      description: {\n        story: `\n🎨 **Map Style Customization**\n\nThis example showcases the dark theme map style, demonstrating how you can customize\nthe visual appearance of your MapListings component.\n\n**Available styles:**\n- \\`mapbox://styles/mapbox/streets-v12\\` - Default streets view\n- \\`mapbox://styles/mapbox/light-v11\\` - Light theme\n- \\`mapbox://styles/mapbox/dark-v11\\` - Dark theme (shown here)\n- \\`mapbox://styles/mapbox/satellite-v9\\` - Satellite imagery\n- \\`mapbox://styles/mapbox/satellite-streets-v12\\` - Satellite with street labels\n\n**Best for:**\n- Matching your application\'s design theme\n- Providing user choice for map appearance\n- Better visibility in different lighting conditions\n\n**Note:** The clustering and listing functionality remains the same across all styles.\n        `\n      }\n    }\n  }\n}',...Part3_MapStyles.parameters?.docs?.source},description:{story:"**Part 3: Different Map Styles**\n\nThis example demonstrates different map styles available with the MapListings component.\nYou can choose from various MapBox styles to match your application's design.",...Part3_MapStyles.parameters?.docs?.description}}},Part4_FilteredSearch.parameters={...Part4_FilteredSearch.parameters,docs:{...Part4_FilteredSearch.parameters?.docs,source:{originalSource:'{\n  args: {\n    apiKey: SAMPLE_API_KEY,\n    mapboxToken: SAMPLE_MAPBOX_TOKEN,\n    initialCenter: [-98.5795, 39.8283],\n    // Continental USA center\n    initialZoom: 4,\n    height: "100vh",\n    width: "100vw",\n    mapStyle: "mapbox://styles/mapbox/streets-v12"\n    // Note: These are placeholder props for future filter implementation\n    // minBedrooms: 2,\n    // maxPrice: 800000,\n    // propertyTypes: [\'residential\', \'condo\']\n  },\n  parameters: {\n    docs: {\n      disable: true // Hide from docs\n    }\n  }\n}',...Part4_FilteredSearch.parameters?.docs?.source},description:{story:"**Part 4: Custom Filters and Multi-Query Setup**\n\nThis placeholder demonstrates how the component could be extended with\nproperty filters (bedrooms, bathrooms, price range) and multi-query\nfunctionality for complex search scenarios.",...Part4_FilteredSearch.parameters?.docs?.description}}}}}]);